<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>è·Ÿç€åšä¸€ä¸ªJSONè§£æå™¨ï¼ˆäº”ï¼‰ | AYu</title>
  <meta name="author" content="AYu">
  
  <meta name="description" content="å­¦ä¹ ç”Ÿæ´»ç‰‡æ®µè®°å½•">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="è·Ÿç€åšä¸€ä¸ªJSONè§£æå™¨ï¼ˆäº”ï¼‰"/>
  <meta property="og:site_name" content="AYu"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.ico" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-70812759-1', 'auto');
  ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?cb5448498d7169c668b07c2b255d62c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<meta name="generator" content="Hexo 5.0.2"><link rel="alternate" href="atom.xml" title="AYu" type="application/atom+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">AYu</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archive" title="All the articles.">
			  <i class=""></i>Archive
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> è·Ÿç€åšä¸€ä¸ªJSONè§£æå™¨ï¼ˆäº”ï¼‰</h1>
		</div>
	


<script src='//unpkg.com/valine/dist/Valine.min.js'></script>

<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p>è·Ÿç€githubä¸Šçš„é¡¹ç›®json-tutorialå®Œæˆä¸€ä¸ªjsonè§£æå™¨ã€‚æœ¬æ–‡å¯¹åº”è¯¥é¡¹ç›®çš„ç¬¬å››å•å…ƒï¼Œé‡ç‚¹åœ¨è§£æ\uXXXXç±»å‹çš„å­—ç¬¦ä¸²ã€‚<a id="more"></a></p>
<p>ğŸ‘‰<a target="_blank" rel="noopener" href="https://github.com/miloyip/json-tutorial">åŸé¡¹ç›®åœ°å€</a></p>
<h1 id="ä¸€ã€JSONæ•°ç»„"><a href="#ä¸€ã€JSONæ•°ç»„" class="headerlink" title="ä¸€ã€JSONæ•°ç»„"></a>ä¸€ã€JSONæ•°ç»„</h1><p>ä¸€ä¸ª JSON æ•°ç»„å¯ä»¥åŒ…å«é›¶è‡³å¤šä¸ªå…ƒç´ ï¼Œè€Œè¿™äº›å…ƒç´ ä¹Ÿå¯ä»¥æ˜¯æ•°ç»„ç±»å‹ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è¡¨ç¤ºåµŒå¥—ï¼ˆnestedï¼‰çš„æ•°æ®ç»“æ„ã€‚å…ˆæ¥çœ‹çœ‹ JSON æ•°ç»„çš„è¯­æ³•ï¼š</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span> = <span class="meta">%x5B</span> ws [ <span class="keyword">value</span> *( ws <span class="meta">%x2C</span> ws <span class="keyword">value</span> ) ] ws <span class="meta">%x5D</span></span><br></pre></td></tr></table></figure>

<p>å½“ä¸­ï¼Œ<code>%x5B</code> æ˜¯å·¦ä¸­æ‹¬å· <code>[</code>ï¼Œ<code>%x2C</code> æ˜¯é€—å· <code>,</code>ï¼Œ<code>%x5D</code> æ˜¯å³ä¸­æ‹¬å· <code>]</code> ï¼Œ<code>ws</code> æ˜¯ç©ºç™½å­—ç¬¦ã€‚ä¸€ä¸ªæ•°ç»„å¯ä»¥åŒ…å«é›¶è‡³å¤šä¸ªå€¼ï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ <code>[]</code>ã€<code>[1,2,true]</code>ã€<code>[[1,2],[3,4],&quot;abc&quot;]</code> éƒ½æ˜¯åˆæ³•çš„æ•°ç»„ã€‚ä½†æ³¨æ„ JSON ä¸æ¥å—æœ«ç«¯é¢å¤–çš„é€—å·ï¼Œä¾‹å¦‚ <code>[1,2,]</code> æ˜¯ä¸åˆæ³•çš„ï¼ˆè®¸å¤šç¼–ç¨‹è¯­è¨€å¦‚ C/C++ã€Javascriptã€Javaã€C# éƒ½å®¹è®¸æ•°ç»„åˆå§‹å€¼åŒ…å«æœ«ç«¯é€—å·ï¼‰ã€‚</p>
<p>JSON æ•°ç»„çš„è¯­æ³•å¾ˆç®€å•ï¼Œå®ç°çš„éš¾ç‚¹ä¸åœ¨è¯­æ³•ä¸Šï¼Œè€Œæ˜¯æ€æ ·ç®¡ç†å†…å­˜ã€‚</p>
<h1 id="äºŒã€æ•°æ®ç»“æ„"><a href="#äºŒã€æ•°æ®ç»“æ„" class="headerlink" title="äºŒã€æ•°æ®ç»“æ„"></a>äºŒã€æ•°æ®ç»“æ„</h1><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è®¾è®¡å­˜å‚¨ JSON æ•°ç»„ç±»å‹çš„æ•°æ®ç»“æ„ã€‚</p>
<p>JSON æ•°ç»„å­˜å‚¨é›¶è‡³å¤šä¸ªå…ƒç´ ï¼Œæœ€ç®€å•å°±æ˜¯ä½¿ç”¨ C è¯­è¨€çš„æ•°ç»„ã€‚æ•°ç»„æœ€å¤§çš„å¥½å¤„æ˜¯èƒ½ä»¥ O(1) ç”¨ç´¢å¼•è®¿é—®ä»»æ„å…ƒç´ ï¼Œæ¬¡è¦å¥½å¤„æ˜¯å†…å­˜å¸ƒå±€ç´§å‡‘ï¼Œçœå†…å­˜ä¹‹ä½™è¿˜æœ‰é«˜ç¼“å­˜ä¸€è‡´æ€§ï¼ˆcache coherenceï¼‰ã€‚ä½†æ•°ç»„çš„ç¼ºç‚¹æ˜¯ä¸èƒ½å¿«é€Ÿæ’å…¥å…ƒç´ ï¼Œè€Œä¸”æˆ‘ä»¬åœ¨è§£æ JSON æ•°ç»„çš„æ—¶å€™ï¼Œè¿˜ä¸çŸ¥é“åº”è¯¥åˆ†é…å¤šå¤§çš„æ•°ç»„æ‰åˆé€‚ã€‚</p>
<p>å¦ä¸€ä¸ªé€‰æ‹©æ˜¯é“¾è¡¨ï¼ˆlinked listï¼‰ï¼Œå®ƒçš„æœ€å¤§ä¼˜ç‚¹æ˜¯å¯å¿«é€Ÿåœ°æ’å…¥å…ƒç´ ï¼ˆå¼€ç«¯ã€æœ«ç«¯æˆ–ä¸­é—´ï¼‰ï¼Œä½†éœ€è¦ä»¥ O(n) æ—¶é—´å»ç»ç´¢å¼•å–å¾—å†…å®¹ã€‚å¦‚æœæˆ‘ä»¬åªéœ€é¡ºåºéå†ï¼Œé‚£ä¹ˆæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚è¿˜æœ‰ä¸€ä¸ªå°ç¼ºç‚¹ï¼Œå°±æ˜¯ç›¸å¯¹æ•°ç»„è€Œè¨€ï¼Œé“¾è¡¨åœ¨å­˜å‚¨æ¯ä¸ªå…ƒç´ æ—¶æœ‰é¢å¤–å†…å­˜å¼€é”€ï¼ˆå­˜å‚¨ä¸‹ä¸€èŠ‚ç‚¹çš„æŒ‡é’ˆï¼‰ï¼Œè€Œä¸”éå†æ—¶å…ƒç´ æ‰€åœ¨çš„å†…å­˜å¯èƒ½ä¸è¿ç»­ï¼Œä»¤ç¼“å­˜ä¸å‘½ä¸­ï¼ˆcache missï¼‰çš„æœºä¼šä¸Šå‡ã€‚</p>
<p>æˆ‘è§è¿‡ä¸€äº› JSON åº“é€‰æ‹©äº†é“¾è¡¨ï¼Œè€Œè¿™é‡Œåˆ™é€‰æ‹©äº†æ•°ç»„ã€‚æˆ‘ä»¬å°†ä¼šé€šè¿‡ä¹‹å‰åœ¨è§£æå­—ç¬¦ä¸²æ—¶å®ç°çš„å †æ ˆï¼Œæ¥è§£å†³è§£æ JSON æ•°ç»„æ—¶æœªçŸ¥æ•°ç»„å¤§å°çš„é—®é¢˜ã€‚</p>
<p>å†³å®šä¹‹åï¼Œæˆ‘ä»¬åœ¨ <code>lept_value</code> çš„ <code>union</code> ä¸­åŠ å…¥æ•°ç»„çš„ç»“æ„ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">lept_value</span> <span class="title">lept_value</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">lept_value</span> &#123;</span></span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> &#123;</span> lept_value* e; <span class="keyword">size_t</span> size; &#125;a; <span class="comment">/* array */</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> &#123;</span> <span class="keyword">char</span>* s; <span class="keyword">size_t</span> len; &#125;s;</span><br><span class="line">        <span class="keyword">double</span> n;</span><br><span class="line">    &#125;u;</span><br><span class="line">    lept_type type;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç”±äº <code>lept_value</code> å†…ä½¿ç”¨äº†è‡ªèº«ç±»å‹çš„æŒ‡é’ˆï¼Œæˆ‘ä»¬å¿…é¡»å‰å‘å£°æ˜ï¼ˆforward declareï¼‰æ­¤ç±»å‹ã€‚</p>
<p>å¦å¤–ï¼Œæ³¨æ„è¿™é‡Œ <code>size</code> æ˜¯å…ƒç´ çš„ä¸ªæ•°ï¼Œä¸æ˜¯å­—èŠ‚å•ä½ã€‚æˆ‘ä»¬å¢åŠ ä¸¤ä¸ª API å»è®¿é—® JSON æ•°ç»„ç±»å‹çš„å€¼ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">lept_get_array_size</span><span class="params">(<span class="keyword">const</span> lept_value* v)</span> </span>&#123;</span><br><span class="line">    assert(v != <span class="literal">NULL</span> &amp;&amp; v-&gt;type == LEPT_ARRAY);</span><br><span class="line">    <span class="keyword">return</span> v-&gt;u.a.size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">lept_value* <span class="title">lept_get_array_element</span><span class="params">(<span class="keyword">const</span> lept_value* v, <span class="keyword">size_t</span> index)</span> </span>&#123;</span><br><span class="line">    assert(v != <span class="literal">NULL</span> &amp;&amp; v-&gt;type == LEPT_ARRAY);</span><br><span class="line">    assert(index &lt; v-&gt;u.a.size);</span><br><span class="line">    <span class="keyword">return</span> &amp;v-&gt;u.a.e[index];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æš‚æ—¶æˆ‘ä»¬ä¸è€ƒè™‘å¢åˆ æ•°ç»„å…ƒç´ ï¼Œè¿™äº›åŠŸèƒ½ç•™å¾…ç¬¬å…«å•å…ƒè®¨è®ºã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•å»è¯•ç”¨è¿™äº› APIï¼ˆç»ƒä¹ éœ€è¦æ›´å¤šæµ‹è¯•ï¼‰ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(_MSC_VER)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXPECT_EQ_SIZE_T(expect, actual) EXPECT_EQ_BASE((expect) == (actual), (size_t)expect, (size_t)actual, <span class="meta-string">&quot;%Iu&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXPECT_EQ_SIZE_T(expect, actual) EXPECT_EQ_BASE((expect) == (actual), (size_t)expect, (size_t)actual, <span class="meta-string">&quot;%zu&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test_parse_array</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    lept_value v;</span><br><span class="line"></span><br><span class="line">    lept_init(&amp;v);</span><br><span class="line">    EXPECT_EQ_INT(LEPT_PARSE_OK, lept_parse(&amp;v, <span class="string">&quot;[ ]&quot;</span>));</span><br><span class="line">    EXPECT_EQ_INT(LEPT_ARRAY, lept_get_type(&amp;v));</span><br><span class="line">    EXPECT_EQ_SIZE_T(<span class="number">0</span>, lept_get_array_size(&amp;v));</span><br><span class="line">    lept_free(&amp;v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¹‹å‰çš„å•å…ƒä¸­ï¼Œä½œè€…å·²å¤šæ¬¡é‡ç”³ï¼ŒC è¯­è¨€çš„æ•°ç»„å¤§å°åº”è¯¥ä½¿ç”¨ <code>size_t</code> ç±»å‹ã€‚å› ä¸ºæˆ‘ä»¬è¦éªŒè¯ <code>lept_get_array_size()</code> è¿”å›å€¼æ˜¯å¦æ­£ç¡®ï¼Œæ‰€ä»¥å†ä¸ºå•å…ƒæµ‹è¯•æ¡†æ¶æ·»åŠ ä¸€ä¸ªå® <code>EXPECT_EQ_SIZE_T</code>ã€‚éº»çƒ¦ä¹‹å¤„åœ¨äºï¼ŒANSI Cï¼ˆC89ï¼‰å¹¶æ²¡æœ‰çš„ <code>size_t</code> æ‰“å°æ–¹æ³•ï¼Œåœ¨ C99 åˆ™åŠ å…¥äº† <code>&quot;%zu&quot;</code>ï¼Œä½† VS2015 ä¸­æ‰æœ‰ï¼Œä¹‹å‰çš„ VC ç‰ˆæœ¬ä½¿ç”¨éæ ‡å‡†çš„ <code>&quot;%Iu&quot;</code>ã€‚å› æ­¤ï¼Œä¸Šé¢çš„ä»£ç ä½¿ç”¨æ¡ä»¶ç¼–è¯‘å»åŒºåˆ† VC å’Œå…¶ä»–ç¼–è¯‘å™¨ã€‚è™½ç„¶è¿™éƒ¨åˆ†ä¸è·¨å¹³å°ä¹Ÿä¸æ˜¯ ANSI C æ ‡å‡†ï¼Œä½†å®ƒåªåœ¨æµ‹è¯•ç¨‹åºä¸­ï¼Œä¸å¤ªå½±å“ç¨‹åºåº“çš„è·¨å¹³å°æ€§ã€‚</p>
<h1 id="ä¸‰ã€è§£æè¿‡ç¨‹"><a href="#ä¸‰ã€è§£æè¿‡ç¨‹" class="headerlink" title="ä¸‰ã€è§£æè¿‡ç¨‹"></a>ä¸‰ã€è§£æè¿‡ç¨‹</h1><p>æˆ‘ä»¬åœ¨è§£æ JSON å­—ç¬¦ä¸²æ—¶ï¼Œå› ä¸ºåœ¨å¼€å§‹æ—¶ä¸èƒ½çŸ¥é“å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè€Œåˆéœ€è¦è¿›è¡Œè½¬ä¹‰ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªä¸´æ—¶ç¼“å†²åŒºå»å­˜å‚¨è§£æåçš„ç»“æœã€‚æˆ‘ä»¬ä¸ºæ­¤å®ç°äº†ä¸€ä¸ªåŠ¨æ€å¢é•¿çš„å †æ ˆï¼Œå¯ä»¥ä¸æ–­å‹å…¥å­—ç¬¦ï¼Œæœ€åä¸€æ¬¡æ€§æŠŠæ•´ä¸ªå­—ç¬¦ä¸²å¼¹å‡ºï¼Œå¤åˆ¶è‡³æ–°åˆ†é…çš„å†…å­˜ä¹‹ä¸­ã€‚</p>
<p>å¯¹äº JSON æ•°ç»„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ç›¸åŒçš„æ–¹æ³•ï¼Œè€Œä¸”ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åŒä¸€ä¸ªå †æ ˆï¼æˆ‘ä»¬åªéœ€è¦æŠŠæ¯ä¸ªè§£æå¥½çš„å…ƒç´ å‹å…¥å †æ ˆï¼Œè§£æåˆ°æ•°ç»„ç»“æŸæ—¶ï¼Œå†ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰å…ƒç´ å¼¹å‡ºï¼Œå¤åˆ¶è‡³æ–°åˆ†é…çš„å†…å­˜ä¹‹ä¸­ã€‚</p>
<p>ä½†å’Œå­—ç¬¦ä¸²æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œå¦‚æœæŠŠ JSON å½“ä½œä¸€æ£µæ ‘çš„æ•°æ®ç»“æ„ï¼ŒJSON å­—ç¬¦ä¸²æ˜¯å¶èŠ‚ç‚¹ï¼Œè€Œ JSON æ•°ç»„æ˜¯ä¸­é—´èŠ‚ç‚¹ã€‚åœ¨å¶èŠ‚ç‚¹çš„è§£æå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æ€æ ·ä½¿ç”¨é‚£ä¸ªå †æ ˆä¹Ÿå¯ä»¥ï¼Œåªè¦æœ€åè¿˜åŸå°±å¥½äº†ã€‚ä½†å¯¹äºæ•°ç»„è¿™æ ·çš„ä¸­é—´èŠ‚ç‚¹ï¼Œå…±ç”¨è¿™ä¸ªå †æ ˆæ²¡é—®é¢˜ä¹ˆï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ï¼šåªè¦åœ¨è§£æå‡½æ•°ç»“æŸæ—¶è¿˜åŸå †æ ˆçš„çŠ¶æ€ï¼Œå°±æ²¡æœ‰é—®é¢˜ã€‚ä¸ºäº†ç›´è§‚åœ°äº†è§£è¿™ä¸ªè§£æè¿‡ç¨‹ï¼Œæˆ‘ä»¬ç”¨è¿ç¯å›¾å»å±•ç¤º <code>[&quot;abc&quot;,[1,2],3]</code> çš„è§£æè¿‡ç¨‹ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬é‡åˆ° <code>[</code>ï¼Œè¿›å…¥ <code>lept_parse_array()</code>ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://github.com/miloyip/json-tutorial/blob/master/tutorial05/images/parse_array01.png"><img src="/2021/Make-a-JSON-parser-5/parse_array01.png" alt=" "></a></p>
<p>ç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„ <code>lept_value</code>ï¼Œç”¨äºå­˜å‚¨ä¹‹åçš„å…ƒç´ ã€‚æˆ‘ä»¬å†è°ƒç”¨ <code>lept_parse_value()</code> å»è§£æè¿™ä¸ªå…ƒç´ å€¼ï¼Œå› ä¸ºé‡åˆ° <code>&quot;</code> è¿›å…¥ <code>lept_parse_string()</code>ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://github.com/miloyip/json-tutorial/blob/master/tutorial05/images/parse_array02.png"><img src="/2021/Make-a-JSON-parser-5/parse_array02.png" alt=" "></a></p>
<p>åœ¨ <code>lept_parse_string()</code> ä¸­ï¼Œä¸æ–­è§£æå­—ç¬¦ç›´è‡³é‡åˆ° <code>&quot;</code>ï¼Œè¿‡ç¨‹ä¸­æŠŠæ¯ä¸ªå­—ç¬¦å‹æ ˆï¼š</p>
<p><a target="_blank" rel="noopener" href="https://github.com/miloyip/json-tutorial/blob/master/tutorial05/images/parse_array03.png"><img src="https://github.com/miloyip/json-tutorial/raw/master/tutorial05/images/parse_array03.png" alt=" "></a></p>
<p>æœ€ååœ¨ <code>lept_parse_string()</code> ä¸­ï¼ŒæŠŠæ ˆä¸Š 3 ä¸ªå­—ç¬¦å¼¹å‡ºï¼Œåˆ†é…å†…å­˜ï¼Œç”Ÿæˆå­—ç¬¦ä¸²å€¼ï¼š</p>
<p><img src="/2021/Make-a-JSON-parser-5/parse_array04.png" alt=" "></p>
<p>è¿”å›ä¸Šä¸€å±‚ <code>lept_parse_array()</code>ï¼ŒæŠŠä¸´æ—¶å…ƒç´ å‹æ ˆï¼š</p>
<p><img src="/2021/Make-a-JSON-parser-5/parse_array05.png"></p>
<p>ç„¶åæˆ‘ä»¬å†é‡åˆ° <code>[</code>ï¼Œè¿›å…¥å¦ä¸€ä¸ª <code>lept_parse_array()</code>ã€‚å®ƒå‘ç°ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ•°å­—ç±»å‹ï¼Œæ‰€è®¤è°ƒç”¨ <code>lept_parse_number()</code>ï¼Œç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„å…ƒç´ å€¼ï¼š</p>
<p><img src="https://github.com/miloyip/json-tutorial/raw/master/tutorial05/images/parse_array06.png"></p>
<p>ä¹‹åæŠŠè¯¥ä¸´æ—¶çš„å…ƒç´ å€¼å‹æ ˆï¼š</p>
<p><a target="_blank" rel="noopener" href="https://github.com/miloyip/json-tutorial/blob/master/tutorial05/images/parse_array07.png"><img src="https://github.com/miloyip/json-tutorial/raw/master/tutorial05/images/parse_array07.png" alt=" "></a></p>
<p>æ¥ç€å†è§£æç¬¬äºŒä¸ªå…ƒç´ ã€‚æˆ‘ä»¬é‡åˆ°äº† <code>]</code>ï¼Œä»æ ˆä¸Šå¼¹å‡º 2 ä¸ªå…ƒç´ ï¼Œåˆ†é…å†…å­˜ï¼Œç”Ÿæˆæ•°ç»„ï¼ˆè™šçº¿ä»£è¡¨æ˜¯è¿ç»­çš„å†…å­˜ï¼‰ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://github.com/miloyip/json-tutorial/blob/master/tutorial05/images/parse_array08.png"><img src="/2021/Make-a-JSON-parser-5/parse_array08.png" alt=" "></a></p>
<p>é‚£ä¸ªæ•°ç»„æ˜¯ä¸Šå±‚æ•°ç»„çš„å…ƒç´ ï¼Œæˆ‘ä»¬æŠŠå®ƒå‹æ ˆã€‚ç°æ—¶æ ˆå†…å·²æœ‰ä¸¤ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬å†ç»§ç»­è§£æä¸‹ä¸€ä¸ªå…ƒç´ ï¼š</p>
<p><img src="/2021/Make-a-JSON-parser-5/parse_array09.png" alt=" "></p>
<p>æœ€åï¼Œé‡åˆ°äº† <code>]</code>ï¼Œå¯ä»¥å¼¹å‡ºæ ˆå†… 3 ä¸ªå…ƒç´ ï¼Œåˆ†é…å†…å­˜ï¼Œç”Ÿæˆæ•°ç»„ï¼š</p>
<p><img src="/2021/Make-a-JSON-parser-5/parse_array10.png"></p>
<h1 id="å››ã€å®ç°"><a href="#å››ã€å®ç°" class="headerlink" title="å››ã€å®ç°"></a>å››ã€å®ç°</h1><p>ç»è¿‡è¿™ä¸ªè¯¦ç»†çš„å›¾è§£ï¼Œå®ç° <code>lept_parse_array()</code> åº”è¯¥æ²¡æœ‰éš¾åº¦ã€‚ä»¥ä¸‹æ˜¯åŠåˆ¶æˆå“ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lept_parse_value</span><span class="params">(lept_context* c, lept_value* v)</span></span>; <span class="comment">/* å‰å‘å£°æ˜ */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lept_parse_array</span><span class="params">(lept_context* c, lept_value* v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">size_t</span> size = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line">    EXPECT(c, <span class="string">&#x27;[&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (*c-&gt;json == <span class="string">&#x27;]&#x27;</span>) &#123;</span><br><span class="line">        c-&gt;json++;</span><br><span class="line">        v-&gt;type = LEPT_ARRAY;</span><br><span class="line">        v-&gt;u.a.size = <span class="number">0</span>;</span><br><span class="line">        v-&gt;u.a.e = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">return</span> LEPT_PARSE_OK;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        lept_value e;</span><br><span class="line">        lept_init(&amp;e);</span><br><span class="line">        <span class="keyword">if</span> ((ret = lept_parse_value(c, &amp;e)) != LEPT_PARSE_OK)</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        <span class="built_in">memcpy</span>(lept_context_push(c, <span class="keyword">sizeof</span>(lept_value)), &amp;e, <span class="keyword">sizeof</span>(lept_value));</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">if</span> (*c-&gt;json == <span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">            c-&gt;json++;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (*c-&gt;json == <span class="string">&#x27;]&#x27;</span>) &#123;</span><br><span class="line">            c-&gt;json++;</span><br><span class="line">            v-&gt;type = LEPT_ARRAY;</span><br><span class="line">            v-&gt;u.a.size = size;</span><br><span class="line">            size *= <span class="keyword">sizeof</span>(lept_value);</span><br><span class="line">            <span class="built_in">memcpy</span>(v-&gt;u.a.e = (lept_value*)<span class="built_in">malloc</span>(size), lept_context_pop(c, size), size);</span><br><span class="line">            <span class="keyword">return</span> LEPT_PARSE_OK;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> LEPT_PARSE_MISS_COMMA_OR_SQUARE_BRACKET;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lept_parse_value</span><span class="params">(lept_context* c, lept_value* v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (*c-&gt;json) &#123;</span><br><span class="line">        <span class="comment">/* ... */</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;[&#x27;</span>:  <span class="keyword">return</span> lept_parse_array(c, v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç®€å•è¯´æ˜çš„è¯ï¼Œå°±æ˜¯åœ¨å¾ªç¯ä¸­å»ºç«‹ä¸€ä¸ªä¸´æ—¶å€¼ï¼ˆ<code>lept_value e</code>ï¼‰ï¼Œç„¶åè°ƒç”¨ <code>lept_parse_value()</code> å»æŠŠå…ƒç´ è§£æè‡³è¿™ä¸ªä¸´æ—¶å€¼ï¼Œå®ŒæˆåæŠŠä¸´æ—¶å€¼å‹æ ˆã€‚å½“é‡åˆ° <code>]</code>ï¼ŒæŠŠæ ˆå†…çš„å…ƒç´ å¼¹å‡ºï¼Œåˆ†é…å†…å­˜ï¼Œç”Ÿæˆæ•°ç»„å€¼ã€‚</p>
<p>æ³¨æ„åˆ°ï¼Œ<code>lept_parse_value()</code> ä¼šè°ƒç”¨ <code>lept_parse_array()</code>ï¼Œè€Œ <code>lept_parse_array()</code> åˆä¼šè°ƒç”¨ <code>lept_parse_value()</code>ï¼Œ<u>è¿™æ˜¯äº’ç›¸å¼•ç”¨ï¼Œæ‰€ä»¥å¿…é¡»è¦åŠ å…¥å‡½æ•°å‰å‘å£°æ˜</u>ã€‚</p>
<p>æœ€åï¼Œæˆ‘æƒ³å‘Šè¯‰åŒå­¦ï¼Œå®ç°è¿™ä¸ªå‡½æ•°æ—¶ï¼Œæˆ‘æ›¾ç»åˆ¶é€ ä¸€ä¸ªä¸æ˜æ˜¾çš„ bugã€‚è¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ª <code>memcpy()</code>ï¼Œç¬¬ä¸€ä¸ªã€Œä¼¼ä¹ã€æ˜¯å¯ä»¥é¿å…çš„ï¼Œå…ˆå‹æ ˆå–å¾—å…ƒç´ çš„æŒ‡é’ˆï¼Œç»™ <code>lept_parse_value</code>ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (;;) &#123;</span><br><span class="line">    <span class="comment">/* bug! */</span></span><br><span class="line">    lept_value* e = lept_context_push(c, <span class="keyword">sizeof</span>(lept_value));</span><br><span class="line">    lept_init(e);</span><br><span class="line">    size++;</span><br><span class="line">    <span class="keyword">if</span> ((ret = lept_parse_value(c, e)) != LEPT_PARSE_OK)</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§å†™æ³•ä¸ºä»€ä¹ˆä¼šæœ‰ bugï¼Ÿè¿™æ˜¯ç¬¬ 5 æ¡ç»ƒä¹ é¢˜ã€‚</p>
<h1 id="äº”ã€æ€»ç»“ä¸ç»ƒä¹ ç­”æ¡ˆ"><a href="#äº”ã€æ€»ç»“ä¸ç»ƒä¹ ç­”æ¡ˆ" class="headerlink" title="äº”ã€æ€»ç»“ä¸ç»ƒä¹ ç­”æ¡ˆ"></a>äº”ã€æ€»ç»“ä¸ç»ƒä¹ ç­”æ¡ˆ</h1><ol>
<li>ç¼–å†™ <code>test_parse_array()</code> å•å…ƒæµ‹è¯•ï¼Œè§£æä»¥ä¸‹ 2 ä¸ª JSONã€‚ç”±äºæ•°ç»„æ˜¯å¤åˆçš„ç±»å‹ï¼Œä¸èƒ½ä½¿ç”¨ä¸€ä¸ªå®å»æµ‹è¯•ç»“æœï¼Œè¯·ä½¿ç”¨å„ä¸ª API æ£€æŸ¥è§£æåçš„å†…å®¹ã€‚</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="literal">null</span> , <span class="literal">false</span> , <span class="literal">true</span> , <span class="number">123</span> , <span class="string">&quot;abc&quot;</span> ]</span><br><span class="line">[ [ ] , [ <span class="number">0</span> ] , [ <span class="number">0</span> , <span class="number">1</span> ] , [ <span class="number">0</span> , <span class="number">1</span> , <span class="number">2</span> ] ]</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç»ƒä¹ çº¯ç²¹ä¸ºäº†ç†Ÿä¹ æ•°ç»„çš„è®¿é—® APIã€‚æ–°å¢çš„ç¬¬ä¸€ä¸ª JSON åªéœ€å¹³å‡¡çš„æ£€æµ‹ã€‚ç¬¬äºŒä¸ª JSON æœ‰ç‰¹å®šæ¨¡å¼ï¼Œç¬¬ i ä¸ªå­æ•°ç»„çš„é•¿åº¦ä¸º iï¼Œæ¯ä¸ªå­æ•°ç»„çš„ç¬¬ j ä¸ªå…ƒç´ æ˜¯æ•°å­—å€¼ jï¼Œæ‰€ä»¥å¯ç”¨ä¸¤å±‚ for å¾ªç¯æµ‹è¯•ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test_parse_array</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">size_t</span> i, j;</span><br><span class="line">    lept_value v;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line"></span><br><span class="line">    lept_init(&amp;v);</span><br><span class="line">    EXPECT_EQ_INT(LEPT_PARSE_OK, lept_parse(&amp;v, <span class="string">&quot;[ null , false , true , 123 , \&quot;abc\&quot; ]&quot;</span>));</span><br><span class="line">    EXPECT_EQ_INT(LEPT_ARRAY, lept_get_type(&amp;v));</span><br><span class="line">    EXPECT_EQ_SIZE_T(<span class="number">5</span>, lept_get_array_size(&amp;v));</span><br><span class="line">    EXPECT_EQ_INT(LEPT_NULL,   lept_get_type(lept_get_array_element(&amp;v, <span class="number">0</span>)));</span><br><span class="line">    EXPECT_EQ_INT(LEPT_FALSE,  lept_get_type(lept_get_array_element(&amp;v, <span class="number">1</span>)));</span><br><span class="line">    EXPECT_EQ_INT(LEPT_TRUE,   lept_get_type(lept_get_array_element(&amp;v, <span class="number">2</span>)));</span><br><span class="line">    EXPECT_EQ_INT(LEPT_NUMBER, lept_get_type(lept_get_array_element(&amp;v, <span class="number">3</span>)));</span><br><span class="line">    EXPECT_EQ_INT(LEPT_STRING, lept_get_type(lept_get_array_element(&amp;v, <span class="number">4</span>)));</span><br><span class="line">    EXPECT_EQ_DOUBLE(<span class="number">123.0</span>, lept_get_number(lept_get_array_element(&amp;v, <span class="number">3</span>)));</span><br><span class="line">    EXPECT_EQ_STRING(<span class="string">&quot;abc&quot;</span>, lept_get_string(lept_get_array_element(&amp;v, <span class="number">4</span>)), lept_get_string_length(lept_get_array_element(&amp;v, <span class="number">4</span>)));</span><br><span class="line">    lept_free(&amp;v);</span><br><span class="line"></span><br><span class="line">    lept_init(&amp;v);</span><br><span class="line">    EXPECT_EQ_INT(LEPT_PARSE_OK, lept_parse(&amp;v, <span class="string">&quot;[ [ ] , [ 0 ] , [ 0 , 1 ] , [ 0 , 1 , 2 ] ]&quot;</span>));</span><br><span class="line">    EXPECT_EQ_INT(LEPT_ARRAY, lept_get_type(&amp;v));</span><br><span class="line">    EXPECT_EQ_SIZE_T(<span class="number">4</span>, lept_get_array_size(&amp;v));</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        lept_value* a = lept_get_array_element(&amp;v, i);</span><br><span class="line">        EXPECT_EQ_INT(LEPT_ARRAY, lept_get_type(a));</span><br><span class="line">        EXPECT_EQ_SIZE_T(i, lept_get_array_size(a));</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">            lept_value* e = lept_get_array_element(a, j);</span><br><span class="line">            EXPECT_EQ_INT(LEPT_NUMBER, lept_get_type(e));</span><br><span class="line">            EXPECT_EQ_DOUBLE((<span class="keyword">double</span>)j, lept_get_number(e));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    lept_free(&amp;v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ol start="2">
<li>ç°æ—¶çš„æµ‹è¯•ç»“æœåº”è¯¥æ˜¯å¤±è´¥çš„ï¼Œå› ä¸º <code>lept_parse_array()</code> é‡Œæ²¡æœ‰å¤„ç†ç©ºç™½å­—ç¬¦ï¼ŒåŠ è¿›åˆé€‚çš„ <code>lept_parse_whitespace()</code> ä»¤æµ‹è¯•é€šè¿‡ã€‚</li>
</ol>
<p>æŒ‰ç°æ—¶çš„ <code>lept_parse_array()</code> çš„ç¼–å†™æ–¹å¼ï¼Œéœ€è¦åŠ å…¥ 3 ä¸ª <code>lept_parse_whitespace()</code> è°ƒç”¨ï¼Œåˆ†åˆ«æ˜¯è§£æ <code>[</code> ä¹‹åï¼Œå…ƒç´ ä¹‹åï¼Œä»¥åŠ <code>,</code> ä¹‹åï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lept_parse_array</span><span class="params">(lept_context* c, lept_value* v)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">    EXPECT(c, <span class="string">&#x27;[&#x27;</span>);</span><br><span class="line">    lept_parse_whitespace(c);</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="comment">/* ... */</span></span><br><span class="line">        <span class="keyword">if</span> ((ret = lept_parse_value(c, &amp;e)) != LEPT_PARSE_OK)</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        <span class="comment">/* ... */</span></span><br><span class="line">        lept_parse_whitespace(c);</span><br><span class="line">        <span class="keyword">if</span> (*c-&gt;json == <span class="string">&#x27;,&#x27;</span>) &#123;</span><br><span class="line">            c-&gt;json++;</span><br><span class="line">            lept_parse_whitespace(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* ... */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ol start="3">
<li>ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/miloyip/json-tutorial/blob/master/tutorial03_answer/tutorial03_answer.md">ç¬¬ä¸‰å•å…ƒè§£ç­”ç¯‡</a>ä»‹ç»çš„æ£€æµ‹å†…å­˜æ³„æ¼å·¥å…·ï¼Œä¼šå‘ç°æµ‹è¯•ä¸­æœ‰å†…å­˜æ³„æ¼ã€‚å¾ˆæ˜æ˜¾åœ¨ <code>lept_parse_array()</code> ä¸­ä½¿ç”¨åˆ° <code>malloc()</code> åˆ†é…å†…å­˜ï¼Œä½†å´æ²¡æœ‰å¯¹åº”çš„ <code>free()</code>ã€‚åº”è¯¥åœ¨å“ªé‡Œé‡Šæ”¾å†…å­˜ï¼Ÿä¿®æ”¹ä»£ç ï¼Œä½¿å·¥å…·ä¸å†æ£€æµ‹åˆ°ç›¸å…³çš„å†…å­˜æ³„æ¼ã€‚</li>
</ol>
<p>æˆåŠŸæµ‹è¯•é‚£ 3 ä¸ª JSON åï¼Œä½¿ç”¨å†…å­˜æ³„æ¼æ£€æµ‹å·¥å…·ä¼šå‘ç° <code>lept_parse_array()</code> ç”¨ <code>malloc()</code>åˆ†é…çš„å†…å­˜æ²¡æœ‰è¢«é‡Šæ”¾ï¼š</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">==<span class="number">154</span>== <span class="number">124</span> (<span class="number">120</span> direct, <span class="number">4</span> indirect) bytes <span class="keyword">in</span> <span class="number">1</span> blocks are definitely lost <span class="keyword">in</span> loss record <span class="number">2</span> of <span class="number">4</span></span><br><span class="line">==<span class="number">154</span>==    at <span class="number">0</span>x4C28C20: malloc (vg_replace_malloc.c:<span class="number">296</span>)</span><br><span class="line">==<span class="number">154</span>==    by <span class="number">0</span>x409D82: lept_parse_array (<span class="keyword">in</span> <span class="regexp">/json-tutorial/</span>tutorial05<span class="regexp">/build/</span>leptjson_test)</span><br><span class="line">==<span class="number">154</span>==    by <span class="number">0</span>x409E91: lept_parse_value (<span class="keyword">in</span> <span class="regexp">/json-tutorial/</span>tutorial05<span class="regexp">/build/</span>leptjson_test)</span><br><span class="line">==<span class="number">154</span>==    by <span class="number">0</span>x409F14: lept_parse (<span class="keyword">in</span> <span class="regexp">/json-tutorial/</span>tutorial05<span class="regexp">/build/</span>leptjson_test)</span><br><span class="line">==<span class="number">154</span>==    by <span class="number">0</span>x405261: test_parse_array (<span class="keyword">in</span> <span class="regexp">/json-tutorial/</span>tutorial05<span class="regexp">/build/</span>leptjson_test)</span><br><span class="line">==<span class="number">154</span>==    by <span class="number">0</span>x408C72: test_parse (<span class="keyword">in</span> <span class="regexp">/json-tutorial/</span>tutorial05<span class="regexp">/build/</span>leptjson_test)</span><br><span class="line">==<span class="number">154</span>==    by <span class="number">0</span>x40916A: main (<span class="keyword">in</span> <span class="regexp">/json-tutorial/</span>tutorial05<span class="regexp">/build/</span>leptjson_test)</span><br><span class="line">==<span class="number">154</span>== </span><br><span class="line">==<span class="number">154</span>== <span class="number">240</span> (<span class="number">96</span> direct, <span class="number">144</span> indirect) bytes <span class="keyword">in</span> <span class="number">1</span> blocks are definitely lost <span class="keyword">in</span> loss record <span class="number">4</span> of <span class="number">4</span></span><br><span class="line">==<span class="number">154</span>==    at <span class="number">0</span>x4C28C20: malloc (vg_replace_malloc.c:<span class="number">296</span>)</span><br><span class="line">==<span class="number">154</span>==    by <span class="number">0</span>x409D82: lept_parse_array (<span class="keyword">in</span> <span class="regexp">/json-tutorial/</span>tutorial05<span class="regexp">/build/</span>leptjson_test)</span><br><span class="line">==<span class="number">154</span>==    by <span class="number">0</span>x409E91: lept_parse_value (<span class="keyword">in</span> <span class="regexp">/json-tutorial/</span>tutorial05<span class="regexp">/build/</span>leptjson_test)</span><br><span class="line">==<span class="number">154</span>==    by <span class="number">0</span>x409F14: lept_parse (<span class="keyword">in</span> <span class="regexp">/json-tutorial/</span>tutorial05<span class="regexp">/build/</span>leptjson_test)</span><br><span class="line">==<span class="number">154</span>==    by <span class="number">0</span>x40582C: test_parse_array (<span class="keyword">in</span> <span class="regexp">/json-tutorial/</span>tutorial05<span class="regexp">/build/</span>leptjson_test)</span><br><span class="line">==<span class="number">154</span>==    by <span class="number">0</span>x408C72: test_parse (<span class="keyword">in</span> <span class="regexp">/json-tutorial/</span>tutorial05<span class="regexp">/build/</span>leptjson_test)</span><br><span class="line">==<span class="number">154</span>==    by <span class="number">0</span>x40916A: main (<span class="keyword">in</span> <span class="regexp">/json-tutorial/</span>tutorial05<span class="regexp">/build/</span>leptjson_test)</span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜æ˜¾ï¼Œæœ‰ <code>malloc()</code> å°±è¦æœ‰å¯¹åº”çš„ <code>free()</code>ã€‚æ­£ç¡®çš„é‡Šæ”¾ä½ç½®åº”è¯¥æ”¾ç½®åœ¨ <code>lept_free()</code>ï¼Œå½“å€¼è¢«é‡Šæ”¾æ—¶ï¼Œè¯¥å€¼æ‹¥æœ‰çš„å†…å­˜ä¹Ÿåœ¨é‚£é‡Œé‡Šæ”¾ã€‚ä¹‹å‰å­—ç¬¦ä¸²çš„é‡Šæ”¾ä¹Ÿæ˜¯æ”¾åœ¨è¿™é‡Œï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lept_free</span><span class="params">(lept_value* v)</span> </span>&#123;</span><br><span class="line">    assert(v != <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (v-&gt;type == LEPT_STRING)</span><br><span class="line">        <span class="built_in">free</span>(v-&gt;u.s.s);</span><br><span class="line">    v-&gt;type = LEPT_NULL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†å¯¹äºæ•°ç»„ï¼Œæˆ‘ä»¬åº”è¯¥å…ˆæŠŠæ•°ç»„å†…çš„å…ƒç´ é€šè¿‡é€’å½’è°ƒç”¨ <code>lept_free()</code> é‡Šæ”¾ï¼Œç„¶åæ‰é‡Šæ”¾æœ¬èº«çš„ <code>v-&gt;u.a.e</code>ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lept_free</span><span class="params">(lept_value* v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">size_t</span> i;</span><br><span class="line">    assert(v != <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">switch</span> (v-&gt;type) &#123;</span><br><span class="line">        <span class="keyword">case</span> LEPT_STRING:</span><br><span class="line">            <span class="built_in">free</span>(v-&gt;u.s.s);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LEPT_ARRAY:</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; v-&gt;u.a.size; i++)</span><br><span class="line">                lept_free(&amp;v-&gt;u.a.e[i]);</span><br><span class="line">            <span class="built_in">free</span>(v-&gt;u.a.e);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v-&gt;type = LEPT_NULL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ä¹‹åï¼Œå†è¿è¡Œå†…å­˜æ³„æ¼æ£€æµ‹å·¥å…·ï¼Œç¡®ä¿é—®é¢˜å·²è¢«ä¿®æ­£ã€‚</p>
<ol start="4">
<li>å¼€å¯ test.c ä¸­ä¸¤å¤„è¢« <code>#if 0 ... #endif</code> å…³é—­çš„æµ‹è¯•ï¼Œæœ¬æ¥ <code>lept_parse_array()</code> å·²ç»èƒ½å¤„ç†è¿™äº›æµ‹è¯•ã€‚ç„¶è€Œï¼Œè¿è¡Œæ—¶ä¼šå‘ç° <code>Assertion failed: (c.top == 0)</code> æ–­è¨€å¤±è´¥ã€‚è¿™æ˜¯ç”±äºï¼Œå½“é”™è¯¯å‘ç”Ÿæ—¶ï¼Œä»ç„¶æœ‰ä¸€äº›ä¸´æ—¶å€¼åœ¨å †æ ˆé‡Œï¼Œæ—¢æ²¡æœ‰æ”¾è¿›æ•°ç»„ï¼Œä¹Ÿæ²¡æœ‰è¢«é‡Šæ”¾ã€‚ä¿®æ”¹ <code>lept_parse_array()</code>ï¼Œå½“é‡åˆ°é”™è¯¯æ—¶ï¼Œä»å †æ ˆä¸­å¼¹å‡ºå¹¶é‡Šæ”¾é‚£äº›ä¸´æ—¶å€¼ï¼Œç„¶åæ‰è¿”å›é”™è¯¯ç ã€‚</li>
</ol>
<p>é‡åˆ°è§£æé”™è¯¯æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½åœ¨ä¹‹å‰å·²å‹å…¥äº†ä¸€äº›å€¼åœ¨è‡ªå®šä¹‰å †æ ˆä¸Šã€‚å¦‚æœæ²¡æœ‰å¤„ç†ï¼Œæœ€åä¼šåœ¨ <code>lept_parse()</code> ä¸­å‘ç°å †æ ˆä¸Šè¿˜æœ‰ä¸€äº›å€¼ï¼Œåšæˆæ–­è¨€å¤±è´¥ã€‚æ‰€ä»¥ï¼Œé‡åˆ°è§£æé”™è¯¯æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»å¼¹å‡ºå¹¶é‡Šæ”¾é‚£äº›å€¼ã€‚</p>
<p>åœ¨ <code>lept_parse_array</code> ä¸­ï¼ŒåŸæœ¬é‡åˆ°è§£æå¤±è´¥æ—¶ï¼Œä¼šç›´æ¥è¿”å›é”™è¯¯ç ã€‚æˆ‘ä»¬æŠŠå®ƒæ”¹ä¸º <code>break</code> ç¦»å¼€å¾ªç¯ï¼Œåœ¨å¾ªç¯ç»“æŸåçš„åœ°æ–¹ç”¨ <code>lept_free()</code> é‡Šæ”¾ä»å †æ ˆå¼¹å‡ºçš„å€¼ï¼Œç„¶åæ‰è¿”å›é”™è¯¯ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lept_parse_array</span><span class="params">(lept_context* c, lept_value* v)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="comment">/* ... */</span></span><br><span class="line">        <span class="keyword">if</span> ((ret = lept_parse_value(c, &amp;e)) != LEPT_PARSE_OK)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">/* ... */</span></span><br><span class="line">        <span class="keyword">if</span> (*c-&gt;json == <span class="string">&#x27;,&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">/* ... */</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (*c-&gt;json == <span class="string">&#x27;]&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">/* ... */</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            ret = LEPT_PARSE_MISS_COMMA_OR_SQUARE_BRACKET;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* Pop and free values on the stack */</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">        lept_free((lept_value*)lept_context_pop(c, <span class="keyword">sizeof</span>(lept_value)));</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ol start="5">
<li>ç¬¬ 4 èŠ‚é‚£æ®µä»£ç ä¸ºä»€ä¹ˆä¼šæœ‰ bugï¼Ÿ</li>
</ol>
<p>è¿™ä¸ª bug æºäºå‹æ ˆæ—¶ï¼Œä¼šè·å¾—ä¸€ä¸ªæŒ‡é’ˆ <code>e</code>ï¼ŒæŒ‡å‘ä»å †æ ˆåˆ†é…åˆ°çš„ç©ºé—´ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (;;) &#123;</span><br><span class="line">    <span class="comment">/* bug! */</span></span><br><span class="line">    lept_value* e = lept_context_push(c, <span class="keyword">sizeof</span>(lept_value));</span><br><span class="line">    lept_init(e);</span><br><span class="line">    size++;</span><br><span class="line">    <span class="keyword">if</span> ((ret = lept_parse_value(c, e)) != LEPT_PARSE_OK)</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæŒ‡é’ˆè°ƒç”¨ <code>lept_parse_value(c, e)</code>ï¼Œè¿™é‡Œä¼šå‡ºç°é—®é¢˜ï¼Œå› ä¸º <code>lept_parse_value()</code> åŠä¹‹ä¸‹çš„å‡½æ•°éƒ½éœ€è¦è°ƒç”¨ <code>lept_context_push()</code>ï¼Œè€Œ <code>lept_context_push()</code> åœ¨å‘ç°æ ˆæ»¡äº†çš„æ—¶å€™ä¼šç”¨ <code>realloc()</code> æ‰©å®¹ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬ä¸Šå±‚çš„ <code>e</code> å°±ä¼šå¤±æ•ˆï¼Œå˜æˆä¸€ä¸ªæ‚¬æŒ‚æŒ‡é’ˆï¼ˆdangling pointerï¼‰ï¼Œè€Œä¸” <code>lept_parse_value(c, e)</code> ä¼šé€šè¿‡è¿™ä¸ªæŒ‡é’ˆå†™å…¥è§£æç»“æœï¼Œé€ æˆéæ³•è®¿é—®ã€‚</p>
<p>åœ¨ä½¿ç”¨ C++ å®¹å™¨æ—¶ï¼Œä¹Ÿä¼šé‡åˆ°ç±»ä¼¼çš„é—®é¢˜ã€‚ä»å®¹å™¨ä¸­å–å¾—çš„è¿­ä»£å™¨ï¼ˆiteratorï¼‰åï¼Œå¦‚æœæ”¹åŠ¨å®¹å™¨å†…å®¹ï¼Œä¹‹å‰çš„è¿­ä»£å™¨ä¼šå¤±æ•ˆã€‚è¿™é‡Œçš„æ‚¬æŒ‚æŒ‡é’ˆé—®é¢˜ä¹Ÿæ˜¯ç›¸åŒçš„ã€‚</p>
<p>ä½†è¿™ç§ bug æœ‰æ—¶å¯èƒ½åœ¨ç®€å•æµ‹è¯•ä¸­ä¸èƒ½è‡ªåŠ¨å‘ç°ï¼Œå› ä¸ºé—®é¢˜åªæœ‰å †æ ˆæ»¡äº†æ‰ä¼šå‡ºç°ã€‚ä»æµ‹è¯•çš„è§’åº¦çœ‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›å‹åŠ›æµ‹è¯•ï¼ˆstress testï¼‰ï¼Œæµ‹è¯•æ›´å¤§æ›´å¤æ‚çš„æ•°æ®ã€‚ä½†ä»ç¼–ç¨‹çš„è§’åº¦çœ‹ï¼Œæˆ‘ä»¬è¦è°¨æ…è€ƒè™‘å˜é‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå°½é‡ä»ç¼–ç¨‹é˜¶æ®µé¿å…å‡ºç°é—®é¢˜ã€‚ä¾‹å¦‚æŠŠ <code>lept_context_push()</code> çš„ API æ”¹ä¸ºï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">lept_context_push</span><span class="params">(lept_context* c, <span class="keyword">const</span> <span class="keyword">void</span>* data, <span class="keyword">size_t</span> size)</span></span>;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±ç¡®æŠŠæ•°æ®å‹å…¥æ ˆå†…ï¼Œé¿å…äº†è¿”å›æŒ‡é’ˆçš„ç”Ÿå‘½å‘¨æœŸé—®é¢˜ã€‚ä½†æˆ‘ä»¬ä¹‹åä¼šå‘ç°ï¼ŒåŸæ¥çš„ API è®¾è®¡åœ¨ä¸€äº›æƒ…å†µä¼šæ›´æ–¹ä¾¿ä¸€äº›ï¼Œä¾‹å¦‚åœ¨æŠŠå­—ç¬¦ä¸²å€¼è½¬åŒ–ï¼ˆstringifyï¼‰ä¸º JSON æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é¢„å…ˆåœ¨å †æ ˆåˆ†é…å­—ç¬¦ä¸²æ‰€éœ€çš„æœ€å¤§ç©ºé—´ï¼Œè€Œå½“æ—¶æ˜¯æœªæœ‰æ•°æ®å¡«å……è¿›å»çš„ã€‚</p>
<p>æ— è®ºå¦‚ä½•ï¼Œæˆ‘ä»¬ç¼–ç¨‹æ—¶éƒ½è¦è€ƒè™‘æ¸…æ¥šå˜é‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œç‰¹åˆ«æ˜¯æŒ‡é’ˆçš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<p>ç»è¿‡å¯¹æ•°ç»„çš„è§£æï¼Œæˆ‘ä»¬ä¹Ÿäº†è§£åˆ°å¦‚ä½•åˆ©ç”¨é€’å½’å¤„ç†å¤åˆå‹çš„æ•°æ®ç±»å‹è§£æã€‚ä¸ä¸€äº›ç”¨é“¾è¡¨æˆ–è‡ªåŠ¨æ‰©å±•çš„åŠ¨æ€æ•°ç»„çš„å®ç°æ¯”è¾ƒï¼Œæˆ‘ä»¬åˆ©ç”¨äº†è‡ªå®šä¹‰å †æ ˆä½œä¸ºç¼“å†²åŒºï¼Œèƒ½åˆ†é…æœ€ç´§å‡‘çš„æ•°ç»„ä½œå­˜å‚¨ä¹‹ç”¨ï¼Œä¼šæ¯”å…¶ä»–å®ç°æ›´çœå†…å­˜ã€‚æˆ‘ä»¬å®Œæˆäº†æ•°ç»„ç±»å‹åï¼Œåªä½™ä¸‹å¯¹è±¡ç±»å‹äº†ã€‚</p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a type="button" class="btn btn-default disabled"><i class="fa fa-arrow-circle-o-left"></i>ä¸Šä¸€é¡µ</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2021/Make-a-JSON-parser-4/" type="button" class="btn btn-default ">ä¸‹ä¸€é¡µ<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>
	
	<!-- comment -->
	<!-- 
<section id="comment">
    <h2 class="title">ç•™è¨€</h2>

    
</section>
 -->


    <section id="comment">
        <h2 class="title">
            ç•™è¨€
        </h2>
        <div id="vcomments"></div>
        <script>
            new Valine({
                el: '#vcomments',
                appId: '8FWjWdEoyYxwoFgc2ET6DcSh-gzGzoHsz',
                appKey: 'DqH3LDGq73YqdepEDCcPgWhl',
                visitor: true,
                // avatar: 'hide',
                avatar: 'retro',
                // è¿™é‡Œè®¾ç½®CDN, é»˜è®¤å¾®åšè¡¨æƒ…CDN
                // emojiCDN: 'https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/',
                // // è¡¨æƒ…titleå’Œå›¾ç‰‡æ˜ å°„
                // emojiMaps: {
                //     "smile": "e3/2018new_weixioa02_org.png",
                //     "lovely": "09/2018new_keai_org.png",
                //     // ... æ›´å¤šè¡¨æƒ…
                // }
            })
        </script>
    </section>


    <style type="text/css">
        h2.title {
            font-size: 25px;
            margin-bottom: 27px;
        }

        .v[data-class=v] .vwrap {
            border: 3px solid #f0f0f0;
        }
    
        .v[data-class=v] .vwrap .vheader .vinput {
            border-bottom: 1.8px dashed #f5f5f5;
            color: #bebaba;
            font-size: 17px;
        }

        .v[data-class=v] .veditor {
            font-size: 1.2em;
            color: #b5b5b5;
        }

        .v[data-class=v] .vrow .vcol {
            
            font-size: 17px;
        }

        .v[data-class=v] .vicon {
            fill: #bebebe;
        }

        .v[data-class=v] .vrow {
            font-size: 0;
            padding: 10px 0 0;
        }

        .v[data-class=v] .vbtn {
            color: #d0cdcd;
        }
        
        .v[data-class=v] .vsys {
            padding: 0em 0em;
        }

        .v[data-class=v] .vcards .vcard {
            padding-top: 0em;
        }

        .v[data-class=v] p {
            margin-bottom: 0;
            color: #c0c0c0;
        }

        a:hover {
            font-weight: 800 !important;
        }

        .v[data-class=v] a:hover{
            color: #c66400;
            background: bottom !important;
        }

        .v[data-class=v] a.vnick:hover{
            color: #c66400 !important;
            background: bottom !important;
        }

        .v[data-class=v] .vwrap .vheader .vinput:focus {
            border-bottom-color: #ff7c29;
        }

    </style>





	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2021-08-11 
	</div>
	
	<span id="busuanzi_container_page_pv">
		<i class="fa fa-eye"></i>
  		<span id="busuanzi_value_page_pv"></span>
    </span>

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/é¡¹ç›®/">é¡¹ç›®<span>5</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/json/">json<span>5</span></a></li>
  
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E4%B8%80%E3%80%81JSON%E6%95%B0%E7%BB%84"><span class="toc-article-text">ä¸€ã€JSONæ•°ç»„</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E4%BA%8C%E3%80%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-article-text">äºŒã€æ•°æ®ç»“æ„</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E4%B8%89%E3%80%81%E8%A7%A3%E6%9E%90%E8%BF%87%E7%A8%8B"><span class="toc-article-text">ä¸‰ã€è§£æè¿‡ç¨‹</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E5%9B%9B%E3%80%81%E5%AE%9E%E7%8E%B0"><span class="toc-article-text">å››ã€å®ç°</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E4%BA%94%E3%80%81%E6%80%BB%E7%BB%93%E4%B8%8E%E7%BB%83%E4%B9%A0%E7%AD%94%E6%A1%88"><span class="toc-article-text">äº”ã€æ€»ç»“ä¸ç»ƒä¹ ç­”æ¡ˆ</span></a></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2021 AYu
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br>     
     <span id="busuanzi_container_site_pv">
    	ğŸ‘€: <span id="busuanzi_value_site_pv"></span>    |   ğŸ™‹: <span id="busuanzi_value_site_uv"></span>
	</span>
</p>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>â¬†ï¸TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
