<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>è·Ÿç€åšä¸€ä¸ªJSONè§£æå™¨ï¼ˆä¸€ï¼‰ | AYu</title>
  <meta name="author" content="AYu">
  
  <meta name="description" content="å­¦ä¹ ç”Ÿæ´»ç‰‡æ®µè®°å½•">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="è·Ÿç€åšä¸€ä¸ªJSONè§£æå™¨ï¼ˆä¸€ï¼‰"/>
  <meta property="og:site_name" content="AYu"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.ico" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-70812759-1', 'auto');
  ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?cb5448498d7169c668b07c2b255d62c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<meta name="generator" content="Hexo 5.0.2"><link rel="alternate" href="atom.xml" title="AYu" type="application/atom+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">AYu</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archive" title="All the articles.">
			  <i class=""></i>Archive
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> è·Ÿç€åšä¸€ä¸ªJSONè§£æå™¨ï¼ˆä¸€ï¼‰</h1>
		</div>
	


<script src='//unpkg.com/valine/dist/Valine.min.js'></script>

<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p>è·Ÿç€githubä¸Šçš„é¡¹ç›®json-tutorialå®Œæˆä¸€ä¸ªjsonè§£æå™¨ã€‚æœ¬æ–‡å¯¹åº”è¯¥é¡¹ç›®çš„ç¬¬ä¸€å•å…ƒã€‚<a id="more"></a></p>
<p>ğŸ‘‰<a target="_blank" rel="noopener" href="https://github.com/miloyip/json-tutorial">é¡¹ç›®åœ°å€</a></p>
<h1 id="JSONæ˜¯ä»€ä¹ˆ"><a href="#JSONæ˜¯ä»€ä¹ˆ" class="headerlink" title="JSONæ˜¯ä»€ä¹ˆ"></a>JSONæ˜¯ä»€ä¹ˆ</h1><p>JSONï¼ˆJavaScript Object Notationï¼‰æ˜¯ä¸€ä¸ªç”¨äºæ•°æ®äº¤æ¢çš„æ–‡æœ¬æ ¼å¼ï¼Œç°æ—¶çš„æ ‡å‡†ä¸º<a target="_blank" rel="noopener" href="https://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf">ECMA-404</a>ã€‚</p>
<p>è™½ç„¶ JSON æºè‡³äº JavaScript è¯­è¨€ï¼Œä½†å®ƒåªæ˜¯ä¸€ç§æ•°æ®æ ¼å¼ï¼Œå¯ç”¨äºä»»ä½•ç¼–ç¨‹è¯­è¨€ã€‚ç°æ—¶å…·ç±»ä¼¼åŠŸèƒ½çš„æ ¼å¼æœ‰ XMLã€YAMLï¼Œå½“ä¸­ä»¥ JSON çš„è¯­æ³•æœ€ä¸ºç®€å•ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸€ä¸ªåŠ¨æ€ç½‘é¡µæƒ³ä»æœåŠ¡å™¨è·å¾—æ•°æ®æ—¶ï¼ŒæœåŠ¡å™¨ä»æ•°æ®åº“æŸ¥æ‰¾æ•°æ®ï¼Œç„¶åæŠŠæ•°æ®è½¬æ¢æˆ JSON æ–‡æœ¬æ ¼å¼ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Design Patterns&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;subtitle&quot;</span>: <span class="string">&quot;Elements of Reusable Object-Oriented Software&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;author&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;Erich Gamma&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Richard Helm&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Ralph Johnson&quot;</span>,</span><br><span class="line">        <span class="string">&quot;John Vlissides&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;year&quot;</span>: <span class="number">2009</span>,</span><br><span class="line">    <span class="attr">&quot;weight&quot;</span>: <span class="number">1.8</span>,</span><br><span class="line">    <span class="attr">&quot;hardcover&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;publisher&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;Company&quot;</span>: <span class="string">&quot;Pearson Education&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;Country&quot;</span>: <span class="string">&quot;India&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;website&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç½‘é¡µçš„è„šæœ¬ä»£ç å°±å¯ä»¥æŠŠæ­¤ JSON æ–‡æœ¬è§£æä¸ºå†…éƒ¨çš„æ•°æ®ç»“æ„å»ä½¿ç”¨ã€‚</p>
<p>ä»æ­¤ä¾‹å­å¯çœ‹å‡ºï¼ŒJSON æ˜¯æ ‘çŠ¶ç»“æ„ï¼Œè€Œ JSON åªåŒ…å« 6 ç§æ•°æ®ç±»å‹ï¼š</p>
<ul>
<li>null: è¡¨ç¤ºä¸º null</li>
<li>boolean: è¡¨ç¤ºä¸º true æˆ– false</li>
<li>number: ä¸€èˆ¬çš„æµ®ç‚¹æ•°è¡¨ç¤ºæ–¹å¼ï¼Œåœ¨ä¸‹ä¸€å•å…ƒè¯¦ç»†è¯´æ˜</li>
<li>string: è¡¨ç¤ºä¸º â€œâ€¦â€</li>
<li>array: è¡¨ç¤ºä¸º [ â€¦ ]</li>
<li>object: è¡¨ç¤ºä¸º { â€¦ }</li>
</ul>
<h1 id="ç›®æ ‡ï¼šç®€å•è€ŒåŸºæœ¬"><a href="#ç›®æ ‡ï¼šç®€å•è€ŒåŸºæœ¬" class="headerlink" title="ç›®æ ‡ï¼šç®€å•è€ŒåŸºæœ¬"></a>ç›®æ ‡ï¼šç®€å•è€ŒåŸºæœ¬</h1><p>æˆ‘ä»¬è¦å®ç°çš„ JSON åº“ï¼Œä¸»è¦æ˜¯å®Œæˆ 3 ä¸ªéœ€æ±‚ï¼š</p>
<ol>
<li>æŠŠ JSON æ–‡æœ¬è§£æä¸ºä¸€ä¸ªæ ‘çŠ¶æ•°æ®ç»“æ„ï¼ˆparseï¼‰ã€‚</li>
<li>æä¾›æ¥å£è®¿é—®è¯¥æ•°æ®ç»“æ„ï¼ˆaccessï¼‰ã€‚</li>
<li>æŠŠæ•°æ®ç»“æ„è½¬æ¢æˆ JSON æ–‡æœ¬ï¼ˆstringifyï¼‰ã€‚</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://github.com/Buland-RAn/json-tutorial/blob/master/tutorial01/images/requirement.png"><img src="https://github.com/Buland-RAn/json-tutorial/raw/master/tutorial01/images/requirement.png" alt="requirement"></a></p>
<h1 id="å¼€å§‹ï¼šforké¡¹ç›®è‡ªå·±åš"><a href="#å¼€å§‹ï¼šforké¡¹ç›®è‡ªå·±åš" class="headerlink" title="å¼€å§‹ï¼šforké¡¹ç›®è‡ªå·±åš"></a>å¼€å§‹ï¼šforké¡¹ç›®è‡ªå·±åš</h1><p>ç‚¹å‡»json-tutorialé¡¹ç›®çš„forkåï¼Œåœ¨æœ¬åœ°cloneï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@github.com:yourname/json-tutorial.git</span><br></pre></td></tr></table></figure>

<p><img src="/2021/Make-a-JSON-parser-1/image-20210710143417392.png" alt="image-20210710143417392"></p>
<p><code>cd</code> è¿›å…¥ä½ çš„å·¥ä½œç›®å½•ï¼Œå¯ä»¥çœ‹å¾…git bashå‘½ä»¤æç¤ºç¬¦åé¢æœ‰(master)æ ‡è¯†ï¼Œè¯´æ˜æ­¤æ—¶æˆ‘ä»¬å¤„åœ¨masteråˆ†æ”¯ä¸Šã€‚</p>
<p>ç”¨git remote -vå‘½ä»¤å¯ä»¥æŸ¥çœ‹è¯¥æœ¬åœ°ä»“åº“å…³è”çš„è¿œç¨‹ä»“åº“ï¼š</p>
<p><img src="/2021/Make-a-JSON-parser-1/image-20210710143652754.png" alt="image-20210710143652754"></p>
<p>å…¶ä¸­ï¼Œ<strong>origin</strong> ä¸ºè¿œç¨‹åœ°å€çš„åˆ«åï¼Œåé¢ä¸ºè¿œç¨‹ä»“åº“çš„urlã€‚</p>
<p>æˆ‘ä»¬çš„ JSON åº“åä¸º leptjsonï¼Œä»£ç æ–‡ä»¶åªæœ‰ 3 ä¸ªï¼š</p>
<ol>
<li><code>leptjson.h</code>ï¼šleptjson çš„å¤´æ–‡ä»¶ï¼ˆheader fileï¼‰ï¼Œå«æœ‰å¯¹å¤–çš„ç±»å‹å’Œ API å‡½æ•°å£°æ˜ã€‚</li>
<li><code>leptjson.c</code>ï¼šleptjson çš„å®ç°æ–‡ä»¶ï¼ˆimplementation fileï¼‰ï¼Œå«æœ‰å†…éƒ¨çš„ç±»å‹å£°æ˜å’Œå‡½æ•°å®ç°ã€‚æ­¤æ–‡ä»¶ä¼šç¼–è¯‘æˆåº“ã€‚</li>
<li><code>test.c</code>ï¼šæˆ‘ä»¬ä½¿ç”¨æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆtest driven development, TDDï¼‰ã€‚æ­¤æ–‡ä»¶åŒ…å«æµ‹è¯•ç¨‹åºï¼Œéœ€è¦é“¾æ¥ leptjson åº“ã€‚</li>
</ol>
<h1 id="ä¸€ã€ç¼–è¯‘ç¯å¢ƒæ­å»º"><a href="#ä¸€ã€ç¼–è¯‘ç¯å¢ƒæ­å»º" class="headerlink" title="ä¸€ã€ç¼–è¯‘ç¯å¢ƒæ­å»º"></a>ä¸€ã€ç¼–è¯‘ç¯å¢ƒæ­å»º</h1><p>å®‰è£…CMakeåï¼Œä½¿ç”¨å…¶cmake-guiç¨‹åºï¼š</p>
<p><img src="/2021/Make-a-JSON-parser-1/image-20210710145207755.png" alt="image-20210710145207755"></p>
<p>å…ˆåœ¨ â€œWhere is the source codeâ€ é€‰æ‹© json-tutorial/tutorial01ï¼Œå†åœ¨ â€œWhere to build the binaryâ€ é”®å…¥ä¸Šä¸€ä¸ªç›®å½•åŠ ä¸Š /buildï¼š</p>
<p><img src="/2021/Make-a-JSON-parser-1/image-20210710150346431.png" alt="image-20210710150346431"></p>
<p>åœ¨é€‰æ‹©generatorçš„åœ°æ–¹è¦é€‰æ‹©ä½ ç”µè„‘ä¸­å®‰è£…çš„vsç‰ˆæœ¬ï¼Œå¦åˆ™ä¼šå¤±è´¥ï¼Œè‹¥é€‰æ‹©é”™è¯¯ï¼Œå¯ä»¥åœ¨file-&gt;delete cacheä¸­é‡ç½®ï¼š</p>
<p><img src="/2021/Make-a-JSON-parser-1/image-20210710150217094.png" alt="image-20210710150217094"></p>
<p>é…ç½®å®Œæˆï¼š</p>
<p><img src="/2021/Make-a-JSON-parser-1/image-20210710150413104.png" alt="image-20210710150413104"></p>
<p>ç¼–è¯‘è¿è¡Œleptjson_teståè‹¥å‡ºç°ä¸‹é¢ç»“æœè¯´æ˜å·²ç»æˆåŠŸæ­å»ºå¥½ç¼–è¯‘ç¯å¢ƒï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/è·¯å¾„/json-tutorial/tutorial01/test.c:56: expect: 3 actual: 0</span><br><span class="line">11/12 (91.67%) passed</span><br></pre></td></tr></table></figure>



<h1 id="äºŒã€å¤´æ–‡ä»¶ä¸APIè®¾è®¡"><a href="#äºŒã€å¤´æ–‡ä»¶ä¸APIè®¾è®¡" class="headerlink" title="äºŒã€å¤´æ–‡ä»¶ä¸APIè®¾è®¡"></a>äºŒã€å¤´æ–‡ä»¶ä¸APIè®¾è®¡</h1><p>ç”±äºå¤´æ–‡ä»¶ä¹Ÿå¯ä»¥ <code>#include</code> å…¶ä»–å¤´æ–‡ä»¶ï¼Œä¸ºé¿å…é‡å¤å£°æ˜ï¼Œé€šå¸¸ä¼šåˆ©ç”¨å®åŠ å…¥ include é˜²èŒƒï¼ˆinclude guardï¼‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> LEPTJSON_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LEPTJSON_H__</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* ... */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* LEPTJSON_H__ */</span></span></span><br></pre></td></tr></table></figure>

<p>å¦‚å‰æ‰€è¿°ï¼ŒJSON ä¸­æœ‰ 6 ç§æ•°æ®ç±»å‹ï¼Œå¦‚æœæŠŠ true å’Œ false å½“ä½œä¸¤ä¸ªç±»å‹å°±æ˜¯ 7 ç§ï¼Œæˆ‘ä»¬ä¸ºæ­¤å£°æ˜ä¸€ä¸ªæšä¸¾ç±»å‹ï¼ˆenumeration typeï¼‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123; </span><br><span class="line">    LEPT_NULL, </span><br><span class="line">    LEPT_FALSE, </span><br><span class="line">    LEPT_TRUE, </span><br><span class="line">    LEPT_NUMBER, </span><br><span class="line">    LEPT_STRING, </span><br><span class="line">    LEPT_ARRAY, </span><br><span class="line">    LEPT_OBJECT </span><br><span class="line">&#125; lept_type;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å£°æ˜ JSON çš„æ•°æ®ç»“æ„ã€‚JSON æ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œæˆ‘ä»¬æœ€ç»ˆéœ€è¦å®ç°ä¸€ä¸ªæ ‘çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä½¿ç”¨ <code>lept_value</code> ç»“æ„ä½“è¡¨ç¤ºï¼Œæˆ‘ä»¬ä¼šç§°å®ƒä¸ºä¸€ä¸ª JSON å€¼ï¼ˆJSON valueï¼‰ã€‚ åœ¨æ­¤å•å…ƒä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç° null, true å’Œ false çš„è§£æï¼Œå› æ­¤è¯¥ç»“æ„ä½“åªéœ€è¦å­˜å‚¨ä¸€ä¸ª lept_typeã€‚ä¹‹åçš„å•å…ƒä¼šé€æ­¥åŠ å…¥å…¶ä»–æ•°æ®ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    lept_type type;</span><br><span class="line">&#125;lept_value;</span><br></pre></td></tr></table></figure>

<p>å…ˆå®šä¹‰ä¸¤ä¸ªAPIï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lept_parse</span><span class="params">(lept_value* v, <span class="keyword">const</span> <span class="keyword">char</span>* json)</span></span>;</span><br><span class="line"><span class="function">lept_type <span class="title">lept_get_type</span><span class="params">(<span class="keyword">const</span> lept_value* v)</span></span>;</span><br></pre></td></tr></table></figure>

<p>å‰ä¸€ä¸ªç”¨æ¥è§£æjsonï¼Œå‚æ•°jsonæ˜¯ä¸åº”è¯¥è¢«æ”¹åŠ¨çš„ï¼Œæ‰€ä»¥ä½¿ç”¨<code>const char*</code> ç±»å‹ã€‚</p>
<p>è¿”å›å€¼æ˜¯ä»¥ä¸‹è¿™äº›æšä¸¾å€¼ï¼Œæ— é”™è¯¯ä¼šè¿”å› <code>LEPT_PARSE_OK</code>ï¼Œå…¶ä»–å€¼åœ¨åé¢è§£é‡Šã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> &#123;</span><br><span class="line">    LEPT_PARSE_OK = <span class="number">0</span>,</span><br><span class="line">    LEPT_PARSE_EXPECT_VALUE,</span><br><span class="line">    LEPT_PARSE_INVALID_VALUE,</span><br><span class="line">    LEPT_PARSE_ROOT_NOT_SINGULAR</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>åä¸€ä¸ªå‡½æ•°ç”¨æ¥è·å–è¯¥<code>lept_value</code>èŠ‚ç‚¹çš„æ•°æ®ç±»å‹ã€‚</p>
<h1 id="ä¸‰ã€JSON-è¯­æ³•å­é›†"><a href="#ä¸‰ã€JSON-è¯­æ³•å­é›†" class="headerlink" title="ä¸‰ã€JSON è¯­æ³•å­é›†"></a>ä¸‰ã€JSON è¯­æ³•å­é›†</h1><p>ä¸‹é¢æ˜¯æ­¤å•å…ƒçš„ JSON è¯­æ³•å­é›†ï¼Œä½¿ç”¨ <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7159">RFC7159</a> ä¸­çš„ <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc5234">ABNF</a> è¡¨ç¤ºï¼š</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">JSON-text</span> = ws value ws</span><br><span class="line"><span class="attr">ws</span> = *(%x20 / %x09 / %x0A / %x0D)</span><br><span class="line"><span class="attr">value</span> = null / <span class="literal">false</span> / <span class="literal">true</span> </span><br><span class="line"><span class="attr">null</span>  = <span class="string">&quot;null&quot;</span></span><br><span class="line"><span class="attr">false</span> = <span class="string">&quot;false&quot;</span></span><br><span class="line"><span class="attr">true</span>  = <span class="string">&quot;true&quot;</span></span><br></pre></td></tr></table></figure>

<p>å½“ä¸­ <code>%xhh</code> è¡¨ç¤ºä»¥ 16 è¿›åˆ¶è¡¨ç¤ºçš„å­—ç¬¦ï¼Œ<code>/</code> æ˜¯å¤šé€‰ä¸€ï¼Œ<code>*</code> æ˜¯é›¶æˆ–å¤šä¸ªï¼Œ<code>()</code> ç”¨äºåˆ†ç»„ã€‚</p>
<p>é‚£ä¹ˆç¬¬ä¸€è¡Œçš„æ„æ€æ˜¯ï¼ŒJSON æ–‡æœ¬ç”± 3 éƒ¨åˆ†ç»„æˆï¼Œé¦–å…ˆæ˜¯ç©ºç™½ï¼ˆwhitespaceï¼‰ï¼Œæ¥ç€æ˜¯ä¸€ä¸ªå€¼ï¼Œæœ€åæ˜¯ç©ºç™½ã€‚</p>
<p>ç¬¬äºŒè¡Œå‘Šè¯‰æˆ‘ä»¬ï¼Œæ‰€è°“ç©ºç™½ï¼Œæ˜¯ç”±é›¶æˆ–å¤šä¸ªç©ºæ ¼ç¬¦ï¼ˆspace U+0020ï¼‰ã€åˆ¶è¡¨ç¬¦ï¼ˆtab U+0009ï¼‰ã€æ¢è¡Œç¬¦ï¼ˆLF U+000Aï¼‰ã€å›è½¦ç¬¦ï¼ˆCR U+000Dï¼‰æ‰€ç»„æˆã€‚</p>
<p>ç¬¬ä¸‰è¡Œæ˜¯è¯´ï¼Œæˆ‘ä»¬ç°æ—¶çš„å€¼åªå¯ä»¥æ˜¯ nullã€false æˆ– trueï¼Œå®ƒä»¬åˆ†åˆ«æœ‰å¯¹åº”çš„å­—é¢å€¼ï¼ˆliteralï¼‰ã€‚</p>
<p>æˆ‘ä»¬çš„è§£æå™¨åº”èƒ½åˆ¤æ–­è¾“å…¥æ˜¯å¦ä¸€ä¸ªåˆæ³•çš„ JSONã€‚å¦‚æœè¾“å…¥çš„ JSON ä¸åˆç¬¦è¿™ä¸ªè¯­æ³•ï¼Œæˆ‘ä»¬è¦äº§ç”Ÿå¯¹åº”çš„é”™è¯¯ç ï¼Œæ–¹ä¾¿ä½¿ç”¨è€…è¿½æŸ¥é—®é¢˜ã€‚</p>
<p>åœ¨è¿™ä¸ª JSON è¯­æ³•å­é›†ä¸‹ï¼Œæˆ‘ä»¬å®šä¹‰ 3 ç§é”™è¯¯ç ï¼š</p>
<ul>
<li>è‹¥ä¸€ä¸ª JSON åªå«æœ‰ç©ºç™½ï¼Œä¼ å› <code>LEPT_PARSE_EXPECT_VALUE</code>ã€‚</li>
<li>è‹¥ä¸€ä¸ªå€¼ä¹‹åï¼Œåœ¨ç©ºç™½ä¹‹åè¿˜æœ‰å…¶ä»–å­—ç¬¦ï¼Œä¼ å› <code>LEPT_PARSE_ROOT_NOT_SINGULAR</code>ã€‚</li>
<li>è‹¥å€¼ä¸æ˜¯é‚£ä¸‰ç§å­—é¢å€¼ï¼Œä¼ å› <code>LEPT_PARSE_INVALID_VALUE</code>ã€‚</li>
</ul>
<h1 id="å››ã€å•å…ƒæµ‹è¯•"><a href="#å››ã€å•å…ƒæµ‹è¯•" class="headerlink" title="å››ã€å•å…ƒæµ‹è¯•"></a>å››ã€å•å…ƒæµ‹è¯•</h1><p>ä¸ºäº†ç®€å•èµ·è§ï¼Œç¼–å†™ä¸€ä¸ªæç®€å•çš„å•å…ƒæµ‹è¯•æ–¹å¼ã€‚æ— è®ºæˆ‘ä»¬æ˜¯é‡‡ç”¨ TDDï¼ˆtest-driven developmentï¼‰ï¼Œæˆ–æ˜¯å…ˆå®ç°åæµ‹è¯•ï¼Œéƒ½åº”å°½é‡åŠ å…¥è¶³å¤Ÿè¦†ç›–ç‡çš„å•å…ƒæµ‹è¯•ã€‚</p>
<p>å›åˆ° leptjson é¡¹ç›®ï¼Œ<code>test.c</code> åŒ…å«äº†ä¸€ä¸ªæç®€çš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;leptjson.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> main_ret = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> test_count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> test_pass = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXPECT_EQ_BASE(equality, expect, actual, format) \</span></span><br><span class="line">    <span class="keyword">do</span> &#123;\</span><br><span class="line">        test_count++;\</span><br><span class="line">        <span class="keyword">if</span> (equality)\</span><br><span class="line">            test_pass++;\</span><br><span class="line">        <span class="keyword">else</span> &#123;\</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;%s:%d: expect: &quot;</span> format <span class="string">&quot; actual: &quot;</span> format <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, expect, actual);\</span><br><span class="line">            main_ret = <span class="number">1</span>;\</span><br><span class="line">        &#125;\</span><br><span class="line">    &#125; <span class="keyword">while</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXPECT_EQ_INT(expect, actual) EXPECT_EQ_BASE((expect) == (actual), expect, actual, <span class="meta-string">&quot;%d&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test_parse_null</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    lept_value v;</span><br><span class="line">    v.type = LEPT_TRUE;</span><br><span class="line">    EXPECT_EQ_INT(LEPT_PARSE_OK, lept_parse(&amp;v, <span class="string">&quot;null&quot;</span>));</span><br><span class="line">    EXPECT_EQ_INT(LEPT_NULL, lept_get_type(&amp;v));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ... */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test_parse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    test_parse_null();</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    test_parse();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d/%d (%3.2f%%) passed\n&quot;</span>, test_pass, test_count, test_pass * <span class="number">100.0</span> / test_count);</span><br><span class="line">    <span class="keyword">return</span> main_ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°æ—¶åªæä¾›äº†ä¸€ä¸ª <code>EXPECT_EQ_INT(expect, actual)</code> çš„å®ï¼Œæ¯æ¬¡ä½¿ç”¨è¿™ä¸ªå®æ—¶ï¼Œå¦‚æœ expect != actualï¼ˆé¢„æœŸå€¼ä¸ç­‰äºå®é™…å€¼ï¼‰ï¼Œä¾¿ä¼šè¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚ è‹¥æŒ‰ç…§ TDD çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å…ˆå†™ä¸€ä¸ªæµ‹è¯•ï¼Œå¦‚ä¸Šé¢çš„ <code>test_parse_null()</code>ï¼Œè€Œ <code>lept_parse()</code> åªè¿”å› <code>LEPT_PARSE_OK</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/è·¯å¾„/json-tutorial/tutorial01/test.c:27: expect: 0 actual: 1</span><br><span class="line">1/2 (50.00%) passed</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªè¿”å› <code>LEPT_PARSE_OK</code>ï¼Œæ‰€ä»¥æ˜¯é€šè¿‡çš„ã€‚ç¬¬äºŒä¸ªæµ‹è¯•å› ä¸º <code>lept_parse()</code> æ²¡æœ‰æŠŠ <code>v.type</code> æ”¹æˆ <code>LEPT_NULL</code>ï¼Œé€ æˆå¤±è´¥ã€‚æˆ‘ä»¬å†å®ç° <code>lept_parse()</code> ä»¤åˆ°å®ƒèƒ½é€šè¿‡æµ‹è¯•ã€‚</p>
<h2 id="å®çš„ç¼–å†™æŠ€å·§-EXPECT-EQ-BASEè§£æ"><a href="#å®çš„ç¼–å†™æŠ€å·§-EXPECT-EQ-BASEè§£æ" class="headerlink" title="å®çš„ç¼–å†™æŠ€å·§: EXPECT_EQ_BASEè§£æ"></a>å®çš„ç¼–å†™æŠ€å·§: EXPECT_EQ_BASEè§£æ</h2><p>åæ–œçº¿ä»£è¡¨è¯¥è¡Œæœªç»“æŸï¼Œä¼šä¸²æ¥ä¸‹ä¸€è¡Œã€‚è€Œå¦‚æœå®é‡Œæœ‰å¤šè¿‡ä¸€ä¸ªè¯­å¥ï¼ˆstatementï¼‰ï¼Œå°±éœ€è¦ç”¨ <code>do &#123; /*...*/ &#125; while(0)</code> åŒ…è£¹æˆå•ä¸ªè¯­å¥ï¼Œå¦åˆ™ä¼šæœ‰å¦‚ä¸‹çš„é—®é¢˜ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> M() a(); b()</span></span><br><span class="line"><span class="keyword">if</span> (cond)</span><br><span class="line">    M();</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    c();</span><br><span class="line"></span><br><span class="line"><span class="comment">/* é¢„å¤„ç†å */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (cond)</span><br><span class="line">    a(); b(); <span class="comment">/* b(); åœ¨ if ä¹‹å¤–     */</span></span><br><span class="line"><span class="keyword">else</span>          <span class="comment">/* &lt;- else ç¼ºä¹å¯¹åº” if */</span></span><br><span class="line">    c();</span><br></pre></td></tr></table></figure>

<p>åªç”¨ <code>&#123; &#125;</code> ä¹Ÿä¸è¡Œï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> M() &#123; a(); b(); &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* é¢„å¤„ç†å */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (cond)</span><br><span class="line">    &#123; a(); b(); &#125;; <span class="comment">/* æœ€åçš„åˆ†å·ä»£è¡¨ if è¯­å¥ç»“æŸ */</span></span><br><span class="line"><span class="keyword">else</span>               <span class="comment">/* else ç¼ºä¹å¯¹åº” if */</span></span><br><span class="line">    c();</span><br></pre></td></tr></table></figure>

<p>ç”¨ do while å°±è¡Œäº†ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> M() do &#123; a(); b(); &#125; while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* é¢„å¤„ç†å */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (cond)</span><br><span class="line">    <span class="keyword">do</span> &#123; a(); b(); &#125; <span class="keyword">while</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    c();</span><br></pre></td></tr></table></figure>



<h1 id="äº”ã€å®ç°è§£æå™¨"><a href="#äº”ã€å®ç°è§£æå™¨" class="headerlink" title="äº”ã€å®ç°è§£æå™¨"></a>äº”ã€å®ç°è§£æå™¨</h1><p>é¦–å…ˆä¸ºäº†å‡å°‘è§£æå‡½æ•°ä¹‹é—´ä¼ é€’å¤šä¸ªå‚æ•°ï¼Œæˆ‘ä»¬æŠŠè¿™äº›æ•°æ®éƒ½æ”¾è¿›ä¸€ä¸ª <code>lept_context</code> ç»“æ„ä½“ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* json;</span><br><span class="line">&#125;lept_context;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ... */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* æç¤ºï¼šè¿™é‡Œåº”è¯¥æ˜¯ JSON-text = ws value ws */</span></span><br><span class="line"><span class="comment">/* ä»¥ä¸‹å®ç°æ²¡å¤„ç†æœ€åçš„ ws å’Œ LEPT_PARSE_ROOT_NOT_SINGULAR */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lept_parse</span><span class="params">(lept_value* v, <span class="keyword">const</span> <span class="keyword">char</span>* json)</span> </span>&#123;</span><br><span class="line">    lept_context c;</span><br><span class="line">    assert(v != <span class="literal">NULL</span>);</span><br><span class="line">    c.json = json;</span><br><span class="line">    v-&gt;type = LEPT_NULL;</span><br><span class="line">    lept_parse_whitespace(&amp;c);</span><br><span class="line">    <span class="keyword">return</span> lept_parse_value(&amp;c, v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æš‚æ—¶æˆ‘ä»¬åªå‚¨å­˜ json å­—ç¬¦ä¸²å½“å‰ä½ç½®ï¼Œä¹‹åçš„å•å…ƒæˆ‘ä»¬éœ€è¦åŠ å…¥æ›´å¤šå†…å®¹ã€‚</p>
<p>è‹¥ <code>lept_parse()</code> å¤±è´¥ï¼Œä¼šæŠŠ <code>v</code> è®¾ä¸º <code>null</code> ç±»å‹ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆæŠŠå®ƒè®¾ä¸º <code>null</code>ï¼Œè®© <code>lept_parse_value()</code> å†™å…¥è§£æå‡ºæ¥çš„æ ¹å€¼ã€‚</p>
<p>ç»™ä¸‹é¢å†…å®¹åšçš„åè¯è§£é‡Šï¼š</p>
<ol>
<li><p><a target="_blank" rel="noopener" href="https://www.wikiwand.com/zh-hans/%E9%80%92%E5%BD%92%E4%B8%8B%E9%99%8D%E8%A7%A3%E6%9E%90%E5%99%A8">é€’å½’ä¸‹é™è§£æå™¨</a>ï¼ˆrecursive descent parserï¼‰</p>
<p>ä¸€ç§è‡ªä¸Šè€Œä¸‹çš„è§£æå™¨ï¼ˆ<a target="_blank" rel="noopener" href="https://www.wikiwand.com/en/Top-down_parsing">Top-down parsing</a>ï¼‰ï¼Œç”±ä¸€ç»„<a target="_blank" rel="noopener" href="https://www.wikiwand.com/zh-hans/%E4%BA%92%E9%80%92%E5%BD%92">ç›¸äº’é€’å½’</a>çš„ç¨‹åºï¼ˆæˆ–ç­‰ä»·çš„éé€’å½’ç¨‹åºï¼‰æ„å»ºè€Œæˆï¼Œå…¶ä¸­æ¯ä¸ªç¨‹åºéƒ½å®ç°äº†æ–‡æ³•ä¸­çš„ä¸€ä¸ª<a target="_blank" rel="noopener" href="https://www.wikiwand.com/zh-hans/%E7%B5%82%E7%B5%90%E7%AC%A6%E8%88%87%E9%9D%9E%E7%B5%82%E7%B5%90%E7%AC%A6">éç»ˆç»“ç¬¦</a>ã€‚</p>
</li>
<li><p><a href>åˆ†è¯å™¨</a>ï¼ˆtokenizerï¼‰</p>
<p>æŒ‰ç…§è§„åˆ™å°†æ–‡æœ¬åˆ‡åˆ†ä¸ºå•è¯çš„å·¥å…·ã€‚</p>
<p><img src="/2021/Make-a-JSON-parser-1/1438655-20180728162354187-296980561.jpg" alt="åˆ†è¯å™¨æµç¨‹å›¾"></p>
</li>
</ol>
<p>leptjson æ˜¯ä¸€ä¸ªæ‰‹å†™çš„<strong>é€’å½’ä¸‹é™è§£æå™¨</strong>ã€‚ç”±äº JSON è¯­æ³•ç‰¹åˆ«ç®€å•ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†™<strong>åˆ†è¯å™¨</strong>ï¼Œåªéœ€æ£€æµ‹ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œä¾¿å¯ä»¥çŸ¥é“å®ƒæ˜¯å“ªç§ç±»å‹çš„å€¼ï¼Œç„¶åè°ƒç”¨ç›¸å…³çš„åˆ†æå‡½æ•°ã€‚å¯¹äºå®Œæ•´çš„ JSON è¯­æ³•ï¼Œè·³è¿‡ç©ºç™½åï¼Œåªéœ€æ£€æµ‹å½“å‰å­—ç¬¦ï¼š</p>
<ul>
<li>n â” null</li>
<li>t â” true</li>
<li>f â” false</li>
<li>â€œ â” string</li>
<li>0-9/- â” number</li>
<li>[ â” array</li>
<li>{ â” object</li>
</ul>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ JSON è¯­æ³•ä¸€èŠ‚çš„ EBNF ç®€å•ç¿»è¯‘æˆè§£æå‡½æ•°ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXPECT(c, ch) do &#123; assert(*c-&gt;json == (ch)); c-&gt;json++; &#125; while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* ws = *(%x20 / %x09 / %x0A / %x0D) */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">lept_parse_whitespace</span><span class="params">(lept_context* c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *p = c-&gt;json;</span><br><span class="line">    <span class="keyword">while</span> (*p == <span class="string">&#x27; &#x27;</span> || *p == <span class="string">&#x27;\t&#x27;</span> || *p == <span class="string">&#x27;\n&#x27;</span> || *p == <span class="string">&#x27;\r&#x27;</span>)</span><br><span class="line">        p++;</span><br><span class="line">    c-&gt;json = p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* null  = &quot;null&quot; */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lept_parse_null</span><span class="params">(lept_context* c, lept_value* v)</span> </span>&#123;</span><br><span class="line">    EXPECT(c, <span class="string">&#x27;n&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (c-&gt;json[<span class="number">0</span>] != <span class="string">&#x27;u&#x27;</span> || c-&gt;json[<span class="number">1</span>] != <span class="string">&#x27;l&#x27;</span> || c-&gt;json[<span class="number">2</span>] != <span class="string">&#x27;l&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> LEPT_PARSE_INVALID_VALUE;</span><br><span class="line">    c-&gt;json += <span class="number">3</span>;</span><br><span class="line">    v-&gt;type = LEPT_NULL;</span><br><span class="line">    <span class="keyword">return</span> LEPT_PARSE_OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* value = null / false / true */</span></span><br><span class="line"><span class="comment">/* æç¤ºï¼šä¸‹é¢ä»£ç æ²¡å¤„ç† false / trueï¼Œå°†ä¼šæ˜¯ç»ƒä¹ ä¹‹ä¸€ */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lept_parse_value</span><span class="params">(lept_context* c, lept_value* v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (*c-&gt;json) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;n&#x27;</span>:  <span class="keyword">return</span> lept_parse_null(c, v);</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;\0&#x27;</span>: <span class="keyword">return</span> LEPT_PARSE_EXPECT_VALUE;</span><br><span class="line">        <span class="keyword">default</span>:   <span class="keyword">return</span> LEPT_PARSE_INVALID_VALUE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±äº <code>lept_parse_whitespace()</code> æ˜¯ä¸ä¼šå‡ºç°é”™è¯¯çš„ï¼Œè¿”å›ç±»å‹ä¸º <code>void</code>ã€‚å…¶å®ƒçš„è§£æå‡½æ•°ä¼šè¿”å›é”™è¯¯ç ï¼Œä¼ é€’è‡³é¡¶å±‚ã€‚</p>
<h1 id="å…­ã€æœ¬å•å…ƒæ–‡ä»¶å®Œæ•´å†…å®¹"><a href="#å…­ã€æœ¬å•å…ƒæ–‡ä»¶å®Œæ•´å†…å®¹" class="headerlink" title="å…­ã€æœ¬å•å…ƒæ–‡ä»¶å®Œæ•´å†…å®¹"></a>å…­ã€æœ¬å•å…ƒæ–‡ä»¶å®Œæ•´å†…å®¹</h1><p>æœ¬å•å…ƒç»“æŸé¡¹ç›®ä¸‰ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼š</p>
<p>leptjson.h</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> LEPTJSON_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LEPTJSON_H__</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123; LEPT_NULL, LEPT_FALSE, LEPT_TRUE, LEPT_NUMBER, LEPT_STRING, LEPT_ARRAY, LEPT_OBJECT &#125; lept_type;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    lept_type type;</span><br><span class="line">&#125;lept_value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> &#123;</span><br><span class="line">    LEPT_PARSE_OK = <span class="number">0</span>,</span><br><span class="line">    LEPT_PARSE_EXPECT_VALUE,</span><br><span class="line">    LEPT_PARSE_INVALID_VALUE,</span><br><span class="line">    LEPT_PARSE_ROOT_NOT_SINGULAR</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lept_parse</span><span class="params">(lept_value* v, <span class="keyword">const</span> <span class="keyword">char</span>* json)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">lept_type <span class="title">lept_get_type</span><span class="params">(<span class="keyword">const</span> lept_value* v)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* LEPTJSON_H__ */</span></span></span><br></pre></td></tr></table></figure>

<p>leptjson.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;leptjson.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;  /* assert() */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;  /* NULL */</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXPECT(c, ch)       do &#123; assert(*c-&gt;json == (ch)); c-&gt;json++; &#125; while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* json;</span><br><span class="line">&#125;lept_context;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">lept_parse_whitespace</span><span class="params">(lept_context* c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *p = c-&gt;json;</span><br><span class="line">    <span class="keyword">while</span> (*p == <span class="string">&#x27; &#x27;</span> || *p == <span class="string">&#x27;\t&#x27;</span> || *p == <span class="string">&#x27;\n&#x27;</span> || *p == <span class="string">&#x27;\r&#x27;</span>)</span><br><span class="line">        p++;</span><br><span class="line">    c-&gt;json = p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lept_parse_null</span><span class="params">(lept_context* c, lept_value* v)</span> </span>&#123;</span><br><span class="line">    EXPECT(c, <span class="string">&#x27;n&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (c-&gt;json[<span class="number">0</span>] != <span class="string">&#x27;u&#x27;</span> || c-&gt;json[<span class="number">1</span>] != <span class="string">&#x27;l&#x27;</span> || c-&gt;json[<span class="number">2</span>] != <span class="string">&#x27;l&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> LEPT_PARSE_INVALID_VALUE;</span><br><span class="line">    c-&gt;json += <span class="number">3</span>;</span><br><span class="line">    v-&gt;type = LEPT_NULL;</span><br><span class="line">    <span class="keyword">return</span> LEPT_PARSE_OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lept_parse_value</span><span class="params">(lept_context* c, lept_value* v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (*c-&gt;json) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;n&#x27;</span>:  <span class="keyword">return</span> lept_parse_null(c, v);</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;\0&#x27;</span>: <span class="keyword">return</span> LEPT_PARSE_EXPECT_VALUE;</span><br><span class="line">        <span class="keyword">default</span>:   <span class="keyword">return</span> LEPT_PARSE_INVALID_VALUE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lept_parse</span><span class="params">(lept_value* v, <span class="keyword">const</span> <span class="keyword">char</span>* json)</span> </span>&#123;</span><br><span class="line">    lept_context c;</span><br><span class="line">    assert(v != <span class="literal">NULL</span>);</span><br><span class="line">    c.json = json;</span><br><span class="line">    v-&gt;type = LEPT_NULL;</span><br><span class="line">    lept_parse_whitespace(&amp;c);</span><br><span class="line">    <span class="keyword">return</span> lept_parse_value(&amp;c, v);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">lept_type <span class="title">lept_get_type</span><span class="params">(<span class="keyword">const</span> lept_value* v)</span> </span>&#123;</span><br><span class="line">    assert(v != <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">return</span> v-&gt;type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>test.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;leptjson.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> main_ret = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> test_count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> test_pass = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXPECT_EQ_BASE(equality, expect, actual, format) \</span></span><br><span class="line">    <span class="keyword">do</span> &#123;\</span><br><span class="line">        test_count++;\</span><br><span class="line">        <span class="keyword">if</span> (equality)\</span><br><span class="line">            test_pass++;\</span><br><span class="line">        <span class="keyword">else</span> &#123;\</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;%s:%d: expect: &quot;</span> format <span class="string">&quot; actual: &quot;</span> format <span class="string">&quot;\n&quot;</span>, __FILE__, __LINE__, expect, actual);\</span><br><span class="line">            main_ret = <span class="number">1</span>;\</span><br><span class="line">        &#125;\</span><br><span class="line">    &#125; <span class="keyword">while</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXPECT_EQ_INT(expect, actual) EXPECT_EQ_BASE((expect) == (actual), expect, actual, <span class="meta-string">&quot;%d&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test_parse_null</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    lept_value v;</span><br><span class="line">    v.type = LEPT_FALSE;</span><br><span class="line">    EXPECT_EQ_INT(LEPT_PARSE_OK, lept_parse(&amp;v, <span class="string">&quot;null&quot;</span>));</span><br><span class="line">    EXPECT_EQ_INT(LEPT_NULL, lept_get_type(&amp;v));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test_parse_expect_value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    lept_value v;</span><br><span class="line"></span><br><span class="line">    v.type = LEPT_FALSE;</span><br><span class="line">    EXPECT_EQ_INT(LEPT_PARSE_EXPECT_VALUE, lept_parse(&amp;v, <span class="string">&quot;&quot;</span>));</span><br><span class="line">    EXPECT_EQ_INT(LEPT_NULL, lept_get_type(&amp;v));</span><br><span class="line"></span><br><span class="line">    v.type = LEPT_FALSE;</span><br><span class="line">    EXPECT_EQ_INT(LEPT_PARSE_EXPECT_VALUE, lept_parse(&amp;v, <span class="string">&quot; &quot;</span>));</span><br><span class="line">    EXPECT_EQ_INT(LEPT_NULL, lept_get_type(&amp;v));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test_parse_invalid_value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    lept_value v;</span><br><span class="line">    v.type = LEPT_FALSE;</span><br><span class="line">    EXPECT_EQ_INT(LEPT_PARSE_INVALID_VALUE, lept_parse(&amp;v, <span class="string">&quot;nul&quot;</span>));</span><br><span class="line">    EXPECT_EQ_INT(LEPT_NULL, lept_get_type(&amp;v));</span><br><span class="line"></span><br><span class="line">    v.type = LEPT_FALSE;</span><br><span class="line">    EXPECT_EQ_INT(LEPT_PARSE_INVALID_VALUE, lept_parse(&amp;v, <span class="string">&quot;?&quot;</span>));</span><br><span class="line">    EXPECT_EQ_INT(LEPT_NULL, lept_get_type(&amp;v));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test_parse_root_not_singular</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    lept_value v;</span><br><span class="line">    v.type = LEPT_FALSE;</span><br><span class="line">    EXPECT_EQ_INT(LEPT_PARSE_ROOT_NOT_SINGULAR, lept_parse(&amp;v, <span class="string">&quot;null x&quot;</span>));</span><br><span class="line">    EXPECT_EQ_INT(LEPT_NULL, lept_get_type(&amp;v));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test_parse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    test_parse_null();</span><br><span class="line">    test_parse_expect_value();</span><br><span class="line">    test_parse_invalid_value();</span><br><span class="line">    test_parse_root_not_singular();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    test_parse();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d/%d (%3.2f%%) passed\n&quot;</span>, test_pass, test_count, test_pass * <span class="number">100.0</span> / test_count);</span><br><span class="line">    <span class="keyword">return</span> main_ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="ä¸ƒã€æ€»ç»“ä¸ç»ƒä¹ ç­”æ¡ˆ"><a href="#ä¸ƒã€æ€»ç»“ä¸ç»ƒä¹ ç­”æ¡ˆ" class="headerlink" title="ä¸ƒã€æ€»ç»“ä¸ç»ƒä¹ ç­”æ¡ˆ"></a>ä¸ƒã€æ€»ç»“ä¸ç»ƒä¹ ç­”æ¡ˆ</h1><p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•é…ç½®ä¸€ä¸ªç¼–ç¨‹ç¯å¢ƒï¼Œå•å…ƒæµ‹è¯•çš„é‡è¦æ€§ï¼Œå’Œä¸€ä¸ª JSON è§£æå™¨çš„å­é›†å®ç°ã€‚</p>
<ol>
<li>è¡¥å……leptjson.cçš„å†…å®¹ï¼Œä½¿å…³äº <code>LEPT_PARSE_ROOT_NOT_SINGULAR</code> çš„å•å…ƒæµ‹è¯•æˆåŠŸï¼Œè‹¥ json åœ¨ä¸€ä¸ªå€¼ä¹‹åï¼Œç©ºç™½ä¹‹åè¿˜æœ‰å…¶å®ƒå­—ç¬¦ï¼Œåˆ™è¦è¿”å› <code>LEPT_PARSE_ROOT_NOT_SINGULAR</code>ã€‚</li>
</ol>
<p>å•å…ƒæµ‹è¯•å¤±è´¥çš„æ˜¯è¿™ä¸€è¡Œï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPECT_EQ_INT(LEPT_PARSE_ROOT_NOT_SINGULAR, lept_parse(&amp;v, <span class="string">&quot;null x&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä» JSON è¯­æ³•å‘ç°ï¼ŒJSON æ–‡æœ¬åº”è¯¥æœ‰ 3 éƒ¨åˆ†ï¼š</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">JSON</span>-<span class="type">text</span> = ws <span class="keyword">value</span> ws</span><br></pre></td></tr></table></figure>

<p>ä½†åŸæ¥çš„ <code>lept_parse()</code> åªå¤„ç†äº†å‰ä¸¤éƒ¨åˆ†ã€‚æˆ‘ä»¬åªéœ€è¦åŠ å…¥ç¬¬ä¸‰éƒ¨åˆ†ï¼Œè§£æç©ºç™½ï¼Œç„¶åæ£€æŸ¥ JSON æ–‡æœ¬æ˜¯å¦å®Œç»“ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lept_parse</span><span class="params">(lept_value* v, <span class="keyword">const</span> <span class="keyword">char</span>* json)</span> </span>&#123;</span><br><span class="line">    lept_context c;</span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line">    assert(v != <span class="literal">NULL</span>);</span><br><span class="line">    c.json = json;</span><br><span class="line">    v-&gt;type = LEPT_NULL;</span><br><span class="line">    lept_parse_whitespace(&amp;c);</span><br><span class="line">    <span class="keyword">if</span> ((ret = lept_parse_value(&amp;c, v)) == LEPT_PARSE_OK) &#123;</span><br><span class="line">        lept_parse_whitespace(&amp;c);</span><br><span class="line">        <span class="keyword">if</span> (*c.json != <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">            ret = LEPT_PARSE_ROOT_NOT_SINGULAR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ol start="2">
<li>å‚è€ƒ <code>test_parse_null()</code>ï¼ŒåŠ å…¥ <code>test_parse_true()</code>ã€<code>test_parse_false()</code> å•å…ƒæµ‹è¯•ã€‚å‚è€ƒ <code>lept_parse_null()</code> çš„å®ç°å’Œè°ƒç”¨æ–¹ï¼Œè§£æ true å’Œ false å€¼ã€‚</li>
</ol>
<p>åªéœ€å‚è€ƒ <code>test_parse_null()</code> åŠ å…¥ä¸¤ä¸ªæµ‹è¯•å‡½æ•°ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test_parse_true</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    lept_value v;</span><br><span class="line">    v.type = LEPT_FALSE;</span><br><span class="line">    EXPECT_EQ_INT(LEPT_PARSE_OK, lept_parse(&amp;v, <span class="string">&quot;true&quot;</span>));</span><br><span class="line">    EXPECT_EQ_INT(LEPT_TRUE, lept_get_type(&amp;v));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test_parse_false</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    lept_value v;</span><br><span class="line">    v.type = LEPT_TRUE;</span><br><span class="line">    EXPECT_EQ_INT(LEPT_PARSE_OK, lept_parse(&amp;v, <span class="string">&quot;false&quot;</span>));</span><br><span class="line">    EXPECT_EQ_INT(LEPT_FALSE, lept_get_type(&amp;v));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test_parse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    test_parse_null();</span><br><span class="line">    test_parse_true();</span><br><span class="line">    test_parse_false();</span><br><span class="line">    test_parse_expect_value();</span><br><span class="line">    test_parse_invalid_value();</span><br><span class="line">    test_parse_root_not_singular();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†è¦è®°å¾—åœ¨ä¸Šä¸€çº§çš„æµ‹è¯•å‡½æ•° <code>test_parse()</code> è°ƒç”¨è¿™å‡½æ•°ï¼Œå¦åˆ™ä¼šä¸èµ·ä½œç”¨ã€‚è¿˜å¥½å¦‚æœæˆ‘ä»¬è®°å¾—ç”¨ <code>static</code> ä¿®é¥°è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šå‘å‡ºè­¦å‘Šï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test.c:30:13: warning: unused <span class="keyword">function</span> <span class="string">&#x27;test_parse_true&#x27;</span> [-Wunused-function]</span><br><span class="line">static void <span class="function"><span class="title">test_parse_true</span></span>() &#123;</span><br><span class="line">            ^</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒ <code>lept_parse_null()</code>ï¼Œå†å†™ä¸¤ä¸ªå‡½æ•°ï¼Œç„¶ååœ¨ <code>lept_parse_value</code> æŒ‰é¦–å­—ç¬¦åˆ†æ´¾ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lept_parse_true</span><span class="params">(lept_context* c, lept_value* v)</span> </span>&#123;</span><br><span class="line">    EXPECT(c, <span class="string">&#x27;t&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (c-&gt;json[<span class="number">0</span>] != <span class="string">&#x27;r&#x27;</span> || c-&gt;json[<span class="number">1</span>] != <span class="string">&#x27;u&#x27;</span> || c-&gt;json[<span class="number">2</span>] != <span class="string">&#x27;e&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> LEPT_PARSE_INVALID_VALUE;</span><br><span class="line">    c-&gt;json += <span class="number">3</span>;</span><br><span class="line">    v-&gt;type = LEPT_TRUE;</span><br><span class="line">    <span class="keyword">return</span> LEPT_PARSE_OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lept_parse_false</span><span class="params">(lept_context* c, lept_value* v)</span> </span>&#123;</span><br><span class="line">    EXPECT(c, <span class="string">&#x27;f&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (c-&gt;json[<span class="number">0</span>] != <span class="string">&#x27;a&#x27;</span> || c-&gt;json[<span class="number">1</span>] != <span class="string">&#x27;l&#x27;</span> || c-&gt;json[<span class="number">2</span>] != <span class="string">&#x27;s&#x27;</span> || c-&gt;json[<span class="number">3</span>] != <span class="string">&#x27;e&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> LEPT_PARSE_INVALID_VALUE;</span><br><span class="line">    c-&gt;json += <span class="number">4</span>;</span><br><span class="line">    v-&gt;type = LEPT_FALSE;</span><br><span class="line">    <span class="keyword">return</span> LEPT_PARSE_OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lept_parse_value</span><span class="params">(lept_context* c, lept_value* v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (*c-&gt;json) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;t&#x27;</span>:  <span class="keyword">return</span> lept_parse_true(c, v);</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;f&#x27;</span>:  <span class="keyword">return</span> lept_parse_false(c, v);</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;n&#x27;</span>:  <span class="keyword">return</span> lept_parse_null(c, v);</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;\0&#x27;</span>: <span class="keyword">return</span> LEPT_PARSE_EXPECT_VALUE;</span><br><span class="line">        <span class="keyword">default</span>:   <span class="keyword">return</span> LEPT_PARSE_INVALID_VALUE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶å®è¿™ 3 ç§ç±»å‹éƒ½æ˜¯è§£æå­—é¢é‡ï¼Œå¯ä»¥ä½¿ç”¨å•ä¸€ä¸ªå‡½æ•°å®ç°ï¼Œä¾‹å¦‚ç”¨è¿™ç§æ–¹å¼è°ƒç”¨ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">&#x27;n&#x27;</span>: <span class="keyword">return</span> lept_parse_literal(c, v, <span class="string">&quot;null&quot;</span>, LEPT_NULL);</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å¯ä»¥å‡å°‘ä¸€äº›é‡å¤ä»£ç ï¼Œä¸è¿‡å¯èƒ½æœ‰å°‘è®¸é¢å¤–æ€§èƒ½å¼€é”€ã€‚</p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a type="button" class="btn btn-default disabled"><i class="fa fa-arrow-circle-o-left"></i>ä¸Šä¸€é¡µ</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2021/how-to-write-specification/" type="button" class="btn btn-default ">ä¸‹ä¸€é¡µ<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>
	
	<!-- comment -->
	<!-- 
<section id="comment">
    <h2 class="title">ç•™è¨€</h2>

    
</section>
 -->


    <section id="comment">
        <h2 class="title">
            ç•™è¨€
        </h2>
        <div id="vcomments"></div>
        <script>
            new Valine({
                el: '#vcomments',
                appId: '8FWjWdEoyYxwoFgc2ET6DcSh-gzGzoHsz',
                appKey: 'DqH3LDGq73YqdepEDCcPgWhl',
                visitor: true,
                // avatar: 'hide',
                avatar: 'retro',
                // è¿™é‡Œè®¾ç½®CDN, é»˜è®¤å¾®åšè¡¨æƒ…CDN
                // emojiCDN: 'https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/',
                // // è¡¨æƒ…titleå’Œå›¾ç‰‡æ˜ å°„
                // emojiMaps: {
                //     "smile": "e3/2018new_weixioa02_org.png",
                //     "lovely": "09/2018new_keai_org.png",
                //     // ... æ›´å¤šè¡¨æƒ…
                // }
            })
        </script>
    </section>


    <style type="text/css">
        h2.title {
            font-size: 25px;
            margin-bottom: 27px;
        }

        .v[data-class=v] .vwrap {
            border: 3px solid #f0f0f0;
        }
    
        .v[data-class=v] .vwrap .vheader .vinput {
            border-bottom: 1.8px dashed #f5f5f5;
            color: #bebaba;
            font-size: 17px;
        }

        .v[data-class=v] .veditor {
            font-size: 1.2em;
            color: #b5b5b5;
        }

        .v[data-class=v] .vrow .vcol {
            
            font-size: 17px;
        }

        .v[data-class=v] .vicon {
            fill: #bebebe;
        }

        .v[data-class=v] .vrow {
            font-size: 0;
            padding: 10px 0 0;
        }

        .v[data-class=v] .vbtn {
            color: #d0cdcd;
        }
        
        .v[data-class=v] .vsys {
            padding: 0em 0em;
        }

        .v[data-class=v] .vcards .vcard {
            padding-top: 0em;
        }

        .v[data-class=v] p {
            margin-bottom: 0;
            color: #c0c0c0;
        }

        a:hover {
            font-weight: 800 !important;
        }

        .v[data-class=v] a:hover{
            color: #c66400;
            background: bottom !important;
        }

        .v[data-class=v] a.vnick:hover{
            color: #c66400 !important;
            background: bottom !important;
        }

        .v[data-class=v] .vwrap .vheader .vinput:focus {
            border-bottom-color: #ff7c29;
        }

    </style>





	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2021-07-10 
	</div>
	
	<span id="busuanzi_container_page_pv">
		<i class="fa fa-eye"></i>
  		<span id="busuanzi_value_page_pv"></span>
    </span>

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/é¡¹ç›®/">é¡¹ç›®<span>1</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/json/">json<span>1</span></a></li>
  
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#JSON%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-article-text">JSONæ˜¯ä»€ä¹ˆ</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E7%9B%AE%E6%A0%87%EF%BC%9A%E7%AE%80%E5%8D%95%E8%80%8C%E5%9F%BA%E6%9C%AC"><span class="toc-article-text">ç›®æ ‡ï¼šç®€å•è€ŒåŸºæœ¬</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E5%BC%80%E5%A7%8B%EF%BC%9Afork%E9%A1%B9%E7%9B%AE%E8%87%AA%E5%B7%B1%E5%81%9A"><span class="toc-article-text">å¼€å§‹ï¼šforké¡¹ç›®è‡ªå·±åš</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E4%B8%80%E3%80%81%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-article-text">ä¸€ã€ç¼–è¯‘ç¯å¢ƒæ­å»º</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E4%BA%8C%E3%80%81%E5%A4%B4%E6%96%87%E4%BB%B6%E4%B8%8EAPI%E8%AE%BE%E8%AE%A1"><span class="toc-article-text">äºŒã€å¤´æ–‡ä»¶ä¸APIè®¾è®¡</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E4%B8%89%E3%80%81JSON-%E8%AF%AD%E6%B3%95%E5%AD%90%E9%9B%86"><span class="toc-article-text">ä¸‰ã€JSON è¯­æ³•å­é›†</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E5%9B%9B%E3%80%81%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-article-text">å››ã€å•å…ƒæµ‹è¯•</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%AE%8F%E7%9A%84%E7%BC%96%E5%86%99%E6%8A%80%E5%B7%A7-EXPECT-EQ-BASE%E8%A7%A3%E6%9E%90"><span class="toc-article-text">å®çš„ç¼–å†™æŠ€å·§: EXPECT_EQ_BASEè§£æ</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E4%BA%94%E3%80%81%E5%AE%9E%E7%8E%B0%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="toc-article-text">äº”ã€å®ç°è§£æå™¨</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E5%85%AD%E3%80%81%E6%9C%AC%E5%8D%95%E5%85%83%E6%96%87%E4%BB%B6%E5%AE%8C%E6%95%B4%E5%86%85%E5%AE%B9"><span class="toc-article-text">å…­ã€æœ¬å•å…ƒæ–‡ä»¶å®Œæ•´å†…å®¹</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E4%B8%83%E3%80%81%E6%80%BB%E7%BB%93%E4%B8%8E%E7%BB%83%E4%B9%A0%E7%AD%94%E6%A1%88"><span class="toc-article-text">ä¸ƒã€æ€»ç»“ä¸ç»ƒä¹ ç­”æ¡ˆ</span></a></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2021 AYu
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br>     
     <span id="busuanzi_container_site_pv">
    	ğŸ‘€: <span id="busuanzi_value_site_pv"></span>    |   ğŸ™‹: <span id="busuanzi_value_site_uv"></span>
	</span>
</p>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>â¬†ï¸TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
